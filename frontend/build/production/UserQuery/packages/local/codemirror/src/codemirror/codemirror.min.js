var $jscomp={};$jscomp.scope={};$jscomp.defineProperty=typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=(a);if(a.get||a.set){throw new TypeError('ES3 does not support getters and setters.')}if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(c,b,a){var d=this.length;c=Number(c);b=Number(b);a=Number(a!=null?a:d);if(c<b){a=Math.min(a,d);while(b<a){if(b in this){this[c++]=this[b++]}else {delete this[c++];b++}}}else {a=Math.min(a,d+b-c);c+=a-b;while(a>b){if(--a in this){this[--c]=this[a]}else {delete this[c]}}}return this};return b},'es6-impl','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global.Symbol){$jscomp.global.Symbol=$jscomp.Symbol}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return ($jscomp.SYMBOL_PREFIX+(a||'')+$jscomp.symbolCounter_++)};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;if(!a){a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global.Symbol.iterator]=function(){return this};return (a)};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a,b){return [a,b]})};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(e,b,a){var c=this.length||0;if(b<0){b=Math.max(0,c+(b))}if(a==null||a>c){a=c}a=Number(a);if(a<0){a=Math.max(0,c+a)}for(var d=Number(b||0);d<a;d++){this[d]=e}return this};return b},'es6-impl','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=(String(a))}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).v};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).i};return b},'es6-impl','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(a,b,f){$jscomp.initSymbolIterator();b=b!=null?b:function(a){return a};var c=[];var e=(a)[Symbol.iterator];if(typeof e=='function'){a=e.call(a);var g;while(!(g=a.next()).done){c.push(b.call((f),g.value))}}else {var h=a.length;for(var d=0;d<h;d++){c.push(b.call((f),a[d]))}}return c};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a){return a})};return b},'es6-impl','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(a){return Array.from(arguments)};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})};return b},'es6','es3');$jscomp.executeAsyncGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(a){if(a.done){b(a.value)}else {Promise.resolve(a.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=(a)[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator((a))};$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new (c)([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if(isConformant()){return c}var a='$jscomp_hidden_'+Math.random().toString().substring(2);function insert(b){if(!$jscomp.owns(b,a)){var c={};$jscomp.defineProperty(b,a,{value:c})}}function patch(a){var b=Object[a];if(b){Object[a]=function(a){insert(a);return b(a)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(a);var b;while(!(b=e.next()).done){var c=b.value;this.set((c[0]),(c[1]))}}};b.prototype.set=function(b,c){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=c;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6-impl','es3');$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.polyfill('Map',function(b){var h=!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(k){return !1}}();if(h){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=new WeakMap();var c=function(){};c.prototype.previous;c.prototype.next;c.prototype.head;c.prototype.key;c.prototype.value;var a=function(a){this.data_={};this.head_=g();this.size=0;if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.set((c[0]),(c[1]))}}};a.prototype.set=function(c,b){var a=d(this,c);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:b};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=b}return this};a.prototype['delete']=function(b){var a=d(this,b);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return !!d(this,a).entry};a.prototype.get=function(b){var a=d(this,b).entry;return (a&&(a.value))};a.prototype.entries=function(){return e(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return e(this,function(a){return a.key})};a.prototype.values=function(){return e(this,function(a){return a.value})};a.prototype.forEach=function(d,c){var e=this.entries();var b;while(!(b=e.next()).done){var a=b.value;d.call((c),(a[1]),(a[0]),this)}};(a.prototype)[Symbol.iterator]=a.prototype.entries;var d=function(f,d){var e=j(d);var a=f.data_[e];if(a&&$jscomp.owns(f.data_,e)){for(var c=0;c<a.length;c++){var b=a[c];if(d!==d&&b.key!==b.key||d===b.key){return {id:e,list:a,index:c,entry:b}}}}return {id:e,list:a,index:-1,entry:undefined}};var e=function(b,c){var a=b.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=b.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:c(a)}}a=null}return {done:!0,value:void 0}})};var g=function(){var a={};a.previous=a.next=a.head=a;return a};var i=0;var j=function(a){var b=a&&typeof a;if(b=='object'||b=='function'){a=(a);if(!f.has(a)){var c=''+ ++i;f.set(a,c);return c}return f.get(a)}return 'p_'+a};return a},'es6-impl','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};return b},'es6-impl','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var e=a;var f=1;var b=a;var c=0;var d=1;while(c!=b){e*=a;d*=-1;b=(c=b)+d*e/++f}return b}return Math.log(1+a)};return b},'es6-impl','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(b){b=Number(b);return (a(b)-a(-b))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(a){if(a===0){return a}a=Number(a);var b=Math.pow(Math.abs(a),1/3);return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(a){a=Number(a)>>>0;if(a===0){return 32}var b=0;if((a&4.29490176E9)===0){a<<=16;b+=16}if((a&4.27819008E9)===0){a<<=8;b+=8}if((a&4.02653184E9)===0){a<<=4;b+=4}if((a&3.221225472E9)===0){a<<=2;b+=2}if((a&2.147483648E9)===0){b++}return b};return b},'es6-impl','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);return (b(a)+b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var d=a;var e=1;var b=a;var c=0;while(c!=b){d*=a/++e;b=(c=b)+d}return b}return Math.exp(a)-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(b,c,g){b=Number(b);c=Number(c);var a,f,e;var d=Math.max(Math.abs(b),Math.abs(c));for(a=2;a<arguments.length;a++){d=Math.max(d,Math.abs(arguments[a]))}if(d>1.0E100||d<1.0E-100){b=b/d;c=c/d;e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a])/d;e+=f*f}return Math.sqrt(e)*d}else {e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a]);e+=f*f}return Math.sqrt(e)}};return b},'es6-impl','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(a,b){a=Number(a);b=Number(b);var e=a>>>16&65535;var c=a&65535;var f=b>>>16&65535;var d=b&65535;var g=e*d+c*f<<16>>>0;return c*d+g|0};return b},'es6-impl','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN10};return b},'es6-impl','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN2};return b},'es6-impl','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(a){a=Number(a);return a===0||isNaN(a)?a:a>0?1:-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);if(a===0){return a}return (b(a)-b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.exp(-2*Math.abs(a));var c=(1-b)/(1+b);return a<0?-c:c};return b},'es6-impl','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(a){a=Number(a);if(isNaN(a)||a===Infinity||a===-Infinity||a===0){return a}var b=Math.floor(Math.abs(a));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6-impl','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(a){if(typeof a!=='number'){return !1}return !isNaN(a)&&a!==Infinity&&a!==-Infinity};return b},'es6-impl','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(a){if(!Number.isFinite(a)){return !1}return a===Math.floor(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(a){return typeof a==='number'&&isNaN(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};return b},'es6-impl','es3');$jscomp.polyfill('Object.assign',function(a){if(a){return a}var b=function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};return b},'es6-impl','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6-impl','es5');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(a,b){if(a===b){return a!==0||1/a===1/(b)}else {return a!==a&&b!==b}};return b},'es6-impl','es3');$jscomp.polyfill('Object.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a};return b},'es6','es5');$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var c=b[a];delete b[a];try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(c){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(c){return function(d){if(!a){a=!0;c.call(b,d)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_((b))}else {if(isObject(b)){this.resolveToNonPromiseObj_((b))}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,(b))}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(c,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+c+', '+a|'): Promise already settled in state'+this.state_)}this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){var b=this.onSettledCallbacks_;for(var a=0;a<b.length;++a){(b[a]).call();b[a]=null}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,c){var a=this.createResolveAndReject_();try{b.call(c,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(e,f){var b;var c;var d=new a(function(a,d){b=a;c=d});function createCallback(a,d){if(typeof a=='function'){return function(d){try{b(a(d))}catch(g){c(g)}}}else {return d}}this.callWhenSettled_(createCallback(e,b),createCallback(f,c));return d};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(c,e){var a=this;function callback(){switch(a.state_){case b.FULFILLED:c(a.result_);break;case b.REJECTED:e(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(function(){d.asyncExecute(callback)})}};a.resolve=function(b){if(b instanceof a){return b}else {return new a(function(a,c){a(b)})}};a.reject=function(b){return new a(function(c,a){a(b)})};a.race=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var c=d.next();!c.done;c=d.next()){a.resolve(c.value).callWhenSettled_(e,f)}})};a.all=function(d){var c=$jscomp.makeIterator(d);var b=c.next();if(b.done){return a.resolve([])}else {return new a(function(f,g){var d=[];var e=0;function onFulfilled(a){return function(b){d[a]=b;e--;if(e==0){f(d)}}}do{d.push(undefined);e++;a.resolve(b.value).callWhenSettled_(onFulfilled(d.length-1),g);b=c.next()}while(!b.done)})}};if($jscomp.EXPOSE_ASYNC_EXECUTOR){a['$jscomp$new$AsyncExecutor']=function(){return new AsyncExecutor()}}return a},'es6-impl','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(d,b,a){return c.call(d,b,a)};return b},'es6','es3');$jscomp.polyfill('Reflect.construct',function(a){if(a){return a}var b=function(b,d,a){if(a===undefined){a=b}var e=a.prototype||Object.prototype;var c=Object.create(e);var f=Reflect.apply(b,c,d);return f||c};return b},'es6','es5');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(d,c,b){try{Object.defineProperty(d,c,b);var a=Object.getOwnPropertyDescriptor(d,c);if(!a){return !1}return a.configurable===(b.configurable||!1)&&a.enumerable===(b.enumerable||!1)&&('value' in a?a.value===b.value&&a.writable===(b.writable||!1):a.get===b.get&&a.set===b.set)}catch(e){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(b,a){if(!$jscomp.owns(b,a)){return !0}try{return delete b[a]}catch(c){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(c,b,d){if(arguments.length<=2){return c[b]}var a=$jscomp.findDescriptor(c,b);if(a){return a.get?a.get.call(d):a.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(b,a){return a in b};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if(typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(b){return b.substring(0,a.length)==a}var c=function(d){var e=[];var b=Object.getOwnPropertyNames(d);var c=Object.getOwnPropertySymbols(d);for(var a=0;a<b.length;a++){(isSymbol(b[a])?c:e).push(b[a])}return e.concat(c)};return c},'es6','es5');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(typeof Object.preventExtensions!='function'){return function(){return !1}}var b=function(a){Object.preventExtensions(a);return !Object.isExtensible(a)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(a,c,d,e){var b=$jscomp.findDescriptor(a,c);if(!b){if(Reflect.isExtensible(a)){a[c]=d;return !0}return !1}if(b.set){b.set.call(arguments.length>3?e:a,d);return !0}else {if(b.writable&&!Object.isFrozen(a)){a[c]=d;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){try{a.__proto__=b;return a.__proto__===b}catch(c){return !1}};return b},'es6','es5');$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.polyfill('Set',function(b){var c=!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}();if(c){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.add(c)}}this.size=this.map_.size};a.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(b){var a=this.map_['delete'](b);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};(a.prototype)[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(b,a){var c=this;this.map_.forEach(function(d){return b.call((a),d,d,c)})};return a},'es6-impl','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(a){var d=$jscomp.checkStringArgs(this,null,'codePointAt');var e=d.length;a=Number(a)||0;if(!(a>=0&&a<e)){return void 0}a=a|0;var b=d.charCodeAt(a);if(b<55296||b>56319||a+1===e){return b}var c=d.charCodeAt(a+1);if(c<56320||c>57343){return b}return (b-55296)*1024+c+9216};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'endsWith');a=a+'';if(b===void 0){b=c.length}var e=Math.max(0,Math.min(b|0,c.length));var d=a.length;while(d>0&&e>0){if(c[--e]!=a[--d]){return !1}}return d<=0};return b},'es6-impl','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(d){var b='';for(var c=0;c<arguments.length;c++){var a=Number(arguments[c]);if(a<0||a>1114111||a!==Math.floor(a)){throw new RangeError('invalid_code_point '+a)}if(a<=65535){b+=String.fromCharCode(a)}else {a-=65536;b+=String.fromCharCode(a>>>10&1023|55296);b+=String.fromCharCode(a&1023|56320)}}return b};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'includes');return c.indexOf(a,b||0)!==-1};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(a){var b=$jscomp.checkStringArgs(this,null,'repeat');if(a<0||a>1342177279){throw new RangeError('Invalid count value')}a=a|0;var c='';while(a){if(a&1){c+=b}if(a>>>=1){b+=b}}return c};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(a,f){var b=$jscomp.checkStringArgs(this,a,'startsWith');a=a+'';var g=b.length;var d=a.length;var e=Math.max(0,Math.min((f)|0,b.length));var c=0;while(c<d&&e<g){if(b[e++]!=a[c++]){return !1}}return c>=d};return b},'es6-impl','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){function tempCtor(){}tempCtor.prototype=b.prototype;a.prototype=new tempCtor();a.prototype.constructor=a;for(var c in b){if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}};$jscomp.polyfill('WeakSet',function(b){function isConformant(){if(!b||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var a=new (b)([c]);if(!a.has(c)||a.has(d)){return !1}a['delete'](c);a.add(d);return !a.has(c)&&a.has(d)}catch(e){return !1}}if(isConformant()){return b}var a=function(a){this.map_=new WeakMap();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=b.value;this.add(c)}}};a.prototype.add=function(a){this.map_.set(a,!0);return this};a.prototype.has=function(a){return this.map_.has(a)};a.prototype['delete']=function(a){return this.map_['delete'](a)};return a},'es6-impl','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}(function(b,a){typeof exports==='object'&&typeof module!=='undefined'?module.exports=a():typeof define==='function'&&define.amd?define(a):b.CodeMirror=a()})(this,function(){var i=navigator.userAgent;var az=navigator.platform;var v=/gecko\/\d/i.test(i);var av=/MSIE \d/.test(i);var aA=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(i);var S=/Edge\/(\d+)/.exec(i);var b=av||aA||S;var e=b&&(av?document.documentMode||6:+(S||aA)[1]);var h=!S&&/WebKit\//.test(i);var aR=h&&/Qt\/\d+\.\d+/.test(i);var aa=!S&&/Chrome\//.test(i);var n=/Opera\//.test(i);var aB=/Apple Computer/.test(navigator.vendor);var aF=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(i);var aS=/PhantomJS/.test(i);var U=!S&&/AppleWebKit/.test(i)&&/Mobile\/\w+/.test(i);var _=/Android/.test(i);var R=U||_||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(i);var o=U||/Mac/.test(az);var aP=/\bCrOS\b/.test(i);var aU=/win/i.test(az);var x=n&&i.match(/Version\/(\d*\.\d*)/);if(x){x=Number(x[1])}if(x&&x>=15){n=!1;h=!0}var as=o&&(aR||n&&(x==null||x<12.11));var ae=v||b&&e>=9;function classTest(a){return new RegExp('(^|\\s)'+a+'(?:$|\\s)\\s*')}var A=function(d,e){var b=d.className;var a=classTest(e).exec(b);if(a){var c=b.slice(a.index+a[0].length);d.className=b.slice(0,a.index)+(c?a[1]+c:'')}};function removeChildren(a){for(var b=a.childNodes.length;b>0;--b){a.removeChild(a.firstChild)}return a}function removeChildrenAndAdd(a,b){return removeChildren(a).appendChild(b)}function elt(f,a,d,e){var b=document.createElement(f);if(d){b.className=d}if(e){b.style.cssText=e}if(typeof a=='string'){b.appendChild(document.createTextNode(a))}else {if(a){for(var c=0;c<a.length;++c){b.appendChild(a[c])}}}return b}function eltP(e,c,b,d){var a=elt(e,c,b,d);a.setAttribute('role','presentation');return a}var B;if(document.createRange){B=function(b,d,e,c){var a=document.createRange();a.setEnd(c||b,e);a.setStart(b,d);return a}}else {B=function(c,b,d){var a=document.body.createTextRange();try{a.moveToElementText(c.parentNode)}catch(aV){return a}a.collapse(!0);a.moveEnd('character',d);a.moveStart('character',b);return a}}function contains(b,a){if(a.nodeType==3){a=a.parentNode}if(b.contains){return b.contains(a)}do{if(a.nodeType==11){a=a.host}if(a==b){return !0}}while(a=a.parentNode)}function activeElt(){var a;try{a=document.activeElement}catch(aV){a=document.body||null}while(a&&a.shadowRoot&&a.shadowRoot.activeElement){a=a.shadowRoot.activeElement}return a}function addClass(b,c){var a=b.className;if(!classTest(c).test(a)){b.className+=(a?' ':'')+c}}function joinClasses(d,c){var b=d.split(' ');for(var a=0;a<b.length;a++){if(b[a]&&!classTest(b[a]).test(c)){c+=' '+b[a]}}return c}var L=function(a){a.select()};if(U){L=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}}else {if(b){L=function(a){try{a.select()}catch(aV){}}}}function bind(b){var a=Array.prototype.slice.call(arguments,1);return function(){return b.apply(null,a)}}function copyObj(c,a,d){if(!a){a={}}for(var b in c){if(c.hasOwnProperty(b)&&(d!==!1||!a.hasOwnProperty(b))){a[b]=c[b]}}return a}function countColumn(e,a,f,g,h){if(a==null){a=e.search(/[^\s\u00a0]/);if(a==-1){a=e.length}}for(var c=g||0,d=h||0;;){var b=e.indexOf('\t',c);if(b<0||b>=a){return d+(a-c)}d+=b-c;d+=f-d%f;c=b+1}}var z=function(){this.id=null};z.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};function indexOf(b,c){for(var a=0;a<b.length;++a){if(b[a]==c){return a}}return -1}var at=30;var ab={toString:function(){return 'CodeMirror.Pass'}};var p={scroll:!1};var am={origin:'*mouse'};var Q={origin:'+move'};function findColumn(d,e,g){for(var c=0,b=0;;){var a=d.indexOf('\t',c);if(a==-1){a=d.length}var f=a-c;if(a==d.length||b+f>=e){return c+Math.min(f,e-b)}b+=a-c;b+=g-b%g;c=a+1;if(b>=e){return c}}}var $=[''];function spaceStr(a){while($.length<=a){$.push(lst($)+' ')}return $[a]}function lst(a){return a[a.length-1]}function map(b,d){var c=[];for(var a=0;a<b.length;a++){c[a]=d(b[a],a)}return c}function insertSorted(b,d,c){var a=0,e=c(d);while(a<b.length&&c(b[a])<=e){a++}b.splice(a,0,d)}function nothing(){}function createObj(c,b){var a;if(Object.create){a=Object.create(c)}else {nothing.prototype=c;a=new nothing()}if(b){copyObj(b,a)}return a}var aD=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(a){return /\w/.test(a)||a>''&&(a.toUpperCase()!=a.toLowerCase()||aD.test(a))}function isWordChar(b,a){if(!a){return isWordCharBasic(b)}if(a.source.indexOf('\\w')>-1&&isWordCharBasic(b)){return !0}return a.test(b)}function isEmpty(a){for(var b in a){if(a.hasOwnProperty(b)&&a[b]){return !1}}return !0}var aI=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(a){return a.charCodeAt(0)>=768&&aI.test(a)}function skipExtendingChars(c,a,b){while((b<0?a>0:a<c.length)&&isExtendingChar(c.charAt(a))){a+=b}return a}function findFirst(e,a,c){var f=a>c?-1:1;for(;;){if(a==c){return a}var d=(a+c)/2,b=f<0?Math.ceil(d):Math.floor(d);if(b==a){return e(b)?a:c}if(e(b)){c=b}else {a=b+f}}}function Display(c,f,d){var a=this;this.input=d;a.scrollbarFiller=elt('div',null,'CodeMirror-scrollbar-filler');a.scrollbarFiller.setAttribute('cm-not-content','true');a.gutterFiller=elt('div',null,'CodeMirror-gutter-filler');a.gutterFiller.setAttribute('cm-not-content','true');a.lineDiv=eltP('div',null,'CodeMirror-code');a.selectionDiv=elt('div',null,null,'position: relative; z-index: 1');a.cursorDiv=elt('div',null,'CodeMirror-cursors');a.measure=elt('div',null,'CodeMirror-measure');a.lineMeasure=elt('div',null,'CodeMirror-measure');a.lineSpace=eltP('div',[a.measure,a.lineMeasure,a.selectionDiv,a.cursorDiv,a.lineDiv],null,'position: relative; outline: none');var g=eltP('div',[a.lineSpace],'CodeMirror-lines');a.mover=elt('div',[g],null,'position: relative');a.sizer=elt('div',[a.mover],'CodeMirror-sizer');a.sizerWidth=null;a.heightForcer=elt('div',null,null,'position: absolute; height: '+at+'px; width: 1px;');a.gutters=elt('div',null,'CodeMirror-gutters');a.lineGutter=null;a.scroller=elt('div',[a.sizer,a.heightForcer,a.gutters],'CodeMirror-scroll');a.scroller.setAttribute('tabIndex','-1');a.wrapper=elt('div',[a.scrollbarFiller,a.gutterFiller,a.scroller],'CodeMirror');if(b&&e<8){a.gutters.style.zIndex=-1;a.scroller.style.paddingRight=0}if(!h&&!(v&&R)){a.scroller.draggable=!0}if(c){if(c.appendChild){c.appendChild(a.wrapper)}else {c(a.wrapper)}}a.viewFrom=a.viewTo=f.first;a.reportedViewFrom=a.reportedViewTo=f.first;a.view=[];a.renderedView=null;a.externalMeasured=null;a.viewOffset=0;a.lastWrapHeight=a.lastWrapWidth=0;a.updateLineNumbers=null;a.nativeBarWidth=a.barHeight=a.barWidth=0;a.scrollbarsClipped=!1;a.lineNumWidth=a.lineNumInnerWidth=a.lineNumChars=null;a.alignWidgets=!1;a.cachedCharWidth=a.cachedTextHeight=a.cachedPaddingH=null;a.maxLine=null;a.maxLineLength=0;a.maxLineChanged=!1;a.wheelDX=a.wheelDY=a.wheelStartX=a.wheelStartY=null;a.shift=!1;a.selForContextMenu=null;a.activeTouch=null;d.init(a)}function getLine(c,a){a-=c.first;if(a<0||a>=c.size){throw new Error('There is no line '+(a+c.first)+' in the document.')}var b=c;while(!b.lines){for(var f=0;;++f){var d=b.children[f],e=d.chunkSize();if(a<e){b=d;break}a-=e}}return b.lines[a]}function getBetween(e,a,b){var d=[],c=a.line;e.iter(a.line,b.line+1,function(f){var e=f.text;if(c==b.line){e=e.slice(0,b.ch)}if(c==a.line){e=e.slice(a.ch)}d.push(e);++c});return d}function getLines(c,b,d){var a=[];c.iter(b,d,function(b){a.push(b.text)});return a}function updateLineHeight(c,d){var b=d-c.height;if(b){for(var a=c;a;a=a.parent){a.height+=b}}}function lineNo(c){if(c.parent==null){return null}var b=c.parent,e=indexOf(b.lines,c);for(var a=b.parent;a;b=a,a=a.parent){for(var d=0;;++d){if(a.children[d]==b){break}e+=a.children[d].chunkSize()}}return e+b.first}function lineAtHeight(a,b){var f=a.first;outer: do{for(var e=0;e<a.children.length;++e){var d=a.children[e],g=d.height;if(b<g){a=d;continue outer}b-=g;f+=d.chunkSize()}return f}while(!a.lines);var c=0;for(;c<a.lines.length;++c){var i=a.lines[c],h=i.height;if(b<h){break}b-=h}return f+c}function isLine(a,b){return b>=a.first&&b<a.first+a.size}function lineNumberFor(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function Pos(b,c,a){if(a===void 0){a=null}if(!(this instanceof Pos)){return new Pos(b,c,a)}this.line=b;this.ch=c;this.sticky=a}function cmp(a,b){return a.line-b.line||a.ch-b.ch}function equalCursorPos(a,b){return a.sticky==b.sticky&&cmp(a,b)==0}function copyPos(a){return Pos(a.line,a.ch)}function maxPos(a,b){return cmp(a,b)<0?b:a}function minPos(a,b){return cmp(a,b)<0?a:b}function clipLine(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function clipPos(a,b){if(b.line<a.first){return Pos(a.first,0)}var c=a.first+a.size-1;if(b.line>c){return Pos(c,getLine(a,c).text.length)}return clipToLen(b,getLine(a,b.line).text.length)}function clipToLen(a,c){var b=a.ch;if(b==null||b>c){return Pos(a.line,c)}else {if(b<0){return Pos(a.line,0)}else {return a}}}function clipPosArray(d,b){var c=[];for(var a=0;a<b.length;a++){c[a]=clipPos(d,b[a])}return c}var ap=!1;var s=!1;function seeReadOnlySpans(){ap=!0}function seeCollapsedSpans(){s=!0}function MarkedSpan(a,b,c){this.marker=a;this.from=b;this.to=c}function getMarkedSpanFor(a,d){if(a){for(var b=0;b<a.length;++b){var c=a[b];if(c.marker==d){return c}}}}function removeMarkedSpan(b,d){var c;for(var a=0;a<b.length;++a){if(b[a]!=d){(c||(c=[])).push(b[a])}}return c}function addMarkedSpan(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b];b.marker.attachLine(a)}function markedSpansBefore(d,b,i){var e;if(d){for(var f=0;f<d.length;++f){var a=d[f],c=a.marker;var g=a.from==null||(c.inclusiveLeft?a.from<=b:a.from<b);if(g||a.from==b&&c.type=='bookmark'&&(!i||!a.marker.insertLeft)){var h=a.to==null||(c.inclusiveRight?a.to>=b:a.to>b);(e||(e=[])).push(new MarkedSpan(c,a.from,h?null:a.to))}}}return e}function markedSpansAfter(d,b,i){var e;if(d){for(var f=0;f<d.length;++f){var a=d[f],c=a.marker;var h=a.to==null||(c.inclusiveRight?a.to>=b:a.to>b);if(h||a.from==b&&c.type=='bookmark'&&(!i||a.marker.insertLeft)){var g=a.from==null||(c.inclusiveLeft?a.from<=b:a.from<b);(e||(e=[])).push(new MarkedSpan(c,g?null:a.from-b,a.to==null?null:a.to-b))}}}return e}function stretchSpansOverChange(h,b){if(b.full){return null}var q=isLine(h,b.from.line)&&getLine(h,b.from.line).markedSpans;var r=isLine(h,b.to.line)&&getLine(h,b.to.line).markedSpans;if(!q&&!r){return null}var l=b.from.ch,v=b.to.ch,p=cmp(b.from,b.to)==0;var a=markedSpansBefore(q,l,p);var c=markedSpansAfter(r,v,p);var e=b.text.length==1,f=lst(b.text).length+(e?l:0);if(a){for(var o=0;o<a.length;++o){var g=a[o];if(g.to==null){var m=getMarkedSpanFor(c,g.marker);if(!m){g.to=l}else {if(e){g.to=m.to==null?null:m.to+f}}}}}if(c){for(var n=0;n<c.length;++n){var d=c[n];if(d.to!=null){d.to+=f}if(d.from==null){var u=getMarkedSpanFor(a,d.marker);if(!u){d.from=f;if(e){(a||(a=[])).push(d)}}}else {d.from+=f;if(e){(a||(a=[])).push(d)}}}}if(a){a=clearEmptySpans(a)}if(c&&c!=a){c=clearEmptySpans(c)}var k=[a];if(!e){var s=b.text.length-2,j;if(s>0&&a){for(var i=0;i<a.length;++i){if(a[i].to==null){(j||(j=[])).push(new MarkedSpan(a[i].marker,null,null))}}}for(var t=0;t<s;++t){k.push(j)}k.push(c)}return k}function clearEmptySpans(a){for(var c=0;c<a.length;++c){var b=a[c];if(b.from!=null&&b.from==b.to&&b.marker.clearWhenEmpty!==!1){a.splice(c--,1)}}if(!a.length){return null}return a}function removeReadOnlyRanges(m,j,l){var a=null;m.iter(j.line,l.line+1,function(b){if(b.markedSpans){for(var d=0;d<b.markedSpans.length;++d){var c=b.markedSpans[d].marker;if(c.readOnly&&(!a||indexOf(a,c)==-1)){(a||(a=[])).push(c)}}}});if(!a){return null}var d=[{from:j,to:l}];for(var h=0;h<a.length;++h){var g=a[h],b=g.find(0);for(var e=0;e<d.length;++e){var c=d[e];if(cmp(c.to,b.from)<0||cmp(c.from,b.to)>0){continue}var f=[e,1],i=cmp(c.from,b.from),k=cmp(c.to,b.to);if(i<0||!g.inclusiveLeft&&!i){f.push({from:c.from,to:b.from})}if(k>0||!g.inclusiveRight&&!k){f.push({from:b.to,to:c.to})}d.splice.apply(d,f);e+=f.length-3}}return d}function detachMarkedSpans(b){var a=b.markedSpans;if(!a){return}for(var c=0;c<a.length;++c){a[c].marker.detachLine(b)}b.markedSpans=null}function attachMarkedSpans(c,a){if(!a){return}for(var b=0;b<a.length;++b){a[b].marker.attachLine(c)}c.markedSpans=a}function extraLeft(a){return a.inclusiveLeft?-1:0}function extraRight(a){return a.inclusiveRight?1:0}function compareCollapsedMarkers(a,b){var d=a.lines.length-b.lines.length;if(d!=0){return d}var f=a.find(),g=b.find();var c=cmp(f.from,g.from)||extraLeft(a)-extraLeft(b);if(c){return -c}var e=cmp(f.to,g.to)||extraRight(a)-extraRight(b);if(e){return e}return b.id-a.id}function collapsedSpanAtSide(f,e){var c=s&&f.markedSpans,b;if(c){for(var a=void 0,d=0;d<c.length;++d){a=c[d];if(a.marker.collapsed&&(e?a.from:a.to)==null&&(!b||compareCollapsedMarkers(b,a.marker)<0)){b=a.marker}}}return b}function collapsedSpanAtStart(a){return collapsedSpanAtSide(a,!0)}function collapsedSpanAtEnd(a){return collapsedSpanAtSide(a,!1)}function conflictingCollapsedRange(l,j,e,g,d){var k=getLine(l,j);var f=s&&k.markedSpans;if(f){for(var h=0;h<f.length;++h){var b=f[h];if(!b.marker.collapsed){continue}var a=b.marker.find(0);var c=cmp(a.from,e)||extraLeft(b.marker)-extraLeft(d);var i=cmp(a.to,g)||extraRight(b.marker)-extraRight(d);if(c>=0&&i<=0||c<=0&&i>=0){continue}if(c<=0&&(b.marker.inclusiveRight&&d.inclusiveLeft?cmp(a.to,e)>=0:cmp(a.to,e)>0)||c>=0&&(b.marker.inclusiveRight&&d.inclusiveLeft?cmp(a.from,g)<=0:cmp(a.from,g)<0)){return !0}}}}function visualLine(a){var b;while(b=collapsedSpanAtStart(a)){a=b.find(-1,!0).line}return a}function visualLineEnd(a){var b;while(b=collapsedSpanAtEnd(a)){a=b.find(1,!0).line}return a}function visualLineContinued(b){var c,a;while(c=collapsedSpanAtEnd(b)){b=c.find(1,!0).line;(a||(a=[])).push(b)}return a}function visualLineNo(d,a){var b=getLine(d,a),c=visualLine(b);if(b==c){return a}return lineNo(c)}function visualLineEndNo(c,a){if(a>c.lastLine()){return a}var b=getLine(c,a),d;if(!lineIsHidden(c,b)){return a}while(d=collapsedSpanAtEnd(b)){b=d.find(1,!0).line}return lineNo(b)+1}function lineIsHidden(e,d){var b=s&&d.markedSpans;if(b){for(var a=void 0,c=0;c<b.length;++c){a=b[c];if(!a.marker.collapsed){continue}if(a.from==null){return !0}if(a.marker.widgetNode){continue}if(a.from==0&&a.marker.inclusiveLeft&&lineIsHiddenInner(e,d,a)){return !0}}}}function lineIsHiddenInner(e,c,a){if(a.to==null){var f=a.marker.find(1,!0);return lineIsHiddenInner(e,f.line,getMarkedSpanFor(f.line.markedSpans,a.marker))}if(a.marker.inclusiveRight&&a.to==c.text.length){return !0}for(var b=void 0,d=0;d<c.markedSpans.length;++d){b=c.markedSpans[d];if(b.marker.collapsed&&!b.marker.widgetNode&&b.from==a.to&&(b.to==null||b.to!=a.from)&&(b.marker.inclusiveLeft||a.marker.inclusiveRight)&&lineIsHiddenInner(e,c,b)){return !0}}}function heightAtLine(c){c=visualLine(c);var e=0,a=c.parent;for(var f=0;f<a.lines.length;++f){var g=a.lines[f];if(g==c){break}else {e+=g.height}}for(var b=a.parent;b;a=b,b=a.parent){for(var d=0;d<b.children.length;++d){var h=b.children[d];if(h==a){break}else {e+=h.height}}}return e}function lineLength(c){if(c.height==0){return 0}var d=c.text.length,b,a=c;while(b=collapsedSpanAtStart(a)){var f=b.find(0,!0);a=f.from.line;d+=f.from.ch-f.to.ch}a=c;while(b=collapsedSpanAtEnd(a)){var e=b.find(0,!0);d-=a.text.length-e.from.ch;a=e.to.line;d+=a.text.length-e.to.ch}return d}function findMaxLine(c){var a=c.display,b=c.doc;a.maxLine=getLine(b,b.first);a.maxLineLength=lineLength(a.maxLine);a.maxLineChanged=!0;b.iter(function(b){var c=lineLength(b);if(c>a.maxLineLength){a.maxLineLength=c;a.maxLine=b}})}function iterateBidiSections(e,a,c,f){if(!e){return f(a,c,'ltr',0)}var g=!1;for(var d=0;d<e.length;++d){var b=e[d];if(b.from<c&&b.to>a||a==c&&b.to==a){f(Math.max(b.from,a),Math.min(b.to,c),b.level==1?'rtl':'ltr',d);g=!0}}if(!g){f(a,c,'ltr')}}var N=null;function getBidiPartAt(f,d,e){var c;N=null;for(var b=0;b<f.length;++b){var a=f[b];if(a.from<d&&a.to>d){return b}if(a.to==d){if(a.from!=a.to&&e=='before'){c=b}else {N=b}}if(a.from==d){if(a.from!=a.to&&e!='before'){c=b}else {N=b}}}return c!=null?c:N}var aJ=function(){var f='bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN';var e='nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111';function charType(a){if(a<=247){return f.charAt(a)}else {if(1424<=a&&a<=1524){return 'R'}else {if(1536<=a&&a<=1785){return e.charAt(a-1536)}else {if(1774<=a&&a<=2220){return 'r'}else {if(8192<=a&&a<=8203){return 'w'}else {if(a==8204){return 'b'}else {return 'L'}}}}}}}var g=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var c=/[stwN]/,d=/[LRr]/,a=/[Lb1n]/,b=/[1n]/;function BidiSpan(a,b,c){this.level=a;this.from=b;this.to=c}return function(s,v){var p=v=='ltr'?'L':'R';if(s.length==0||v=='ltr'&&!g.test(s)){return !1}var h=s.length,e=[];for(var D=0;D<h;++D){e.push(charType(s.charCodeAt(D)))}for(var x=0,I=p;x<h;++x){var J=e[x];if(J=='m'){e[x]=I}else {I=J}}for(var u=0,K=p;u<h;++u){var w=e[u];if(w=='1'&&K=='r'){e[u]='n'}else {if(d.test(w)){K=w;if(w=='r'){e[u]='R'}}}}for(var o=1,q=e[0];o<h-1;++o){var z=e[o];if(z=='+'&&q=='1'&&e[o+1]=='1'){e[o]='1'}else {if(z==','&&q==e[o+1]&&(q=='1'||q=='n')){e[o]=q}}q=z}for(var k=0;k<h;++k){var G=e[k];if(G==','){e[k]='N'}else {if(G=='%'){var m=void 0;for(m=k+1;m<h&&e[m]=='%';++m){}var M=k&&e[k-1]=='!'||m<h&&e[m]=='1'?'1':'N';for(var E=k;E<m;++E){e[E]=M}k=m-1}}}for(var y=0,H=p;y<h;++y){var A=e[y];if(H=='L'&&A=='1'){e[y]='L'}else {if(d.test(A)){H=A}}}for(var n=0;n<h;++n){if(c.test(e[n])){var l=void 0;for(l=n+1;l<h&&c.test(e[l]);++l){}var F=(n?e[n-1]:p)=='L';var O=(l<h?e[l]:p)=='L';var L=F==O?F?'L':'R':p;for(var B=n;B<l;++B){e[B]=L}n=l-1}}var i=[],t;for(var f=0;f<h;){if(a.test(e[f])){var P=f;for(++f;f<h&&a.test(e[f]);++f){}i.push(new BidiSpan(0,P,f))}else {var r=f,C=i.length;for(++f;f<h&&e[f]!='L';++f){}for(var j=r;j<f;){if(b.test(e[j])){if(r<j){i.splice(C,0,new BidiSpan(1,r,j))}var N=j;for(++j;j<f&&b.test(e[j]);++j){}i.splice(C,0,new BidiSpan(2,N,j));r=j}else {++j}}if(r<f){i.splice(C,0,new BidiSpan(1,r,f))}}}if(v=='ltr'){if(i[0].level==1&&(t=s.match(/^\s+/))){i[0].from=t[0].length;i.unshift(new BidiSpan(0,0,t[0].length))}if(lst(i).level==1&&(t=s.match(/\s+$/))){lst(i).to-=t[0].length;i.push(new BidiSpan(0,h-t[0].length,h))}}return v=='rtl'?i.reverse():i}}();function getOrder(b,c){var a=b.order;if(a==null){a=b.order=aJ(b.text,c)}return a}var au=[];var a=function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,!1)}else {if(a.attachEvent){a.attachEvent('on'+b,c)}else {var d=a._handlers||(a._handlers={});d[b]=(d[b]||au).concat(c)}}};function getHandlers(a,b){return a._handlers&&a._handlers[b]||au}function off(a,b,f){if(a.removeEventListener){a.removeEventListener(b,f,!1)}else {if(a.detachEvent){a.detachEvent('on'+b,f)}else {var e=a._handlers,c=e&&e[b];if(c){var d=indexOf(c,f);if(d>-1){e[b]=c.slice(0,d).concat(c.slice(d+1))}}}}}function signal(c,e){var a=getHandlers(c,e);if(!a.length){return}var d=Array.prototype.slice.call(arguments,2);for(var b=0;b<a.length;++b){a[b].apply(null,d)}}function signalDOMEvent(b,a,c){if(typeof a=='string'){a={type:a,preventDefault:function(){this.defaultPrevented=!0}}}signal(b,c||a.type,b,a);return e_defaultPrevented(a)||a.codemirrorIgnore}function signalCursorActivity(b){var a=b._handlers&&b._handlers.cursorActivity;if(!a){return}var d=b.curOp.cursorActivityHandlers||(b.curOp.cursorActivityHandlers=[]);for(var c=0;c<a.length;++c){if(indexOf(d,a[c])==-1){d.push(a[c])}}}function hasHandler(a,b){return getHandlers(a,b).length>0}function eventMixin(b){b.prototype.on=function(b,c){a(this,b,c)};b.prototype.off=function(a,b){off(this,a,b)}}function e_preventDefault(a){if(a.preventDefault){a.preventDefault()}else {a.returnValue=!1}}function e_stopPropagation(a){if(a.stopPropagation){a.stopPropagation()}else {a.cancelBubble=!0}}function e_defaultPrevented(a){return a.defaultPrevented!=null?a.defaultPrevented:a.returnValue==!1}function e_stop(a){e_preventDefault(a);e_stopPropagation(a)}function e_target(a){return a.target||a.srcElement}function e_button(b){var a=b.which;if(a==null){if(b.button&1){a=1}else {if(b.button&2){a=3}else {if(b.button&4){a=2}}}}if(o&&b.ctrlKey&&a==1){a=3}return a}var aN=function(){if(b&&e<9){return !1}var a=elt('div');return 'draggable' in a||'dragDrop' in a}();var ai;function zeroWidthElement(c){if(ai==null){var a=elt('span','​');removeChildrenAndAdd(c,elt('span',[a,document.createTextNode('x')]));if(c.firstChild.offsetHeight!=0){ai=a.offsetWidth<=1&&a.offsetHeight>2&&!(b&&e<8)}}var d=ai?elt('span','​'):elt('span',' ',null,'display: inline-block; width: 1px; margin-right: -1px');d.setAttribute('cm-text','');return d}var aj;function hasBadBidiRects(b){if(aj!=null){return aj}var c=removeChildrenAndAdd(b,document.createTextNode('AخA'));var a=B(c,0,1).getBoundingClientRect();var d=B(c,1,2).getBoundingClientRect();removeChildren(b);if(!a||a.left==a.right){return !1}return aj=d.right-a.right<3}var ah='\n\nb'.split(/\n/).length!=3?function(b){var c=0,d=[],g=b.length;while(c<=g){var a=b.indexOf('\n',c);if(a==-1){a=b.length}var e=b.slice(c,b.charAt(a-1)=='\r'?a-1:a);var f=e.indexOf('\r');if(f!=-1){d.push(e.slice(0,f));c+=f+1}else {d.push(e);c=a+1}}return d}:function(a){return a.split(/\r\n?|\n/)};var aM=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(aV){return !1}}:function(b){var a;try{a=b.ownerDocument.selection.createRange()}catch(aV){}if(!a||a.parentElement()!=b){return !1}return a.compareEndPoints('StartToEnd',a)!=0};var aL=function(){var a=elt('div');if('oncopy' in a){return !0}a.setAttribute('oncopy','return;');return typeof a.oncopy=='function'}();var af=null;function hasBadZoomedRects(c){if(af!=null){return af}var a=removeChildrenAndAdd(c,elt('span','x'));var d=a.getBoundingClientRect();var b=B(a,0,1).getBoundingClientRect();return af=Math.abs(d.left-b.left)>1}var an={};var E={};function defineMode(b,a){if(arguments.length>2){a.dependencies=Array.prototype.slice.call(arguments,2)}an[b]=a}function defineMIME(a,b){E[a]=b}function resolveMode(a){if(typeof a=='string'&&E.hasOwnProperty(a)){a=E[a]}else {if(a&&typeof a.name=='string'&&E.hasOwnProperty(a.name)){var b=E[a.name];if(typeof b=='string'){b={name:b}}a=createObj(b,a);a.name=b.name}else {if(typeof a=='string'&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a)){return resolveMode('application/xml')}else {if(typeof a=='string'&&/^[\w\-]+\/[\w\-]+\+json$/.test(a)){return resolveMode('application/json')}}}}if(typeof a=='string'){return {name:a}}else {return a||{name:'null'}}}function getMode(f,a){a=resolveMode(a);var e=an[a.name];if(!e){return getMode(f,'text/plain')}var b=e(f,a);if(C.hasOwnProperty(a.name)){var d=C[a.name];for(var c in d){if(!d.hasOwnProperty(c)){continue}if(b.hasOwnProperty(c)){b['_'+c]=b[c]}b[c]=d[c]}}b.name=a.name;if(a.helperType){b.helperType=a.helperType}if(a.modeProps){for(var g in a.modeProps){b[g]=a.modeProps[g]}}return b}var C={};function extendMode(a,b){var c=C.hasOwnProperty(a)?C[a]:C[a]={};copyObj(b,c)}function copyState(d,a){if(a===!0){return a}if(d.copyState){return d.copyState(a)}var c={};for(var e in a){var b=a[e];if(b instanceof Array){b=b.concat([])}c[e]=b}return c}function innerMode(b,c){var a;while(b.innerMode){a=b.innerMode(c);if(!a||a.mode==b){break}c=a.state;b=a.mode}return a||{mode:b,state:c}}function startState(a,b,c){return a.startState?a.startState(b,c):!0}var f=function(c,b,a){this.pos=this.start=0;this.string=c;this.tabSize=b||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=a};f.prototype.eol=function(){return this.pos>=this.string.length};f.prototype.sol=function(){return this.pos==this.lineStart};f.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};f.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};f.prototype.eat=function(a){var b=this.string.charAt(this.pos);var c;if(typeof a=='string'){c=b==a}else {c=b&&(a.test?a.test(b):a(b))}if(c){++this.pos;return b}};f.prototype.eatWhile=function(a){var b=this.pos;while(this.eat(a)){}return this.pos>b};f.prototype.eatSpace=function(){var a=this;var b=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++a.pos}return this.pos>b};f.prototype.skipToEnd=function(){this.pos=this.string.length};f.prototype.skipTo=function(b){var a=this.string.indexOf(b,this.pos);if(a>-1){this.pos=a;return !0}};f.prototype.backUp=function(a){this.pos-=a};f.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};f.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};f.prototype.match=function(a,c,e){if(typeof a=='string'){var d=function(a){return e?a.toLowerCase():a};var f=this.string.substr(this.pos,a.length);if(d(f)==d(a)){if(c!==!1){this.pos+=a.length}return !0}}else {var b=this.string.slice(this.pos).match(a);if(b&&b.index>0){return null}if(b&&c!==!1){this.pos+=b[0].length}return b}};f.prototype.current=function(){return this.string.slice(this.start,this.pos)};f.prototype.hideFirstChars=function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}};f.prototype.lookAhead=function(b){var a=this.lineOracle;return a&&a.lookAhead(b)};f.prototype.baseToken=function(){var a=this.lineOracle;return a&&a.baseToken(this.pos)};var Y=function(b,a){this.state=b;this.lookAhead=a};var q=function(d,b,c,a){this.state=b;this.doc=d;this.line=c;this.maxLookAhead=a||0;this.baseTokens=null;this.baseTokenPos=1};q.prototype.lookAhead=function(a){var b=this.doc.getLine(this.line+a);if(b!=null&&a>this.maxLookAhead){this.maxLookAhead=a}return b};q.prototype.baseToken=function(b){var c=this;if(!this.baseTokens){return null}while(this.baseTokens[this.baseTokenPos]<=b){c.baseTokenPos+=2}var a=this.baseTokens[this.baseTokenPos+1];return {type:a&&a.replace(/( |^)overlay .*/,''),size:this.baseTokens[this.baseTokenPos]-b}};q.prototype.nextLine=function(){this.line++;if(this.maxLookAhead>0){this.maxLookAhead--}};q.fromSaved=function(b,a,c){if(a instanceof Y){return new q(b,copyState(b.mode,a.state),c,a.lookAhead)}else {return new q(b,copyState(b.mode,a),c)}};q.prototype.save=function(b){var a=b!==!1?copyState(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Y(a,this.maxLookAhead):a};function highlightLine(c,f,b,g){var a=[c.state.modeGen],d={};runMode(c,f.text,c.doc.mode,b,function(c,b){return a.push(c,b)},d,g);var h=b.state;var i=function(j){b.baseTokens=a;var g=c.state.overlays[j],e=1,i=0;b.state=!0;runMode(c,f.text,g.mode,b,function(c,f){var b=e;while(i<c){var d=a[e];if(d>c){a.splice(e,1,c,a[e+1],d)}e+=2;i=Math.min(c,d)}if(!f){return}if(g.opaque){a.splice(b,e-b,c,'overlay '+f);e=b+2}else {for(;b<e;b+=2){var h=a[b+1];a[b+1]=(h?h+' ':'')+'overlay '+f}}},d);b.state=h;b.baseTokens=null;b.baseTokenPos=1};for(var e=0;e<c.state.overlays.length;++e){i(e)}return {styles:a,classes:d.bgClass||d.textClass?d:null}}function getLineStyles(b,a,f){if(!a.styles||a.styles[0]!=b.state.modeGen){var c=getContextBefore(b,lineNo(a));var d=a.text.length>b.options.maxHighlightLength&&copyState(b.doc.mode,c.state);var e=highlightLine(b,a,c);if(d){c.state=d}a.stateAfter=c.save(!d);a.styles=e.styles;if(e.classes){a.styleClasses=e.classes}else {if(a.styleClasses){a.styleClasses=null}}if(f===b.doc.highlightFrontier){b.doc.modeFrontier=Math.max(b.doc.modeFrontier,++b.doc.highlightFrontier)}}return a.styles}function getContextBefore(d,e,g){var a=d.doc,f=d.display;if(!a.mode.startState){return new q(a,!0,e)}var c=findStartLine(d,e,g);var h=c>a.first&&getLine(a,c-1).stateAfter;var b=h?q.fromSaved(a,h,c):new q(a,startState(a.mode),c);a.iter(c,e,function(c){processLine(d,c.text,b);var a=b.line;c.stateAfter=a==e-1||a%5==0||a>=f.viewFrom&&a<f.viewTo?b.save():null;b.nextLine()});if(g){a.modeFrontier=b.line}return b}function processLine(e,d,b,g){var c=e.doc.mode;var a=new f(d,e.options.tabSize,b);a.start=a.pos=g||0;if(d==''){callBlankLine(c,b.state)}while(!a.eol()){readToken(c,a,b.state);a.start=a.pos}}function callBlankLine(a,c){if(a.blankLine){return a.blankLine(c)}if(!a.innerMode){return}var b=innerMode(a,c);if(b.mode.blankLine){return b.mode.blankLine(b.state)}}function readToken(b,a,d,c){for(var e=0;e<10;e++){if(c){c[0]=innerMode(b,d).mode}var f=b.token(a,d);if(a.pos>a.start){return f}}throw new Error('Mode '+b.name+' failed to advance stream.')}var aC=function(a,c,b){this.start=a.start;this.end=a.pos;this.string=a.current();this.type=c||null;this.state=b};function takeToken(i,b,j,c){var e=i.doc,l=e.mode,h;b=clipPos(e,b);var k=getLine(e,b.line),d=getContextBefore(i,b.line,j);var a=new f(k.text,i.options.tabSize,d),g;if(c){g=[]}while((c||a.pos<b.ch)&&!a.eol()){a.start=a.pos;h=readToken(l,a,d.state);if(c){g.push(new aC(a,h,copyState(e.mode,d.state)))}}return c?g:new aC(a,h,d.state)}function extractLineClasses(b,c){if(b){for(;;){var a=b.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!a){break}b=b.slice(0,a.index)+b.slice(a.index+a[0].length);var d=a[1]?'bgClass':'textClass';if(c[d]==null){c[d]=a[2]}else {if(!(new RegExp('(?:^|s)'+a[2]+'(?:$|s)')).test(c[d])){c[d]+=' '+a[2]}}}}return b}function runMode(d,i,l,h,o,m,p){var e=l.flattenSpans;if(e==null){e=d.options.flattenSpans}var b=0,g=null;var a=new f(i,d.options.tabSize,h),c;var j=d.options.addModeClass&&[null];if(i==''){extractLineClasses(callBlankLine(l,h.state),m)}while(!a.eol()){if(a.pos>d.options.maxHighlightLength){e=!1;if(p){processLine(d,i,h,a.pos)}a.pos=i.length;c=null}else {c=extractLineClasses(readToken(l,a,h.state,j),m)}if(j){var k=j[0].name;if(k){c='m-'+(c?k+' '+c:k)}}if(!e||g!=c){while(b<a.start){b=Math.min(a.start,b+5000);o(b,g)}g=c}a.start=a.pos}while(b<a.pos){var n=Math.min(a.pos,b+5000);o(n,g);b=n}}function findStartLine(e,j,h){var f,c,b=e.doc;var k=h?-1:j-(e.doc.mode.innerMode?1000:100);for(var a=j;a>k;--a){if(a<=b.first){return b.first}var i=getLine(b,a-1),d=i.stateAfter;if(d&&(!h||a+(d instanceof Y?d.lookAhead:0)<=b.modeFrontier)){return a}var g=countColumn(i.text,null,e.options.tabSize);if(c==null||f>g){c=a-1;f=g}}return c}function retreatFrontier(a,c){a.modeFrontier=Math.min(a.modeFrontier,c);if(a.highlightFrontier<c-10){return}var e=a.first;for(var b=c-1;b>e;b--){var d=getLine(a,b).stateAfter;if(d&&(!(d instanceof Y)||b+d.lookAhead<c)){e=b+1;break}}a.highlightFrontier=Math.min(a.highlightFrontier,e)}var G=function(c,b,a){this.text=c;attachMarkedSpans(this,b);this.height=a?a(this):1};G.prototype.lineNo=function(){return lineNo(this)};eventMixin(G);function updateLine(a,e,d,b){a.text=e;if(a.stateAfter){a.stateAfter=null}if(a.styles){a.styles=null}if(a.order!=null){a.order=null}detachMarkedSpans(a);attachMarkedSpans(a,d);var c=b?b(a):1;if(c!=a.height){updateLineHeight(a,c)}}function cleanUpLine(a){a.parent=null;detachMarkedSpans(a)}var aH={};var aE={};function interpretTokenStyle(a,c){if(!a||/^\s*$/.test(a)){return null}var b=c.addModeClass?aE:aH;return b[a]||(b[a]=a.replace(/\S+/g,'cm-$&'))}function buildLineContent(e,c){var i=eltP('span',null,null,h?'padding-right: .1px':null);var a={pre:eltP('pre',[i],'CodeMirror-line'),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(b||h)&&e.getOption('lineWrapping')};c.measure={};for(var f=0;f<=(c.rest?c.rest.length:0);f++){var d=f?c.rest[f-1]:c.line,j=void 0;a.pos=0;a.addToken=buildToken;if(hasBadBidiRects(e.display.measure)&&(j=getOrder(d,e.doc.direction))){a.addToken=buildTokenBadBidi(a.addToken,j)}a.map=[];var k=c!=e.display.externalMeasured&&lineNo(d);insertLineContent(d,a,getLineStyles(e,d,k));if(d.styleClasses){if(d.styleClasses.bgClass){a.bgClass=joinClasses(d.styleClasses.bgClass,a.bgClass||'')}if(d.styleClasses.textClass){a.textClass=joinClasses(d.styleClasses.textClass,a.textClass||'')}}if(a.map.length==0){a.map.push(0,0,a.content.appendChild(zeroWidthElement(e.display.measure)))}if(f==0){c.measure.map=a.map;c.measure.cache={}}else {(c.measure.maps||(c.measure.maps=[])).push(a.map);(c.measure.caches||(c.measure.caches=[])).push({})}}if(h){var g=a.content.lastChild;if(/\bcm-tab\b/.test(g.className)||g.querySelector&&g.querySelector('.cm-tab')){a.content.className='cm-tab-wrap-hack'}}signal(e,'renderLine',e,c.line,a.pre);if(a.pre.className){a.textClass=joinClasses(a.pre.className,a.textClass||'')}return a}function defaultSpecialCharPlaceholder(b){var a=elt('span','•','cm-invalidchar');a.title='\\u'+b.charCodeAt(0).toString(16);a.setAttribute('aria-label',a.title);return a}function buildToken(a,f,s,k,m,t,v){if(!f){return}var j=a.splitSpaces?splitSpaces(f,a.trailingSpace):f;var n=a.cm.state.specialChars,p=!1;var c;if(!n.test(f)){a.col+=f.length;c=document.createTextNode(j);a.map.push(a.pos,a.pos+f.length,c);if(b&&e<9){p=!0}a.pos+=f.length}else {c=document.createDocumentFragment();var i=0;while(!0){n.lastIndex=i;var g=n.exec(f);var h=g?g.index-i:f.length-i;if(h){var o=document.createTextNode(j.slice(i,i+h));if(b&&e<9){c.appendChild(elt('span',[o]))}else {c.appendChild(o)}a.map.push(a.pos,a.pos+h,o);a.col+=h;a.pos+=h}if(!g){break}i+=h+1;var d=void 0;if(g[0]=='\t'){var r=a.cm.options.tabSize,q=r-a.col%r;d=c.appendChild(elt('span',spaceStr(q),'cm-tab'));d.setAttribute('role','presentation');d.setAttribute('cm-text','\t');a.col+=q}else {if(g[0]=='\r'||g[0]=='\n'){d=c.appendChild(elt('span',g[0]=='\r'?'␍':'␤','cm-invalidchar'));d.setAttribute('cm-text',g[0]);a.col+=1}else {d=a.cm.options.specialCharPlaceholder(g[0]);d.setAttribute('cm-text',g[0]);if(b&&e<9){c.appendChild(elt('span',[d]))}else {c.appendChild(d)}a.col+=1}}a.map.push(a.pos,a.pos+1,d);a.pos++}}a.trailingSpace=j.charCodeAt(f.length-1)==32;if(s||k||m||p||v){var l=s||'';if(k){l+=k}if(m){l+=m}var u=elt('span',[c],l,v);if(t){u.title=t}return a.content.appendChild(u)}a.content.appendChild(c)}function splitSpaces(a,f){if(a.length>1&&!/  /.test(a)){return a}var d=f,e='';for(var b=0;b<a.length;b++){var c=a.charAt(b);if(c==' '&&d&&(b==a.length-1||a.charCodeAt(b+1)==32)){c=' '}e+=c;d=c==' '}return e}function buildTokenBadBidi(a,b){return function(h,f,e,g,l,j,k){e=e?e+' cm-force-border':'cm-force-border';var d=h.pos,m=d+f.length;for(;;){var c=void 0;for(var i=0;i<b.length;i++){c=b[i];if(c.to>d&&c.from<=d){break}}if(c.to>=m){return a(h,f,e,g,l,j,k)}a(h,f.slice(0,c.to-d),e,g,null,j,k);g=null;f=f.slice(c.to-d);d=c.to}}}function buildCollapsedSpan(a,e,d,c){var b=!c&&d.widgetNode;if(b){a.map.push(a.pos,a.pos+e,b)}if(!c&&a.cm.display.input.needsContentAttribute){if(!b){b=a.content.appendChild(document.createElement('span'))}b.setAttribute('cm-marker',d.id)}if(b){a.cm.display.input.setUneditable(b);a.content.appendChild(b)}a.pos+=e;a.trailingSpace=!1}function insertLineContent(B,f,i){var u=B.markedSpans,t=B.text,r=0;if(!u){for(var p=1;p<i.length;p+=2){f.addToken(f,t.slice(r,r=i[p]),interpretTokenStyle(i[p+1],f.cm.options))}return}var y=t.length,a=0,C=1,g='',v,k;var e=0,n,m,l,o,c;for(;;){if(e==a){n=m=l=o=k='';c=null;e=Infinity;var s=[],h=void 0;for(var z=0;z<u.length;++z){var b=u[z],d=b.marker;if(d.type=='bookmark'&&b.from==a&&d.widgetNode){s.push(d)}else {if(b.from<=a&&(b.to==null||b.to>a||d.collapsed&&b.to==a&&b.from==a)){if(b.to!=null&&b.to!=a&&e>b.to){e=b.to;m=''}if(d.className){n+=' '+d.className}if(d.css){k=(k?k+';':'')+d.css}if(d.startStyle&&b.from==a){l+=' '+d.startStyle}if(d.endStyle&&b.to==e){(h||(h=[])).push(d.endStyle,b.to)}if(d.title&&!o){o=d.title}if(d.collapsed&&(!c||compareCollapsedMarkers(c.marker,d)<0)){c=b}}else {if(b.from>a&&e>b.from){e=b.from}}}}if(h){for(var q=0;q<h.length;q+=2){if(h[q+1]==e){m+=' '+h[q]}}}if(!c||c.from==a){for(var x=0;x<s.length;++x){buildCollapsedSpan(f,0,s[x])}}if(c&&(c.from||0)==a){buildCollapsedSpan(f,(c.to==null?y+1:c.to)-a,c.marker,c.from==null);if(c.to==null){return}if(c.to==a){c=!1}}}if(a>=y){break}var j=Math.min(y,e);while(!0){if(g){var w=a+g.length;if(!c){var A=w>j?g.slice(0,j-a):g;f.addToken(f,A,v?v+n:n,l,a+A.length==e?m:'',o,k)}if(w>=j){g=g.slice(j-a);a=j;break}a=w;l=''}g=t.slice(r,r=i[C++]);v=interpretTokenStyle(i[C++],f.cm.options)}}}function LineView(c,a,b){this.line=a;this.rest=visualLineContinued(a);this.size=this.rest?lineNo(lst(this.rest))-b+1:1;this.node=this.text=null;this.hidden=lineIsHidden(c,a)}function buildViewArray(e,f,g){var c=[],b;for(var a=f;a<g;a=b){var d=new LineView(e.doc,getLine(e.doc,a),a);b=a+d.size;c.push(d)}return c}var D=null;function pushOperation(a){if(D){D.ops.push(a)}else {a.ownsGroup=D={ops:[a],delayedCallbacks:[]}}}function fireCallbacksForOps(d){var c=d.delayedCallbacks,b=0;do{for(;b<c.length;b++){c[b].call(null)}for(var e=0;e<d.ops.length;e++){var a=d.ops[e];if(a.cursorActivityHandlers){while(a.cursorActivityCalled<a.cursorActivityHandlers.length){a.cursorActivityHandlers[a.cursorActivityCalled++].call(null,a.cm)}}}}while(b<c.length)}function finishOperation(c,b){var a=c.ownsGroup;if(!a){return}try{fireCallbacksForOps(a)}finally{D=null;b(a)}}var H=null;function signalLater(d,g){var b=getHandlers(d,g);if(!b.length){return}var e=Array.prototype.slice.call(arguments,2),a;if(D){a=D.delayedCallbacks}else {if(H){a=H}else {a=H=[];setTimeout(fireOrphanDelayed,0)}}var f=function(c){a.push(function(){return b[c].apply(null,e)})};for(var c=0;c<b.length;++c){f(c)}}function fireOrphanDelayed(){var b=H;H=null;for(var a=0;a<b.length;++a){b[a]()}}function updateLineForChanges(c,a,f,e){for(var d=0;d<a.changes.length;d++){var b=a.changes[d];if(b=='text'){updateLineText(c,a)}else {if(b=='gutter'){updateLineGutter(c,a,f,e)}else {if(b=='class'){updateLineClasses(c,a)}else {if(b=='widget'){updateLineWidgets(c,a,e)}}}}}a.changes=null}function ensureLineWrapped(a){if(a.node==a.text){a.node=elt('div',null,null,'position: relative');if(a.text.parentNode){a.text.parentNode.replaceChild(a.node,a.text)}a.node.appendChild(a.text);if(b&&e<8){a.node.style.zIndex=2}}return a.node}function updateLineBackground(d,a){var b=a.bgClass?a.bgClass+' '+(a.line.bgClass||''):a.line.bgClass;if(b){b+=' CodeMirror-linebackground'}if(a.background){if(b){a.background.className=b}else {a.background.parentNode.removeChild(a.background);a.background=null}}else {if(b){var c=ensureLineWrapped(a);a.background=c.insertBefore(elt('div',null,b),c.firstChild);d.display.input.setUneditable(a.background)}}}function getLineContent(c,b){var a=c.display.externalMeasured;if(a&&a.line==b.line){c.display.externalMeasured=null;b.measure=a.measure;return a.built}return buildLineContent(c,b)}function updateLineText(d,a){var c=a.text.className;var b=getLineContent(d,a);if(a.text==a.node){a.node=b.pre}a.text.parentNode.replaceChild(b.pre,a.text);a.text=b.pre;if(b.bgClass!=a.bgClass||b.textClass!=a.textClass){a.bgClass=b.bgClass;a.textClass=b.textClass;updateLineClasses(d,a)}else {if(c){a.text.className=c}}}function updateLineClasses(c,a){updateLineBackground(c,a);if(a.line.wrapClass){ensureLineWrapped(a).className=a.line.wrapClass}else {if(a.node!=a.text){a.node.className=''}}var b=a.textClass?a.textClass+' '+(a.line.textClass||''):a.line.textClass;a.text.className=b||''}function updateLineGutter(b,a,j,c){if(a.gutter){a.node.removeChild(a.gutter);a.gutter=null}if(a.gutterBackground){a.node.removeChild(a.gutterBackground);a.gutterBackground=null}if(a.line.gutterClass){var k=ensureLineWrapped(a);a.gutterBackground=elt('div',null,'CodeMirror-gutter-background '+a.line.gutterClass,'left: '+(b.options.fixedGutter?c.fixedPos:-c.gutterTotalWidth)+'px; width: '+c.gutterTotalWidth+'px');b.display.input.setUneditable(a.gutterBackground);k.insertBefore(a.gutterBackground,a.text)}var d=a.line.gutterMarkers;if(b.options.lineNumbers||d){var i=ensureLineWrapped(a);var e=a.gutter=elt('div',null,'CodeMirror-gutter-wrapper','left: '+(b.options.fixedGutter?c.fixedPos:-c.gutterTotalWidth)+'px');b.display.input.setUneditable(e);i.insertBefore(e,a.text);if(a.line.gutterClass){e.className+=' '+a.line.gutterClass}if(b.options.lineNumbers&&(!d||!d['CodeMirror-linenumbers'])){a.lineNumber=e.appendChild(elt('div',lineNumberFor(b.options,j),'CodeMirror-linenumber CodeMirror-gutter-elt','left: '+c.gutterLeft['CodeMirror-linenumbers']+'px; width: '+b.display.lineNumInnerWidth+'px'))}if(d){for(var g=0;g<b.options.gutters.length;++g){var f=b.options.gutters[g],h=d.hasOwnProperty(f)&&d[f];if(h){e.appendChild(elt('div',[h],'CodeMirror-gutter-elt','left: '+c.gutterLeft[f]+'px; width: '+c.gutterWidth[f]+'px'))}}}}}function updateLineWidgets(e,a,d){if(a.alignable){a.alignable=null}for(var b=a.node.firstChild,c=void 0;b;b=c){c=b.nextSibling;if(b.className=='CodeMirror-linewidget'){a.node.removeChild(b)}}insertLineWidgets(e,a,d)}function buildLineElement(c,a,e,d){var b=getLineContent(c,a);a.text=a.node=b.pre;if(b.bgClass){a.bgClass=b.bgClass}if(b.textClass){a.textClass=b.textClass}updateLineClasses(c,a);updateLineGutter(c,a,e,d);insertLineWidgets(c,a,d);return a.node}function insertLineWidgets(d,a,c){insertLineWidgetsFor(d,a.line,a,c,!0);if(a.rest){for(var b=0;b<a.rest.length;b++){insertLineWidgetsFor(d,a.rest[b],a,c,!1)}}}function insertLineWidgetsFor(j,e,c,i,h){if(!e.widgets){return}var f=ensureLineWrapped(c);for(var d=0,g=e.widgets;d<g.length;++d){var a=g[d],b=elt('div',[a.node],'CodeMirror-linewidget');if(!a.handleMouseEvents){b.setAttribute('cm-ignore-events','true')}positionLineWidget(a,b,c,i);j.display.input.setUneditable(b);if(h&&a.above){f.insertBefore(b,c.gutter||c.text)}else {f.appendChild(b)}signalLater(a,'redraw')}}function positionLineWidget(c,a,d,b){if(c.noHScroll){(d.alignable||(d.alignable=[])).push(a);var e=b.wrapperWidth;a.style.left=b.fixedPos+'px';if(!c.coverGutter){e-=b.gutterTotalWidth;a.style.paddingLeft=b.gutterTotalWidth+'px'}a.style.width=e+'px'}if(c.coverGutter){a.style.zIndex=5;a.style.position='relative';if(!c.noHScroll){a.style.marginLeft=-b.gutterTotalWidth+'px'}}}function widgetHeight(a){if(a.height!=null){return a.height}var b=a.doc.cm;if(!b){return 0}if(!contains(document.body,a.node)){var c='position: relative;';if(a.coverGutter){c+='margin-left: -'+b.display.gutters.offsetWidth+'px;'}if(a.noHScroll){c+='width: '+b.display.wrapper.clientWidth+'px;'}removeChildrenAndAdd(b.display.measure,elt('div',[a.node],null,c))}return a.height=a.node.parentNode.offsetHeight}function eventInWidget(b,c){for(var a=e_target(c);a!=b.wrapper;a=a.parentNode){if(!a||a.nodeType==1&&a.getAttribute('cm-ignore-events')=='true'||a.parentNode==b.sizer&&a!=b.mover){return !0}}}function paddingTop(a){return a.lineSpace.offsetTop}function paddingVert(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function paddingH(a){if(a.cachedPaddingH){return a.cachedPaddingH}var d=removeChildrenAndAdd(a.measure,elt('pre','x'));var c=window.getComputedStyle?window.getComputedStyle(d):d.currentStyle;var b={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};if(!isNaN(b.left)&&!isNaN(b.right)){a.cachedPaddingH=b}return b}function scrollGap(a){return at-a.display.nativeBarWidth}function displayWidth(a){return a.display.scroller.clientWidth-scrollGap(a)-a.display.barWidth}function displayHeight(a){return a.display.scroller.clientHeight-scrollGap(a)-a.display.barHeight}function ensureLineHeights(j,a,e){var c=j.options.lineWrapping;var f=c&&displayWidth(j);if(!a.measure.heights||c&&a.measure.width!=f){var g=a.measure.heights=[];if(c){a.measure.width=f;var d=a.text.firstChild.getClientRects();for(var b=0;b<d.length-1;b++){var i=d[b],h=d[b+1];if(Math.abs(i.bottom-h.bottom)>2){g.push((i.bottom+h.top)/2-e.top)}}}g.push(e.bottom-e.top)}}function mapFromLineView(a,d,e){if(a.line==d){return {map:a.measure.map,cache:a.measure.cache}}for(var c=0;c<a.rest.length;c++){if(a.rest[c]==d){return {map:a.measure.maps[c],cache:a.measure.caches[c]}}}for(var b=0;b<a.rest.length;b++){if(lineNo(a.rest[b])>e){return {map:a.measure.maps[b],cache:a.measure.caches[b],before:!0}}}}function updateExternalMeasurement(c,b){b=visualLine(b);var e=lineNo(b);var a=c.display.externalMeasured=new LineView(c.doc,b,e);a.lineN=e;var d=a.built=buildLineContent(c,a);a.text=d.pre;removeChildrenAndAdd(c.display.lineMeasure,d.pre);return a}function measureChar(a,c,d,b){return measureCharPrepared(a,prepareMeasureForLine(a,c),d,b)}function findViewForLine(c,a){if(a>=c.display.viewFrom&&a<c.display.viewTo){return c.display.view[findViewIndex(c,a)]}var b=c.display.externalMeasured;if(b&&a>=b.lineN&&a<b.lineN+b.size){return b}}function prepareMeasureForLine(b,c){var d=lineNo(c);var a=findViewForLine(b,d);if(a&&!a.text){a=null}else {if(a&&a.changes){updateLineForChanges(b,a,d,getDimensions(b));b.curOp.forceUpdate=!0}}if(!a){a=updateExternalMeasurement(b,c)}var e=mapFromLineView(a,c,d);return {line:c,view:a,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function measureCharPrepared(g,a,d,f,e){if(a.before){d=-1}var c=d+(f||''),b;if(a.cache.hasOwnProperty(c)){b=a.cache[c]}else {if(!a.rect){a.rect=a.view.text.getBoundingClientRect()}if(!a.hasHeights){ensureLineHeights(g,a.view,a.rect);a.hasHeights=!0}b=measureCharInner(g,a,d,f);if(!b.bogus){a.cache[c]=b}}return {left:b.left,right:b.right,top:e?b.rtop:b.top,bottom:e?b.rbottom:b.bottom}}var ay={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(b,g,j){var h,c,i,f,e,d;for(var a=0;a<b.length;a+=3){e=b[a];d=b[a+1];if(g<e){c=0;i=1;f='left'}else {if(g<d){c=g-e;i=c+1}else {if(a==b.length-3||g==d&&b[a+3]>g){i=d-e;c=i-1;if(g>=d){f='right'}}}}if(c!=null){h=b[a+2];if(e==d&&j==(h.insertLeft?'left':'right')){f=j}if(j=='left'&&c==0){while(a&&b[a-2]==b[a-3]&&b[a-1].insertLeft){h=b[(a-=3)+2];f='left'}}if(j=='right'&&c==d-e){while(a<b.length-3&&b[a+3]==b[a+4]&&!b[a+5].insertLeft){h=b[(a+=3)+2];f='right'}}break}}return {node:h,start:c,end:i,collapse:f,coverStart:e,coverEnd:d}}function getUsefulRect(b,e){var a=ay;if(e=='left'){for(var d=0;d<b.length;d++){if((a=b[d]).left!=a.right){break}}}else {for(var c=b.length-1;c>=0;c--){if((a=b[c]).left!=a.right){break}}}return a}function measureCharInner(o,f,w,n){var d=nodeAndOffsetInLineMap(f.map,w,n);var g=d.node,c=d.start,h=d.end,k=d.collapse;var a;if(g.nodeType==3){for(var s=0;s<4;s++){while(c&&isExtendingChar(f.line.text.charAt(d.coverStart+c))){--c}while(d.coverStart+h<d.coverEnd&&isExtendingChar(f.line.text.charAt(d.coverStart+h))){++h}if(b&&e<9&&c==0&&h==d.coverEnd-d.coverStart){a=g.parentNode.getBoundingClientRect()}else {a=getUsefulRect(B(g,c,h).getClientRects(),n)}if(a.left||a.right||c==0){break}h=c;c=c-1;k='right'}if(b&&e<11){a=maybeUpdateRectForZooming(o.display.measure,a)}}else {if(c>0){k=n='right'}var p;if(o.options.lineWrapping&&(p=g.getClientRects()).length>1){a=p[n=='right'?p.length-1:0]}else {a=g.getBoundingClientRect()}}if(b&&e<9&&!c&&(!a||!a.left&&!a.right)){var j=g.parentNode.getClientRects()[0];if(j){a={left:j.left,right:j.left+charWidth(o.display),top:j.top,bottom:j.bottom}}else {a=ay}}var r=a.top-f.rect.top,q=a.bottom-f.rect.top;var u=(r+q)/2;var l=f.view.measure.heights;var i=0;for(;i<l.length-1;i++){if(u<l[i]){break}}var v=i?l[i-1]:0,t=l[i];var m={left:(k=='right'?a.right:a.left)-f.rect.left,right:(k=='left'?a.left:a.right)-f.rect.left,top:v,bottom:t};if(!a.left&&!a.right){m.bogus=!0}if(!o.options.singleCursorHeightPerLine){m.rtop=r;m.rbottom=q}return m}function maybeUpdateRectForZooming(d,a){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(d)){return a}var b=screen.logicalXDPI/screen.deviceXDPI;var c=screen.logicalYDPI/screen.deviceYDPI;return {left:a.left*b,right:a.right*b,top:a.top*c,bottom:a.bottom*c}}function clearLineMeasurementCacheFor(a){if(a.measure){a.measure.cache={};a.measure.heights=null;if(a.rest){for(var b=0;b<a.rest.length;b++){a.measure.caches[b]={}}}}}function clearLineMeasurementCache(a){a.display.externalMeasure=null;removeChildren(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++){clearLineMeasurementCacheFor(a.display.view[b])}}function clearCaches(a){clearLineMeasurementCache(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;if(!a.options.lineWrapping){a.display.maxLineChanged=!0}a.display.lineNumChars=null}function pageScrollX(){if(aa&&_){return -(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft))}return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){if(aa&&_){return -(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop))}return window.pageYOffset||(document.documentElement||document.body).scrollTop}function widgetTopHeight(a){var c=0;if(a.widgets){for(var b=0;b<a.widgets.length;++b){if(a.widgets[b].above){c+=widgetHeight(a.widgets[b])}}}return c}function intoCoordSystem(d,e,b,a,i){if(!i){var f=widgetTopHeight(e);b.top+=f;b.bottom+=f}if(a=='line'){return b}if(!a){a='local'}var c=heightAtLine(e);if(a=='local'){c+=paddingTop(d.display)}else {c-=d.display.viewOffset}if(a=='page'||a=='window'){var g=d.display.lineSpace.getBoundingClientRect();c+=g.top+(a=='window'?0:pageScrollY());var h=g.left+(a=='window'?0:pageScrollX());b.left+=h;b.right+=h}b.top+=c;b.bottom+=c;return b}function fromCoordSystem(g,b,a){if(a=='div'){return b}var c=b.left,d=b.top;if(a=='page'){c-=pageScrollX();d-=pageScrollY()}else {if(a=='local'||!a){var f=g.display.sizer.getBoundingClientRect();c+=f.left;d+=f.top}}var e=g.display.lineSpace.getBoundingClientRect();return {left:c-e.left,top:d-e.top}}function charCoords(b,c,d,a,e){if(!a){a=getLine(b.doc,c.line)}return intoCoordSystem(b,a,measureChar(b,a,c.ch,e),d)}function cursorCoords(d,g,k,b,e,j){b=b||getLine(d.doc,g.line);if(!e){e=prepareMeasureForLine(d,b)}function get(f,c){var a=measureCharPrepared(d,e,f,c?'right':'left',j);if(c){a.left=a.right}else {a.right=a.left}return intoCoordSystem(d,b,a,k)}var f=getOrder(b,d.doc.direction),a=g.ch,c=g.sticky;if(a>=b.text.length){a=b.text.length;c='before'}else {if(a<=0){a=0;c='after'}}if(!f){return get(c=='before'?a-1:a,c=='before')}function getBidi(b,c,a){var e=f[c],d=e.level==1;return get(a?b-1:b,d!=a)}var l=getBidiPartAt(f,a,c);var h=N;var i=getBidi(a,l,c=='before');if(h!=null){i.other=getBidi(a,h,c!='before')}return i}function estimateCoords(a,b){var c=0;b=clipPos(a.doc,b);if(!a.options.lineWrapping){c=charWidth(a.display)*b.ch}var d=getLine(a.doc,b.line);var e=heightAtLine(d)+paddingTop(a.display);return {left:c,right:c,top:e,bottom:e+d.height}}function PosWithInfo(d,f,c,b,e){var a=Pos(d,f,c);a.xRel=e;if(b){a.outside=!0}return a}function coordsChar(h,i,d){var a=h.doc;d+=h.display.viewOffset;if(d<0){return PosWithInfo(a.first,0,null,!0,-1)}var c=lineAtHeight(a,d),j=a.first+a.size-1;if(c>j){return PosWithInfo(a.first+a.size-1,getLine(a,j).text.length,null,!0,1)}if(i<0){i=0}var f=getLine(a,c);for(;;){var b=coordsCharInner(h,f,c,i,d);var g=collapsedSpanAtEnd(f);var e=g&&g.find(0,!0);if(g&&(b.ch>e.from.ch||b.ch==e.from.ch&&b.xRel>0)){c=lineNo(f=e.to.line)}else {return b}}}function wrappedLineExtent(f,d,c,b){b-=widgetTopHeight(d);var a=d.text.length;var e=findFirst(function(a){return measureCharPrepared(f,c,a-1).bottom<=b},a,0);a=findFirst(function(a){return measureCharPrepared(f,c,a).top>b},e,a);return {begin:e,end:a}}function wrappedLineExtentChar(b,c,a,e){if(!a){a=prepareMeasureForLine(b,c)}var d=intoCoordSystem(b,c,measureCharPrepared(b,a,e),'line').top;return wrappedLineExtent(b,c,a,d)}function boxIsAfter(a,d,b,c){return a.bottom<=b?!1:a.top>b?!0:(c?a.left:a.right)>d}function coordsCharInner(d,b,m,g,e){e-=heightAtLine(b);var i=prepareMeasureForLine(d,b);var k=widgetTopHeight(b);var o=0,p=b.text.length,c=!0;var u=getOrder(b,d.doc.direction);if(u){var h=(d.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)(d,b,m,i,u,g,e);c=h.level!=1;o=c?h.from:h.to-1;p=c?h.to:h.from-1}var q=null,f=null;var a=findFirst(function(b){var a=measureCharPrepared(d,i,b);a.top+=k;a.bottom+=k;if(!boxIsAfter(a,g,e,!1)){return !1}if(a.top<=e&&a.left<=g){q=b;f=a}return !0},o,p);var n,j,s=!1;if(f){var t=g-f.left<f.right-g,r=t==c;a=q+(r?0:1);j=r?'after':'before';n=t?f.left:f.right}else {if(!c&&(a==p||a==o)){a++}j=a==0?'after':a==b.text.length?'before':measureCharPrepared(d,i,a-(c?1:0)).bottom+k<=e==c?'after':'before';var l=cursorCoords(d,Pos(m,a,j),'line',b,i);n=l.left;s=e<l.top||e>=l.bottom}a=skipExtendingChars(b.text,a,1);return PosWithInfo(m,a,j,s,g-n)}function coordsBidiPart(j,f,g,e,b,k,d){var c=findFirst(function(h){var a=b[h],c=a.level!=1;return boxIsAfter(cursorCoords(j,Pos(g,c?a.to:a.from,c?'before':'after'),'line',f,e),k,d,!0)},0,b.length-1);var a=b[c];if(c>0){var i=a.level!=1;var h=cursorCoords(j,Pos(g,i?a.from:a.to,i?'after':'before'),'line',f,e);if(boxIsAfter(h,k,d,!0)&&h.top>d){a=b[c-1]}}return a}function coordsBidiPartWrapped(n,k,q,i,e,h,p){var m=wrappedLineExtent(n,k,i,p);var d=m.begin;var b=m.end;if(/\s/.test(k.text.charAt(b-1))){b--}var a=null,j=null;for(var g=0;g<e.length;g++){var c=e[g];if(c.from>=b||c.to<=d){continue}var o=c.level!=1;var f=measureCharPrepared(n,i,o?Math.min(b,c.to)-1:Math.max(d,c.from)).right;var l=f<h?h-f+1000000000:f-h;if(!a||j>l){a=c;j=l}}if(!a){a=e[e.length-1]}if(a.from<d){a={from:d,to:a.to,level:a.level}}if(a.to>b){a={from:a.from,to:b,level:a.level}}return a}var y;function textHeight(a){if(a.cachedTextHeight!=null){return a.cachedTextHeight}if(y==null){y=elt('pre');for(var c=0;c<49;++c){y.appendChild(document.createTextNode('x'));y.appendChild(elt('br'))}y.appendChild(document.createTextNode('x'))}removeChildrenAndAdd(a.measure,y);var b=y.offsetHeight/50;if(b>3){a.cachedTextHeight=b}removeChildren(a.measure);return b||1}function charWidth(a){if(a.cachedCharWidth!=null){return a.cachedCharWidth}var c=elt('span','xxxxxxxxxx');var e=elt('pre',[c]);removeChildrenAndAdd(a.measure,e);var d=c.getBoundingClientRect(),b=(d.right-d.left)/10;if(b>2){a.cachedCharWidth=b}return b||10}function getDimensions(c){var b=c.display,f={},e={};var g=b.gutters.clientLeft;for(var a=b.gutters.firstChild,d=0;a;a=a.nextSibling,++d){f[c.options.gutters[d]]=a.offsetLeft+a.clientLeft+g;e[c.options.gutters[d]]=a.clientWidth}return {fixedPos:compensateForHScroll(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:f,gutterWidth:e,wrapperWidth:b.wrapper.clientWidth}}function compensateForHScroll(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function estimateHeight(a){var c=textHeight(a.display),b=a.options.lineWrapping;var d=b&&Math.max(5,a.display.scroller.clientWidth/charWidth(a.display)-3);return function(e){if(lineIsHidden(a.doc,e)){return 0}var g=0;if(e.widgets){for(var f=0;f<e.widgets.length;f++){if(e.widgets[f].height){g+=e.widgets[f].height}}}if(b){return g+(Math.ceil(e.text.length/d)||1)*c}else {return g+c}}}function estimateLineHeights(a){var b=a.doc,c=estimateHeight(a);b.iter(function(a){var b=c(a);if(b!=a.height){updateLineHeight(a,b)}})}function posFromMouse(b,d,k,j){var i=b.display;if(!k&&e_target(d).getAttribute('cm-not-content')=='true'){return null}var e,g,f=i.lineSpace.getBoundingClientRect();try{e=d.clientX-f.left;g=d.clientY-f.top}catch(aV){return null}var a=coordsChar(b,e,g),c;if(j&&a.xRel==1&&(c=getLine(b.doc,a.line).text).length==a.ch){var h=countColumn(c,c.length,b.options.tabSize)-c.length;a=Pos(a.line,Math.max(0,Math.round((e-paddingH(b.display).left)/charWidth(b.display))-h))}return a}function findViewIndex(c,a){if(a>=c.display.viewTo){return null}a-=c.display.viewFrom;if(a<0){return null}var d=c.display.view;for(var b=0;b<d.length;b++){a-=d[b].size;if(a<0){return b}}}function updateSelection(a){a.display.input.showSelection(a.display.input.prepareSelection())}function prepareSelection(a,d){if(d===void 0){d=!0}var f=a.doc,e={};var h=e.cursors=document.createDocumentFragment();var i=e.selection=document.createDocumentFragment();for(var c=0;c<f.sel.ranges.length;c++){if(!d&&c==f.sel.primIndex){continue}var b=f.sel.ranges[c];if(b.from().line>=a.display.viewTo||b.to().line<a.display.viewFrom){continue}var g=b.empty();if(g||a.options.showCursorWhenSelecting){drawSelectionCursor(a,b.head,h)}if(!g){drawSelectionRange(a,b,i)}}return e}function drawSelectionCursor(d,f,e){var a=cursorCoords(d,f,'div',null,null,!d.options.singleCursorHeightPerLine);var c=e.appendChild(elt('div',' ','CodeMirror-cursor'));c.style.left=a.left+'px';c.style.top=a.top+'px';c.style.height=Math.max(0,a.bottom-a.top)*d.options.cursorHeight+'px';if(a.other){var b=e.appendChild(elt('div',' ','CodeMirror-cursor CodeMirror-secondarycursor'));b.style.display='';b.style.left=a.other.left+'px';b.style.top=a.other.top+'px';b.style.height=(a.other.bottom-a.other.top)*0.85+'px'}}function cmpCoords(a,b){return a.top-b.top||a.left-b.left}function drawSelectionRange(g,o,p){var m=g.display,h=g.doc;var k=document.createDocumentFragment();var n=paddingH(g.display),c=n.left;var e=Math.max(m.sizerWidth,displayWidth(g)-m.sizer.offsetLeft)-n.right;var b=h.direction=='ltr';function add(d,a,c,b){if(a<0){a=0}a=Math.round(a);b=Math.round(b);k.appendChild(elt('div',null,'CodeMirror-selected','position: absolute; left: '+d+'px;\n                             top: '+a+'px; width: '+(c==null?e-d:c)+'px;\n                             height: '+(b-a)+'px'))}function drawForLine(m,k,j){var f=getLine(h,m);var l=f.text.length;var a,d;function coords(b,a){return charCoords(g,Pos(m,b),'div',f,a)}function wrapX(e,d,c){var a=wrappedLineExtentChar(g,f,null,e);var b=d=='ltr'==(c=='after')?'left':'right';var h=c=='after'?a.begin:a.end-(/\s/.test(f.text.charAt(a.end-1))?2:1);return coords(h,b)[b]}var i=getOrder(f,h.direction);iterateBidiSections(i,k||0,j==null?l:j,function(r,s,h,y){var m=h=='ltr';var f=coords(r,m?'left':'right');var g=coords(s-1,m?'right':'left');var n=k==null&&r==0,p=j==null&&s==l;var v=y==0,w=!i||y==i.length-1;if(g.top-f.top<=3){var A=(b?n:p)&&v;var z=(b?p:n)&&w;var x=A?c:(m?f:g).left;var B=z?e:(m?g:f).right;add(x,f.top,B-x,f.bottom)}else {var q,u,o,t;if(m){q=b&&n&&v?c:f.left;u=b?e:wrapX(r,h,'before');o=b?c:wrapX(s,h,'after');t=b&&p&&w?e:g.right}else {q=!b?c:wrapX(r,h,'before');u=!b&&n&&v?e:f.right;o=!b&&p&&w?c:g.left;t=!b?e:wrapX(s,h,'after')}add(q,f.top,u-q,f.bottom);if(f.bottom<g.top){add(c,f.bottom,null,g.top)}add(o,g.top,t-o,g.bottom)}if(!a||cmpCoords(f,a)<0){a=f}if(cmpCoords(g,a)<0){a=g}if(!d||cmpCoords(f,d)<0){d=f}if(cmpCoords(g,d)<0){d=g}});return {start:a,end:d}}var f=o.from(),i=o.to();if(f.line==i.line){drawForLine(f.line,f.ch,i.ch)}else {var l=getLine(h,f.line),q=getLine(h,i.line);var j=visualLine(l)==visualLine(q);var a=drawForLine(f.line,f.ch,j?l.text.length+1:null).end;var d=drawForLine(i.line,j?0:null,i.ch).start;if(j){if(a.top<d.top-2){add(a.right,a.top,null,a.bottom);add(c,d.top,d.left,d.bottom)}else {add(a.right,a.top,d.left-a.right,a.bottom)}}if(a.bottom<d.top){add(c,a.bottom,null,d.top)}}p.appendChild(k)}function restartBlink(b){if(!b.state.focused){return}var a=b.display;clearInterval(a.blinker);var c=!0;a.cursorDiv.style.visibility='';if(b.options.cursorBlinkRate>0){a.blinker=setInterval(function(){return a.cursorDiv.style.visibility=(c=!c)?'':'hidden'},b.options.cursorBlinkRate)}else {if(b.options.cursorBlinkRate<0){a.cursorDiv.style.visibility='hidden'}}}function ensureFocus(a){if(!a.state.focused){a.display.input.focus();onFocus(a)}}function delayBlurEvent(a){a.state.delayingBlurEvent=!0;setTimeout(function(){if(a.state.delayingBlurEvent){a.state.delayingBlurEvent=!1;onBlur(a)}},100)}function onFocus(a,b){if(a.state.delayingBlurEvent){a.state.delayingBlurEvent=!1}if(a.options.readOnly=='nocursor'){return}if(!a.state.focused){signal(a,'focus',a,b);a.state.focused=!0;addClass(a.display.wrapper,'CodeMirror-focused');if(!a.curOp&&a.display.selForContextMenu!=a.doc.sel){a.display.input.reset();if(h){setTimeout(function(){return a.display.input.reset(!0)},20)}}a.display.input.receivedFocus()}restartBlink(a)}function onBlur(a,b){if(a.state.delayingBlurEvent){return}if(a.state.focused){signal(a,'blur',a,b);a.state.focused=!1;A(a.display.wrapper,'CodeMirror-focused')}clearInterval(a.display.blinker);setTimeout(function(){if(!a.state.focused){a.display.shift=!1}},150)}function updateHeightsInViewport(l){var d=l.display;var h=d.lineDiv.offsetTop;for(var f=0;f<d.view.length;f++){var a=d.view[f],c=void 0;if(a.hidden){continue}if(b&&e<8){var j=a.node.offsetTop+a.node.offsetHeight;c=j-h;h=j}else {var k=a.node.getBoundingClientRect();c=k.bottom-k.top}var i=a.line.height-c;if(c<2){c=textHeight(d)}if(i>0.005||i<-0.005){updateLineHeight(a.line,c);updateWidgetHeight(a.line);if(a.rest){for(var g=0;g<a.rest.length;g++){updateWidgetHeight(a.rest[g])}}}}}function updateWidgetHeight(a){if(a.widgets){for(var b=0;b<a.widgets.length;++b){var d=a.widgets[b],c=d.node.parentNode;if(c){d.height=c.offsetHeight}}}}function visibleLines(c,b,a){var e=a&&a.top!=null?Math.max(0,a.top):c.scroller.scrollTop;e=Math.floor(e-paddingTop(c));var i=a&&a.bottom!=null?a.bottom:e+c.wrapper.clientHeight;var d=lineAtHeight(b,e),f=lineAtHeight(b,i);if(a&&a.ensure){var g=a.ensure.from.line,h=a.ensure.to.line;if(g<d){d=g;f=lineAtHeight(b,heightAtLine(getLine(b,g))+c.wrapper.clientHeight)}else {if(Math.min(h,b.lastLine())>=f){d=lineAtHeight(b,heightAtLine(getLine(b,h))-c.wrapper.clientHeight);f=h}}}return {from:d,to:Math.max(f,d+1)}}function alignHorizontally(d){var b=d.display,c=b.view;if(!b.alignWidgets&&(!b.gutters.firstChild||!d.options.fixedGutter)){return}var h=compensateForHScroll(b)-b.scroller.scrollLeft+d.doc.scrollLeft;var i=b.gutters.offsetWidth,f=h+'px';for(var a=0;a<c.length;a++){if(!c[a].hidden){if(d.options.fixedGutter){if(c[a].gutter){c[a].gutter.style.left=f}if(c[a].gutterBackground){c[a].gutterBackground.style.left=f}}var e=c[a].alignable;if(e){for(var g=0;g<e.length;g++){e[g].style.left=f}}}}if(d.options.fixedGutter){b.gutters.style.left=h+i+'px'}}function maybeUpdateLineNumberWidth(b){if(!b.options.lineNumbers){return !1}var g=b.doc,c=lineNumberFor(b.options,g.first+g.size-1),a=b.display;if(c.length!=a.lineNumChars){var f=a.measure.appendChild(elt('div',[elt('div',c)],'CodeMirror-linenumber CodeMirror-gutter-elt'));var e=f.firstChild.offsetWidth,d=f.offsetWidth-e;a.lineGutter.style.width='';a.lineNumInnerWidth=Math.max(e,a.lineGutter.offsetWidth-d)+1;a.lineNumWidth=a.lineNumInnerWidth+d;a.lineNumChars=a.lineNumInnerWidth?c.length:-1;a.lineGutter.style.width=a.lineNumWidth+'px';updateGutterSpace(b);return !0}return !1}function maybeScrollWindow(b,a){if(signalDOMEvent(b,'scrollCursorIntoView')){return}var e=b.display,f=e.sizer.getBoundingClientRect(),c=null;if(a.top+f.top<0){c=!0}else {if(a.bottom+f.top>(window.innerHeight||document.documentElement.clientHeight)){c=!1}}if(c!=null&&!aS){var d=elt('div','​',null,'position: absolute;\n                         top: '+(a.top-e.viewOffset-paddingTop(b.display))+'px;\n                         height: '+(a.bottom-a.top+scrollGap(b)+e.barHeight)+'px;\n                         left: '+a.left+'px; width: '+Math.max(2,a.right-a.left)+'px;');b.display.lineSpace.appendChild(d);d.scrollIntoView(c);b.display.lineSpace.removeChild(d)}}function scrollPosIntoView(b,a,d,g){if(g==null){g=0}var i;if(!b.options.lineWrapping&&a==d){a=a.ch?Pos(a.line,a.sticky=='before'?a.ch-1:a.ch,'after'):a;d=a.sticky=='before'?Pos(a.line,a.ch+1,'before'):a}for(var j=0;j<5;j++){var h=!1;var c=cursorCoords(b,a);var e=!d||d==a?c:cursorCoords(b,d);i={left:Math.min(c.left,e.left),top:Math.min(c.top,e.top)-g,right:Math.max(c.left,e.left),bottom:Math.max(c.bottom,e.bottom)+g};var f=calculateScrollPos(b,i);var l=b.doc.scrollTop,k=b.doc.scrollLeft;if(f.scrollTop!=null){updateScrollTop(b,f.scrollTop);if(Math.abs(b.doc.scrollTop-l)>1){h=!0}}if(f.scrollLeft!=null){setScrollLeft(b,f.scrollLeft);if(Math.abs(b.doc.scrollLeft-k)>1){h=!0}}if(!h){break}}return i}function scrollIntoView(b,c){var a=calculateScrollPos(b,c);if(a.scrollTop!=null){updateScrollTop(b,a.scrollTop)}if(a.scrollLeft!=null){setScrollLeft(b,a.scrollLeft)}}function calculateScrollPos(b,a){var d=b.display,j=textHeight(b.display);if(a.top<0){a.top=0}var g=b.curOp&&b.curOp.scrollTop!=null?b.curOp.scrollTop:d.scroller.scrollTop;var f=displayHeight(b),c={};if(a.bottom-a.top>f){a.bottom=a.top+f}var k=b.doc.height+paddingVert(d);var n=a.top<j,m=a.bottom>k-j;if(a.top<g){c.scrollTop=n?0:a.top}else {if(a.bottom>g+f){var l=Math.min(a.top,(m?k:a.bottom)-f);if(l!=g){c.scrollTop=l}}}var i=b.curOp&&b.curOp.scrollLeft!=null?b.curOp.scrollLeft:d.scroller.scrollLeft;var e=displayWidth(b)-(b.options.fixedGutter?d.gutters.offsetWidth:0);var h=a.right-a.left>e;if(h){a.right=a.left+e}if(a.left<10){c.scrollLeft=0}else {if(a.left<i){c.scrollLeft=Math.max(0,a.left-(h?0:10))}else {if(a.right>e+i-3){c.scrollLeft=a.right+(h?0:10)-e}}}return c}function addToScrollTop(a,b){if(b==null){return}resolveScrollToPos(a);a.curOp.scrollTop=(a.curOp.scrollTop==null?a.doc.scrollTop:a.curOp.scrollTop)+b}function ensureCursorVisible(a){resolveScrollToPos(a);var b=a.getCursor();a.curOp.scrollToPos={from:b,to:b,margin:a.options.cursorScrollMargin}}function scrollToCoords(a,b,c){if(b!=null||c!=null){resolveScrollToPos(a)}if(b!=null){a.curOp.scrollLeft=b}if(c!=null){a.curOp.scrollTop=c}}function scrollToRange(a,b){resolveScrollToPos(a);a.curOp.scrollToPos=b}function resolveScrollToPos(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=estimateCoords(a,b.from),d=estimateCoords(a,b.to);scrollToCoordsRange(a,c,d,b.margin)}}function scrollToCoordsRange(e,a,b,c){var d=calculateScrollPos(e,{left:Math.min(a.left,b.left),top:Math.min(a.top,b.top)-c,right:Math.max(a.right,b.right),bottom:Math.max(a.bottom,b.bottom)+c});scrollToCoords(e,d.scrollLeft,d.scrollTop)}function updateScrollTop(a,b){if(Math.abs(a.doc.scrollTop-b)<2){return}if(!v){updateDisplaySimple(a,{top:b})}setScrollTop(a,b,!0);if(v){updateDisplaySimple(a)}startWorker(a,100)}function setScrollTop(b,a,c){a=Math.min(b.display.scroller.scrollHeight-b.display.scroller.clientHeight,a);if(b.display.scroller.scrollTop==a&&!c){return}b.doc.scrollTop=a;b.display.scrollbars.setScrollTop(a);if(b.display.scroller.scrollTop!=a){b.display.scroller.scrollTop=a}}function setScrollLeft(a,b,d,c){b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth);if((d?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)&&!c){return}a.doc.scrollLeft=b;alignHorizontally(a);if(a.display.scroller.scrollLeft!=b){a.display.scroller.scrollLeft=b}a.display.scrollbars.setScrollLeft(b)}function measureForScrollbars(b){var a=b.display,c=a.gutters.offsetWidth;var d=Math.round(b.doc.height+paddingVert(b.display));return {clientHeight:a.scroller.clientHeight,viewHeight:a.wrapper.clientHeight,scrollWidth:a.scroller.scrollWidth,clientWidth:a.scroller.clientWidth,viewWidth:a.wrapper.clientWidth,barLeft:b.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+scrollGap(b)+a.barHeight,nativeBarWidth:a.nativeBarWidth,gutterWidth:c}}var w=function(g,f,h){this.cm=h;var d=this.vert=elt('div',[elt('div',null,null,'min-width: 1px')],'CodeMirror-vscrollbar');var c=this.horiz=elt('div',[elt('div',null,null,'height: 100%; min-height: 1px')],'CodeMirror-hscrollbar');g(d);g(c);a(d,'scroll',function(){if(d.clientHeight){f(d.scrollTop,'vertical')}});a(c,'scroll',function(){if(c.clientWidth){f(c.scrollLeft,'horizontal')}});this.checkedZeroWidth=!1;if(b&&e<8){this.horiz.style.minHeight=this.vert.style.minWidth='18px'}};w.prototype.update=function(a){var c=a.scrollWidth>a.clientWidth+1;var d=a.scrollHeight>a.clientHeight+1;var b=a.nativeBarWidth;if(d){this.vert.style.display='block';this.vert.style.bottom=c?b+'px':'0';var e=a.viewHeight-(c?b:0);this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+e)+'px'}else {this.vert.style.display='';this.vert.firstChild.style.height='0'}if(c){this.horiz.style.display='block';this.horiz.style.right=d?b+'px':'0';this.horiz.style.left=a.barLeft+'px';var f=a.viewWidth-a.barLeft-(d?b:0);this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+f)+'px'}else {this.horiz.style.display='';this.horiz.firstChild.style.width='0'}if(!this.checkedZeroWidth&&a.clientHeight>0){if(b==0){this.zeroWidthHack()}this.checkedZeroWidth=!0}return {right:d?b:0,bottom:c?b:0}};w.prototype.setScrollLeft=function(a){if(this.horiz.scrollLeft!=a){this.horiz.scrollLeft=a}if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,'horiz')}};w.prototype.setScrollTop=function(a){if(this.vert.scrollTop!=a){this.vert.scrollTop=a}if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,'vert')}};w.prototype.zeroWidthHack=function(){var a=o&&!aF?'12px':'18px';this.horiz.style.height=this.vert.style.width=a;this.horiz.style.pointerEvents=this.vert.style.pointerEvents='none';this.disableHoriz=new z();this.disableVert=new z()};w.prototype.enableZeroWidthBar=function(a,b,c){a.style.pointerEvents='auto';function maybeDisable(){var d=a.getBoundingClientRect();var e=c=='vert'?document.elementFromPoint(d.right-1,(d.top+d.bottom)/2):document.elementFromPoint((d.right+d.left)/2,d.bottom-1);if(e!=a){a.style.pointerEvents='none'}else {b.set(1000,maybeDisable)}}b.set(1000,maybeDisable)};w.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)};var K=function(){};K.prototype.update=function(){return {bottom:0,right:0}};K.prototype.setScrollLeft=function(){};K.prototype.setScrollTop=function(){};K.prototype.clear=function(){};function updateScrollbars(a,c){if(!c){c=measureForScrollbars(a)}var b=a.display.barWidth,d=a.display.barHeight;updateScrollbarsInner(a,c);for(var e=0;e<4&&b!=a.display.barWidth||d!=a.display.barHeight;e++){if(b!=a.display.barWidth&&a.options.lineWrapping){updateHeightsInViewport(a)}updateScrollbarsInner(a,measureForScrollbars(a));b=a.display.barWidth;d=a.display.barHeight}}function updateScrollbarsInner(c,d){var a=c.display;var b=a.scrollbars.update(d);a.sizer.style.paddingRight=(a.barWidth=b.right)+'px';a.sizer.style.paddingBottom=(a.barHeight=b.bottom)+'px';a.heightForcer.style.borderBottom=b.bottom+'px solid transparent';if(b.right&&b.bottom){a.scrollbarFiller.style.display='block';a.scrollbarFiller.style.height=b.bottom+'px';a.scrollbarFiller.style.width=b.right+'px'}else {a.scrollbarFiller.style.display=''}if(b.bottom&&c.options.coverGutterNextToScrollbar&&c.options.fixedGutter){a.gutterFiller.style.display='block';a.gutterFiller.style.height=b.bottom+'px';a.gutterFiller.style.width=d.gutterWidth+'px'}else {a.gutterFiller.style.display=''}}var aq={'native':w,'null':K};function initScrollbars(b){if(b.display.scrollbars){b.display.scrollbars.clear();if(b.display.scrollbars.addClass){A(b.display.wrapper,b.display.scrollbars.addClass)}}b.display.scrollbars=new aq[b.options.scrollbarStyle](function(c){b.display.wrapper.insertBefore(c,b.display.scrollbarFiller);a(c,'mousedown',function(){if(b.state.focused){setTimeout(function(){return b.display.input.focus()},0)}});c.setAttribute('cm-not-content','true')},function(a,c){if(c=='horizontal'){setScrollLeft(b,a)}else {updateScrollTop(b,a)}},b);if(b.display.scrollbars.addClass){addClass(b.display.wrapper,b.display.scrollbars.addClass)}}var aQ=0;function startOperation(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++aQ};pushOperation(a.curOp)}function endOperation(a){var b=a.curOp;finishOperation(b,function(a){for(var b=0;b<a.ops.length;b++){a.ops[b].cm.curOp=null}endOperations(a)})}function endOperations(g){var a=g.ops;for(var f=0;f<a.length;f++){endOperation_R1(a[f])}for(var b=0;b<a.length;b++){endOperation_W1(a[b])}for(var c=0;c<a.length;c++){endOperation_R2(a[c])}for(var d=0;d<a.length;d++){endOperation_W2(a[d])}for(var e=0;e<a.length;e++){endOperation_finish(a[e])}}function endOperation_R1(a){var b=a.cm,c=b.display;maybeClipScrollbars(b);if(a.updateMaxLine){findMaxLine(b)}a.mustUpdate=a.viewChanged||a.forceUpdate||a.scrollTop!=null||a.scrollToPos&&(a.scrollToPos.from.line<c.viewFrom||a.scrollToPos.to.line>=c.viewTo)||c.maxLineChanged&&b.options.lineWrapping;a.update=a.mustUpdate&&new X(b,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function endOperation_W1(a){a.updatedDisplay=a.mustUpdate&&updateDisplayIfNeeded(a.cm,a.update)}function endOperation_R2(a){var b=a.cm,c=b.display;if(a.updatedDisplay){updateHeightsInViewport(b)}a.barMeasure=measureForScrollbars(b);if(c.maxLineChanged&&!b.options.lineWrapping){a.adjustWidthTo=measureChar(b,c.maxLine,c.maxLine.text.length).left+3;b.display.sizerWidth=a.adjustWidthTo;a.barMeasure.scrollWidth=Math.max(c.scroller.clientWidth,c.sizer.offsetLeft+a.adjustWidthTo+scrollGap(b)+b.display.barWidth);a.maxScrollLeft=Math.max(0,c.sizer.offsetLeft+a.adjustWidthTo-displayWidth(b))}if(a.updatedDisplay||a.selectionChanged){a.preparedSelection=c.input.prepareSelection()}}function endOperation_W2(a){var b=a.cm;if(a.adjustWidthTo!=null){b.display.sizer.style.minWidth=a.adjustWidthTo+'px';if(a.maxScrollLeft<b.doc.scrollLeft){setScrollLeft(b,Math.min(b.display.scroller.scrollLeft,a.maxScrollLeft),!0)}b.display.maxLineChanged=!1}var c=a.focus&&a.focus==activeElt();if(a.preparedSelection){b.display.input.showSelection(a.preparedSelection,c)}if(a.updatedDisplay||a.startHeight!=b.doc.height){updateScrollbars(b,a.barMeasure)}if(a.updatedDisplay){setDocumentHeight(b,a.barMeasure)}if(a.selectionChanged){restartBlink(b)}if(b.state.focused&&a.updateInput){b.display.input.reset(a.typing)}if(c){ensureFocus(a.cm)}}function endOperation_finish(a){var b=a.cm,d=b.display,h=b.doc;if(a.updatedDisplay){postUpdateDisplay(b,a.update)}if(d.wheelStartX!=null&&(a.scrollTop!=null||a.scrollLeft!=null||a.scrollToPos)){d.wheelStartX=d.wheelStartY=null}if(a.scrollTop!=null){setScrollTop(b,a.scrollTop,a.forceScroll)}if(a.scrollLeft!=null){setScrollLeft(b,a.scrollLeft,!0,!0)}if(a.scrollToPos){var i=scrollPosIntoView(b,clipPos(h,a.scrollToPos.from),clipPos(h,a.scrollToPos.to),a.scrollToPos.margin);maybeScrollWindow(b,i)}var e=a.maybeHiddenMarkers,c=a.maybeUnhiddenMarkers;if(e){for(var g=0;g<e.length;++g){if(!e[g].lines.length){signal(e[g],'hide')}}}if(c){for(var f=0;f<c.length;++f){if(c[f].lines.length){signal(c[f],'unhide')}}}if(d.wrapper.offsetHeight){h.scrollTop=b.display.scroller.scrollTop}if(a.changeObjs){signal(b,'changes',b,a.changeObjs)}if(a.update){a.update.finish()}}function runInOp(a,b){if(a.curOp){return b()}startOperation(a);try{return b()}finally{endOperation(a)}}function operation(a,b){return function(){if(a.curOp){return b.apply(a,arguments)}startOperation(a);try{return b.apply(a,arguments)}finally{endOperation(a)}}}function methodOp(a){return function(){if(this.curOp){return a.apply(this,arguments)}startOperation(this);try{return a.apply(this,arguments)}finally{endOperation(this)}}}function docMethodOp(a){return function(){var b=this.cm;if(!b||b.curOp){return a.apply(this,arguments)}startOperation(b);try{return a.apply(this,arguments)}finally{endOperation(b)}}}function regChange(b,c,d,e){if(c==null){c=b.doc.first}if(d==null){d=b.doc.first+b.doc.size}if(!e){e=0}var a=b.display;if(e&&d<a.viewTo&&(a.updateLineNumbers==null||a.updateLineNumbers>c)){a.updateLineNumbers=c}b.curOp.viewChanged=!0;if(c>=a.viewTo){if(s&&visualLineNo(b.doc,c)<a.viewTo){resetView(b)}}else {if(d<=a.viewFrom){if(s&&visualLineEndNo(b.doc,d+e)>a.viewFrom){resetView(b)}else {a.viewFrom+=e;a.viewTo+=e}}else {if(c<=a.viewFrom&&d>=a.viewTo){resetView(b)}else {if(c<=a.viewFrom){var j=viewCuttingPoint(b,d,d+e,1);if(j){a.view=a.view.slice(j.index);a.viewFrom=j.lineN;a.viewTo+=e}else {resetView(b)}}else {if(d>=a.viewTo){var i=viewCuttingPoint(b,c,c,-1);if(i){a.view=a.view.slice(0,i.index);a.viewTo=i.lineN}else {resetView(b)}}else {var h=viewCuttingPoint(b,c,c,-1);var g=viewCuttingPoint(b,d,d+e,1);if(h&&g){a.view=a.view.slice(0,h.index).concat(buildViewArray(b,h.lineN,g.lineN)).concat(a.view.slice(g.index));a.viewTo+=e}else {resetView(b)}}}}}}var f=a.externalMeasured;if(f){if(d<f.lineN){f.lineN+=e}else {if(c<f.lineN+f.size){a.externalMeasured=null}}}}function regLineChange(d,a,f){d.curOp.viewChanged=!0;var b=d.display,c=d.display.externalMeasured;if(c&&a>=c.lineN&&a<c.lineN+c.size){b.externalMeasured=null}if(a<b.viewFrom||a>=b.viewTo){return}var e=b.view[findViewIndex(d,a)];if(e.node==null){return}var g=e.changes||(e.changes=[]);if(indexOf(g,f)==-1){g.push(f)}}function resetView(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function viewCuttingPoint(c,d,b,f){var a=findViewIndex(c,d),g,e=c.display.view;if(!s||b==c.doc.first+c.doc.size){return {index:a,lineN:b}}var h=c.display.viewFrom;for(var i=0;i<a;i++){h+=e[i].size}if(h!=d){if(f>0){if(a==e.length-1){return null}g=h+e[a].size-d;a++}else {g=h-d}d+=g;b+=g}while(visualLineNo(c.doc,b)!=b){if(a==(f<0?0:e.length-1)){return null}b+=f*e[a-(f<0?1:0)].size;a+=f}return {index:a,lineN:b}}function adjustView(d,b,c){var a=d.display,e=a.view;if(e.length==0||b>=a.viewTo||c<=a.viewFrom){a.view=buildViewArray(d,b,c);a.viewFrom=b}else {if(a.viewFrom>b){a.view=buildViewArray(d,b,a.viewFrom).concat(a.view)}else {if(a.viewFrom<b){a.view=a.view.slice(findViewIndex(d,b))}}a.viewFrom=b;if(a.viewTo<c){a.view=a.view.concat(buildViewArray(d,a.viewTo,c))}else {if(a.viewTo>c){a.view=a.view.slice(0,findViewIndex(d,c))}}}a.viewTo=c}function countDirtyView(e){var d=e.display.view,c=0;for(var b=0;b<d.length;b++){var a=d[b];if(!a.hidden&&(!a.node||a.changes)){++c}}return c}function startWorker(a,b){if(a.doc.highlightFrontier<a.display.viewTo){a.state.highlight.set(b,bind(highlightWorker,a))}}function highlightWorker(b){var c=b.doc;if(c.highlightFrontier>=b.display.viewTo){return}var e=+new Date()+b.options.workTime;var a=getContextBefore(b,c.highlightFrontier);var d=[];c.iter(a.line,Math.min(c.first+c.size,b.display.viewTo+500),function(f){if(a.line>=b.display.viewFrom){var i=f.styles;var m=f.text.length>b.options.maxHighlightLength?copyState(c.mode,a.state):null;var l=highlightLine(b,f,a,!0);if(m){a.state=m}f.styles=l.styles;var h=f.styleClasses,g=l.classes;if(g){f.styleClasses=g}else {if(h){f.styleClasses=null}}var k=!i||i.length!=f.styles.length||h!=g&&(!h||!g||h.bgClass!=g.bgClass||h.textClass!=g.textClass);for(var j=0;!k&&j<i.length;++j){k=i[j]!=f.styles[j]}if(k){d.push(a.line)}f.stateAfter=a.save();a.nextLine()}else {if(f.text.length<=b.options.maxHighlightLength){processLine(b,f.text,a)}f.stateAfter=a.line%5==0?a.save():null;a.nextLine()}if(+new Date()>e){startWorker(b,b.options.workDelay);return !0}});c.highlightFrontier=a.line;c.modeFrontier=Math.max(c.modeFrontier,a.line);if(d.length){runInOp(b,function(){for(var a=0;a<d.length;a++){regLineChange(b,d[a],'text')}})}}var X=function(b,c,d){var a=b.display;this.viewport=c;this.visible=visibleLines(a,b.doc,c);this.editorIsHidden=!a.wrapper.offsetWidth;this.wrapperHeight=a.wrapper.clientHeight;this.wrapperWidth=a.wrapper.clientWidth;this.oldDisplayWidth=displayWidth(b);this.force=d;this.dims=getDimensions(b);this.events=[]};X.prototype.signal=function(a,b){if(hasHandler(a,b)){this.events.push(arguments)}};X.prototype.finish=function(){var b=this;for(var a=0;a<this.events.length;a++){signal.apply(null,b.events[a])}};function maybeClipScrollbars(b){var a=b.display;if(!a.scrollbarsClipped&&a.scroller.offsetWidth){a.nativeBarWidth=a.scroller.offsetWidth-a.scroller.clientWidth;a.heightForcer.style.height=scrollGap(b)+'px';a.sizer.style.marginBottom=-a.nativeBarWidth+'px';a.sizer.style.borderRightWidth=scrollGap(b)+'px';a.scrollbarsClipped=!0}}function selectionSnapshot(d){if(d.hasFocus()){return null}var c=activeElt();if(!c||!contains(d.display.lineDiv,c)){return null}var b={activeElt:c};if(window.getSelection){var a=window.getSelection();if(a.anchorNode&&a.extend&&contains(d.display.lineDiv,a.anchorNode)){b.anchorNode=a.anchorNode;b.anchorOffset=a.anchorOffset;b.focusNode=a.focusNode;b.focusOffset=a.focusOffset}}return b}function restoreSelection(a){if(!a||!a.activeElt||a.activeElt==activeElt()){return}a.activeElt.focus();if(a.anchorNode&&contains(document.body,a.anchorNode)&&contains(document.body,a.focusNode)){var c=window.getSelection(),b=document.createRange();b.setEnd(a.anchorNode,a.anchorOffset);b.collapse(!1);c.removeAllRanges();c.addRange(b);c.extend(a.focusNode,a.focusOffset)}}function updateDisplayIfNeeded(b,c){var a=b.display,f=b.doc;if(c.editorIsHidden){resetView(b);return !1}if(!c.force&&c.visible.from>=a.viewFrom&&c.visible.to<=a.viewTo&&(a.updateLineNumbers==null||a.updateLineNumbers>=a.viewTo)&&a.renderedView==a.view&&countDirtyView(b)==0){return !1}if(maybeUpdateLineNumberWidth(b)){resetView(b);c.dims=getDimensions(b)}var i=f.first+f.size;var d=Math.max(c.visible.from-b.options.viewportMargin,f.first);var e=Math.min(i,c.visible.to+b.options.viewportMargin);if(a.viewFrom<d&&d-a.viewFrom<20){d=Math.max(f.first,a.viewFrom)}if(a.viewTo>e&&a.viewTo-e<20){e=Math.min(i,a.viewTo)}if(s){d=visualLineNo(b.doc,d);e=visualLineEndNo(b.doc,e)}var h=d!=a.viewFrom||e!=a.viewTo||a.lastWrapHeight!=c.wrapperHeight||a.lastWrapWidth!=c.wrapperWidth;adjustView(b,d,e);a.viewOffset=heightAtLine(getLine(b.doc,a.viewFrom));b.display.mover.style.top=a.viewOffset+'px';var g=countDirtyView(b);if(!h&&g==0&&!c.force&&a.renderedView==a.view&&(a.updateLineNumbers==null||a.updateLineNumbers>=a.viewTo)){return !1}var j=selectionSnapshot(b);if(g>4){a.lineDiv.style.display='none'}patchDisplay(b,a.updateLineNumbers,c.dims);if(g>4){a.lineDiv.style.display=''}a.renderedView=a.view;restoreSelection(j);removeChildren(a.cursorDiv);removeChildren(a.selectionDiv);a.gutters.style.height=a.sizer.style.minHeight=0;if(h){a.lastWrapHeight=c.wrapperHeight;a.lastWrapWidth=c.wrapperWidth;startWorker(b,400)}a.updateLineNumbers=null;return !0}function postUpdateDisplay(a,b){var c=b.viewport;for(var e=!0;;e=!1){if(!e||!a.options.lineWrapping||b.oldDisplayWidth==displayWidth(a)){if(c&&c.top!=null){c={top:Math.min(a.doc.height+paddingVert(a.display)-displayHeight(a),c.top)}}b.visible=visibleLines(a.display,a.doc,c);if(b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo){break}}if(!updateDisplayIfNeeded(a,b)){break}updateHeightsInViewport(a);var d=measureForScrollbars(a);updateSelection(a);updateScrollbars(a,d);setDocumentHeight(a,d);b.force=!1}b.signal(a,'update',a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo){b.signal(a,'viewportChange',a,a.display.viewFrom,a.display.viewTo);a.display.reportedViewFrom=a.display.viewFrom;a.display.reportedViewTo=a.display.viewTo}}function updateDisplaySimple(a,d){var b=new X(a,d);if(updateDisplayIfNeeded(a,b)){updateHeightsInViewport(a);postUpdateDisplay(a,b);var c=measureForScrollbars(a);updateSelection(a);updateScrollbars(a,c);setDocumentHeight(a,c);b.finish()}}function patchDisplay(c,i,k){var f=c.display,m=c.options.lineNumbers;var e=f.lineDiv,b=e.firstChild;function rm(a){var b=a.nextSibling;if(h&&o&&c.display.currentWheelTarget==a){a.style.display='none'}else {a.parentNode.removeChild(a)}return b}var l=f.view,d=f.viewFrom;for(var g=0;g<l.length;g++){var a=l[g];if(a.hidden){}else {if(!a.node||a.node.parentNode!=e){var n=buildLineElement(c,a,d,k);e.insertBefore(n,b)}else {while(b!=a.node){b=rm(b)}var j=m&&i!=null&&i<=d&&a.lineNumber;if(a.changes){if(indexOf(a.changes,'gutter')>-1){j=!1}updateLineForChanges(c,a,d,k)}if(j){removeChildren(a.lineNumber);a.lineNumber.appendChild(document.createTextNode(lineNumberFor(c.options,d)))}b=a.node.nextSibling}}d+=a.size}while(b){b=rm(b)}}function updateGutterSpace(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+'px'}function setDocumentHeight(a,b){a.display.sizer.style.minHeight=b.docHeight+'px';a.display.heightForcer.style.top=b.docHeight+'px';a.display.gutters.style.height=b.docHeight+a.display.barHeight+scrollGap(a)+'px'}function updateGutters(a){var c=a.display.gutters,e=a.options.gutters;removeChildren(c);var b=0;for(;b<e.length;++b){var d=e[b];var f=c.appendChild(elt('div',null,'CodeMirror-gutter '+d));if(d=='CodeMirror-linenumbers'){a.display.lineGutter=f;f.style.width=(a.display.lineNumWidth||1)+'px'}}c.style.display=b?'':'none';updateGutterSpace(a)}function setGuttersForLineNumbers(a){var b=indexOf(a.gutters,'CodeMirror-linenumbers');if(b==-1&&a.lineNumbers){a.gutters=a.gutters.concat(['CodeMirror-linenumbers'])}else {if(b>-1&&!a.lineNumbers){a.gutters=a.gutters.slice(0);a.gutters.splice(b,1)}}}var Z=0;var k=null;if(b){k=-0.53}else {if(v){k=15}else {if(aa){k=-0.7}else {if(aB){k=-1/3}}}}function wheelEventDelta(a){var c=a.wheelDeltaX,b=a.wheelDeltaY;if(c==null&&a.detail&&a.axis==a.HORIZONTAL_AXIS){c=a.detail}if(b==null&&a.detail&&a.axis==a.VERTICAL_AXIS){b=a.detail}else {if(b==null){b=a.wheelDelta}}return {x:c,y:b}}function wheelEventPixels(b){var a=wheelEventDelta(b);a.x*=k;a.y*=k;return a}function onScrollWheel(d,m){var q=wheelEventDelta(m),f=q.x,c=q.y;var a=d.display,b=a.scroller;var s=b.scrollWidth>b.clientWidth;var i=b.scrollHeight>b.clientHeight;if(!(f&&s||c&&i)){return}if(c&&o&&h){outer: for(var e=m.target,r=a.view;e!=b;e=e.parentNode){for(var p=0;p<r.length;p++){if(r[p].node==e){d.display.currentWheelTarget=e;break outer}}}}if(f&&!v&&!n&&k!=null){if(c&&i){updateScrollTop(d,Math.max(0,b.scrollTop+c*k))}setScrollLeft(d,Math.max(0,b.scrollLeft+f*k));if(!c||c&&i){e_preventDefault(m)}a.wheelStartX=null;return}if(c&&k!=null){var j=c*k;var g=d.doc.scrollTop,l=g+a.wrapper.clientHeight;if(j<0){g=Math.max(0,g+j-50)}else {l=Math.min(d.doc.height,l+j+50)}updateDisplaySimple(d,{top:g,bottom:l})}if(Z<20){if(a.wheelStartX==null){a.wheelStartX=b.scrollLeft;a.wheelStartY=b.scrollTop;a.wheelDX=f;a.wheelDY=c;setTimeout(function(){if(a.wheelStartX==null){return}var c=b.scrollLeft-a.wheelStartX;var d=b.scrollTop-a.wheelStartY;var e=d&&a.wheelDY&&d/a.wheelDY||c&&a.wheelDX&&c/a.wheelDX;a.wheelStartX=a.wheelStartY=null;if(!e){return}k=(k*Z+e)/(Z+1);++Z},200)}else {a.wheelDX+=f;a.wheelDY+=c}}}var l=function(b,a){this.ranges=b;this.primIndex=a};l.prototype.primary=function(){return this.ranges[this.primIndex]};l.prototype.equals=function(a){var e=this;if(a==this){return !0}if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length){return !1}for(var b=0;b<this.ranges.length;b++){var d=e.ranges[b],c=a.ranges[b];if(!equalCursorPos(d.anchor,c.anchor)||!equalCursorPos(d.head,c.head)){return !1}}return !0};l.prototype.deepCopy=function(){var b=this;var d=[];for(var a=0;a<this.ranges.length;a++){d[a]=new c(copyPos(b.ranges[a].anchor),copyPos(b.ranges[a].head))}return new l(d,this.primIndex)};l.prototype.somethingSelected=function(){var b=this;for(var a=0;a<this.ranges.length;a++){if(!b.ranges[a].empty()){return !0}}return !1};l.prototype.contains=function(d,b){var e=this;if(!b){b=d}for(var a=0;a<this.ranges.length;a++){var c=e.ranges[a];if(cmp(b,c.from())>=0&&cmp(d,c.to())<=0){return a}}return -1};var c=function(a,b){this.anchor=a;this.head=b};c.prototype.from=function(){return minPos(this.anchor,this.head)};c.prototype.to=function(){return maxPos(this.anchor,this.head)};c.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function normalizeSelection(a,e){var j=a[e];a.sort(function(a,b){return cmp(a.from(),b.from())});e=indexOf(a,j);for(var d=1;d<a.length;d++){var f=a[d],b=a[d-1];if(cmp(b.to(),f.from())>=0){var g=minPos(b.from(),f.from()),i=maxPos(b.to(),f.to());var h=b.empty()?f.from()==f.head:b.from()==b.head;if(d<=e){--e}a.splice(--d,2,new c(h?i:g,h?g:i))}}return new l(a,e)}function simpleSelection(a,b){return new l([new c(a,b||a)],0)}function changeEnd(a){if(!a.text){return a.to}return Pos(a.from.line+a.text.length-1,lst(a.text).length+(a.text.length==1?a.from.ch:0))}function adjustForChange(b,a){if(cmp(b,a.from)<0){return b}if(cmp(b,a.to)<=0){return changeEnd(a)}var d=b.line+a.text.length-(a.to.line-a.from.line)-1,c=b.ch;if(b.line==a.to.line){c+=changeEnd(a).ch-a.to.ch}return Pos(d,c)}function computeSelAfterChange(a,d){var f=[];for(var b=0;b<a.sel.ranges.length;b++){var e=a.sel.ranges[b];f.push(new c(adjustForChange(e.anchor,d),adjustForChange(e.head,d)))}return normalizeSelection(f,a.sel.primIndex)}function offsetPos(a,b,c){if(a.line==b.line){return Pos(c.line,a.ch-b.ch+c.ch)}else {return Pos(c.line+(a.line-b.line),a.ch)}}function computeReplacedSel(g,j,n){var h=[];var b=Pos(g.first,0),e=b;for(var a=0;a<j.length;a++){var f=j[a];var d=offsetPos(f.from,b,e);var i=offsetPos(changeEnd(f),b,e);b=f.to;e=i;if(n=='around'){var k=g.sel.ranges[a],m=cmp(k.head,k.anchor)<0;h[a]=new c(m?i:d,m?d:i)}else {h[a]=new c(d,d)}}return new l(h,g.sel.primIndex)}function loadMode(a){a.doc.mode=getMode(a.options,a.doc.modeOption);resetModeState(a)}function resetModeState(a){a.doc.iter(function(a){if(a.stateAfter){a.stateAfter=null}if(a.styles){a.styles=null}});a.doc.modeFrontier=a.doc.highlightFrontier=a.doc.first;startWorker(a,100);a.state.modeGen++;if(a.curOp){regChange(a)}}function isWholeLineUpdate(b,a){return a.from.ch==0&&a.to.ch==0&&lst(a.text)==''&&(!b.cm||b.cm.options.wholeLineUpdateBefore)}function updateDoc(b,e,l,j){function spansFor(a){return l?l[a]:null}function update(a,c,b){updateLine(a,c,b,j);signalLater(a,'change',a,e)}function linesFor(d,e){var c=[];for(var b=d;b<e;++b){c.push(new G(a[b],spansFor(b),j))}return c}var c=e.from,g=e.to,a=e.text;var d=getLine(b,c.line),f=getLine(b,g.line);var k=lst(a),i=spansFor(a.length-1),h=g.line-c.line;if(e.full){b.insert(0,linesFor(0,a.length));b.remove(a.length,b.size-a.length)}else {if(isWholeLineUpdate(b,e)){var n=linesFor(0,a.length-1);update(f,f.text,i);if(h){b.remove(c.line,h)}if(n.length){b.insert(c.line,n)}}else {if(d==f){if(a.length==1){update(d,d.text.slice(0,c.ch)+k+d.text.slice(g.ch),i)}else {var m=linesFor(1,a.length-1);m.push(new G(k+d.text.slice(g.ch),i,j));update(d,d.text.slice(0,c.ch)+a[0],spansFor(0));b.insert(c.line+1,m)}}else {if(a.length==1){update(d,d.text.slice(0,c.ch)+a[0]+f.text.slice(g.ch),spansFor(0));b.remove(c.line+1,h)}else {update(d,d.text.slice(0,c.ch)+a[0],spansFor(0));update(f,k+f.text.slice(g.ch),i);var o=linesFor(1,a.length-1);if(h>1){b.remove(c.line+1,h-1)}b.insert(c.line+1,o)}}}}signalLater(b,'change',b,e)}function linkedDocs(b,c,a){function propagate(b,h,g){if(b.linked){for(var f=0;f<b.linked.length;++f){var d=b.linked[f];if(d.doc==h){continue}var e=g&&d.sharedHist;if(a&&!e){continue}c(d.doc,e);propagate(d.doc,b,e)}}}propagate(b,null,!0)}function attachDoc(a,b){if(b.cm){throw new Error('This document is already in use.')}a.doc=b;b.cm=a;estimateLineHeights(a);loadMode(a);setDirectionClass(a);if(!a.options.lineWrapping){findMaxLine(a)}a.options.mode=b.modeOption;regChange(a)}function setDirectionClass(a){(a.doc.direction=='rtl'?addClass:A)(a.display.lineDiv,'CodeMirror-rtl')}function directionChanged(a){runInOp(a,function(){setDirectionClass(a);regChange(a)})}function History(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=a||1}function historyChangeFromChange(c,a){var b={from:copyPos(a.from),to:changeEnd(a),text:getBetween(c,a.from,a.to)};attachLocalSpans(c,b,a.from.line,a.to.line+1);linkedDocs(c,function(c){return attachLocalSpans(c,b,a.from.line,a.to.line+1)},!0);return b}function clearSelectionEvents(a){while(a.length){var b=lst(a);if(b.ranges){a.pop()}else {break}}}function lastChangeEvent(a,b){if(b){clearSelectionEvents(a.done);return lst(a.done)}else {if(a.done.length&&!lst(a.done).ranges){return lst(a.done)}else {if(a.done.length>1&&!a.done[a.done.length-2].ranges){a.done.pop();return lst(a.done)}}}}function addChangeToHistory(c,b,i,f){var a=c.history;a.undone.length=0;var h=+new Date(),d;var e;if((a.lastOp==f||a.lastOrigin==b.origin&&b.origin&&(b.origin.charAt(0)=='+'&&c.cm&&a.lastModTime>h-c.cm.options.historyEventDelay||b.origin.charAt(0)=='*'))&&(d=lastChangeEvent(a,a.lastOp==f))){e=lst(d.changes);if(cmp(b.from,b.to)==0&&cmp(b.from,e.to)==0){e.to=changeEnd(b)}else {d.changes.push(historyChangeFromChange(c,b))}}else {var g=lst(a.done);if(!g||!g.ranges){pushSelectionToHistory(c.sel,a.done)}d={changes:[historyChangeFromChange(c,b)],generation:a.generation};a.done.push(d);while(a.done.length>a.undoDepth){a.done.shift();if(!a.done[0].ranges){a.done.shift()}}}a.done.push(i);a.generation=++a.maxGeneration;a.lastModTime=a.lastSelTime=h;a.lastOp=a.lastSelOp=f;a.lastOrigin=a.lastSelOrigin=b.origin;if(!e){signal(c,'historyAdded')}}function selectionEventCanBeMerged(a,e,b,c){var d=e.charAt(0);return d=='*'||d=='+'&&b.ranges.length==c.ranges.length&&b.somethingSelected()==c.somethingSelected()&&new Date()-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function addSelectionToHistory(f,d,e,c){var a=f.history,b=c&&c.origin;if(e==a.lastSelOp||b&&a.lastSelOrigin==b&&(a.lastModTime==a.lastSelTime&&a.lastOrigin==b||selectionEventCanBeMerged(f,b,lst(a.done),d))){a.done[a.done.length-1]=d}else {pushSelectionToHistory(d,a.done)}a.lastSelTime=+new Date();a.lastSelOrigin=b;a.lastSelOp=e;if(c&&c.clearRedo!==!1){clearSelectionEvents(a.undone)}}function pushSelectionToHistory(c,b){var a=lst(b);if(!(a&&a.ranges&&a.equals(c))){b.push(c)}}function attachLocalSpans(a,c,e,f){var b=c['spans_'+a.id],d=0;a.iter(Math.max(a.first,e),Math.min(a.first+a.size,f),function(e){if(e.markedSpans){(b||(b=c['spans_'+a.id]={}))[d]=e.markedSpans}++d})}function removeClearedSpans(b){if(!b){return null}var a;for(var c=0;c<b.length;++c){if(b[c].marker.explicitlyCleared){if(!a){a=b.slice(0,c)}}else {if(a){a.push(b[c])}}}return !a?b:a.length?a:null}function getOldSpans(e,b){var c=b['spans_'+e.id];if(!c){return null}var d=[];for(var a=0;a<b.text.length;++a){d.push(removeClearedSpans(c[a]))}return d}function mergeOldSpans(j,h){var a=getOldSpans(j,h);var e=stretchSpansOverChange(j,h);if(!a){return e}if(!e){return a}for(var c=0;c<a.length;++c){var d=a[c],b=e[c];if(d&&b){spans: for(var f=0;f<b.length;++f){var i=b[f];for(var g=0;g<d.length;++g){if(d[g].marker==i.marker){continue spans}}d.push(i)}}else {if(b){a[c]=b}}}return a}function copyHistoryArray(j,h,m){var e=[];for(var f=0;f<j.length;++f){var b=j[f];if(b.ranges){e.push(m?l.prototype.deepCopy.call(b):b);continue}var i=b.changes,d=[];e.push({changes:d});for(var g=0;g<i.length;++g){var a=i[g],k=void 0;d.push({from:a.from,to:a.to,text:a.text});if(h){for(var c in a){if(k=c.match(/^spans_(\d+)$/)){if(indexOf(h,Number(k[1]))>-1){lst(d)[c]=a[c];delete a[c]}}}}}}return e}function extendRange(g,a,b,f){if(f){var d=g.anchor;if(b){var e=cmp(a,d)<0;if(e!=cmp(b,d)<0){d=a;a=b}else {if(e!=cmp(a,b)<0){a=b}}}return new c(d,a)}else {return new c(b||a,a)}}function extendSelection(a,e,d,c,b){if(b==null){b=a.cm&&(a.cm.display.shift||a.extend)}setSelection(a,new l([extendRange(a.sel.primary(),e,d,b)],0),c)}function extendSelections(a,g,d){var c=[];var e=a.cm&&(a.cm.display.shift||a.extend);for(var b=0;b<a.sel.ranges.length;b++){c[b]=extendRange(a.sel.ranges[b],g[b],null,e)}var f=normalizeSelection(c,a.sel.primIndex);setSelection(a,f,d)}function replaceOneSelection(a,e,d,c){var b=a.sel.ranges.slice(0);b[e]=d;setSelection(a,normalizeSelection(b,a.sel.primIndex),c)}function setSimpleSelection(d,b,c,a){setSelection(d,simpleSelection(b,c),a)}function filterSelectionChange(a,d,e){var b={ranges:d.ranges,update:function(d){var e=this;this.ranges=[];for(var b=0;b<d.length;b++){e.ranges[b]=new c(clipPos(a,d[b].anchor),clipPos(a,d[b].head))}},origin:e&&e.origin};signal(a,'beforeSelectionChange',a,b);if(a.cm){signal(a.cm,'beforeSelectionChange',a.cm,b)}if(b.ranges!=d.ranges){return normalizeSelection(b.ranges,b.ranges.length-1)}else {return d}}function setSelectionReplaceHistory(b,c,d){var a=b.history.done,e=lst(a);if(e&&e.ranges){a[a.length-1]=c;setSelectionNoUndo(b,c,d)}else {setSelection(b,c,d)}}function setSelection(a,c,b){setSelectionNoUndo(a,c,b);addSelectionToHistory(a,a.sel,a.cm?a.cm.curOp.id:NaN,b)}function setSelectionNoUndo(a,c,b){if(hasHandler(a,'beforeSelectionChange')||a.cm&&hasHandler(a.cm,'beforeSelectionChange')){c=filterSelectionChange(a,c,b)}var d=b&&b.bias||(cmp(c.primary().head,a.sel.primary().head)<0?-1:1);setSelectionInner(a,skipAtomicInSelection(a,c,d,!0));if(!(b&&b.scroll===!1)&&a.cm){ensureCursorVisible(a.cm)}}function setSelectionInner(a,b){if(b.equals(a.sel)){return}a.sel=b;if(a.cm){a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0;signalCursorActivity(a.cm)}signalLater(a,'cursorActivity',a)}function reCheckSelection(a){setSelectionInner(a,skipAtomicInSelection(a,a.sel,null,!1))}function skipAtomicInSelection(f,b,k,i){var a;for(var d=0;d<b.ranges.length;d++){var e=b.ranges[d];var g=b.ranges.length==f.sel.ranges.length&&f.sel.ranges[d];var h=skipAtomic(f,e.anchor,g&&g.anchor,k,i);var j=skipAtomic(f,e.head,g&&g.head,k,i);if(a||h!=e.anchor||j!=e.head){if(!a){a=b.ranges.slice(0,d)}a[d]=new c(h,j)}}return a?normalizeSelection(a,b.primIndex):b}function skipAtomicInner(g,a,l,c,j){var f=getLine(g,a.line);if(f.markedSpans){for(var i=0;i<f.markedSpans.length;++i){var e=f.markedSpans[i],b=e.marker;if((e.from==null||(b.inclusiveLeft?e.from<=a.ch:e.from<a.ch))&&(e.to==null||(b.inclusiveRight?e.to>=a.ch:e.to>a.ch))){if(j){signal(b,'beforeCursorEnter');if(b.explicitlyCleared){if(!f.markedSpans){break}else {--i;continue}}}if(!b.atomic){continue}if(l){var d=b.find(c<0?1:-1),k=void 0;if(c<0?b.inclusiveRight:b.inclusiveLeft){d=movePos(g,d,-c,d&&d.line==a.line?f:null)}if(d&&d.line==a.line&&(k=cmp(d,l))&&(c<0?k<0:k>0)){return skipAtomicInner(g,d,a,c,j)}}var h=b.find(c<0?-1:1);if(c<0?b.inclusiveLeft:b.inclusiveRight){h=movePos(g,h,c,h.line==a.line?f:null)}return h?skipAtomicInner(g,h,a,c,j):null}}}return a}function skipAtomic(a,e,c,g,b){var d=g||1;var f=skipAtomicInner(a,e,c,d,b)||!b&&skipAtomicInner(a,e,c,d,!0)||skipAtomicInner(a,e,c,-d,b)||!b&&skipAtomicInner(a,e,c,-d,!0);if(!f){a.cantEdit=!0;return Pos(a.first,0)}return f}function movePos(b,a,c,d){if(c<0&&a.ch==0){if(a.line>b.first){return clipPos(b,Pos(a.line-1))}else {return null}}else {if(c>0&&a.ch==(d||getLine(b,a.line)).text.length){if(a.line<b.first+b.size-1){return Pos(a.line+1,0)}else {return null}}else {return new Pos(a.line,a.ch+c)}}}function selectAll(a){a.setSelection(Pos(a.firstLine(),0),Pos(a.lastLine()),p)}function filterChange(b,c,d){var a={canceled:!1,from:c.from,to:c.to,text:c.text,origin:c.origin,cancel:function(){return a.canceled=!0}};if(d){a.update=function(d,f,e,c){if(d){a.from=clipPos(b,d)}if(f){a.to=clipPos(b,f)}if(e){a.text=e}if(c!==undefined){a.origin=c}}}signal(b,'beforeChange',b,a);if(b.cm){signal(b.cm,'beforeChange',b.cm,a)}if(a.canceled){return null}return {from:a.from,to:a.to,text:a.text,origin:a.origin}}function makeChange(a,b,e){if(a.cm){if(!a.cm.curOp){return operation(a.cm,makeChange)(a,b,e)}if(a.cm.state.suppressEdits){return}}if(hasHandler(a,'beforeChange')||a.cm&&hasHandler(a.cm,'beforeChange')){b=filterChange(a,b,!0);if(!b){return}}var d=ap&&!e&&removeReadOnlyRanges(a,b.from,b.to);if(d){for(var c=d.length-1;c>=0;--c){makeChangeInner(a,{from:d[c].from,to:d[c].to,text:c?['']:b.text,origin:b.origin})}}else {makeChangeInner(a,b)}}function makeChangeInner(b,a){if(a.text.length==1&&a.text[0]==''&&cmp(a.from,a.to)==0){return}var c=computeSelAfterChange(b,a);addChangeToHistory(b,a,c,b.cm?b.cm.curOp.id:NaN);makeChangeSingleDoc(b,a,c,stretchSpansOverChange(b,a));var d=[];linkedDocs(b,function(b,c){if(!c&&indexOf(d,b.history)==-1){rebaseHist(b.history,a);d.push(b.history)}makeChangeSingleDoc(b,a,null,stretchSpansOverChange(b,a))})}function makeChangeFromHistory(a,h,f){if(a.cm&&a.cm.state.suppressEdits&&!f){return}var c=a.history,b,l=a.sel;var d=h=='undo'?c.done:c.undone,g=h=='undo'?c.undone:c.done;var e=0;for(;e<d.length;e++){b=d[e];if(f?b.ranges&&!b.equals(a.sel):!b.ranges){break}}if(e==d.length){return}c.lastOrigin=c.lastSelOrigin=null;for(;;){b=d.pop();if(b.ranges){pushSelectionToHistory(b,g);if(f&&!b.equals(a.sel)){setSelection(a,b,{clearRedo:!1});return}l=b}else {break}}var j=[];pushSelectionToHistory(l,g);g.push({changes:j,generation:c.generation});c.generation=b.generation||++c.maxGeneration;var m=hasHandler(a,'beforeChange')||a.cm&&hasHandler(a.cm,'beforeChange');var n=function(e){var c=b.changes[e];c.origin=h;if(m&&!filterChange(a,c,!1)){d.length=0;return {}}j.push(historyChangeFromChange(a,c));var g=e?computeSelAfterChange(a,c):lst(d);makeChangeSingleDoc(a,c,g,mergeOldSpans(a,c));if(!e&&a.cm){a.cm.scrollIntoView({from:c.from,to:changeEnd(c)})}var f=[];linkedDocs(a,function(a,b){if(!b&&indexOf(f,a.history)==-1){rebaseHist(a.history,c);f.push(a.history)}makeChangeSingleDoc(a,c,null,mergeOldSpans(a,c))})};for(var i=b.changes.length-1;i>=0;--i){var k=n(i);if(k){return k.v}}}function shiftDoc(a,b){if(b==0){return}a.first+=b;a.sel=new l(map(a.sel.ranges,function(a){return new c(Pos(a.anchor.line+b,a.anchor.ch),Pos(a.head.line+b,a.head.ch))}),a.sel.primIndex);if(a.cm){regChange(a.cm,a.first,a.first-b,b);for(var e=a.cm.display,d=e.viewFrom;d<e.viewTo;d++){regLineChange(a.cm,d,'gutter')}}}function makeChangeSingleDoc(b,a,c,d){if(b.cm&&!b.cm.curOp){return operation(b.cm,makeChangeSingleDoc)(b,a,c,d)}if(a.to.line<b.first){shiftDoc(b,a.text.length-1-(a.to.line-a.from.line));return}if(a.from.line>b.lastLine()){return}if(a.from.line<b.first){var f=a.text.length-1-(b.first-a.from.line);shiftDoc(b,f);a={from:Pos(b.first,0),to:Pos(a.to.line+f,a.to.ch),text:[lst(a.text)],origin:a.origin}}var e=b.lastLine();if(a.to.line>e){a={from:a.from,to:Pos(e,getLine(b,e).text.length),text:[a.text[0]],origin:a.origin}}a.removed=getBetween(b,a.from,a.to);if(!c){c=computeSelAfterChange(b,a)}if(b.cm){makeChangeSingleDocInEditor(b.cm,a,d)}else {updateDoc(b,a,d)}setSelectionNoUndo(b,c,p)}function makeChangeSingleDocInEditor(a,b,m){var d=a.doc,e=a.display,c=b.from,f=b.to;var g=!1,h=c.line;if(!a.options.lineWrapping){h=lineNo(visualLine(getLine(d,c.line)));d.iter(h,f.line+1,function(a){if(a==e.maxLine){g=!0;return !0}})}if(d.sel.contains(b.from,b.to)>-1){signalCursorActivity(a)}updateDoc(d,b,m,estimateHeight(a));if(!a.options.lineWrapping){d.iter(h,c.line+b.text.length,function(a){var b=lineLength(a);if(b>e.maxLineLength){e.maxLine=a;e.maxLineLength=b;e.maxLineChanged=!0;g=!1}});if(g){a.curOp.updateMaxLine=!0}}retreatFrontier(d,c.line);startWorker(a,400);var l=b.text.length-(f.line-c.line)-1;if(b.full){regChange(a)}else {if(c.line==f.line&&b.text.length==1&&!isWholeLineUpdate(a.doc,b)){regLineChange(a,c.line,'text')}else {regChange(a,c.line,f.line+1,l)}}var i=hasHandler(a,'changes'),j=hasHandler(a,'change');if(j||i){var k={from:c,to:f,text:b.text,removed:b.removed,origin:b.origin};if(j){signalLater(a,'change',a,k)}if(i){(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(k)}}a.display.selForContextMenu=null}function replaceRange(e,d,b,a,f){if(!a){a=b}if(cmp(a,b)<0){var c;c=[a,b],b=c[0],a=c[1],c}if(typeof d=='string'){d=e.splitLines(d)}makeChange(e,{from:b,to:a,text:d,origin:f})}function rebaseHistSelSingle(a,b,d,c){if(d<a.line){a.line+=c}else {if(b<a.line){a.line=b;a.ch=0}}}function rebaseHistArray(d,g,i,e){for(var c=0;c<d.length;++c){var a=d[c],j=!0;if(a.ranges){if(!a.copied){a=d[c]=a.deepCopy();a.copied=!0}for(var f=0;f<a.ranges.length;f++){rebaseHistSelSingle(a.ranges[f].anchor,g,i,e);rebaseHistSelSingle(a.ranges[f].head,g,i,e)}continue}for(var h=0;h<a.changes.length;++h){var b=a.changes[h];if(i<b.from.line){b.from=Pos(b.from.line+e,b.from.ch);b.to=Pos(b.to.line+e,b.to.ch)}else {if(g<=b.to.line){j=!1;break}}}if(!j){d.splice(0,c+1);c=0}}}function rebaseHist(e,a){var b=a.from.line,c=a.to.line,d=a.text.length-(c-b)-1;rebaseHistArray(e.done,b,c,d);rebaseHistArray(e.undone,b,c,d)}function changeLine(b,a,e,f){var c=a,d=a;if(typeof a=='number'){d=getLine(b,clipLine(b,a))}else {c=lineNo(a)}if(c==null){return null}if(f(d,c)&&b.cm){regLineChange(b.cm,c,e)}return d}function LeafChunk(a){var d=this;this.lines=a;this.parent=null;var c=0;for(var b=0;b<a.length;++b){a[b].parent=d;c+=a[b].height}this.height=c}LeafChunk.prototype={chunkSize:function chunkSize(){return this.lines.length},removeInner:function removeInner(b,e){var d=this;for(var c=b,f=b+e;c<f;++c){var a=d.lines[c];d.height-=a.height;cleanUpLine(a);signalLater(a,'delete')}this.lines.splice(b,e)},collapse:function collapse(a){a.push.apply(a,this.lines)},insertInner:function insertInner(c,a,d){var e=this;this.height+=d;this.lines=this.lines.slice(0,c).concat(a).concat(this.lines.slice(c));for(var b=0;b<a.length;++b){a[b].parent=e}},iterN:function iterN(a,e,c){var b=this;for(var d=a+e;a<d;++a){if(c(b.lines[a])){return !0}}}};function BranchChunk(a){var f=this;this.children=a;var e=0,d=0;for(var c=0;c<a.length;++c){var b=a[c];e+=b.chunkSize();d+=b.height;b.parent=f}this.size=e;this.height=d;this.parent=null}BranchChunk.prototype={chunkSize:function chunkSize(){return this.size},removeInner:function removeInner(b,e){var f=this;this.size-=e;for(var d=0;d<this.children.length;++d){var a=f.children[d],c=a.chunkSize();if(b<c){var g=Math.min(e,c-b),i=a.height;a.removeInner(b,g);f.height-=i-a.height;if(c==g){f.children.splice(d--,1);a.parent=null}if((e-=g)==0){break}b=0}else {b-=c}}if(this.size-e<25&&(this.children.length>1||!(this.children[0] instanceof LeafChunk))){var h=[];this.collapse(h);this.children=[new LeafChunk(h)];this.children[0].parent=this}},collapse:function collapse(c){var b=this;for(var a=0;a<this.children.length;++a){b.children[a].collapse(c)}},insertInner:function insertInner(f,i,h){var b=this;this.size+=i.length;this.height+=h;for(var c=0;c<this.children.length;++c){var a=b.children[c],j=a.chunkSize();if(f<=j){a.insertInner(f,i,h);if(a.lines&&a.lines.length>50){var g=a.lines.length%25+25;for(var e=g;e<a.lines.length;){var d=new LeafChunk(a.lines.slice(e,e+=25));a.height-=d.height;b.children.splice(++c,0,d);d.parent=b}a.lines=a.lines.slice(0,g);b.maybeSpill()}break}f-=j}},maybeSpill:function maybeSpill(){if(this.children.length<=10){return}var a=this;do{var e=a.children.splice(a.children.length-5,5);var b=new BranchChunk(e);if(!a.parent){var c=new BranchChunk(a.children);c.parent=a;a.children=[c,b];a=c}else {a.size-=b.size;a.height-=b.height;var d=indexOf(a.parent.children,a);a.parent.children.splice(d+1,0,b)}b.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()},iterN:function iterN(a,f,h){var g=this;for(var c=0;c<this.children.length;++c){var d=g.children[c],b=d.chunkSize();if(a<b){var e=Math.min(f,b-a);if(d.iterN(a,e,h)){return !0}if((f-=e)==0){break}a=0}else {a-=b}}}};var M=function(e,d,a){var c=this;if(a){for(var b in a){if(a.hasOwnProperty(b)){c[b]=a[b]}}}this.doc=e;this.node=d};M.prototype.clear=function(){var g=this;var a=this.doc.cm,c=this.line.widgets,b=this.line,e=lineNo(b);if(e==null||!c){return}for(var d=0;d<c.length;++d){if(c[d]==g){c.splice(d--,1)}}if(!c.length){b.widgets=null}var f=widgetHeight(this);updateLineHeight(b,Math.max(0,b.height-f));if(a){runInOp(a,function(){adjustScrollWhenAboveVisible(a,b,-f);regLineChange(a,e,'widget')});signalLater(a,'lineWidgetCleared',a,this,e)}};M.prototype.changed=function(){var d=this;var e=this.height,a=this.doc.cm,b=this.line;this.height=null;var c=widgetHeight(this)-e;if(!c){return}updateLineHeight(b,b.height+c);if(a){runInOp(a,function(){a.curOp.forceUpdate=!0;adjustScrollWhenAboveVisible(a,b,c);signalLater(a,'lineWidgetChanged',a,d,lineNo(b))})}};eventMixin(M);function adjustScrollWhenAboveVisible(a,c,b){if(heightAtLine(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)){addToScrollTop(a,b)}}function addLineWidget(c,d,f,e){var a=new M(c,f,e);var b=c.cm;if(b&&a.noHScroll){b.display.alignWidgets=!0}changeLine(c,d,'widget',function(d){var e=d.widgets||(d.widgets=[]);if(a.insertAt==null){e.push(a)}else {e.splice(Math.min(e.length-1,Math.max(0,a.insertAt)),0,a)}a.line=d;if(b&&!lineIsHidden(c,d)){var f=heightAtLine(d)<c.scrollTop;updateLineHeight(d,d.height+widgetHeight(a));if(f){addToScrollTop(b,a.height)}b.curOp.forceUpdate=!0}return !0});signalLater(b,'lineWidgetAdded',b,a,typeof d=='number'?d:lineNo(d));return a}var ar=0;var t=function(b,a){this.lines=[];this.type=a;this.doc=b;this.id=++ar};t.prototype.clear=function(){var c=this;if(this.explicitlyCleared){return}var a=this.doc.cm,k=a&&!a.curOp;if(k){startOperation(a)}if(hasHandler(this,'clear')){var f=this.find();if(f){signalLater(this,'clear',f.from,f.to)}}var e=null,h=null;for(var i=0;i<this.lines.length;++i){var b=c.lines[i];var d=getMarkedSpanFor(b.markedSpans,c);if(a&&!c.collapsed){regLineChange(a,lineNo(b),'text')}else {if(a){if(d.to!=null){h=lineNo(b)}if(d.from!=null){e=lineNo(b)}}}b.markedSpans=removeMarkedSpan(b.markedSpans,d);if(d.from==null&&c.collapsed&&!lineIsHidden(c.doc,b)&&a){updateLineHeight(b,textHeight(a.display))}}if(a&&this.collapsed&&!a.options.lineWrapping){for(var g=0;g<this.lines.length;++g){var j=visualLine(c.lines[g]),l=lineLength(j);if(l>a.display.maxLineLength){a.display.maxLine=j;a.display.maxLineLength=l;a.display.maxLineChanged=!0}}}if(e!=null&&a&&this.collapsed){regChange(a,e,h+1)}this.lines.length=0;this.explicitlyCleared=!0;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=!1;if(a){reCheckSelection(a.doc)}}if(a){signalLater(a,'markerCleared',a,this,e,h)}if(k){endOperation(a)}if(this.parent){this.parent.clear()}};t.prototype.find=function(c,g){var h=this;if(c==null&&this.type=='bookmark'){c=1}var b,e;for(var f=0;f<this.lines.length;++f){var a=h.lines[f];var d=getMarkedSpanFor(a.markedSpans,h);if(d.from!=null){b=Pos(g?a:lineNo(a),d.from);if(c==-1){return b}}if(d.to!=null){e=Pos(g?a:lineNo(a),d.to);if(c==1){return e}}}return b&&{from:b,to:e}};t.prototype.changed=function(){var d=this;var c=this.find(-1,!0),b=this,a=this.doc.cm;if(!c||!a){return}runInOp(a,function(){var e=c.line,i=lineNo(c.line);var g=findViewForLine(a,i);if(g){clearLineMeasurementCacheFor(g);a.curOp.selectionChanged=a.curOp.forceUpdate=!0}a.curOp.updateMaxLine=!0;if(!lineIsHidden(b.doc,e)&&b.height!=null){var h=b.height;b.height=null;var f=widgetHeight(b)-h;if(f){updateLineHeight(e,e.height+f)}}signalLater(a,'markerChanged',a,d)})};t.prototype.attachLine=function(b){if(!this.lines.length&&this.doc.cm){var a=this.doc.cm.curOp;if(!a.maybeHiddenMarkers||indexOf(a.maybeHiddenMarkers,this)==-1){(a.maybeUnhiddenMarkers||(a.maybeUnhiddenMarkers=[])).push(this)}}this.lines.push(b)};t.prototype.detachLine=function(b){this.lines.splice(indexOf(this.lines,b),1);if(!this.lines.length&&this.doc.cm){var a=this.doc.cm.curOp;(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this)}};eventMixin(t);function markText(c,d,e,g,i){if(g&&g.shared){return markTextShared(c,d,e,g,i)}if(c.cm&&!c.cm.curOp){return operation(c.cm,markText)(c,d,e,g,i)}var b=new t(c,i),l=cmp(d,e);if(g){copyObj(g,b,!1)}if(l>0||l==0&&b.clearWhenEmpty!==!1){return b}if(b.replacedWith){b.collapsed=!0;b.widgetNode=eltP('span',[b.replacedWith],'CodeMirror-widget');if(!g.handleMouseEvents){b.widgetNode.setAttribute('cm-ignore-events','true')}if(g.insertLeft){b.widgetNode.insertLeft=!0}}if(b.collapsed){if(conflictingCollapsedRange(c,d.line,d,e,b)||d.line!=e.line&&conflictingCollapsedRange(c,e.line,d,e,b)){throw new Error('Inserting collapsed marker partially overlapping an existing one')}seeCollapsedSpans()}if(b.addToHistory){addChangeToHistory(c,{from:d,to:e,origin:'markText'},c.sel,NaN)}var h=d.line,f=c.cm,k;c.iter(h,e.line+1,function(a){if(f&&b.collapsed&&!f.options.lineWrapping&&visualLine(a)==f.display.maxLine){k=!0}if(b.collapsed&&h!=d.line){updateLineHeight(a,0)}addMarkedSpan(a,new MarkedSpan(b,h==d.line?d.ch:null,h==e.line?e.ch:null));++h});if(b.collapsed){c.iter(d.line,e.line+1,function(a){if(lineIsHidden(c,a)){updateLineHeight(a,0)}})}if(b.clearOnEnter){a(b,'beforeCursorEnter',function(){return b.clear()})}if(b.readOnly){seeReadOnlySpans();if(c.history.done.length||c.history.undone.length){c.clearHistory()}}if(b.collapsed){b.id=++ar;b.atomic=!0}if(f){if(k){f.curOp.updateMaxLine=!0}if(b.collapsed){regChange(f,d.line,e.line+1)}else {if(b.className||b.title||b.startStyle||b.endStyle||b.css){for(var j=d.line;j<=e.line;j++){regLineChange(f,j,'text')}}}if(b.atomic){reCheckSelection(f.doc)}signalLater(f,'markerAdded',f,b)}return b}var I=function(a,c){var d=this;this.markers=a;this.primary=c;for(var b=0;b<a.length;++b){a[b].parent=d}};I.prototype.clear=function(){var b=this;if(this.explicitlyCleared){return}this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a){b.markers[a].clear()}signalLater(this,'clear')};I.prototype.find=function(b,a){return this.primary.find(b,a)};eventMixin(I);function markTextShared(g,e,h,a,f){a=copyObj(a);a.shared=!1;var b=[markText(g,e,h,a,f)],c=b[0];var d=a.widgetNode;linkedDocs(g,function(g){if(d){a.widgetNode=d.cloneNode(!0)}b.push(markText(g,clipPos(g,e),clipPos(g,h),a,f));for(var i=0;i<g.linked.length;++i){if(g.linked[i].isParent){return}}c=lst(b)});return new I(b,c)}function findSharedMarkers(a){return a.findMarks(Pos(a.first,0),a.clipPos(Pos(a.lastLine())),function(a){return a.parent})}function copySharedMarkers(b,d){for(var c=0;c<d.length;c++){var a=d[c],h=a.find();var f=b.clipPos(h.from),g=b.clipPos(h.to);if(cmp(f,g)){var e=markText(b,f,g,a.primary,a.primary.type);a.markers.push(e);e.parent=a}}}function detachSharedMarkers(b){var c=function(f){var a=b[f],e=[a.primary.doc];linkedDocs(a.primary.doc,function(a){return e.push(a)});for(var c=0;c<a.markers.length;c++){var d=a.markers[c];if(indexOf(e,d.doc)==-1){d.parent=null;a.markers.splice(c--,1)}}};for(var a=0;a<b.length;a++){c(a)}}var aO=0;var j=function(b,f,a,e,d){if(!(this instanceof j)){return new j(b,f,a,e,d)}if(a==null){a=0}BranchChunk.call(this,[new LeafChunk([new G('',null)])]);this.first=a;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=a;var c=Pos(a,0);this.sel=simpleSelection(c);this.history=new History(null);this.id=++aO;this.modeOption=f;this.lineSep=e;this.direction=d=='rtl'?'rtl':'ltr';this.extend=!1;if(typeof b=='string'){b=this.splitLines(b)}updateDoc(this,{from:c,to:c,text:b});setSelection(this,simpleSelection(c),p)};j.prototype=createObj(BranchChunk.prototype,{constructor:j,iter:function(a,c,b){if(b){this.iterN(a-this.first,c-a,b)}else {this.iterN(this.first,this.first+this.size,a)}},insert:function(d,a){var c=0;for(var b=0;b<a.length;++b){c+=a[b].height}this.insertInner(d-this.first,a,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=getLines(this,this.first,this.first+this.size);if(a===!1){return b}return b.join(a||this.lineSeparator())},setValue:docMethodOp(function(c){var b=Pos(this.first,0),a=this.first+this.size-1;makeChange(this,{from:b,to:Pos(a,getLine(this,a).text.length),text:this.splitLines(c),origin:'setValue',full:!0},!0);if(this.cm){scrollToCoords(this.cm,0,0)}setSelection(this,simpleSelection(b),p)}),replaceRange:function(d,a,b,c){a=clipPos(this,a);b=b?clipPos(this,b):a;replaceRange(this,d,a,b,c)},getRange:function(c,d,a){var b=getBetween(this,clipPos(this,c),clipPos(this,d));if(a===!1){return b}return b.join(a||this.lineSeparator())},getLine:function(b){var a=this.getLineHandle(b);return a&&a.text},getLineHandle:function(a){if(isLine(this,a)){return getLine(this,a)}},getLineNumber:function(a){return lineNo(a)},getLineHandleVisualStart:function(a){if(typeof a=='number'){a=getLine(this,a)}return visualLine(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return clipPos(this,a)},getCursor:function(a){var c=this.sel.primary(),b;if(a==null||a=='head'){b=c.head}else {if(a=='anchor'){b=c.anchor}else {if(a=='end'||a=='to'||a===!1){b=c.to()}else {b=c.from()}}}return b},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(a,c,b){setSimpleSelection(this,clipPos(this,typeof a=='number'?Pos(a,c||0):a),null,b)}),setSelection:docMethodOp(function(a,c,b){setSimpleSelection(this,clipPos(this,a),clipPos(this,c||a),b)}),extendSelection:docMethodOp(function(c,a,b){extendSelection(this,clipPos(this,c),a&&clipPos(this,a),b)}),extendSelections:docMethodOp(function(b,a){extendSelections(this,clipPosArray(this,b),a)}),extendSelectionsBy:docMethodOp(function(c,a){var b=map(this.sel.ranges,c);extendSelections(this,clipPosArray(this,b),a)}),setSelections:docMethodOp(function(a,d,g){var e=this;if(!a.length){return}var f=[];for(var b=0;b<a.length;b++){f[b]=new c(clipPos(e,a[b].anchor),clipPos(e,a[b].head))}if(d==null){d=Math.min(a.length-1,this.sel.primIndex)}setSelection(this,normalizeSelection(f,d),g)}),addSelection:docMethodOp(function(b,e,d){var a=this.sel.ranges.slice(0);a.push(new c(clipPos(this,b),clipPos(this,e||b)));setSelection(this,normalizeSelection(a,a.length-1),d)}),getSelection:function(d){var f=this;var c=this.sel.ranges,a;for(var b=0;b<c.length;b++){var e=getBetween(f,c[b].from(),c[b].to());a=a?a.concat(e):e}if(d===!1){return a}else {return a.join(d||this.lineSeparator())}},getSelections:function(d){var e=this;var f=[],b=this.sel.ranges;for(var a=0;a<b.length;a++){var c=getBetween(e,b[a].from(),b[a].to());if(d!==!1){c=c.join(d||e.lineSeparator())}f[a]=c}return f},replaceSelection:function(e,c,d){var b=[];for(var a=0;a<this.sel.ranges.length;a++){b[a]=e}this.replaceSelections(b,c,d||'+input')},replaceSelections:docMethodOp(function(j,c,i){var f=this;var b=[],h=this.sel;for(var a=0;a<h.ranges.length;a++){var g=h.ranges[a];b[a]={from:g.from(),to:g.to(),text:f.splitLines(j[a]),origin:i}}var e=c&&c!='end'&&computeReplacedSel(this,b,c);for(var d=b.length-1;d>=0;d--){makeChange(f,b[d])}if(e){setSelectionReplaceHistory(this,e)}else {if(this.cm){ensureCursorVisible(this.cm)}}}),undo:docMethodOp(function(){makeChangeFromHistory(this,'undo')}),redo:docMethodOp(function(){makeChangeFromHistory(this,'redo')}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,'undo',!0)}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,'redo',!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){var a=this.history,e=0,d=0;for(var c=0;c<a.done.length;c++){if(!a.done[c].ranges){++e}}for(var b=0;b<a.undone.length;b++){if(!a.undone[b].ranges){++d}}return {undo:e,redo:d}},clearHistory:function(){this.history=new History(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){if(a){this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null}return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return {done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(a){var b=this.history=new History(this.history.maxGeneration);b.done=copyHistoryArray(a.done.slice(0),null,!0);b.undone=copyHistoryArray(a.undone.slice(0),null,!0)},setGutterMarker:docMethodOp(function(c,b,a){return changeLine(this,c,'gutter',function(c){var d=c.gutterMarkers||(c.gutterMarkers={});d[b]=a;if(!a&&isEmpty(d)){c.gutterMarkers=null}return !0})}),clearGutter:docMethodOp(function(a){var b=this;this.iter(function(c){if(c.gutterMarkers&&c.gutterMarkers[a]){changeLine(b,c,'gutter',function(){c.gutterMarkers[a]=null;if(isEmpty(c.gutterMarkers)){c.gutterMarkers=null}return !0})}})}),lineInfo:function(a){var b;if(typeof a=='number'){if(!isLine(this,a)){return null}b=a;a=getLine(this,a);if(!a){return null}}else {b=lineNo(a);if(b==null){return null}}return {line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:docMethodOp(function(c,a,b){return changeLine(this,c,a=='gutter'?'gutter':'class',function(c){var d=a=='text'?'textClass':a=='background'?'bgClass':a=='gutter'?'gutterClass':'wrapClass';if(!c[d]){c[d]=b}else {if(classTest(b).test(c[d])){return !1}else {c[d]+=' '+b}}return !0})}),removeLineClass:docMethodOp(function(c,a,b){return changeLine(this,c,a=='gutter'?'gutter':'class',function(e){var f=a=='text'?'textClass':a=='background'?'bgClass':a=='gutter'?'gutterClass':'wrapClass';var d=e[f];if(!d){return !1}else {if(b==null){e[f]=null}else {var c=d.match(classTest(b));if(!c){return !1}var g=c.index+c[0].length;e[f]=d.slice(0,c.index)+(!c.index||g==d.length?'':' ')+d.slice(g)||null}}return !0})}),addLineWidget:docMethodOp(function(b,c,a){return addLineWidget(this,b,c,a)}),removeLineWidget:function(a){a.clear()},markText:function(b,c,a){return markText(this,clipPos(this,b),clipPos(this,c),a,a&&a.type||'range')},setBookmark:function(b,a){var c={replacedWith:a&&(a.nodeType==null?a.widget:a),insertLeft:a&&a.insertLeft,clearWhenEmpty:!1,shared:a&&a.shared,handleMouseEvents:a&&a.handleMouseEvents};b=clipPos(this,b);return markText(this,b,b,c,'bookmark')},findMarksAt:function(b){b=clipPos(this,b);var e=[],c=getLine(this,b.line).markedSpans;if(c){for(var d=0;d<c.length;++d){var a=c[d];if((a.from==null||a.from<=b.ch)&&(a.to==null||a.to>=b.ch)){e.push(a.marker.parent||a.marker)}}}return e},findMarks:function(a,b,d){a=clipPos(this,a);b=clipPos(this,b);var e=[],c=a.line;this.iter(a.line,b.line+1,function(i){var g=i.markedSpans;if(g){for(var h=0;h<g.length;h++){var f=g[h];if(!(f.to!=null&&c==a.line&&a.ch>=f.to||f.from==null&&c!=a.line||f.from!=null&&c==b.line&&f.from>=b.ch)&&(!d||d(f.marker))){e.push(f.marker.parent||f.marker)}}}++c});return e},getAllMarks:function(){var a=[];this.iter(function(d){var b=d.markedSpans;if(b){for(var c=0;c<b.length;++c){if(b[c].from!=null){a.push(b[c].marker)}}}});return a},posFromIndex:function(a){var c,b=this.first,d=this.lineSeparator().length;this.iter(function(f){var e=f.text.length+d;if(e>a){c=a;return !0}a-=e;++b});return clipPos(this,Pos(b,c))},indexFromPos:function(a){a=clipPos(this,a);var b=a.ch;if(a.line<this.first||a.ch<0){return 0}var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(b){var a=new j(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);a.scrollTop=this.scrollTop;a.scrollLeft=this.scrollLeft;a.sel=this.sel;a.extend=!1;if(b){a.history.undoDepth=this.history.undoDepth;a.setHistory(this.getHistory())}return a},linkedDoc:function(a){if(!a){a={}}var c=this.first,d=this.first+this.size;if(a.from!=null&&a.from>c){c=a.from}if(a.to!=null&&a.to<d){d=a.to}var b=new j(getLines(this,c,d),a.mode||this.modeOption,c,this.lineSep,this.direction);if(a.sharedHist){b.history=this.history}(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];copySharedMarkers(b,findSharedMarkers(this));return b},unlinkDoc:function(a){var b=this;if(a instanceof CodeMirror){a=a.doc}if(this.linked){for(var c=0;c<this.linked.length;++c){var e=b.linked[c];if(e.doc!=a){continue}b.linked.splice(c,1);a.unlinkDoc(b);detachSharedMarkers(findSharedMarkers(b));break}}if(a.history==this.history){var d=[a.id];linkedDocs(a,function(a){return d.push(a.id)},!0);a.history=new History(null);a.history.done=copyHistoryArray(this.history.done,d);a.history.undone=copyHistoryArray(this.history.undone,d)}},iterLinkedDocs:function(a){linkedDocs(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){if(this.lineSep){return a.split(this.lineSep)}return ah(a)},lineSeparator:function(){return this.lineSep||'\n'},setDirection:docMethodOp(function(a){if(a!='rtl'){a='ltr'}if(a==this.direction){return}this.direction=a;this.iter(function(a){return a.order=null});if(this.cm){directionChanged(this.cm)}})});j.prototype.eachLine=j.prototype.iter;var ax=0;function onDrop(d){var a=this;clearDragCursor(a);if(signalDOMEvent(a,d)||eventInWidget(a.display,d)){return}e_preventDefault(d);if(b){ax=+new Date()}var c=posFromMouse(a,d,!0),f=d.dataTransfer.files;if(!c||a.isReadOnly()){return}if(f&&f.length&&window.FileReader&&window.File){var i=f.length,k=Array(i),m=0;var l=function(d,e){if(a.options.allowDropFileTypes&&indexOf(a.options.allowDropFileTypes,d.type)==-1){return}var b=new FileReader();b.onload=operation(a,function(){var d=b.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(d)){d=''}k[e]=d;if(++m==i){c=clipPos(a.doc,c);var f={from:c,to:c,text:a.doc.splitLines(k.join(a.doc.lineSeparator())),origin:'paste'};makeChange(a.doc,f);setSelectionReplaceHistory(a.doc,simpleSelection(c,changeEnd(f)))}});b.readAsText(d)};for(var h=0;h<i;++h){l(f[h],h)}}else {if(a.state.draggingText&&a.doc.sel.contains(c)>-1){a.state.draggingText(d);setTimeout(function(){return a.display.input.focus()},20);return}try{var j=d.dataTransfer.getData('Text');if(j){var e;if(a.state.draggingText&&!a.state.draggingText.copy){e=a.listSelections()}setSelectionNoUndo(a.doc,simpleSelection(c,c));if(e){for(var g=0;g<e.length;++g){replaceRange(a.doc,'',e[g].anchor,e[g].head,'drag')}}a.replaceSelection(j,'around','paste');a.display.input.focus()}}catch(aV){}}}function onDragStart(d,c){if(b&&(!d.state.draggingText||+new Date()-ax<100)){e_stop(c);return}if(signalDOMEvent(d,c)||eventInWidget(d.display,c)){return}c.dataTransfer.setData('Text',d.getSelection());c.dataTransfer.effectAllowed='copyMove';if(c.dataTransfer.setDragImage&&!aB){var a=elt('img',null,null,'position: fixed; left: 0; top: 0;');a.src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';if(n){a.width=a.height=1;d.display.wrapper.appendChild(a);a._top=a.offsetTop}c.dataTransfer.setDragImage(a,0,0);if(n){a.parentNode.removeChild(a)}}}function onDragOver(a,d){var c=posFromMouse(a,d);if(!c){return}var b=document.createDocumentFragment();drawSelectionCursor(a,c,b);if(!a.display.dragCursor){a.display.dragCursor=elt('div',null,'CodeMirror-cursors CodeMirror-dragcursors');a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv)}removeChildrenAndAdd(a.display.dragCursor,b)}function clearDragCursor(a){if(a.display.dragCursor){a.display.lineSpace.removeChild(a.display.dragCursor);a.display.dragCursor=null}}function forEachCodeMirror(d){if(!document.getElementsByClassName){return}var b=document.getElementsByClassName('CodeMirror');for(var a=0;a<b.length;a++){var c=b[a].CodeMirror;if(c){d(c)}}}var ao=!1;function ensureGlobalHandlers(){if(ao){return}registerGlobalHandlers();ao=!0}function registerGlobalHandlers(){var b;a(window,'resize',function(){if(b==null){b=setTimeout(function(){b=null;forEachCodeMirror(onResize)},100)}});a(window,'blur',function(){return forEachCodeMirror(onBlur)})}function onResize(b){var a=b.display;if(a.lastWrapHeight==a.wrapper.clientHeight&&a.lastWrapWidth==a.wrapper.clientWidth){return}a.cachedCharWidth=a.cachedTextHeight=a.cachedPaddingH=null;a.scrollbarsClipped=!1;b.setSize()}var u={3:'Pause',8:'Backspace',9:'Tab',13:'Enter',16:'Shift',17:'Ctrl',18:'Alt',19:'Pause',20:'CapsLock',27:'Esc',32:'Space',33:'PageUp',34:'PageDown',35:'End',36:'Home',37:'Left',38:'Up',39:'Right',40:'Down',44:'PrintScrn',45:'Insert',46:'Delete',59:';',61:'=',91:'Mod',92:'Mod',93:'Mod',106:'*',107:'=',109:'-',110:'.',111:'/',127:'Delete',145:'ScrollLock',173:'-',186:';',187:'=',188:',',189:'-',190:'.',191:'/',192:'`',219:'[',220:'\\',221:']',222:"'",63232:'Up',63233:'Down',63234:'Left',63235:'Right',63272:'Delete',63273:'Home',63275:'End',63276:'PageUp',63277:'PageDown',63302:'Insert'};for(var V=0;V<10;V++){u[V+48]=u[V+96]=String(V)}for(var ad=65;ad<=90;ad++){u[ad]=String.fromCharCode(ad)}for(var T=1;T<=12;T++){u[T+111]=u[T+63235]='F'+T}var r={};r.basic={'Left':'goCharLeft','Right':'goCharRight','Up':'goLineUp','Down':'goLineDown','End':'goLineEnd','Home':'goLineStartSmart','PageUp':'goPageUp','PageDown':'goPageDown','Delete':'delCharAfter','Backspace':'delCharBefore','Shift-Backspace':'delCharBefore','Tab':'defaultTab','Shift-Tab':'indentAuto','Enter':'newlineAndIndent','Insert':'toggleOverwrite','Esc':'singleSelection'};r.pcDefault={'Ctrl-A':'selectAll','Ctrl-D':'deleteLine','Ctrl-Z':'undo','Shift-Ctrl-Z':'redo','Ctrl-Y':'redo','Ctrl-Home':'goDocStart','Ctrl-End':'goDocEnd','Ctrl-Up':'goLineUp','Ctrl-Down':'goLineDown','Ctrl-Left':'goGroupLeft','Ctrl-Right':'goGroupRight','Alt-Left':'goLineStart','Alt-Right':'goLineEnd','Ctrl-Backspace':'delGroupBefore','Ctrl-Delete':'delGroupAfter','Ctrl-S':'save','Ctrl-F':'find','Ctrl-G':'findNext','Shift-Ctrl-G':'findPrev','Shift-Ctrl-F':'replace','Shift-Ctrl-R':'replaceAll','Ctrl-[':'indentLess','Ctrl-]':'indentMore','Ctrl-U':'undoSelection','Shift-Ctrl-U':'redoSelection','Alt-U':'redoSelection',fallthrough:'basic'};r.emacsy={'Ctrl-F':'goCharRight','Ctrl-B':'goCharLeft','Ctrl-P':'goLineUp','Ctrl-N':'goLineDown','Alt-F':'goWordRight','Alt-B':'goWordLeft','Ctrl-A':'goLineStart','Ctrl-E':'goLineEnd','Ctrl-V':'goPageDown','Shift-Ctrl-V':'goPageUp','Ctrl-D':'delCharAfter','Ctrl-H':'delCharBefore','Alt-D':'delWordAfter','Alt-Backspace':'delWordBefore','Ctrl-K':'killLine','Ctrl-T':'transposeChars','Ctrl-O':'openLine'};r.macDefault={'Cmd-A':'selectAll','Cmd-D':'deleteLine','Cmd-Z':'undo','Shift-Cmd-Z':'redo','Cmd-Y':'redo','Cmd-Home':'goDocStart','Cmd-Up':'goDocStart','Cmd-End':'goDocEnd','Cmd-Down':'goDocEnd','Alt-Left':'goGroupLeft','Alt-Right':'goGroupRight','Cmd-Left':'goLineLeft','Cmd-Right':'goLineRight','Alt-Backspace':'delGroupBefore','Ctrl-Alt-Backspace':'delGroupAfter','Alt-Delete':'delGroupAfter','Cmd-S':'save','Cmd-F':'find','Cmd-G':'findNext','Shift-Cmd-G':'findPrev','Cmd-Alt-F':'replace','Shift-Cmd-Alt-F':'replaceAll','Cmd-[':'indentLess','Cmd-]':'indentMore','Cmd-Backspace':'delWrappedLineLeft','Cmd-Delete':'delWrappedLineRight','Cmd-U':'undoSelection','Shift-Cmd-U':'redoSelection','Ctrl-Up':'goDocStart','Ctrl-Down':'goDocEnd',fallthrough:['basic','emacsy']};r['default']=o?r.macDefault:r.pcDefault;function normalizeKeyName(a){var c=a.split(/-(?!$)/);a=c[c.length-1];var g,f,e,h;for(var d=0;d<c.length-1;d++){var b=c[d];if(/^(cmd|meta|m)$/i.test(b)){h=!0}else {if(/^a(lt)?$/i.test(b)){g=!0}else {if(/^(c|ctrl|control)$/i.test(b)){f=!0}else {if(/^s(hift)?$/i.test(b)){e=!0}else {throw new Error('Unrecognized modifier name: '+b)}}}}}if(g){a='Alt-'+a}if(f){a='Ctrl-'+a}if(h){a='Cmd-'+a}if(e){a='Shift-'+a}return a}function normalizeKeyMap(a){var d={};for(var b in a){if(a.hasOwnProperty(b)){var h=a[b];if(/^(name|fallthrough|(de|at)tach)$/.test(b)){continue}if(h=='...'){delete a[b];continue}var e=map(b.split(' '),normalizeKeyName);for(var g=0;g<e.length;g++){var f=void 0,c=void 0;if(g==e.length-1){c=e.join(' ');f=h}else {c=e.slice(0,g+1).join(' ');f='...'}var i=d[c];if(!i){d[c]=f}else {if(i!=f){throw new Error('Inconsistent bindings for '+c)}}}delete a[b]}}for(var j in d){a[j]=d[j]}return a}function lookupKey(c,a,e,d){a=getKeyMap(a);var b=a.call?a.call(c,d):a[c];if(b===!1){return 'nothing'}if(b==='...'){return 'multi'}if(b!=null&&e(b)){return 'handled'}if(a.fallthrough){if(Object.prototype.toString.call(a.fallthrough)!='[object Array]'){return lookupKey(c,a.fallthrough,e,d)}for(var f=0;f<a.fallthrough.length;f++){var g=lookupKey(c,a.fallthrough[f],e,d);if(g){return g}}}}function isModifierKey(b){var a=typeof b=='string'?b:u[b.keyCode];return a=='Ctrl'||a=='Alt'||a=='Shift'||a=='Mod'}function addModifierNames(a,b,d){var c=a;if(b.altKey&&c!='Alt'){a='Alt-'+a}if((as?b.metaKey:b.ctrlKey)&&c!='Ctrl'){a='Ctrl-'+a}if((as?b.ctrlKey:b.metaKey)&&c!='Cmd'){a='Cmd-'+a}if(!d&&b.shiftKey&&c!='Shift'){a='Shift-'+a}return a}function keyName(a,c){if(n&&a.keyCode==34&&a['char']){return !1}var b=u[a.keyCode];if(b==null||a.altGraphKey){return !1}if(a.keyCode==3&&a.code){b=a.code}return addModifierNames(b,a,c)}function getKeyMap(a){return typeof a=='string'?r[a]:a}function deleteNearSelection(c,g){var f=c.doc.sel.ranges,a=[];for(var d=0;d<f.length;d++){var b=g(f[d]);while(a.length&&cmp(b.from,lst(a).to)<=0){var e=a.pop();if(cmp(e.from,b.from)<0){b.from=e.from;break}}a.push(b)}runInOp(c,function(){for(var b=a.length-1;b>=0;b--){replaceRange(c.doc,'',a[b].from,a[b].to,'+delete')}ensureCursorVisible(c)})}function moveCharLogically(b,d,c){var a=skipExtendingChars(b.text,d+c,c);return a<0||a>b.text.length?null:a}function moveLogically(d,a,b){var c=moveCharLogically(d,a.ch,b);return c==null?null:new Pos(a.line,c,b<0?'after':'before')}function endOfLine(l,e,d,g,c){if(l){var f=getOrder(d,e.doc.direction);if(f){var b=c<0?lst(f):f[0];var j=c<0==(b.level==1);var h=j?'after':'before';var a;if(b.level>0||e.doc.direction=='rtl'){var i=prepareMeasureForLine(e,d);a=c<0?d.text.length-1:0;var k=measureCharPrepared(e,i,a).top;a=findFirst(function(a){return measureCharPrepared(e,i,a).top==k},c<0==(b.level==1)?b.from:b.to-1,a);if(h=='before'){a=moveCharLogically(d,a,1)}}else {a=c<0?b.to:b.from}return new Pos(g,a,h)}}return new Pos(g,c<0?d.text.length:0,c<0?'before':'after')}function moveVisually(g,b,a,c){var e=getOrder(b,g.doc.direction);if(!e){return moveLogically(b,a,c)}if(a.ch>=b.text.length){a.ch=b.text.length;a.sticky='before'}else {if(a.ch<=0){a.ch=0;a.sticky='after'}}var p=getBidiPartAt(e,a.ch,a.sticky),d=e[p];if(g.doc.direction=='ltr'&&d.level%2==0&&(c>0?d.to>a.ch:d.from<a.ch)){return moveLogically(b,a,c)}var h=function(a,c){return moveCharLogically(b,a instanceof Pos?a.ch:a,c)};var m;var n=function(a){if(!g.options.lineWrapping){return {begin:0,end:b.text.length}}m=m||prepareMeasureForLine(g,b);return wrappedLineExtentChar(g,b,m,a)};var i=n(a.sticky=='before'?h(a,-1):a.ch);if(g.doc.direction=='rtl'||d.level==1){var k=d.level==1==c<0;var f=h(a,k?1:-1);if(f!=null&&(!k?f>=d.from&&f>=i.begin:f<=d.to&&f<=i.end)){var q=k?'before':'after';return new Pos(a.line,f,q)}}var o=function(g,j,f){var i=function(b,c){return c?new Pos(a.line,h(b,1),'before'):new Pos(a.line,b,'after')};for(;g>=0&&g<e.length;g+=j){var c=e[g];var d=j>0==(c.level!=1);var b=d?f.begin:h(f.end,-1);if(c.from<=b&&b<c.to){return i(b,d)}b=d?c.from:h(c.to,-1);if(f.begin<=b&&b<f.end){return i(b,d)}}};var j=o(p+c,c,i);if(j){return j}var l=c>0?i.end:h(i.begin,-1);if(l!=null&&!(c>0&&l==b.text.length)){j=o(c>0?0:e.length-1,c,n(l));if(j){return j}}return null}var P={selectAll:selectAll,singleSelection:function(a){return a.setSelection(a.getCursor('anchor'),a.getCursor('head'),p)},killLine:function(a){return deleteNearSelection(a,function(b){if(b.empty()){var c=getLine(a.doc,b.head.line).text.length;if(b.head.ch==c&&b.head.line<a.lastLine()){return {from:b.head,to:Pos(b.head.line+1,0)}}else {return {from:b.head,to:Pos(b.head.line,c)}}}else {return {from:b.from(),to:b.to()}}})},deleteLine:function(a){return deleteNearSelection(a,function(b){return {from:Pos(b.from().line,0),to:clipPos(a.doc,Pos(b.to().line+1,0))}})},delLineLeft:function(a){return deleteNearSelection(a,function(a){return {from:Pos(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){return deleteNearSelection(a,function(b){var d=a.charCoords(b.head,'div').top+5;var c=a.coordsChar({left:0,top:d},'div');return {from:c,to:b.from()}})},delWrappedLineRight:function(a){return deleteNearSelection(a,function(b){var d=a.charCoords(b.head,'div').top+5;var c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:d},'div');return {from:b.from(),to:c}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(Pos(a.firstLine(),0))},goDocEnd:function(a){return a.extendSelection(Pos(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(b){return lineStart(a,b.head.line)},{origin:'+move',bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(b){return lineStartSmart(a,b.head)},{origin:'+move',bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(b){return lineEnd(a,b.head.line)},{origin:'+move',bias:-1})},goLineRight:function(a){return a.extendSelectionsBy(function(b){var c=a.cursorCoords(b.head,'div').top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},'div')},Q)},goLineLeft:function(a){return a.extendSelectionsBy(function(b){var c=a.cursorCoords(b.head,'div').top+5;return a.coordsChar({left:0,top:c},'div')},Q)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(c){var d=a.cursorCoords(c.head,'div').top+5;var b=a.coordsChar({left:0,top:d},'div');if(b.ch<a.getLine(b.line).search(/\S/)){return lineStartSmart(a,c.head)}return b},Q)},goLineUp:function(a){return a.moveV(-1,'line')},goLineDown:function(a){return a.moveV(1,'line')},goPageUp:function(a){return a.moveV(-1,'page')},goPageDown:function(a){return a.moveV(1,'page')},goCharLeft:function(a){return a.moveH(-1,'char')},goCharRight:function(a){return a.moveH(1,'char')},goColumnLeft:function(a){return a.moveH(-1,'column')},goColumnRight:function(a){return a.moveH(1,'column')},goWordLeft:function(a){return a.moveH(-1,'word')},goGroupRight:function(a){return a.moveH(1,'group')},goGroupLeft:function(a){return a.moveH(-1,'group')},goWordRight:function(a){return a.moveH(1,'word')},delCharBefore:function(a){return a.deleteH(-1,'char')},delCharAfter:function(a){return a.deleteH(1,'char')},delWordBefore:function(a){return a.deleteH(-1,'word')},delWordAfter:function(a){return a.deleteH(1,'word')},delGroupBefore:function(a){return a.deleteH(-1,'group')},delGroupAfter:function(a){return a.deleteH(1,'group')},indentAuto:function(a){return a.indentSelection('smart')},indentMore:function(a){return a.indentSelection('add')},indentLess:function(a){return a.indentSelection('subtract')},insertTab:function(a){return a.replaceSelection('\t')},insertSoftTab:function(a){var e=[],d=a.listSelections(),b=a.options.tabSize;for(var c=0;c<d.length;c++){var f=d[c].from();var g=countColumn(a.getLine(f.line),f.ch,b);e.push(spaceStr(b-g%b))}a.replaceSelections(e)},defaultTab:function(a){if(a.somethingSelected()){a.indentSelection('add')}else {a.execCommand('insertTab')}},transposeChars:function(a){return runInOp(a,function(){var g=a.listSelections(),h=[];for(var f=0;f<g.length;f++){if(!g[f].empty()){continue}var b=g[f].head,d=getLine(a.doc,b.line).text;if(d){if(b.ch==d.length){b=new Pos(b.line,b.ch-1)}if(b.ch>0){b=new Pos(b.line,b.ch+1);a.replaceRange(d.charAt(b.ch-1)+d.charAt(b.ch-2),Pos(b.line,b.ch-2),b,'+transpose')}else {if(b.line>a.doc.first){var e=getLine(a.doc,b.line-1).text;if(e){b=new Pos(b.line,1);a.replaceRange(d.charAt(0)+a.doc.lineSeparator()+e.charAt(e.length-1),Pos(b.line-1,e.length-1),b,'+transpose')}}}}h.push(new c(b,b))}a.setSelections(h)})},newlineAndIndent:function(a){return runInOp(a,function(){var b=a.listSelections();for(var c=b.length-1;c>=0;c--){a.replaceRange(a.doc.lineSeparator(),b[c].anchor,b[c].head,'+input')}b=a.listSelections();for(var d=0;d<b.length;d++){a.indentLine(b[d].from().line,null,!0)}ensureCursorVisible(a)})},openLine:function(a){return a.replaceSelection('\n','start')},toggleOverwrite:function(a){return a.toggleOverwrite()}};function lineStart(d,b){var c=getLine(d.doc,b);var a=visualLine(c);if(a!=c){b=lineNo(a)}return endOfLine(!0,d,a,b,1)}function lineEnd(d,a){var b=getLine(d.doc,a);var c=visualLineEnd(b);if(c!=b){a=lineNo(c)}return endOfLine(!0,d,b,a,-1)}function lineStartSmart(c,b){var a=lineStart(c,b.line);var f=getLine(c.doc,a.line);var e=getOrder(f,c.doc.direction);if(!e||e[0].level==0){var d=Math.max(0,f.text.search(/\S/));var g=b.line==a.line&&b.ch<=d&&b.ch;return Pos(a.line,g?0:d,a.sticky)}return a}function doHandleBinding(a,b,d){if(typeof b=='string'){b=P[b];if(!b){return !1}}a.display.input.ensurePolled();var e=a.display.shift,c=!1;try{if(a.isReadOnly()){a.state.suppressEdits=!0}if(d){a.display.shift=!1}c=b(a)!=ab}finally{a.display.shift=e;a.state.suppressEdits=!1}return c}function lookupKeyForEditor(a,c,b){for(var d=0;d<a.state.keyMaps.length;d++){var e=lookupKey(c,a.state.keyMaps[d],b,a);if(e){return e}}return a.options.extraKeys&&lookupKey(c,a.options.extraKeys,b,a)||lookupKey(c,a.options.keyMap,b,a)}var aT=new z();function dispatchKey(a,b,e,d){var c=a.state.keySeq;if(c){if(isModifierKey(b)){return 'handled'}if(/\'$/.test(b)){a.state.keySeq=null}else {aT.set(50,function(){if(a.state.keySeq==c){a.state.keySeq=null;a.display.input.reset()}})}if(dispatchKeyInner(a,c+' '+b,e,d)){return !0}}return dispatchKeyInner(a,b,e,d)}function dispatchKeyInner(b,c,d,e){var a=lookupKeyForEditor(b,c,e);if(a=='multi'){b.state.keySeq=c}if(a=='handled'){signalLater(b,'keyHandled',b,c,d)}if(a=='handled'||a=='multi'){e_preventDefault(d);restartBlink(b)}return !!a}function handleKeyBinding(a,b){var c=keyName(b,!0);if(!c){return !1}if(b.shiftKey&&!a.state.keySeq){return dispatchKey(a,'Shift-'+c,b,function(b){return doHandleBinding(a,b,!0)})||dispatchKey(a,c,b,function(b){if(typeof b=='string'?/^go[A-Z]/.test(b):b.motion){return doHandleBinding(a,b)}})}else {return dispatchKey(a,c,b,function(b){return doHandleBinding(a,b)})}}function handleCharBinding(a,c,b){return dispatchKey(a,"'"+b+"'",c,function(b){return doHandleBinding(a,b,!0)})}var ag=null;function onKeyDown(a){var c=this;c.curOp.focus=activeElt();if(signalDOMEvent(c,a)){return}if(b&&e<11&&a.keyCode==27){a.returnValue=!1}var d=a.keyCode;c.display.shift=d==16||a.shiftKey;var f=handleKeyBinding(c,a);if(n){ag=f?d:null;if(!f&&d==88&&!aL&&(o?a.metaKey:a.ctrlKey)){c.replaceSelection('',null,'cut')}}if(d==18&&!/\bCodeMirror-crosshair\b/.test(c.display.lineDiv.className)){showCrossHair(c)}}function showCrossHair(c){var b=c.display.lineDiv;addClass(b,'CodeMirror-crosshair');function up(a){if(a.keyCode==18||!a.altKey){A(b,'CodeMirror-crosshair');off(document,'keyup',up);off(document,'mouseover',up)}}a(document,'keyup',up);a(document,'mouseover',up)}function onKeyUp(a){if(a.keyCode==16){this.doc.sel.shift=!1}signalDOMEvent(this,a)}function onKeyPress(a){var b=this;if(eventInWidget(b.display,a)||signalDOMEvent(b,a)||a.ctrlKey&&!a.altKey||o&&a.metaKey){return}var d=a.keyCode,c=a.charCode;if(n&&d==ag){ag=null;e_preventDefault(a);return}if(n&&(!a.which||a.which<10)&&handleKeyBinding(b,a)){return}var e=String.fromCharCode(c==null?d:c);if(e=='\b'){return}if(handleCharBinding(b,a,e)){return}b.display.input.onKeyPress(a)}var aG=400;var ak=function(b,c,a){this.time=b;this.pos=c;this.button=a};ak.prototype.compare=function(b,c,a){return this.time+aG>b&&cmp(c,this.pos)==0&&a==this.button};var O;var J;function clickRepeat(c,a){var b=+new Date();if(J&&J.compare(b,c,a)){O=J=null;return 'triple'}else {if(O&&O.compare(b,c,a)){J=new ak(b,c,a);O=null;return 'double'}else {O=new ak(b,c,a);J=null;return 'single'}}}function onMouseDown(a){var b=this,c=b.display;if(signalDOMEvent(b,a)||c.activeTouch&&c.input.supportsTouch()){return}c.input.ensurePolled();c.shift=a.shiftKey;if(eventInWidget(c,a)){if(!h){c.scroller.draggable=!1;setTimeout(function(){return c.scroller.draggable=!0},100)}return}if(clickInGutter(b,a)){return}var d=posFromMouse(b,a),e=e_button(a),f=d?clickRepeat(d,e):'single';window.focus();if(e==1&&b.state.selectingText){b.state.selectingText(a)}if(d&&handleMappedButton(b,e,d,f,a)){return}if(e==1){if(d){leftButtonDown(b,d,f,a)}else {if(e_target(a)==c.scroller){e_preventDefault(a)}}}else {if(e==2){if(d){extendSelection(b.doc,d)}setTimeout(function(){return c.input.focus()},20)}else {if(e==3){if(ae){onContextMenu(b,a)}else {delayBlurEvent(b)}}}}}function handleMappedButton(b,c,f,d,e){var a='Click';if(d=='double'){a='Double'+a}else {if(d=='triple'){a='Triple'+a}}a=(c==1?'Left':c==2?'Middle':'Right')+a;return dispatchKey(b,addModifierNames(a,e),e,function(a){if(typeof a=='string'){a=P[a]}if(!a){return !1}var c=!1;try{if(b.isReadOnly()){b.state.suppressEdits=!0}c=a(b,f)!=ab}finally{b.state.suppressEdits=!1}return c})}function configureMouse(c,d,a){var e=c.getOption('configureMouse');var b=e?e(c,d,a):{};if(b.unit==null){var f=aP?a.shiftKey&&a.metaKey:a.altKey;b.unit=f?'rectangle':d=='single'?'char':d=='double'?'word':'line'}if(b.extend==null||c.doc.extend){b.extend=c.doc.extend||a.shiftKey}if(b.addNew==null){b.addNew=o?a.metaKey:a.ctrlKey}if(b.moveOnDrag==null){b.moveOnDrag=!(o?a.altKey:a.ctrlKey)}return b}function leftButtonDown(a,c,g,e){if(b){setTimeout(bind(ensureFocus,a),0)}else {a.curOp.focus=activeElt()}var f=configureMouse(a,g,e);var h=a.doc.sel,d;if(a.options.dragDrop&&aN&&!a.isReadOnly()&&g=='single'&&(d=h.contains(c))>-1&&(cmp((d=h.ranges[d]).from(),c)<0||c.xRel>0)&&(cmp(d.to(),c)>0||c.xRel<0)){leftButtonStartDrag(a,e,c,f)}else {leftButtonSelect(a,e,c,f)}}function leftButtonStartDrag(f,l,m,i){var c=f.display,g=!1;var d=operation(f,function(a){if(h){c.scroller.draggable=!1}f.state.draggingText=!1;off(document,'mouseup',d);off(document,'mousemove',k);off(c.scroller,'dragstart',j);off(c.scroller,'drop',d);if(!g){e_preventDefault(a);if(!i.addNew){extendSelection(f.doc,m,null,null,i.extend)}if(h||b&&e==9){setTimeout(function(){document.body.focus();c.input.focus()},20)}else {c.input.focus()}}});var k=function(a){g=g||Math.abs(l.clientX-a.clientX)+Math.abs(l.clientY-a.clientY)>=10};var j=function(){return g=!0};if(h){c.scroller.draggable=!0}f.state.draggingText=d;d.copy=!i.moveOnDrag;if(c.scroller.dragDrop){c.scroller.dragDrop()}a(document,'mouseup',d);a(document,'mousemove',k);a(c.scroller,'dragstart',j);a(c.scroller,'drop',d);delayBlurEvent(f);setTimeout(function(){return c.input.focus()},20)}function rangeForUnit(d,a,b){if(b=='char'){return new c(a,a)}if(b=='word'){return d.findWordAt(a)}if(b=='line'){return new c(Pos(a.line,0),clipPos(d.doc,Pos(a.line+1,0)))}var e=b(d,a);return new c(e.from,e.to)}function leftButtonSelect(e,r,f,g){var m=e.display,b=e.doc;e_preventDefault(r);var h,d,j=b.sel,i=j.ranges;if(g.addNew&&!g.extend){d=b.sel.contains(f);if(d>-1){h=i[d]}else {h=new c(f,f)}}else {h=b.sel.primary();d=b.sel.primIndex}if(g.unit=='rectangle'){if(!g.addNew){h=new c(f,f)}f=posFromMouse(e,r,!0,!0);d=-1}else {var o=rangeForUnit(e,f,g.unit);if(g.extend){h=extendRange(h,o.anchor,o.head,g.extend)}else {h=o}}if(!g.addNew){d=0;setSelection(b,new l([h],0),am);j=b.sel}else {if(d==-1){d=i.length;setSelection(b,normalizeSelection(i.concat([h]),d),{scroll:!1,origin:'*mouse'})}else {if(i.length>1&&i[d].empty()&&g.unit=='char'&&!g.extend){setSelection(b,normalizeSelection(i.slice(0,d).concat(i.slice(d+1)),0),{scroll:!1,origin:'*mouse'});j=b.sel}else {replaceOneSelection(b,d,h,am)}}}var n=f;function extendTo(a){if(cmp(n,a)==0){return}n=a;if(g.unit=='rectangle'){var k=[],o=e.options.tabSize;var u=countColumn(getLine(b,f.line).text,f.ch,o);var v=countColumn(getLine(b,a.line).text,a.ch,o);var x=Math.min(u,v),w=Math.max(u,v);for(var i=Math.min(f.line,a.line),y=Math.min(e.lastLine(),Math.max(f.line,a.line));i<=y;i++){var s=getLine(b,i).text,m=findColumn(s,x,o);if(x==w){k.push(new c(Pos(i,m),Pos(i,m)))}else {if(s.length>m){k.push(new c(Pos(i,m),Pos(i,findColumn(s,w,o))))}}}if(!k.length){k.push(new c(f,f))}setSelection(b,normalizeSelection(j.ranges.slice(0,d).concat(k),d),{origin:'*mouse',scroll:!1});e.scrollIntoView(a)}else {var q=h;var l=rangeForUnit(e,a,g.unit);var p=q.anchor,r;if(cmp(l.anchor,p)>0){r=l.head;p=minPos(q.from(),l.anchor)}else {r=l.anchor;p=maxPos(q.to(),l.head)}var t=j.ranges.slice(0);t[d]=bidiSimplify(e,new c(clipPos(b,p),r));setSelection(b,normalizeSelection(t,d),am)}}var q=m.wrapper.getBoundingClientRect();var k=0;function extend(c){var d=++k;var a=posFromMouse(e,c,!0,g.unit=='rectangle');if(!a){return}if(cmp(a,n)!=0){e.curOp.focus=activeElt();extendTo(a);var h=visibleLines(m,b);if(a.line>=h.to||a.line<h.from){setTimeout(operation(e,function(){if(k==d){extend(c)}}),150)}}else {var f=c.clientY<q.top?-20:c.clientY>q.bottom?20:0;if(f){setTimeout(operation(e,function(){if(k!=d){return}m.scroller.scrollTop+=f;extend(c)}),50)}}}function done(a){e.state.selectingText=!1;k=Infinity;e_preventDefault(a);m.input.focus();off(document,'mousemove',s);off(document,'mouseup',p);b.history.lastSelOrigin=null}var s=operation(e,function(a){if(!e_button(a)){done(a)}else {extend(a)}});var p=operation(e,done);e.state.selectingText=p;a(document,'mousemove',s);a(document,'mouseup',p)}function bidiSimplify(p,d){var a=d.anchor;var b=d.head;var q=getLine(p.doc,a.line);if(cmp(a,b)==0&&a.sticky==b.sticky){return d}var e=getOrder(q);if(!e){return d}var k=getBidiPartAt(e,a.ch,a.sticky),h=e[k];if(h.from!=a.ch&&h.to!=a.ch){return d}var f=k+(h.from==a.ch==(h.level!=1)?0:1);if(f==0||f==e.length){return d}var g;if(b.line!=a.line){g=(b.line-a.line)*(p.doc.direction=='ltr'?1:-1)>0}else {var i=getBidiPartAt(e,b.ch,b.sticky);var n=i-k||(b.ch-a.ch)*(h.level==1?-1:1);if(i==f-1||i==f){g=n<0}else {g=n>0}}var j=e[f+(g?-1:0)];var m=g==(j.level==1);var o=m?j.from:j.to,l=m?'after':'before';return a.ch==o&&a.sticky==l?d:new c(new Pos(a.line,o,l),b)}function gutterEvent(b,a,h,j){var d,c;if(a.touches){d=a.touches[0].clientX;c=a.touches[0].clientY}else {try{d=a.clientX;c=a.clientY}catch(aV){return !1}}if(d>=Math.floor(b.display.gutters.getBoundingClientRect().right)){return !1}if(j){e_preventDefault(a)}var f=b.display;var g=f.lineDiv.getBoundingClientRect();if(c>g.bottom||!hasHandler(b,h)){return e_defaultPrevented(a)}c-=g.top-f.viewOffset;for(var e=0;e<b.options.gutters.length;++e){var i=f.gutters.childNodes[e];if(i&&i.getBoundingClientRect().right>=d){var l=lineAtHeight(b.doc,c);var k=b.options.gutters[e];signal(b,h,b,l,k,a);return e_defaultPrevented(a)}}}function clickInGutter(a,b){return gutterEvent(a,b,'gutterClick',!0)}function onContextMenu(a,b){if(eventInWidget(a.display,b)||contextMenuInGutter(a,b)){return}if(signalDOMEvent(a,b,'contextmenu')){return}a.display.input.onContextMenu(b)}function contextMenuInGutter(a,b){if(!hasHandler(a,'gutterContextMenu')){return !1}return gutterEvent(a,b,'gutterContextMenu',!1)}function themeChanged(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,'')+a.options.theme.replace(/(^|\s)\s*/g,' cm-s-');clearCaches(a)}var F={toString:function(){return 'CodeMirror.Init'}};var aw={};var W={};function defineOptions(a){var b=a.optionHandlers;function option(d,f,c,e){a.defaults[d]=f;if(c){b[d]=e?function(d,b,a){if(a!=F){c(d,b,a)}}:c}}a.defineOption=option;a.Init=F;option('value','',function(b,a){return b.setValue(a)},!0);option('mode',null,function(a,b){a.doc.modeOption=b;loadMode(a)},!0);option('indentUnit',2,loadMode,!0);option('indentWithTabs',!1);option('smartIndent',!0);option('tabSize',4,function(a){resetModeState(a);clearCaches(a);regChange(a)},!0);option('lineSeparator',null,function(d,a){d.doc.lineSep=a;if(!a){return}var b=[],e=d.doc.first;d.doc.iter(function(f){for(var d=0;;){var c=f.text.indexOf(a,d);if(c==-1){break}d=c+a.length;b.push(Pos(e,c))}e++});for(var c=b.length-1;c>=0;c--){replaceRange(d.doc,a,b[c],Pos(b[c].line,b[c].ch+a.length))}});option('specialChars',/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(b,a,c){b.state.specialChars=new RegExp(a.source+(a.test('\t')?'':'|\t'),'g');if(c!=F){b.refresh()}});option('specialCharPlaceholder',defaultSpecialCharPlaceholder,function(a){return a.refresh()},!0);option('electricChars',!0);option('inputStyle',R?'contenteditable':'textarea',function(){throw new Error('inputStyle can not (yet) be changed in a running editor')},!0);option('spellcheck',!1,function(b,a){return b.getInputField().spellcheck=a},!0);option('rtlMoveVisually',!aU);option('wholeLineUpdateBefore',!0);option('theme','default',function(a){themeChanged(a);guttersChanged(a)},!0);option('keyMap','default',function(d,e,c){var b=getKeyMap(e);var a=c!=F&&getKeyMap(c);if(a&&a.detach){a.detach(d,b)}if(b.attach){b.attach(d,a||null)}});option('extraKeys',null);option('configureMouse',null);option('lineWrapping',!1,wrappingChanged,!0);option('gutters',[],function(a){setGuttersForLineNumbers(a.options);guttersChanged(a)},!0);option('fixedGutter',!0,function(a,b){a.display.gutters.style.left=b?compensateForHScroll(a.display)+'px':'0';a.refresh()},!0);option('coverGutterNextToScrollbar',!1,function(a){return updateScrollbars(a)},!0);option('scrollbarStyle','native',function(a){initScrollbars(a);updateScrollbars(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);option('lineNumbers',!1,function(a){setGuttersForLineNumbers(a.options);guttersChanged(a)},!0);option('firstLineNumber',1,guttersChanged,!0);option('lineNumberFormatter',function(a){return a},guttersChanged,!0);option('showCursorWhenSelecting',!1,updateSelection,!0);option('resetSelectionOnContextMenu',!0);option('lineWiseCopyCut',!0);option('pasteLinesPerSelection',!0);option('readOnly',!1,function(a,b){if(b=='nocursor'){onBlur(a);a.display.input.blur()}a.display.input.readOnlyChanged(b)});option('disableInput',!1,function(b,a){if(!a){b.display.input.reset()}},!0);option('dragDrop',!0,dragDropChanged);option('allowDropFileTypes',null);option('cursorBlinkRate',530);option('cursorScrollMargin',0);option('cursorHeight',1,updateSelection,!0);option('singleCursorHeightPerLine',!0,updateSelection,!0);option('workTime',100);option('workDelay',100);option('flattenSpans',!0,resetModeState,!0);option('addModeClass',!1,resetModeState,!0);option('pollInterval',100);option('undoDepth',200,function(b,a){return b.doc.history.undoDepth=a});option('historyEventDelay',1250);option('viewportMargin',10,function(a){return a.refresh()},!0);option('maxHighlightLength',10000,resetModeState,!0);option('moveInputWithCursor',!0,function(b,a){if(!a){b.display.input.resetPosition()}});option('tabindex',null,function(b,a){return b.display.input.getField().tabIndex=a||''});option('autofocus',null);option('direction','ltr',function(b,a){return b.doc.setDirection(a)},!0)}function guttersChanged(a){updateGutters(a);regChange(a);alignHorizontally(a)}function dragDropChanged(b,e,f){var g=f&&f!=F;if(!e!=!g){var d=b.display.dragFunctions;var c=e?a:off;c(b.display.scroller,'dragstart',d.start);c(b.display.scroller,'dragenter',d.enter);c(b.display.scroller,'dragover',d.over);c(b.display.scroller,'dragleave',d.leave);c(b.display.scroller,'drop',d.drop)}}function wrappingChanged(a){if(a.options.lineWrapping){addClass(a.display.wrapper,'CodeMirror-wrap');a.display.sizer.style.minWidth='';a.display.sizerWidth=null}else {A(a.display.wrapper,'CodeMirror-wrap');findMaxLine(a)}estimateLineHeights(a);regChange(a);clearCaches(a);setTimeout(function(){return updateScrollbars(a)},100)}function CodeMirror(k,a){var f=this;if(!(this instanceof CodeMirror)){return new CodeMirror(k,a)}this.options=a=a?copyObj(a):{};copyObj(aw,a,!1);setGuttersForLineNumbers(a);var c=a.value;if(typeof c=='string'){c=new j(c,a.mode,null,a.lineSeparator,a.direction)}this.doc=c;var l=new CodeMirror.inputStyles[a.inputStyle](this);var d=this.display=new Display(k,c,l);d.wrapper.CodeMirror=this;updateGutters(this);themeChanged(this);if(a.lineWrapping){this.display.wrapper.className+=' CodeMirror-wrap'}initScrollbars(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new z(),keySeq:null,specialChars:null};if(a.autofocus&&!R){d.input.focus()}if(b&&e<11){setTimeout(function(){return f.display.input.reset(!0)},20)}registerEventHandlers(this);ensureGlobalHandlers();startOperation(this);this.curOp.forceUpdate=!0;attachDoc(this,c);if(a.autofocus&&!R||this.hasFocus()){setTimeout(bind(onFocus,this),20)}else {onBlur(this)}for(var g in W){if(W.hasOwnProperty(g)){W[g](f,a[g],F)}}maybeUpdateLineNumberWidth(this);if(a.finishInit){a.finishInit(this)}for(var i=0;i<al.length;++i){al[i](f)}endOperation(this);if(h&&a.lineWrapping&&getComputedStyle(d.lineDiv).textRendering=='optimizelegibility'){d.lineDiv.style.textRendering='auto'}}CodeMirror.defaults=aw;CodeMirror.optionHandlers=W;function registerEventHandlers(d){var f=d.display;a(f.scroller,'mousedown',operation(d,onMouseDown));if(b&&e<11){a(f.scroller,'dblclick',operation(d,function(a){if(signalDOMEvent(d,a)){return}var c=posFromMouse(d,a);if(!c||clickInGutter(d,a)||eventInWidget(d.display,a)){return}e_preventDefault(a);var b=d.findWordAt(c);extendSelection(d.doc,b.anchor,b.head)}))}else {a(f.scroller,'dblclick',function(a){return signalDOMEvent(d,a)||e_preventDefault(a)})}if(!ae){a(f.scroller,'contextmenu',function(a){return onContextMenu(d,a)})}var i,h={end:0};function finishTouch(){if(f.activeTouch){i=setTimeout(function(){return f.activeTouch=null},1000);h=f.activeTouch;h.end=+new Date()}}function isMouseLikeTouchEvent(b){if(b.touches.length!=1){return !1}var a=b.touches[0];return a.radiusX<=1&&a.radiusY<=1}function farAway(b,a){if(a.left==null){return !0}var c=a.left-b.left,d=a.top-b.top;return c*c+d*d>20*20}a(f.scroller,'touchstart',function(a){if(!signalDOMEvent(d,a)&&!isMouseLikeTouchEvent(a)&&!clickInGutter(d,a)){f.input.ensurePolled();clearTimeout(i);var b=+new Date();f.activeTouch={start:b,moved:!1,prev:b-h.end<=300?h:null};if(a.touches.length==1){f.activeTouch.left=a.touches[0].pageX;f.activeTouch.top=a.touches[0].pageY}}});a(f.scroller,'touchmove',function(){if(f.activeTouch){f.activeTouch.moved=!0}});a(f.scroller,'touchend',function(g){var a=f.activeTouch;if(a&&!eventInWidget(f,g)&&a.left!=null&&!a.moved&&new Date()-a.start<300){var e=d.coordsChar(f.activeTouch,'page'),b;if(!a.prev||farAway(a,a.prev)){b=new c(e,e)}else {if(!a.prev.prev||farAway(a,a.prev.prev)){b=d.findWordAt(e)}else {b=new c(Pos(e.line,0),clipPos(d.doc,Pos(e.line+1,0)))}}d.setSelection(b.anchor,b.head);d.focus();e_preventDefault(g)}finishTouch()});a(f.scroller,'touchcancel',finishTouch);a(f.scroller,'scroll',function(){if(f.scroller.clientHeight){updateScrollTop(d,f.scroller.scrollTop);setScrollLeft(d,f.scroller.scrollLeft,!0);signal(d,'scroll',d)}});a(f.scroller,'mousewheel',function(a){return onScrollWheel(d,a)});a(f.scroller,'DOMMouseScroll',function(a){return onScrollWheel(d,a)});a(f.wrapper,'scroll',function(){return f.wrapper.scrollTop=f.wrapper.scrollLeft=0});f.dragFunctions={enter:function(a){if(!signalDOMEvent(d,a)){e_stop(a)}},over:function(a){if(!signalDOMEvent(d,a)){onDragOver(d,a);e_stop(a)}},start:function(a){return onDragStart(d,a)},drop:operation(d,onDrop),leave:function(a){if(!signalDOMEvent(d,a)){clearDragCursor(d)}}};var g=f.input.getField();a(g,'keyup',function(a){return onKeyUp.call(d,a)});a(g,'keydown',operation(d,onKeyDown));a(g,'keypress',operation(d,onKeyPress));a(g,'focus',function(a){return onFocus(d,a)});a(g,'blur',function(a){return onBlur(d,a)})}var al=[];CodeMirror.defineInitHook=function(a){return al.push(a)};function indentLine(g,f,b,n){var d=g.doc,q;if(b==null){b='add'}if(b=='smart'){if(!d.mode.indent){b='prev'}else {q=getContextBefore(g,f).state}}var j=g.options.tabSize;var e=getLine(d,f),l=countColumn(e.text,null,j);if(e.stateAfter){e.stateAfter=null}var h=e.text.match(/^\s*/)[0],a;if(!n&&!/\S/.test(e.text)){a=0;b='not'}else {if(b=='smart'){a=d.mode.indent(q,e.text.slice(h.length),e.text);if(a==ab||a>150){if(!n){return}b='prev'}}}if(b=='prev'){if(f>d.first){a=countColumn(getLine(d,f-1).text,null,j)}else {a=0}}else {if(b=='add'){a=l+g.options.indentUnit}else {if(b=='subtract'){a=l-g.options.indentUnit}else {if(typeof b=='number'){a=l+b}}}}a=Math.max(0,a);var i='',m=0;if(g.options.indentWithTabs){for(var r=Math.floor(a/j);r;--r){m+=j;i+='\t'}}if(m<a){i+=spaceStr(a-m)}if(i!=h){replaceRange(d,i,Pos(f,0),Pos(f,h.length),'+input');e.stateAfter=null;return !0}else {for(var k=0;k<d.sel.ranges.length;k++){var p=d.sel.ranges[k];if(p.head.line==f&&p.head.ch<h.length){var o=Pos(f,h.length);replaceOneSelection(d,k,new c(o,o));break}}}}var m=null;function setLastCopied(a){m=a}function applyTextInput(a,f,j,b,q){var l=a.doc;a.display.shift=!1;if(!b){b=l.sel}var h=a.state.pasteIncoming||q=='paste';var g=ah(f),c=null;if(h&&b.ranges.length>1){if(m&&m.text.join('\n')==f){if(b.ranges.length%m.text.length==0){c=[];for(var n=0;n<m.text.length;n++){c.push(l.splitLines(m.text[n]))}}}else {if(g.length==b.ranges.length&&a.options.pasteLinesPerSelection){c=map(g,function(a){return [a]})}}}var p;for(var i=b.ranges.length-1;i>=0;i--){var k=b.ranges[i];var d=k.from(),e=k.to();if(k.empty()){if(j&&j>0){d=Pos(d.line,d.ch-j)}else {if(a.state.overwrite&&!h){e=Pos(e.line,Math.min(getLine(l,e.line).text.length,e.ch+lst(g).length))}else {if(m&&m.lineWise&&m.text.join('\n')==f){d=e=Pos(d.line,0)}}}}p=a.curOp.updateInput;var o={from:d,to:e,text:c?c[i%c.length]:g,origin:q||(h?'paste':a.state.cutIncoming?'cut':'+input')};makeChange(a.doc,o);signalLater(a,'inputRead',a,o)}if(f&&!h){triggerElectric(a,f)}ensureCursorVisible(a);a.curOp.updateInput=p;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function handlePaste(b,a){var c=b.clipboardData&&b.clipboardData.getData('Text');if(c){b.preventDefault();if(!a.isReadOnly()&&!a.options.disableInput){runInOp(a,function(){return applyTextInput(a,c,0,null,'paste')})}return !0}}function triggerElectric(a,h){if(!a.options.electricChars||!a.options.smartIndent){return}var f=a.doc.sel;for(var d=f.ranges.length-1;d>=0;d--){var b=f.ranges[d];if(b.head.ch>100||d&&f.ranges[d-1].head.line==b.head.line){continue}var c=a.getModeAt(b.head);var e=!1;if(c.electricChars){for(var g=0;g<c.electricChars.length;g++){if(h.indexOf(c.electricChars.charAt(g))>-1){e=indentLine(a,b.head.line,'smart');break}}}else {if(c.electricInput){if(c.electricInput.test(getLine(a.doc,b.head.line).text.slice(0,b.head.ch))){e=indentLine(a,b.head.line,'smart')}}}if(e){signalLater(a,'electricInput',a,b.head.line)}}}function copyableRanges(b){var f=[],d=[];for(var c=0;c<b.doc.sel.ranges.length;c++){var e=b.doc.sel.ranges[c].head.line;var a={anchor:Pos(e,0),head:Pos(e+1,0)};d.push(a);f.push(b.getRange(a.anchor,a.head))}return {text:f,ranges:d}}function disableBrowserMagic(a,b){a.setAttribute('autocorrect','off');a.setAttribute('autocapitalize','off');a.setAttribute('spellcheck',!!b)}function hiddenTextarea(){var a=elt('textarea',null,null,'position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none');var b=elt('div',[a],null,'overflow: hidden; position: relative; width: 3px; height: 0px;');if(h){a.style.width='1000px'}else {a.setAttribute('wrap','off')}if(U){a.style.border='1px solid black'}disableBrowserMagic(a);return b}function addEditorMethods(a){var d=a.optionHandlers;var b=a.helpers={};a.prototype={constructor:a,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,c){var b=this.options,e=b[a];if(b[a]==c&&a!='mode'){return}b[a]=c;if(d.hasOwnProperty(a)){operation(this,d[a])(this,c,e)}signal(this,'optionChange',this,a)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(b,a){this.state.keyMaps[a?'push':'unshift'](getKeyMap(b))},removeKeyMap:function(c){var b=this.state.keyMaps;for(var a=0;a<b.length;++a){if(b[a]==c||b[a].name==c){b.splice(a,1);return !0}}},addOverlay:methodOp(function(c,b){var d=c.token?c:a.getMode(this.options,c);if(d.startState){throw new Error('Overlays may not be stateful.')}insertSorted(this.state.overlays,{mode:d,modeSpec:c,opaque:b&&b.opaque,priority:b&&b.priority||0},function(a){return a.priority});this.state.modeGen++;regChange(this)}),removeOverlay:methodOp(function(c){var d=this;var b=this.state.overlays;for(var a=0;a<b.length;++a){var e=b[a].modeSpec;if(e==c||typeof c=='string'&&e.name==c){b.splice(a,1);d.state.modeGen++;regChange(d);return}}}),indentLine:methodOp(function(b,a,c){if(typeof a!='string'&&typeof a!='number'){if(a==null){a=this.options.smartIndent?'smart':'prev'}else {a=a?'add':'subtract'}}if(isLine(this.doc,b)){indentLine(this,b,a,c)}}),indentSelection:methodOp(function(j){var a=this;var g=this.doc.sel.ranges,e=-1;for(var b=0;b<g.length;b++){var d=g[b];if(!d.empty()){var h=d.from(),k=d.to();var l=Math.max(e,h.line);e=Math.min(a.lastLine(),k.line-(k.ch?0:1))+1;for(var i=l;i<e;++i){indentLine(a,i,j)}var f=a.doc.sel.ranges;if(h.ch==0&&g.length==f.length&&f[b].from().ch>0){replaceOneSelection(a.doc,b,new c(h,f[b].to()),p)}}else {if(d.head.line>e){indentLine(a,d.head.line,j,!0);e=d.head.line;if(b==a.doc.sel.primIndex){ensureCursorVisible(a)}}}}}),getTokenAt:function(b,a){return takeToken(this,b,a)},getLineTokens:function(b,a){return takeToken(this,Pos(b),a,!0)},getTokenTypeAt:function(d){d=clipPos(this.doc,d);var c=getLineStyles(this,getLine(this.doc,d.line));var g=0,h=(c.length-1)/2,f=d.ch;var a;if(f==0){a=c[2]}else {for(;;){var b=g+h>>1;if((b?c[b*2-1]:0)>=f){h=b}else {if(c[b*2+1]<f){g=b+1}else {a=c[b*2+2];break}}}}var e=a?a.indexOf('overlay '):-1;return e<0?a:e==0?null:a.slice(0,e-1)},getModeAt:function(c){var b=this.doc.mode;if(!b.innerMode){return b}return a.innerMode(b,this.getTokenAt(c).state).mode},getHelper:function(b,a){return this.getHelpers(b,a)[0]},getHelpers:function(k,e){var j=this;var d=[];if(!b.hasOwnProperty(e)){return d}var c=b[e],a=this.getModeAt(k);if(typeof a[e]=='string'){if(c[a[e]]){d.push(c[a[e]])}}else {if(a[e]){for(var h=0;h<a[e].length;h++){var i=c[a[e][h]];if(i){d.push(i)}}}else {if(a.helperType&&c[a.helperType]){d.push(c[a.helperType])}else {if(c[a.name]){d.push(c[a.name])}}}}for(var g=0;g<c._global.length;g++){var f=c._global[g];if(f.pred(a,j)&&indexOf(d,f.val)==-1){d.push(f.val)}}return d},getStateAfter:function(a,c){var b=this.doc;a=clipLine(b,a==null?b.first+b.size-1:a);return getContextBefore(this,a+1,c).state},cursorCoords:function(a,d){var b,c=this.doc.sel.primary();if(a==null){b=c.head}else {if(typeof a=='object'){b=clipPos(this.doc,a)}else {b=a?c.from():c.to()}}return cursorCoords(this,b,d||'page')},charCoords:function(b,a){return charCoords(this,clipPos(this.doc,b),a||'page')},coordsChar:function(a,b){a=fromCoordSystem(this,a,b||'page');return coordsChar(this,a.left,a.top)},lineAtHeight:function(a,b){a=fromCoordSystem(this,{top:a,left:0},b||'page').top;return lineAtHeight(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,f,e){var c=!1,b;if(typeof a=='number'){var d=this.doc.first+this.doc.size-1;if(a<this.doc.first){a=this.doc.first}else {if(a>d){a=d;c=!0}}b=getLine(this.doc,a)}else {b=a}return intoCoordSystem(this,b,{top:0,left:0},f||'page',e||c).top+(c?this.doc.height-heightAtLine(b):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return {from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(b,a,j,f,g){var d=this.display;b=cursorCoords(this,clipPos(this.doc,b));var e=b.bottom,c=b.left;a.style.position='absolute';a.setAttribute('cm-ignore-events','true');this.display.input.setUneditable(a);d.sizer.appendChild(a);if(f=='over'){e=b.top}else {if(f=='above'||f=='near'){var i=Math.max(d.wrapper.clientHeight,this.doc.height),h=Math.max(d.sizer.clientWidth,d.lineSpace.clientWidth);if((f=='above'||b.bottom+a.offsetHeight>i)&&b.top>a.offsetHeight){e=b.top-a.offsetHeight}else {if(b.bottom+a.offsetHeight<=i){e=b.bottom}}if(c+a.offsetWidth>h){c=h-a.offsetWidth}}}a.style.top=e+'px';a.style.left=a.style.right='';if(g=='right'){c=d.sizer.clientWidth-a.offsetWidth;a.style.right='0px'}else {if(g=='left'){c=0}else {if(g=='middle'){c=(d.sizer.clientWidth-a.offsetWidth)/2}}a.style.left=c+'px'}if(j){scrollIntoView(this,{left:c,top:e,right:c+a.offsetWidth,bottom:e+a.offsetHeight})}},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(a){if(P.hasOwnProperty(a)){return P[a].call(null,this)}},triggerElectric:methodOp(function(a){triggerElectric(this,a)}),findPosH:function(g,a,h,e){var f=this;var c=1;if(a<0){c=-1;a=-a}var b=clipPos(this.doc,g);for(var d=0;d<a;++d){b=findPosH(f.doc,b,c,h,e);if(b.hitSide){break}}return b},moveH:methodOp(function(b,c){var a=this;this.extendSelectionsBy(function(d){if(a.display.shift||a.doc.extend||d.empty()){return findPosH(a.doc,d.head,b,c,a.options.rtlMoveVisually)}else {return b<0?d.from():d.to()}},Q)}),deleteH:methodOp(function(a,c){var d=this.doc.sel,b=this.doc;if(d.somethingSelected()){b.replaceSelection('',null,'+delete')}else {deleteNearSelection(this,function(d){var e=findPosH(b,d.head,a,c,!1);return a<0?{from:e,to:d.head}:{from:d.head,to:e}})}}),findPosV:function(i,a,j,h){var e=this;var f=1,d=h;if(a<0){f=-1;a=-a}var b=clipPos(this.doc,i);for(var g=0;g<a;++g){var c=cursorCoords(e,b,'div');if(d==null){d=c.left}else {c.left=d}b=findPosV(e,c,f,j);if(b.hitSide){break}}return b},moveV:methodOp(function(f,e){var b=this;var a=this.doc,d=[];var g=!this.display.shift&&!a.extend&&a.sel.somethingSelected();a.extendSelectionsBy(function(c){if(g){return f<0?c.from():c.to()}var h=cursorCoords(b,c.head,'div');if(c.goalColumn!=null){h.left=c.goalColumn}d.push(h.left);var i=findPosV(b,h,f,e);if(e=='page'&&c==a.sel.primary()){addToScrollTop(b,charCoords(b,i,'div').top-h.top)}return i},Q);if(d.length){for(var c=0;c<a.sel.ranges.length;c++){a.sel.ranges[c].goalColumn=d[c]}}}),findWordAt:function(b){var i=this.doc,d=getLine(i,b.line).text;var a=b.ch,e=b.ch;if(d){var g=this.getHelper(b,'wordChars');if((b.sticky=='before'||e==d.length)&&a){--a}else {++e}var f=d.charAt(a);var h=isWordChar(f,g)?function(a){return isWordChar(a,g)}:/\s/.test(f)?function(a){return /\s/.test(a)}:function(a){return !/\s/.test(a)&&!isWordChar(a)};while(a>0&&h(d.charAt(a-1))){--a}while(e<d.length&&h(d.charAt(e))){++e}}return new c(Pos(b.line,a),Pos(b.line,e))},toggleOverwrite:function(a){if(a!=null&&a==this.state.overwrite){return}if(this.state.overwrite=!this.state.overwrite){addClass(this.display.cursorDiv,'CodeMirror-overwrite')}else {A(this.display.cursorDiv,'CodeMirror-overwrite')}signal(this,'overwriteToggle',this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return !!(this.options.readOnly||this.doc.cantEdit)},scrollTo:methodOp(function(a,b){scrollToCoords(this,a,b)}),getScrollInfo:function(){var a=this.display.scroller;return {left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-scrollGap(this)-this.display.barHeight,width:a.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(a,b){if(a==null){a={from:this.doc.sel.primary().head,to:null};if(b==null){b=this.options.cursorScrollMargin}}else {if(typeof a=='number'){a={from:Pos(a,0),to:null}}else {if(a.from==null){a={from:a,to:null}}}}if(!a.to){a.to=a.from}a.margin=b||0;if(a.from.line!=null){scrollToRange(this,a)}else {scrollToCoordsRange(this,a.from,a.to,a.margin)}}),setSize:methodOp(function(d,c){var e=this;var b=function(a){return typeof a=='number'||/^\d+$/.test(String(a))?a+'px':a};if(d!=null){this.display.wrapper.style.width=b(d)}if(c!=null){this.display.wrapper.style.height=b(c)}if(this.options.lineWrapping){clearLineMeasurementCache(this)}var a=this.display.viewFrom;this.doc.iter(a,this.display.viewTo,function(b){if(b.widgets){for(var c=0;c<b.widgets.length;c++){if(b.widgets[c].noHScroll){regLineChange(e,a,'widget');break}}}++a});this.curOp.forceUpdate=!0;signal(this,'refresh',this)}),operation:function(a){return runInOp(this,a)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp(function(){var a=this.display.cachedTextHeight;regChange(this);this.curOp.forceUpdate=!0;clearCaches(this);scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop);updateGutterSpace(this);if(a==null||Math.abs(a-textHeight(this.display))>0.5){estimateLineHeights(this)}signal(this,'refresh',this)}),swapDoc:methodOp(function(a){var b=this.doc;b.cm=null;attachDoc(this,a);clearCaches(this);this.display.input.reset();scrollToCoords(this,a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;signalLater(this,'swapDoc',this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};eventMixin(a);a.registerHelper=function(c,e,d){if(!b.hasOwnProperty(c)){b[c]=a[c]={_global:[]}}b[c][e]=d};a.registerGlobalHelper=function(d,f,e,c){a.registerHelper(d,f,c);b[d]._global.push({pred:e,val:c})}}function findPosH(b,a,c,f,l){var m=a;var n=c;var d=getLine(b,a.line);function findNextLine(){var e=a.line+c;if(e<b.first||e>=b.first+b.size){return !1}a=new Pos(e,a.ch,a.sticky);return d=getLine(b,e)}function moveOnce(f){var e;if(l){e=moveVisually(b.cm,d,a,c)}else {e=moveLogically(d,a,c)}if(e==null){if(!f&&findNextLine()){a=endOfLine(l,b.cm,d,a.line,c)}else {return !1}}else {a=e}return !0}if(f=='char'){moveOnce()}else {if(f=='column'){moveOnce(!0)}else {if(f=='word'||f=='group'){var h=null,j=f=='group';var o=b.cm&&b.cm.getHelper(a,'wordChars');for(var g=!0;;g=!1){if(c<0&&!moveOnce(!g)){break}var k=d.text.charAt(a.ch)||'\n';var e=isWordChar(k,o)?'w':j&&k=='\n'?'n':!j||/\s/.test(k)?null:'p';if(j&&!g&&!e){e='s'}if(h&&h!=e){if(c<0){c=1;moveOnce();a.sticky='after'}break}if(e){h=e}if(c>0&&!moveOnce(!g)){break}}}}}var i=skipAtomic(b,a,m,n,!0);if(equalCursorPos(m,i)){i.hitSide=!0}return i}function findPosV(e,c,b,f){var i=e.doc,j=c.left,a;if(f=='page'){var h=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);var g=Math.max(h-0.5*textHeight(e.display),3);a=(b>0?c.bottom:c.top)+b*g}else {if(f=='line'){a=b>0?c.bottom+3:c.top-3}}var d;for(;;){d=coordsChar(e,j,a);if(!d.outside){break}if(b<0?a<=0:a>=i.height){d.hitSide=!0;break}a+=b*5}return d}var d=function(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new z();this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};d.prototype.init=function(g){var c=this;var f=this,b=f.cm;var d=f.div=g.lineDiv;disableBrowserMagic(d,b.options.spellcheck);a(d,'paste',function(a){if(signalDOMEvent(b,a)||handlePaste(a,b)){return}if(e<=11){setTimeout(operation(b,function(){return c.updateFromDOM()}),20)}});a(d,'compositionstart',function(a){c.composing={data:a.data,done:!1}});a(d,'compositionupdate',function(a){if(!c.composing){c.composing={data:a.data,done:!1}}});a(d,'compositionend',function(a){if(c.composing){if(a.data!=c.composing.data){c.readFromDOMSoon()}c.composing.done=!0}});a(d,'touchstart',function(){return f.forceCompositionEnd()});a(d,'input',function(){if(!c.composing){c.readFromDOMSoon()}});function onCopyCut(a){if(signalDOMEvent(b,a)){return}if(b.somethingSelected()){setLastCopied({lineWise:!1,text:b.getSelections()});if(a.type=='cut'){b.replaceSelection('',null,'cut')}}else {if(!b.options.lineWiseCopyCut){return}else {var h=copyableRanges(b);setLastCopied({lineWise:!0,text:h.text});if(a.type=='cut'){b.operation(function(){b.setSelections(h.ranges,0,p);b.replaceSelection('',null,'cut')})}}}if(a.clipboardData){a.clipboardData.clearData();var g=m.text.join('\n');a.clipboardData.setData('Text',g);if(a.clipboardData.getData('Text')==g){a.preventDefault();return}}var c=hiddenTextarea(),i=c.firstChild;b.display.lineSpace.insertBefore(c,b.display.lineSpace.firstChild);i.value=m.text.join('\n');var e=document.activeElement;L(i);setTimeout(function(){b.display.lineSpace.removeChild(c);e.focus();if(e==d){f.showPrimarySelection()}},50)}a(d,'copy',onCopyCut);a(d,'cut',onCopyCut)};d.prototype.prepareSelection=function(){var a=prepareSelection(this.cm,!1);a.focus=this.cm.state.focused;return a};d.prototype.showSelection=function(a,b){if(!a||!this.cm.display.view.length){return}if(a.focus||b){this.showPrimarySelection()}this.showMultipleSelections(a)};d.prototype.showPrimarySelection=function(){var a=window.getSelection(),b=this.cm,m=b.doc.sel.primary();var j=m.from(),k=m.to();if(b.display.viewTo==b.display.viewFrom||j.line>=b.display.viewTo||k.line<b.display.viewFrom){a.removeAllRanges();return}var g=domToPos(b,a.anchorNode,a.anchorOffset);var h=domToPos(b,a.focusNode,a.focusOffset);if(g&&!g.bad&&h&&!h.bad&&cmp(minPos(g,h),j)==0&&cmp(maxPos(g,h),k)==0){return}var l=b.display.view;var d=j.line>=b.display.viewFrom&&posToDOM(b,j)||{node:l[0].measure.map[2],offset:0};var e=k.line<b.display.viewTo&&posToDOM(b,k);if(!e){var i=l[l.length-1].measure;var c=i.maps?i.maps[i.maps.length-1]:i.map;e={node:c[c.length-1],offset:c[c.length-2]-c[c.length-3]}}if(!d||!e){a.removeAllRanges();return}var n=a.rangeCount&&a.getRangeAt(0),f;try{f=B(d.node,d.offset,e.offset,e.node)}catch(aV){}if(f){if(!v&&b.state.focused){a.collapse(d.node,d.offset);if(!f.collapsed){a.removeAllRanges();a.addRange(f)}}else {a.removeAllRanges();a.addRange(f)}if(n&&a.anchorNode==null){a.addRange(n)}else {if(v){this.startGracePeriod()}}}this.rememberSelection()};d.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;if(a.selectionChanged()){a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})}},20)};d.prototype.showMultipleSelections=function(a){removeChildrenAndAdd(this.cm.display.cursorDiv,a.cursors);removeChildrenAndAdd(this.cm.display.selectionDiv,a.selection)};d.prototype.rememberSelection=function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset};d.prototype.selectionInEditor=function(){var a=window.getSelection();if(!a.rangeCount){return !1}var b=a.getRangeAt(0).commonAncestorContainer;return contains(this.div,b)};d.prototype.focus=function(){if(this.cm.options.readOnly!='nocursor'){if(!this.selectionInEditor()){this.showSelection(this.prepareSelection(),!0)}this.div.focus()}};d.prototype.blur=function(){this.div.blur()};d.prototype.getField=function(){return this.div};d.prototype.supportsTouch=function(){return !0};d.prototype.receivedFocus=function(){var a=this;if(this.selectionInEditor()){this.pollSelection()}else {runInOp(this.cm,function(){return a.cm.curOp.selectionChanged=!0})}function poll(){if(a.cm.state.focused){a.pollSelection();a.polling.set(a.cm.options.pollInterval,poll)}}this.polling.set(this.cm.options.pollInterval,poll)};d.prototype.selectionChanged=function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset};d.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged()){return}var a=window.getSelection(),b=this.cm;if(_&&aa&&this.cm.options.gutters.length&&isInGutter(a.anchorNode)){this.cm.triggerOnKeyDown({type:'keydown',keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}if(this.composing){return}this.rememberSelection();var c=domToPos(b,a.anchorNode,a.anchorOffset);var d=domToPos(b,a.focusNode,a.focusOffset);if(c&&d){runInOp(b,function(){setSelection(b.doc,simpleSelection(c,d),p);if(c.bad||d.bad){b.curOp.selectionChanged=!0}})}};d.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null}var b=this.cm,c=b.display,u=b.doc.sel.primary();var f=u.from(),k=u.to();if(f.ch==0&&f.line>b.firstLine()){f=Pos(f.line-1,getLine(b.doc,f.line-1).length)}if(k.ch==getLine(b.doc,k.line).text.length&&k.line<b.lastLine()){k=Pos(k.line+1,0)}if(f.line<c.viewFrom||k.line>c.viewTo-1){return !1}var n,h,m;if(f.line==c.viewFrom||(n=findViewIndex(b,f.line))==0){h=lineNo(c.view[0].line);m=c.view[0].node}else {h=lineNo(c.view[n].line);m=c.view[n-1].node.nextSibling}var o=findViewIndex(b,k.line);var j,p;if(o==c.view.length-1){j=c.viewTo-1;p=c.lineDiv.lastChild}else {j=lineNo(c.view[o+1].line)-1;p=c.view[o+1].node.previousSibling}if(!m){return !1}var a=b.doc.splitLines(domTextBetween(b,m,p,h,j));var e=getBetween(b.doc,Pos(h,0),Pos(j,getLine(b.doc,j).text.length));while(a.length>1&&e.length>1){if(lst(a)==lst(e)){a.pop();e.pop();j--}else {if(a[0]==e[0]){a.shift();e.shift();h++}else {break}}}var d=0,g=0;var r=a[0],s=e[0],v=Math.min(r.length,s.length);while(d<v&&r.charCodeAt(d)==s.charCodeAt(d)){++d}var i=lst(a),l=lst(e);var w=Math.min(i.length-(a.length==1?d:0),l.length-(e.length==1?d:0));while(g<w&&i.charCodeAt(i.length-g-1)==l.charCodeAt(l.length-g-1)){++g}if(a.length==1&&e.length==1&&h==f.line){while(d&&d>f.ch&&i.charCodeAt(i.length-g-1)==l.charCodeAt(l.length-g-1)){d--;g++}}a[a.length-1]=i.slice(0,i.length-g).replace(/^\u200b+/,'');a[0]=a[0].slice(d).replace(/\u200b+$/,'');var q=Pos(h,d);var t=Pos(j,e.length?lst(e).length-g:0);if(a.length>1||a[0]||cmp(q,t)){replaceRange(b.doc,a,q,t,'+input');return !0}};d.prototype.ensurePolled=function(){this.forceCompositionEnd()};d.prototype.reset=function(){this.forceCompositionEnd()};d.prototype.forceCompositionEnd=function(){if(!this.composing){return}clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus()};d.prototype.readFromDOMSoon=function(){var a=this;if(this.readDOMTimeout!=null){return}this.readDOMTimeout=setTimeout(function(){a.readDOMTimeout=null;if(a.composing){if(a.composing.done){a.composing=null}else {return}}a.updateFromDOM()},80)};d.prototype.updateFromDOM=function(){var a=this;if(this.cm.isReadOnly()||!this.pollContent()){runInOp(this.cm,function(){return regChange(a.cm)})}};d.prototype.setUneditable=function(a){a.contentEditable='false'};d.prototype.onKeyPress=function(a){if(a.charCode==0){return}a.preventDefault();if(!this.cm.isReadOnly()){operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(a.charCode==null?a.keyCode:a.charCode),0)}};d.prototype.readOnlyChanged=function(a){this.div.contentEditable=String(a!='nocursor')};d.prototype.onContextMenu=function(){};d.prototype.resetPosition=function(){};d.prototype.needsContentAttribute=!0;function posToDOM(d,b){var c=findViewForLine(d,b.line);if(!c||c.hidden){return null}var f=getLine(d.doc,b.line);var i=mapFromLineView(c,f,b.line);var e=getOrder(f,d.doc.direction),g='left';if(e){var h=getBidiPartAt(e,b.ch);g=h%2?'right':'left'}var a=nodeAndOffsetInLineMap(i.map,b.ch,g);a.offset=a.collapse=='right'?a.end:a.start;return a}function isInGutter(b){for(var a=b;a;a=a.parentNode){if(/CodeMirror-gutter-wrapper/.test(a.className)){return !0}}return !1}function badPos(a,b){if(b){a.bad=!0}return a}function domTextBetween(d,a,h,f,g){var c='',b=!1,e=d.doc.lineSeparator();function recognizeMarker(a){return function(b){return b.id==a}}function close(){if(b){c+=e;b=!1}}function addText(a){if(a){close();c+=a}}function walk(a){if(a.nodeType==1){var k=a.getAttribute('cm-text');if(k!=null){addText(k||a.textContent.replace(/\u200b/g,''));return}var i=a.getAttribute('cm-marker'),c;if(i){var l=d.findMarks(Pos(f,0),Pos(g+1,0),recognizeMarker(+i));if(l.length&&(c=l[0].find(0))){addText(getBetween(d.doc,c.from,c.to).join(e))}return}if(a.getAttribute('contenteditable')=='false'){return}var j=/^(pre|div|p)$/i.test(a.nodeName);if(j){close()}for(var h=0;h<a.childNodes.length;h++){walk(a.childNodes[h])}if(j){b=!0}}else {if(a.nodeType==3){addText(a.nodeValue)}}}for(;;){walk(a);if(a==h){break}a=a.nextSibling}return c}function domToPos(b,c,d){var a;if(c==b.display.lineDiv){a=b.display.lineDiv.childNodes[d];if(!a){return badPos(b.clipPos(Pos(b.display.viewTo-1)),!0)}c=null;d=0}else {for(a=c;;a=a.parentNode){if(!a||a==b.display.lineDiv){return null}if(a.parentNode&&a.parentNode==b.display.lineDiv){break}}}for(var e=0;e<b.display.view.length;e++){var f=b.display.view[e];if(f.node==a){return locateNodeInLineView(f,c,d)}}}function locateNodeInLineView(c,a,d){var j=c.text.firstChild,i=!1;if(!a||!contains(j,a)){return badPos(Pos(lineNo(c.line),0),!0)}if(a==j){i=!0;a=j.childNodes[d];d=0;if(!a){var o=c.rest?lst(c.rest):c.line;return badPos(Pos(lineNo(o),o.text.length),i)}}var e=a.nodeType==3?a:null,f=a;if(!e&&a.childNodes.length==1&&a.firstChild.nodeType==3){e=a.firstChild;if(d){d=e.nodeValue.length}}while(f.parentNode!=j){f=f.parentNode}var l=c.measure,k=l.maps;function find(g,i,f){for(var a=-1;a<(k?k.length:0);a++){var d=a<0?l.map:k[a];for(var b=0;b<d.length;b+=3){var e=d[b+2];if(e==g||e==i){var j=lineNo(a<0?c.line:c.rest[a]);var h=d[b]+f;if(f<0||e!=g){h=d[b+(f?1:0)]}return Pos(j,h)}}}}var b=find(e,f,d);if(b){return badPos(b,i)}for(var h=f.nextSibling,n=e?e.nodeValue.length-d:0;h;h=h.nextSibling){b=find(h,h.firstChild,0);if(b){return badPos(Pos(b.line,b.ch-n),i)}else {n+=h.textContent.length}}for(var g=f.previousSibling,m=d;g;g=g.previousSibling){b=find(g,g.firstChild,-1);if(b){return badPos(Pos(b.line,b.ch+m),i)}else {m+=g.textContent.length}}}var g=function(a){this.cm=a;this.prevInput='';this.pollingFast=!1;this.polling=new z();this.hasSelection=!1;this.composing=null};g.prototype.init=function(g){var h=this;var d=this,c=this.cm;var i=this.wrapper=hiddenTextarea();var f=this.textarea=i.firstChild;g.wrapper.insertBefore(i,g.wrapper.firstChild);if(U){f.style.width='0px'}a(f,'input',function(){if(b&&e>=9&&h.hasSelection){h.hasSelection=null}d.poll()});a(f,'paste',function(a){if(signalDOMEvent(c,a)||handlePaste(a,c)){return}c.state.pasteIncoming=!0;d.fastPoll()});function prepareCopyCut(b){if(signalDOMEvent(c,b)){return}if(c.somethingSelected()){setLastCopied({lineWise:!1,text:c.getSelections()})}else {if(!c.options.lineWiseCopyCut){return}else {var a=copyableRanges(c);setLastCopied({lineWise:!0,text:a.text});if(b.type=='cut'){c.setSelections(a.ranges,null,p)}else {d.prevInput='';f.value=a.text.join('\n');L(f)}}}if(b.type=='cut'){c.state.cutIncoming=!0}}a(f,'cut',prepareCopyCut);a(f,'copy',prepareCopyCut);a(g.scroller,'paste',function(a){if(eventInWidget(g,a)||signalDOMEvent(c,a)){return}c.state.pasteIncoming=!0;d.focus()});a(g.lineSpace,'selectstart',function(a){if(!eventInWidget(g,a)){e_preventDefault(a)}});a(f,'compositionstart',function(){var a=c.getCursor('from');if(d.composing){d.composing.range.clear()}d.composing={start:a,range:c.markText(a,c.getCursor('to'),{className:'CodeMirror-composing'})}});a(f,'compositionend',function(){if(d.composing){d.poll();d.composing.range.clear();d.composing=null}})};g.prototype.prepareSelection=function(){var a=this.cm,b=a.display,g=a.doc;var c=prepareSelection(a);if(a.options.moveInputWithCursor){var d=cursorCoords(a,g.sel.primary().head,'div');var f=b.wrapper.getBoundingClientRect(),e=b.lineDiv.getBoundingClientRect();c.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,d.top+e.top-f.top));c.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,d.left+e.left-f.left))}return c};g.prototype.showSelection=function(a){var c=this.cm,b=c.display;removeChildrenAndAdd(b.cursorDiv,a.cursors);removeChildrenAndAdd(b.selectionDiv,a.selection);if(a.teTop!=null){this.wrapper.style.top=a.teTop+'px';this.wrapper.style.left=a.teLeft+'px'}};g.prototype.reset=function(d){if(this.contextMenuPending||this.composing){return}var a=this.cm;if(a.somethingSelected()){this.prevInput='';var c=a.getSelection();this.textarea.value=c;if(a.state.focused){L(this.textarea)}if(b&&e>=9){this.hasSelection=c}}else {if(!d){this.prevInput=this.textarea.value='';if(b&&e>=9){this.hasSelection=null}}}};g.prototype.getField=function(){return this.textarea};g.prototype.supportsTouch=function(){return !1};g.prototype.focus=function(){if(this.cm.options.readOnly!='nocursor'&&(!R||activeElt()!=this.textarea)){try{this.textarea.focus()}catch(aV){}}};g.prototype.blur=function(){this.textarea.blur()};g.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};g.prototype.receivedFocus=function(){this.slowPoll()};g.prototype.slowPoll=function(){var a=this;if(this.pollingFast){return}this.polling.set(this.cm.options.pollInterval,function(){a.poll();if(a.cm.state.focused){a.slowPoll()}})};g.prototype.fastPoll=function(){var b=!1,a=this;a.pollingFast=!0;function p(){var c=a.poll();if(!c&&!b){b=!0;a.polling.set(60,p)}else {a.pollingFast=!1;a.slowPoll()}}a.polling.set(20,p)};g.prototype.poll=function(){var f=this;var a=this.cm,h=this.textarea,d=this.prevInput;if(this.contextMenuPending||!a.state.focused||aM(h)&&!d&&!this.composing||a.isReadOnly()||a.options.disableInput||a.state.keySeq){return !1}var c=h.value;if(c==d&&!a.somethingSelected()){return !1}if(b&&e>=9&&this.hasSelection===c||o&&/[\uf700-\uf7ff]/.test(c)){a.display.input.reset();return !1}if(a.doc.sel==a.display.selForContextMenu){var i=c.charCodeAt(0);if(i==8203&&!d){d='​'}if(i==8666){this.reset();return this.cm.execCommand('undo')}}var g=0,j=Math.min(d.length,c.length);while(g<j&&d.charCodeAt(g)==c.charCodeAt(g)){++g}runInOp(a,function(){applyTextInput(a,c.slice(g),d.length-g,null,f.composing?'*compose':null);if(c.length>1000||c.indexOf('\n')>-1){h.value=f.prevInput=''}else {f.prevInput=c}if(f.composing){f.composing.range.clear();f.composing.range=a.markText(f.composing.start,a.getCursor('to'),{className:'CodeMirror-composing'})}});return !0};g.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=!1}};g.prototype.onKeyPress=function(){if(b&&e>=9){this.hasSelection=null}this.fastPoll()};g.prototype.onContextMenu=function(i){var g=this,d=g.cm,c=d.display,f=g.textarea;var j=posFromMouse(d,i),q=c.scroller.scrollTop;if(!j||n){return}var s=d.options.resetSelectionOnContextMenu;if(s&&d.doc.sel.contains(j)==-1){operation(d,setSelection)(d.doc,simpleSelection(j),p)}var r=f.style.cssText,o=g.wrapper.style.cssText;g.wrapper.style.cssText='position: absolute';var l=g.wrapper.getBoundingClientRect();f.style.cssText='position: absolute; width: 30px; height: 30px;\n      top: '+(i.clientY-l.top-5)+'px; left: '+(i.clientX-l.left-5)+'px;\n      z-index: 1000; background: '+(b?'rgba(255, 255, 255, .05)':'transparent')+';\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);';var k;if(h){k=window.scrollY}c.input.focus();if(h){window.scrollTo(null,k)}c.input.reset();if(!d.somethingSelected()){f.value=g.prevInput=' '}g.contextMenuPending=!0;c.selForContextMenu=d.doc.sel;clearTimeout(c.detectingSelectAll);function prepareSelectAllHack(){if(f.selectionStart!=null){var a=d.somethingSelected();var b='​'+(a?f.value:'');f.value='⇚';f.value=b;g.prevInput=a?'':'​';f.selectionStart=1;f.selectionEnd=b.length;c.selForContextMenu=d.doc.sel}}function rehide(){g.contextMenuPending=!1;g.wrapper.style.cssText=o;f.style.cssText=r;if(b&&e<9){c.scrollbars.setScrollTop(c.scroller.scrollTop=q)}if(f.selectionStart!=null){if(!b||b&&e<9){prepareSelectAllHack()}var h=0,a=function(){if(c.selForContextMenu==d.doc.sel&&f.selectionStart==0&&f.selectionEnd>0&&g.prevInput=='​'){operation(d,selectAll)(d)}else {if(h++<10){c.detectingSelectAll=setTimeout(a,500)}else {c.selForContextMenu=null;c.input.reset()}}};c.detectingSelectAll=setTimeout(a,200)}}if(b&&e>=9){prepareSelectAllHack()}if(ae){e_stop(i);var m=function(){off(window,'mouseup',m);setTimeout(rehide,20)};a(window,'mouseup',m)}else {setTimeout(rehide,50)}};g.prototype.readOnlyChanged=function(a){if(!a){this.reset()}this.textarea.disabled=a=='nocursor'};g.prototype.setUneditable=function(){};g.prototype.needsContentAttribute=!1;function fromTextArea(b,c){c=c?copyObj(c):{};c.value=b.value;if(!c.tabindex&&b.tabIndex){c.tabindex=b.tabIndex}if(!c.placeholder&&b.placeholder){c.placeholder=b.placeholder}if(c.autofocus==null){var f=activeElt();c.autofocus=f==b||b.getAttribute('autofocus')!=null&&f==document.body}function save(){b.value=g.getValue()}var e;if(b.form){a(b.form,'submit',save);if(!c.leaveSubmitMethodAlone){var d=b.form;e=d.submit;try{var h=d.submit=function(){save();d.submit=e;d.submit();d.submit=h}}catch(aV){}}}c.finishInit=function(a){a.save=save;a.getTextArea=function(){return b};a.toTextArea=function(){a.toTextArea=isNaN;save();b.parentNode.removeChild(a.getWrapperElement());b.style.display='';if(b.form){off(b.form,'submit',save);if(typeof b.form.submit=='function'){b.form.submit=e}}}};b.style.display='none';var g=CodeMirror(function(a){return b.parentNode.insertBefore(a,b.nextSibling)},c);return g}function addLegacyProps(b){b.off=off;b.on=a;b.wheelEventPixels=wheelEventPixels;b.Doc=j;b.splitLines=ah;b.countColumn=countColumn;b.findColumn=findColumn;b.isWordChar=isWordCharBasic;b.Pass=ab;b.signal=signal;b.Line=G;b.changeEnd=changeEnd;b.scrollbarModel=aq;b.Pos=Pos;b.cmpPos=cmp;b.modes=an;b.mimeModes=E;b.resolveMode=resolveMode;b.getMode=getMode;b.modeExtensions=C;b.extendMode=extendMode;b.copyState=copyState;b.startState=startState;b.innerMode=innerMode;b.commands=P;b.keyMap=r;b.keyName=keyName;b.isModifierKey=isModifierKey;b.lookupKey=lookupKey;b.normalizeKeyMap=normalizeKeyMap;b.StringStream=f;b.SharedTextMarker=I;b.TextMarker=t;b.LineWidget=M;b.e_preventDefault=e_preventDefault;b.e_stopPropagation=e_stopPropagation;b.e_stop=e_stop;b.addClass=addClass;b.contains=contains;b.rmClass=A;b.keyNames=u}defineOptions(CodeMirror);addEditorMethods(CodeMirror);var aK='iter insert remove copy getEditor constructor'.split(' ');for(var ac in j.prototype){if(j.prototype.hasOwnProperty(ac)&&indexOf(aK,ac)<0){CodeMirror.prototype[ac]=function(a){return function(){return a.apply(this.doc,arguments)}}(j.prototype[ac])}}eventMixin(j);CodeMirror.inputStyles={'textarea':g,'contenteditable':d};CodeMirror.defineMode=function(a){if(!CodeMirror.defaults.mode&&a!='null'){CodeMirror.defaults.mode=a}defineMode.apply(this,arguments)};CodeMirror.defineMIME=defineMIME;CodeMirror.defineMode('null',function(){return {token:function(a){return a.skipToEnd()}}});CodeMirror.defineMIME('text/plain','null');CodeMirror.defineExtension=function(b,a){CodeMirror.prototype[b]=a};CodeMirror.defineDocExtension=function(b,a){j.prototype[b]=a};CodeMirror.fromTextArea=fromTextArea;addLegacyProps(CodeMirror);CodeMirror.version='5.33.1';return CodeMirror});