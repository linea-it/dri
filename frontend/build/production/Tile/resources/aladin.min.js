function AstroMath(){}function Projection(a,c){this.PROJECTION=Projection.PROJ_TAN,this.ROT=this.tr_oR(a,c)}function Coo(c,d,a){this.lon=c,this.lat=d,this.prec=a,this.frame=null,this.computeDirCos()}function Tokenizer(a,c){this.string=Strings.trim(a,c),this.sep=c,this.pos=0}function Strings(){}function Numbers(){}function relMouseCoords(E){if(E.offsetX){return{x:E.offsetX,y:E.offsetY}}if(!Utils.cssScale){var v=window.getComputedStyle(document.body,null),p=v.getPropertyValue("-webkit-transform")||v.getPropertyValue("-moz-transform")||v.getPropertyValue("-ms-transform")||v.getPropertyValue("-o-transform")||v.getPropertyValue("transform"),f=/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/,j=p.match(f);Utils.cssScale=j?parseFloat(j[1]):1}var F=E;F.target;var C=F.target||F.srcElement,k=C.currentStyle||window.getComputedStyle(C,null),q=parseInt(k.borderLeftWidth,10),m=parseInt(k.borderTopWidth,10),B=C.getBoundingClientRect(),D=F.clientX-q-B.left,w=F.clientY-m-B.top;return{x:parseInt(D/Utils.cssScale),y:parseInt(w/Utils.cssScale)}}var cds=cds||{},A=A||{};"object"!=typeof JSON&&(JSON={}),function(){function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,r,o,s,a,n=gap,h=e[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(e,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?h+"":"null";case"boolean":case"null":return h+"";case"object":if(!h){return"null"}if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(h)){for(s=h.length,i=0;s>i;i+=1){a[i]=str(i,h)||"null"}return o=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+n+"]":"["+a.join(",")+"]",gap=n,o}if(rep&&"object"==typeof rep){for(s=rep.length,i=0;s>i;i+=1){"string"==typeof rep[i]&&(r=rep[i],o=str(r,h),o&&a.push(quote(r)+(gap?": ":":")+o))}}else{for(r in h){Object.prototype.hasOwnProperty.call(h,r)&&(o=str(r,h),o&&a.push(quote(r)+(gap?": ":":")+o))}}return o=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+n+"}":"{"+a.join(",")+"}",gap=n,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var r;if(gap="",indent="","number"==typeof i){for(r=0;i>r;r+=1){indent+=" "}}else{"string"==typeof i&&(indent=i)}if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length)){throw Error("JSON.stringify")}return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,r,o=t[e];if(o&&"object"==typeof o){for(i in o){Object.prototype.hasOwnProperty.call(o,i)&&(r=walk(o,i),void 0!==r?o[i]=r:delete o[i])}}return reviver.call(t,e,o)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}(),Logger={},Logger.log=function(c,f){try{var a="http://alasky.u-strasbg.fr/cgi/AladinLiteLogger/log.py",d="";f&&(d=JSON.stringify(f)),$.ajax({url:a,data:{action:c,params:d,pageUrl:window.location.href,referer:document.referrer?document.referrer:""},method:"GET",dataType:"json"})}catch(h){window.console&&console.log("Exception: "+h)}},function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(w){function q(C){var F=C||window.event,h=p.call(arguments,1),o=0,H=0,D=0,c=0,t=0,G=0;if(C=w.event.fix(F),C.type="mousewheel","detail" in F&&(D=-1*F.detail),"wheelDelta" in F&&(D=F.wheelDelta),"wheelDeltaY" in F&&(D=F.wheelDeltaY),"wheelDeltaX" in F&&(H=-1*F.wheelDeltaX),"axis" in F&&F.axis===F.HORIZONTAL_AXIS&&(H=-1*D,D=0),o=0===D?H:D,"deltaY" in F&&(D=-1*F.deltaY,o=D),"deltaX" in F&&(H=F.deltaX,0===D&&(o=-1*H)),0!==D||0!==H){if(1===F.deltaMode){var s=w.data(this,"mousewheel-line-height");o*=s,D*=s,H*=s}else{if(2===F.deltaMode){var i=w.data(this,"mousewheel-page-height");o*=i,D*=i,H*=i}}if(c=Math.max(Math.abs(D),Math.abs(H)),(!B||B>c)&&(B=c,d(F,c)&&(B/=40)),d(F,c)&&(o/=40,H/=40,D/=40),o=Math[o>=1?"floor":"ceil"](o/B),H=Math[H>=1?"floor":"ceil"](H/B),D=Math[D>=1?"floor":"ceil"](D/B),u.settings.normalizeOffset&&this.getBoundingClientRect){var E=this.getBoundingClientRect();t=C.clientX-E.left,G=C.clientY-E.top}return C.deltaX=H,C.deltaY=D,C.deltaFactor=B,C.offsetX=t,C.offsetY=G,C.deltaMode=0,h.unshift(C,o,H,D),f&&clearTimeout(f),f=setTimeout(m,200),(w.event.dispatch||w.event.handle).apply(this,h)}}function m(){B=null}function d(a,c){return u.settings.adjustOldDeltas&&"mousewheel"===a.type&&0===c%120}var f,B,v=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],j="onwheel" in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],p=Array.prototype.slice;if(w.event.fixHooks){for(var k=v.length;k;){w.event.fixHooks[v[--k]]=w.event.mouseHooks}}var u=w.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener){for(var a=j.length;a;){this.addEventListener(j[--a],q,!1)}}else{this.onmousewheel=q}w.data(this,"mousewheel-line-height",u.getLineHeight(this)),w.data(this,"mousewheel-page-height",u.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var a=j.length;a;){this.removeEventListener(j[--a],q,!1)}}else{this.onmousewheel=null}w.removeData(this,"mousewheel-line-height"),w.removeData(this,"mousewheel-page-height")},getLineHeight:function(h){var a=w(h),c=a["offsetParent" in w.fn?"offsetParent":"parent"]();return c.length||(c=w("body")),parseInt(c.css("fontSize"),10)||parseInt(a.css("fontSize"),10)||16},getPageHeight:function(a){return w(a).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};w.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}();var Stats=function(){function U(c,h,a){var f,l,d;for(l=0;30>l;l++){for(f=0;73>f;f++){d=4*(f+74*l),c[d]=c[d+4],c[d+1]=c[d+5],c[d+2]=c[d+6]}}for(l=0;30>l;l++){d=4*(73+74*l),h>l?(c[d]=Q[a].bg.r,c[d+1]=Q[a].bg.g,c[d+2]=Q[a].bg.b):(c[d]=Q[a].fg.r,c[d+1]=Q[a].fg.g,c[d+2]=Q[a].fg.b)}}var ai,ae,X,aa,V,am,ab,af,ad,ak,N,aj,Z,ah,L=0,ag=2,ac=0,G=(new Date).getTime(),K=G,W=G,J=0,k=1000,al=0,F=0,j=1000,H=0,Y=0,q=1000,D=0,Q={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};ai=document.createElement("div"),ai.style.cursor="pointer",ai.style.width="80px",ai.style.opacity="0.9",ai.style.zIndex="10001",ai.addEventListener("click",function(){switch(L++,L==ag&&(L=0),ae.style.display="none",ab.style.display="none",N.style.display="none",L){case 0:ae.style.display="block";break;case 1:ab.style.display="block";break;case 2:N.style.display="block"}},!1),ae=document.createElement("div"),ae.style.backgroundColor="rgb("+Math.floor(Q.fps.bg.r/2)+","+Math.floor(Q.fps.bg.g/2)+","+Math.floor(Q.fps.bg.b/2)+")",ae.style.padding="2px 0px 3px 0px",ai.appendChild(ae),X=document.createElement("div"),X.style.fontFamily="Helvetica, Arial, sans-serif",X.style.textAlign="left",X.style.fontSize="9px",X.style.color="rgb("+Q.fps.fg.r+","+Q.fps.fg.g+","+Q.fps.fg.b+")",X.style.margin="0px 0px 1px 3px",X.innerHTML='<span style="font-weight:bold">FPS</span>',ae.appendChild(X),aa=document.createElement("canvas"),aa.width=74,aa.height=30,aa.style.display="block",aa.style.marginLeft="3px",ae.appendChild(aa),V=aa.getContext("2d"),V.fillStyle="rgb("+Q.fps.bg.r+","+Q.fps.bg.g+","+Q.fps.bg.b+")",V.fillRect(0,0,aa.width,aa.height),am=V.getImageData(0,0,aa.width,aa.height),ab=document.createElement("div"),ab.style.backgroundColor="rgb("+Math.floor(Q.ms.bg.r/2)+","+Math.floor(Q.ms.bg.g/2)+","+Math.floor(Q.ms.bg.b/2)+")",ab.style.padding="2px 0px 3px 0px",ab.style.display="none",ai.appendChild(ab),af=document.createElement("div"),af.style.fontFamily="Helvetica, Arial, sans-serif",af.style.textAlign="left",af.style.fontSize="9px",af.style.color="rgb("+Q.ms.fg.r+","+Q.ms.fg.g+","+Q.ms.fg.b+")",af.style.margin="0px 0px 1px 3px",af.innerHTML='<span style="font-weight:bold">MS</span>',ab.appendChild(af),aa=document.createElement("canvas"),aa.width=74,aa.height=30,aa.style.display="block",aa.style.marginLeft="3px",ab.appendChild(aa),ad=aa.getContext("2d"),ad.fillStyle="rgb("+Q.ms.bg.r+","+Q.ms.bg.g+","+Q.ms.bg.b+")",ad.fillRect(0,0,aa.width,aa.height),ak=ad.getImageData(0,0,aa.width,aa.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(ag=3)}catch(B){}return N=document.createElement("div"),N.style.backgroundColor="rgb("+Math.floor(Q.mb.bg.r/2)+","+Math.floor(Q.mb.bg.g/2)+","+Math.floor(Q.mb.bg.b/2)+")",N.style.padding="2px 0px 3px 0px",N.style.display="none",ai.appendChild(N),aj=document.createElement("div"),aj.style.fontFamily="Helvetica, Arial, sans-serif",aj.style.textAlign="left",aj.style.fontSize="9px",aj.style.color="rgb("+Q.mb.fg.r+","+Q.mb.fg.g+","+Q.mb.fg.b+")",aj.style.margin="0px 0px 1px 3px",aj.innerHTML='<span style="font-weight:bold">MB</span>',N.appendChild(aj),aa=document.createElement("canvas"),aa.width=74,aa.height=30,aa.style.display="block",aa.style.marginLeft="3px",N.appendChild(aa),Z=aa.getContext("2d"),Z.fillStyle="#301010",Z.fillRect(0,0,aa.width,aa.height),ah=Z.getImageData(0,0,aa.width,aa.height),{domElement:ai,update:function(){ac++,G=(new Date).getTime(),F=G-K,j=Math.min(j,F),H=Math.max(H,F),U(ak.data,Math.min(30,30-30*(F/200)),"ms"),af.innerHTML='<span style="font-weight:bold">'+F+" MS</span> ("+j+"-"+H+")",ad.putImageData(ak,0,0),K=G,G>W+1000&&(J=Math.round(1000*ac/(G-W)),k=Math.min(k,J),al=Math.max(al,J),U(am.data,Math.min(30,30-30*(J/100)),"fps"),X.innerHTML='<span style="font-weight:bold">'+J+" FPS</span> ("+k+"-"+al+")",V.putImageData(am,0,0),3==ag&&(Y=9.54e-7*performance.memory.usedJSHeapSize,q=Math.min(q,Y),D=Math.max(D,Y),U(ah.data,Math.min(30,30-Y/2),"mb"),aj.innerHTML='<span style="font-weight:bold">'+Math.round(Y)+" MB</span> ("+Math.round(q)+"-"+Math.round(D)+")",Z.putImageData(ah,0,0)),W=G,ac=0)}}};Constants={},Constants.PI=Math.PI,Constants.C_PR=Math.PI/180,Constants.VLEV=2,Constants.EPS=1e-7,Constants.c=0.105,Constants.LN10=Math.log(10),Constants.PIOVER2=Math.PI/2,Constants.TWOPI=2*Math.PI,Constants.TWOTHIRD=2/3,Constants.ARCSECOND_RADIAN=0.00000484813681109536,SpatialVector=function(){function a(d,f,c){this.x=d,this.y=f,this.z=c,this.ra_=0,this.dec_=0,this.okRaDec_=!1}return a.prototype.setXYZ=function(d,f,c){this.x=d,this.y=f,this.z=c,this.okRaDec_=!1},a.prototype.length=function(){return Math.sqrt(this.lengthSquared())},a.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},a.prototype.normalized=function(){var c=this.length();this.x/=c,this.y/=c,this.z/=c},a.prototype.set=function(c,d){this.ra_=c,this.dec_=d,this.okRaDec_=!0,this.updateXYZ()},a.prototype.angle=function(d){var h=this.y*d.z-this.z*d.y,c=this.z*d.x-this.x*d.z,f=this.x*d.y-this.y*d.x,j=Math.sqrt(h*h+c*c+f*f);return Math.abs(Math.atan2(j,dot(d)))},a.prototype.get=function(){return[x,y,z]},a.prototype.toString=function(){return"SpatialVector["+this.x+", "+this.y+", "+this.z+"]"},a.prototype.cross=function(c){return new a(this.y*c.z-c.y*this.z,this.z*c.x-c.z*this.x,this.x*c.y-c.x()*this.y)},a.prototype.equal=function(c){return this.x==c.x&&this.y==c.y&&this.z==c.z()?!0:!1},a.prototype.mult=function(c){return new a(c*this.x,c*this.y,c*this.z)},a.prototype.dot=function(c){return this.x*c.x+this.y*c.y+this.z*c.z},a.prototype.add=function(c){return new a(this.x+c.x,this.y+c.y,this.z+c.z)},a.prototype.sub=function(c){return new a(this.x-c.x,this.y-c.y,this.z-c.z)},a.prototype.dec=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.dec_},a.prototype.ra=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.ra_},a.prototype.updateXYZ=function(){var c=Math.cos(this.dec_*Constants.C_PR);this.x=Math.cos(this.ra_*Constants.C_PR)*c,this.y=Math.sin(this.ra_*Constants.C_PR)*c,this.z=Math.sin(this.dec_*Constants.C_PR)},a.prototype.updateRaDec=function(){this.dec_=Math.asin(this.z)/Constants.C_PR;var c=Math.cos(this.dec_*Constants.C_PR);this.ra_=c>Constants.EPS||-Constants.EPS>c?this.y>Constants.EPS||this.y<-Constants.EPS?0>this.y?360-Math.acos(this.x/c)/Constants.C_PR:Math.acos(this.x/c)/Constants.C_PR:0>this.x?180:0:0,this.okRaDec_=!0},a.prototype.toRaRadians=function(){var c=0;return(0!=this.x||0!=this.y)&&(c=Math.atan2(this.y,this.x)),0>c&&(c+=2*Math.PI),c},a.prototype.toDeRadians=function(){var c=z/this.length(),d=Math.acos(c);return Math.PI/2-d},a}(),AngularPosition=function(){return AngularPosition=function(a,c){this.theta=a,this.phi=c},AngularPosition.prototype.toString=function(){return"theta: "+this.theta+", phi: "+this.phi},AngularPosition}(),LongRangeSetBuilder=function(){function a(){this.items=[]}return a.prototype.appendRange=function(d,f){for(var c=d;f>=c;c++){c in this.items||this.items.push(c)}},a}(),HealpixIndex=function(){function a(c){this.nside=c}return a.NS_MAX=8192,a.ORDER_MAX=13,a.NSIDELIST=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192],a.JRLL=[2,2,2,2,3,3,3,3,4,4,4,4],a.JPLL=[1,3,5,7,0,2,4,6,1,3,5,7],a.XOFFSET=[-1,-1,0,1,1,1,0,-1],a.YOFFSET=[0,1,1,1,0,-1,-1,-1],a.FACEARRAY=[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],a.SWAPARRAY=[[0,0,0,0,0,0,0,0,3,3,3,3],[0,0,0,0,0,0,0,0,6,6,6,6],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,5,5,5,5],[0,0,0,0,0,0,0,0,0,0,0,0],[5,5,5,5,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[6,6,6,6,0,0,0,0,0,0,0,0],[3,3,3,3,0,0,0,0,0,0,0,0]],a.Z0=Constants.TWOTHIRD,a.prototype.init=function(){var d=256;this.ctab=Array(d),this.utab=Array(d);for(var c=0;256>c;++c){this.ctab[c]=1&c|(2&c)<<7|(4&c)>>1|(8&c)<<6|(16&c)>>2|(32&c)<<5|(64&c)>>3|(128&c)<<4,this.utab[c]=1&c|(2&c)<<1|(4&c)<<2|(8&c)<<3|(16&c)<<4|(32&c)<<5|(64&c)<<6|(128&c)<<7}this.nl2=2*this.nside,this.nl3=3*this.nside,this.nl4=4*this.nside,this.npface=this.nside*this.nside,this.ncap=2*this.nside*(this.nside-1),this.npix=12*this.npface,this.fact2=4/this.npix,this.fact1=(this.nside<<1)*this.fact2,this.order=a.nside2order(this.nside)},a.calculateNSide=function(q){for(var m=0,d=q*q,f=180/Constants.PI,B=51840000*Constants.PI*f*f,v=Utils.castToInt(B/d),j=v/12,p=Math.sqrt(j),k=a.NS_MAX,t=0,w=0;a.NSIDELIST.length>w;w++){if(k>=Math.abs(p-a.NSIDELIST[w])&&(k=Math.abs(p-a.NSIDELIST[w]),m=a.NSIDELIST[w],t=w),p>m&&a.NS_MAX>p&&(m=a.NSIDELIST[t+1]),p>a.NS_MAX){return console.log("nside cannot be bigger than "+a.NS_MAX),a.NS_MAX}}return m},a.nside2order=function(c){return(c&c-1)>0?-1:Utils.castToInt(a.log2(c))},a.log2=function(c){return Math.log(c)/Math.log(2)},a.prototype.ang2pix_nest=function(K,G){var w,C,t,N,D,H,F,M,q,L,B,J,k;if(G>=Constants.TWOPI&&(G-=Constants.TWOPI),0>G&&(G+=Constants.TWOPI),K>Constants.PI||0>K){throw {name:"Illegal argument",message:"theta must be between 0 and "+Constants.PI}}if(G>Constants.TWOPI||0>G){throw {name:"Illegal argument",message:"phi must be between 0 and "+Constants.TWOPI}}if(C=Math.cos(K),t=Math.abs(C),N=G/Constants.PIOVER2,a.Z0>=t){var I=this.nside*(0.5+N),E=0.75*this.nside*C,M=I-E,q=I+E;H=M>>this.order,F=q>>this.order,B=H==F?4==H?4:H+4:F>H?H:F+8,J=Utils.castToInt(q&this.nside-1),k=Utils.castToInt(this.nside-(M&this.nside-1)-1)}else{L=Utils.castToInt(N),L>=4&&(L=3),D=N-L;var j=this.nside*Math.sqrt(3*(1-t));M=Utils.castToInt(D*j),q=Utils.castToInt((1-D)*j),M=Math.min(a.NS_MAX-1,M),q=Math.min(a.NS_MAX-1,q),C>=0?(B=L,J=Utils.castToInt(this.nside-q-1),k=Utils.castToInt(this.nside-M-1)):(B=L+8,J=M,k=q)}return w=this.xyf2nest(J,k,B)},a.prototype.xyf2nest=function(d,f,c){return(c<<2*this.order)+(this.utab[255&d]|this.utab[255&d>>8]<<16|this.utab[255&d>>16]<<32|this.utab[255&d>>24]<<48|this.utab[255&f]<<1|this.utab[255&f>>8]<<17|this.utab[255&f>>16]<<33|this.utab[255&f>>24]<<49)},a.prototype.nest2xyf=function(d){var h={};h.face_num=d>>2*this.order;var c=d&this.npface-1,f=(93823560581120&c)>>16|(6148820866244280000&c)>>31|21845&c|(1431633920&c)>>15;return h.ix=this.ctab[255&f]|this.ctab[255&f>>8]<<4|this.ctab[255&f>>16]<<16|this.ctab[255&f>>24]<<20,c>>=1,f=(93823560581120&c)>>16|(6148820866244280000&c)>>31|21845&c|(1431633920&c)>>15,h.iy=this.ctab[255&f]|this.ctab[255&f>>8]<<4|this.ctab[255&f>>16]<<16|this.ctab[255&f>>24]<<20,h},a.prototype.pix2ang_nest=function(t){if(0>t||t>this.npix-1){throw {name:"Illegal argument",message:"ipix out of range"}}var p,f,j,D=this.nest2xyf(t),B=D.ix,k=D.iy,q=D.face_num,m=(a.JRLL[q]<<this.order)-B-k-1;this.nside>m?(p=m,f=1-p*p*this.fact2,j=0):m>this.nl3?(p=this.nl4-m,f=p*p*this.fact2-1,j=0):(p=this.nside,f=(this.nl2-m)*this.fact1,j=1&m-this.nside);var w=Math.acos(f),C=(a.JPLL[q]*p+B-k+1+j)/2;C>this.nl4&&(C-=this.nl4),1>C&&(C+=this.nl4);var v=(C-0.5*(j+1))*(Constants.PIOVER2/p);return{theta:w,phi:v}},a.nside2Npix=function(d){if(0>d||(d&-d)!=d||d>a.NS_MAX){throw {name:"Illegal argument",message:"nside should be >0, power of 2, <"+a.NS_MAX}}var c=12*d*d;return c},a.prototype.xyf2ring=function(l,d,k){var m,j,c,p=a.JRLL[k]*this.nside-l-d-1;this.nside>p?(m=p,c=2*m*(m-1),j=0):p>3*this.nside?(m=this.nl4-p,c=this.npix-2*(m+1)*m,j=0):(m=this.nside,c=this.ncap+(p-this.nside)*this.nl4,j=1&p-this.nside);var f=(a.JPLL[k]*m+l-d+1+j)/2;return f>this.nl4?f-=this.nl4:1>f&&(f+=this.nl4),c+f-1},a.prototype.nest2ring=function(d){var f=this.nest2xyf(d),c=this.xyf2ring(f.ix,f.iy,f.face_num);return c},a.prototype.corners_nest=function(d,f){var c=this.nest2ring(d);return this.corners_ring(c,f)},a.prototype.pix2ang_ring=function(u){var p,k,c,d,v,q,f,m,j;if(0>u||u>this.npix-1){throw {name:"Illegal argument",message:"ipix out of range"}}return q=u+1,this.ncap>=q?(m=q/2,j=Utils.castToInt(m),c=Utils.castToInt(Math.sqrt(m-Math.sqrt(j)))+1,d=q-2*c*(c-1),p=Math.acos(1-c*c*this.fact2),k=(d-0.5)*Constants.PI/(2*c)):this.npix-this.ncap>u?(v=u-this.ncap,c=v/this.nl4+this.nside,d=v%this.nl4+1,f=(1&c+this.nside)>0?1:0.5,p=Math.acos((this.nl2-c)*this.fact1),k=(d-f)*Constants.PI/this.nl2):(v=this.npix-u,c=Utils.castToInt(0.5*(1+Math.sqrt(2*v-1))),d=4*c+1-(v-2*c*(c-1)),p=Math.acos(-1+Math.pow(c,2)*this.fact2),k=(d-0.5)*Constants.PI/(2*c)),[p,k]},a.prototype.ring=function(d){var j,c,h=0,k=d+1,f=0;return this.ncap>=k?(c=k/2,f=Utils.castToInt(c),h=Utils.castToInt(Math.sqrt(c-Math.sqrt(f)))+1):this.nl2*(5*this.nside+1)>=k?(j=Utils.castToInt(k-this.ncap-1),h=Utils.castToInt(j/this.nl4+this.nside)):(j=this.npix-k+1,c=j/2,f=Utils.castToInt(c),h=Utils.castToInt(Math.sqrt(c-Math.sqrt(f)))+1,h=this.nl4-h),h},a.prototype.integration_limits_in_costh=function(d){var h,c,f,j;return j=1*this.nside,this.nside>=d?(c=1-Math.pow(d,2)/3/this.npface,f=1-Math.pow(d-1,2)/3/this.npface,h=d==this.nside?2*(this.nside-1)/3/j:1-Math.pow(d+1,2)/3/this.npface):this.nl3>d?(c=2*(2*this.nside-d)/3/j,f=2*(2*this.nside-d+1)/3/j,h=2*(2*this.nside-d-1)/3/j):(f=d==this.nl3?2*(-this.nside+1)/3/j:-1+Math.pow(4*this.nside-d+1,2)/3/this.npface,h=-1+Math.pow(this.nl4-d-1,2)/3/this.npface,c=-1+Math.pow(this.nl4-d,2)/3/this.npface),[f,c,h]},a.prototype.pixel_boundaries=function(L,F,B,j){var m,M,I,q,C,w,H,K,G=1*this.nside;if(Math.abs(j)>=1-1/3/this.npface){return H=B*Constants.PIOVER2,K=(B+1)*Constants.PIOVER2,[H,K]}if(1.5*j>=1){m=Math.sqrt(3*(1-j)),M=1/G/m,I=F,q=I-1,C=L-F,w=C+1,H=Constants.PIOVER2*(Math.max(q*M,1-w*M)+B),K=Constants.PIOVER2*(Math.min(1-C*M,I*M)+B)}else{if(1.5*j>-1){var k=0.5*(1-1.5*j),E=k+1,J=this.nside+L%2;I=F-(J-L)/2,q=I-1,C=(J+L)/2-F,w=C+1,H=Constants.PIOVER2*(Math.max(E-w/G,-k+q/G)+B),K=Constants.PIOVER2*(Math.min(E-C/G,-k+I/G)+B)}else{m=Math.sqrt(3*(1+j)),M=1/G/m;var D=2*this.nside;I=L-D+F,q=I-1,C=D-F,w=C+1,H=Constants.PIOVER2*(Math.max(1-(D-q)*M,(D-w)*M)+B),K=Constants.PIOVER2*(Math.min(1-(D-I)*M,(D-C)*M)+B)}}return[H,K]},a.vector=function(d,h){var c=1*Math.sin(d)*Math.cos(h),f=1*Math.sin(d)*Math.sin(h),j=1*Math.cos(d);return new SpatialVector(c,f,j)},a.prototype.corners_ring=function(Q,M){var G=2*M+2,I=Array(G),E=this.pix2ang_ring(Q),U=Math.cos(E[0]),J=E[0],N=E[1],L=Utils.castToInt(N/Constants.PIOVER2),T=this.ring(Q),D=Math.min(T,Math.min(this.nside,this.nl4-T)),R=0,H=Constants.PIOVER2/D;R=T>=this.nside&&this.nl3>=T?Utils.castToInt(N/H+T%2/2)+1:Utils.castToInt(N/H)+1,R-=L*D;var P=G/2,B=this.integration_limits_in_costh(T),O=Math.acos(B[0]),K=Math.acos(B[2]),k=this.pixel_boundaries(T,R,L,B[0]);if(I[0]=R>D/2?a.vector(O,k[1]):a.vector(O,k[0]),k=this.pixel_boundaries(T,R,L,B[2]),I[P]=R>D/2?a.vector(K,k[1]):a.vector(K,k[0]),1==M){var t=Math.acos(B[1]);k=this.pixel_boundaries(T,R,L,B[1]),I[1]=a.vector(t,k[0]),I[3]=a.vector(t,k[1])}else{for(var F=B[2]-B[0],q=F/(M+1),j=1;M>=j;j++){U=B[0]+q*j,J=Math.acos(U),k=this.pixel_boundaries(T,R,L,U),I[j]=a.vector(J,k[0]),I[G-j]=a.vector(J,k[1])}}return I},a.vec2Ang=function(d){var h=d.z/d.length(),c=Math.acos(h),f=0;return(0!=d.x||0!=d.y)&&(f=Math.atan2(d.y,d.x)),0>f&&(f+=2*Math.PI),[c,f]},a.prototype.queryDisc=function(ag,ac,V,Y){if(0>ac||ac>Constants.PI){throw {name:"Illegal argument",message:"angular radius is in RADIAN and should be in [0,pi]"}}var Q,ak,Z,ad,ab,ai,L,ah,X,af,K,ae,aa,F,J,U,H,k,aj,D=new LongRangeSetBuilder,j=null,ab=ac;if(Y&&(ab+=Constants.PI/this.nl4),j=a.vec2Ang(ag),ai=j[0],L=j[1],K=this.fact2,ae=this.fact1,ad=Math.cos(ai),aj=1/Math.sqrt((1-ad)*(1+ad)),F=ai-ab,J=ai+ab,ah=Math.cos(ab),H=Math.cos(F),Q=this.ringAbove(H)+1,U=Math.cos(J),ak=this.ringAbove(U),Q>ak&&0==ak&&(ak=Q),0>=F){for(var G=1;Q>G;++G){this.inRing(G,0,Math.PI,D)}}for(Z=Q;ak>=Z;++Z){k=this.nside>Z?1-Z*Z*K:this.nl3>=Z?(this.nl2-Z)*ae:-1+(this.nl4-Z)*(this.nl4-Z)*K,X=(ah-k*ad)*aj,af=1-k*k-X*X,aa=Math.atan2(Math.sqrt(af),X),isNaN(aa)&&(aa=ab),this.inRing(Z,L,aa,D)}if(J>=Math.PI){for(var G=ak+1;this.nl4>G;++G){this.inRing(G,0,Math.PI,D,!1)}}var W;if(V){for(var q=D.items,B=[],N=0;q.length>N;N++){var t=this.ring2nest(q[N]);B.indexOf(t)>=0||B.push(t)}W=B}else{W=D.items}return W},a.prototype.inRing=function(w,M,I,C,E){var B,P,F,J,H=!1,O=!1,q=1e-12,N=0,D=0,L=0,k=0,K=(M-I)%Constants.TWOPI-q,G=M+I+q,j=(M+I)%Constants.TWOPI+q;if(q>Math.abs(I-Constants.PI)&&(H=!0),w>=this.nside&&this.nl3>=w?(D=w-this.nside+1,F=this.ncap+this.nl4*(D-1),J=F+this.nl4-1,B=D%2,P=this.nl4):(this.nside>w?(D=w,F=2*D*(D-1),J=F+4*D-1):(D=4*this.nside-w,F=this.npix-2*D*(D+1),J=F+4*D-1),P=4*D,B=1),H){return C.appendRange(F,J),void 0}if(N=B/2,E){L=Math.round(P*K/Constants.TWOPI-N),k=Math.round(P*G/Constants.TWOPI-N),L%=P,k>P&&(k%=P)}else{if(L=Math.ceil(P*K/Constants.TWOPI-N),k=Utils.castToInt(P*j/Constants.TWOPI-N),L>k&&1==w&&(k=Utils.castToInt(P*G/Constants.TWOPI-N)),L==k+1&&(L=k),1==L-k&&Constants.PI>I*P){return console.log("the interval is too small and avay from center"),void 0}L=Math.min(L,P-1),k=Math.max(k,0)}if(L>k&&(O=!0),O){L+=F,k+=F,C.appendRange(F,k),C.appendRange(L,J)}else{if(0>L){return L=Math.abs(L),C.appendRange(F,F+k),C.appendRange(J-L+1,J),void 0}L+=F,k+=F,C.appendRange(L,k)}},a.prototype.ringAbove=function(d){var f=Math.abs(d);if(f>Constants.TWOTHIRD){var c=Utils.castToInt(this.nside*Math.sqrt(3*(1-f)));return d>0?c:4*this.nside-c-1}return Utils.castToInt(this.nside*(2-1.5*d))},a.prototype.ring2nest=function(c){var d=this.ring2xyf(c);return this.xyf2nest(d.ix,d.iy,d.face_num)},a.prototype.ring2xyf=function(C){var v,j,m,H,F={};if(this.ncap>C){v=Utils.castToInt(0.5*(1+Math.sqrt(1+2*C))),j=C+1-2*v*(v-1),m=0,H=v,F.face_num=0;var q=j-1;q>=2*v&&(F.face_num=2,q-=2*v),q>=v&&++F.face_num}else{if(this.npix-this.ncap>C){var w=C-this.ncap;this.order>=0?(v=(w>>this.order+2)+this.nside,j=(w&this.nl4-1)+1):(v=w/this.nl4+this.nside,j=w%this.nl4+1),m=1&v+this.nside,H=this.nside;var t,E,G=v-this.nside+1,D=this.nl2+2-G;this.order>=0?(t=j-Utils.castToInt(G/2)+this.nside-1>>this.order,E=j-Utils.castToInt(D/2)+this.nside-1>>this.order):(t=(j-Utils.castToInt(G/2)+this.nside-1)/this.nside,E=(j-Utils.castToInt(D/2)+this.nside-1)/this.nside),F.face_num=E==t?4==E?4:Utils.castToInt(E)+4:t>E?Utils.castToInt(E):Utils.castToInt(t)+8}else{var w=this.npix-C;v=Utils.castToInt(0.5*(1+Math.sqrt(2*w-1))),j=4*v+1-(w-2*v*(v-1)),m=0,H=v,v=2*this.nl2-v,F.face_num=8;var q=j-1;q>=2*H&&(F.face_num=10,q-=2*H),q>=H&&++F.face_num}}var k=v-a.JRLL[F.face_num]*this.nside+1,B=2*j-a.JPLL[F.face_num]*H-m-1;return B>=this.nl2&&(B-=8*this.nside),F.ix=B-k>>1,F.iy=-(B+k)>>1,F},a}(),Utils=function(){},Utils.radecToPolar=function(a,c){return{theta:Math.PI/2-c/180*Math.PI,phi:a/180*Math.PI}},Utils.polarToRadec=function(a,c){return{ra:180*c/Math.PI,dec:180*(Math.PI/2-a)/Math.PI}},Utils.castToInt=function(a){return a>0?Math.floor(a):Math.ceil(a)},AstroMath.D2R=Math.PI/180,AstroMath.R2D=180/Math.PI,AstroMath.sign=function(a){return a>0?1:0>a?-1:0},AstroMath.cosd=function(a){if(0==a%90){var c=Math.abs(Math.floor(a/90+0.5))%4;switch(c){case 0:return 1;case 1:return 0;case 2:return -1;case 3:return 0}}return Math.cos(a*AstroMath.D2R)},AstroMath.sind=function(a){if(0===a%90){var c=Math.abs(Math.floor(a/90-0.5))%4;switch(c){case 0:return 1;case 1:return 0;case 2:return -1;case 3:return 0}}return Math.sin(a*AstroMath.D2R)},AstroMath.tand=function(a){var c;return c=a%360,0==c||180==Math.abs(c)?0:45==c||225==c?1:-135==c||-315==c?-1:Math.tan(a*AstroMath.D2R)},AstroMath.asind=function(a){return Math.asin(a)*AstroMath.R2D},AstroMath.acosd=function(a){return Math.acos(a)*AstroMath.R2D},AstroMath.atand=function(a){return Math.atan(a)*AstroMath.R2D},AstroMath.atan2=function(c,f){if(0==c){return f>0?0:0>f?Math.PI:0/0}var a=AstroMath.sign(c);if(0==f){return Math.PI/2*a}var d=Math.atan(Math.abs(c/f));return f>0?d*a:0>f?(Math.PI-d)*a:void 0},AstroMath.atan2d=function(a,c){return AstroMath.atan2(a,c)*AstroMath.R2D},AstroMath.cosh=function(a){return(Math.exp(a)+Math.exp(-a))/2},AstroMath.sinh=function(a){return(Math.exp(a)-Math.exp(-a))/2},AstroMath.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},AstroMath.acosh=function(a){return Math.log(a+Math.sqrt(a*a-1))},AstroMath.asinh=function(a){return Math.log(a+Math.sqrt(a*a+1))},AstroMath.atanh=function(a){return 0.5*Math.log((1+a)/(1-a))},AstroMath.sinc=function(c){var d,a=Math.abs(c);return 0.001>=a?(a*=a,d=1-a*(1-a/20)/6):d=Math.sin(a)/a,d},AstroMath.asinc=function(c){var d,a=Math.abs(c);return 0.001>=a?(a*=a,d=1+a*(6+0.45*a)/6):d=Math.asin(a)/a,d},AstroMath.hypot=function(a,c){return Math.sqrt(a*a+c*c)},AstroMath.eulerMatrix=function(u,p,k){var c=Array(3);c[0]=Array(3),c[1]=Array(3),c[2]=Array(3);var d=AstroMath.cosd(u),v=AstroMath.sind(u),q=AstroMath.cosd(p),f=AstroMath.sind(p),m=AstroMath.cosd(k),j=AstroMath.sind(k);return c[0][0]=m*q*d-j*v,c[0][1]=-j*q*d-m*v,c[0][2]=-f*d,c[1][0]=m*q*v+j*d,c[1][1]=-j*q*v+m*d,c[1][2]=-f*v,c[2][0]=-f*m,c[2][1]=-f*d,c[2][2]=q,c},AstroMath.displayMatrix=function(c){for(var h=c.length,a=0,f=0;h>f;f++){c[f].length>a&&(a=c[f].length)}for(var j="<table>\n",f=0;h>f;f++){j+="<tr>";for(var d=0;h>d;d++){j+="<td>",c[f].length>f&&(j+=""+c[f][d]),j+="</td>"}j+="</td>\n"}return j+="</table>\n"},Projection.PROJ_TAN=1,Projection.PROJ_TAN2=2,Projection.PROJ_STG=2,Projection.PROJ_SIN=3,Projection.PROJ_SIN2=4,Projection.PROJ_ZEA=4,Projection.PROJ_ARC=5,Projection.PROJ_SCHMIDT=5,Projection.PROJ_AITOFF=6,Projection.PROJ_AIT=6,Projection.PROJ_GLS=7,Projection.PROJ_MERCATOR=8,Projection.PROJ_MER=8,Projection.PROJ_LAM=9,Projection.PROJ_LAMBERT=9,Projection.PROJ_TSC=10,Projection.PROJ_QSC=11,Projection.PROJ_LIST=["Mercator",Projection.PROJ_MERCATOR,"Gnomonic",Projection.PROJ_TAN,"Stereographic",Projection.PROJ_TAN2,"Orthographic",Projection.PROJ_SIN,"Zenithal",Projection.PROJ_ZEA,"Schmidt",Projection.PROJ_SCHMIDT,"Aitoff",Projection.PROJ_AITOFF,"Lambert",Projection.PROJ_LAMBERT],Projection.PROJ_NAME=["-","Gnomonic","Stereographic","Orthographic","Equal-area","Schmidt plates","Aitoff","Global sin","Mercator","Lambert"],Projection.prototype={setCenter:function(a,c){this.ROT=this.tr_oR(a,c)},setProjection:function(a){this.PROJECTION=a},project:function(c,f){var a=this.tr_ou(c,f),d=this.tr_uu(a,this.ROT),h=this.tr_up(this.PROJECTION,d);return null==h?null:{X:-h[0],Y:-h[1]}},unproject:function(c,f){c=-c,f=-f;var a=this.tr_pu(this.PROJECTION,c,f),d=this.tr_uu1(a,this.ROT),h=this.tr_uo(d);return{ra:h[0],dec:h[1]}},tr_up:function(u,p){var k,c,d,v,q,f=p[0],m=p[1],j=p[2];if(k=AstroMath.hypot(f,m),0==k&&0==j){return null}switch(u){default:d=null;break;case Projection.PROJ_AITOFF:c=Math.sqrt(k*(k+f)/2),v=Math.sqrt(2*k*(k-f)),c=Math.sqrt((1+c)/2),v/=c,q=j/c,0>m&&(v=-v),d=[v,q];break;case Projection.PROJ_GLS:q=Math.asin(j),v=0!=k?Math.atan2(m,f)*k:0,d=[v,q];break;case Projection.PROJ_MERCATOR:0!=k?(v=Math.atan2(m,f),q=AstroMath.atanh(j),d=[v,q]):d=null;break;case Projection.PROJ_TAN:f>0?(v=m/f,q=j/f,d=[v,q]):d=null;break;case Projection.PROJ_TAN2:c=(1+f)/2,c>0?(v=m/c,q=j/c,d=[v,q]):d=null;break;case Projection.PROJ_ARC:-1>=f?(v=Math.PI,q=0):(k=AstroMath.hypot(m,j),c=f>0?AstroMath.asinc(k):Math.acos(f)/k,v=m*c,q=j*c),d=[v,q];break;case Projection.PROJ_SIN:f>=0?(v=m,q=j,d=[v,q]):d=null;break;case Projection.PROJ_SIN2:c=Math.sqrt((1+f)/2),0!=c?(v=m/c,q=j/c):(v=2,q=0),d=[v,q];break;case Projection.PROJ_LAMBERT:q=j,v=0,0!=k&&(v=Math.atan2(m,f)),d=[v,q]}return d},tr_pu:function(f,k,d){var j,l,h,c,m;switch(f){default:return null;case Projection.PROJ_AITOFF:if(j=k*k/8+d*d/2,j>1){return null}h=1-j,l=Math.sqrt(1-j/2),c=k*l/2,m=d*l,j=AstroMath.hypot(h,c),0!=j&&(l=h,h=(l*l-c*c)/j,c=2*l*c/j);break;case Projection.PROJ_GLS:if(m=Math.sin(d),j=1-m*m,0>j){return null}j=Math.sqrt(j),l=0!=j?k/j:0,h=j*Math.cos(l),c=j*Math.sin(l);break;case Projection.PROJ_MERCATOR:m=AstroMath.tanh(d),j=1/AstroMath.cosh(d),h=j*Math.cos(k),c=j*Math.sin(k);break;case Projection.PROJ_LAMBERT:if(m=d,j=1-m*m,0>j){return null}j=Math.sqrt(j),h=j*Math.cos(k),c=j*Math.sin(k);break;case Projection.PROJ_TAN:h=1/Math.sqrt(1+k*k+d*d),c=k*h,m=d*h;break;case Projection.PROJ_TAN2:j=(k*k+d*d)/4,l=1+j,h=(1-j)/l,c=k/l,m=d/l;break;case Projection.PROJ_ARC:if(j=AstroMath.hypot(k,d),j>Math.PI){return null}l=AstroMath.sinc(j),h=Math.cos(j),c=l*k,m=l*d;break;case Projection.PROJ_SIN:if(l=1-k*k-d*d,0>l){return null}h=Math.sqrt(l),c=k,m=d;break;case Projection.PROJ_SIN2:if(j=(k*k+d*d)/4,j>1){return null}l=Math.sqrt(1-j),h=1-2*j,c=l*k,m=l*d}return[h,c,m]},tr_oR:function(c,d){var a=Array(3);return a[0]=Array(3),a[1]=Array(3),a[2]=Array(3),a[2][2]=AstroMath.cosd(d),a[0][2]=AstroMath.sind(d),a[1][1]=AstroMath.cosd(c),a[1][0]=-AstroMath.sind(c),a[1][2]=0,a[0][0]=a[2][2]*a[1][1],a[0][1]=-a[2][2]*a[1][0],a[2][0]=-a[0][2]*a[1][1],a[2][1]=a[0][2]*a[1][0],a},tr_ou:function(c,f){var a=Array(3),d=AstroMath.cosd(f);return a[0]=d*AstroMath.cosd(c),a[1]=d*AstroMath.sind(c),a[2]=AstroMath.sind(f),a},tr_uu:function(c,h){var a=Array(3),f=c[0],j=c[1],d=c[2];return a[0]=h[0][0]*f+h[0][1]*j+h[0][2]*d,a[1]=h[1][0]*f+h[1][1]*j+h[1][2]*d,a[2]=h[2][0]*f+h[2][1]*j+h[2][2]*d,a},tr_uu1:function(c,h){var a=Array(3),f=c[0],j=c[1],d=c[2];return a[0]=h[0][0]*f+h[1][0]*j+h[2][0]*d,a[1]=h[0][1]*f+h[1][1]*j+h[2][1]*d,a[2]=h[0][2]*f+h[1][2]*j+h[2][2]*d,a},tr_uo:function(f){var k,d,j=f[0],l=f[1],h=f[2],c=j*j+l*l;if(0==c){if(0==h){return null}k=0,d=h>0?90:-90}else{d=AstroMath.atand(h/Math.sqrt(c)),k=AstroMath.atan2d(l,j),0>k&&(k+=360)}return[k,d]}},Coo.factor=[3600,60,1],Coo.prototype={setFrame:function(a){this.frame=a},computeDirCos:function(){var a=AstroMath.cosd(this.lat);this.x=a*AstroMath.cosd(this.lon),this.y=a*AstroMath.sind(this.lon),this.z=AstroMath.sind(this.lat)},computeLonLat:function(){var a=this.x*this.x+this.y*this.y;this.lon=0,0==a?0==this.z?(this.lon=0/0,this.lat=0/0):this.lat=this.z>0?90:-90:(this.lon=AstroMath.atan2d(this.y,this.x),this.lat=AstroMath.atan2d(this.z,Math.sqrt(a)),0>this.lon&&(this.lon+=360))},dist2:function(c){var d=c.x-this.x,a=d*d;return d=c.y-this.y,a+=d*d,d=c.z-this.z,a+=d*d},distance:function(a){return 0==a.x&&0==a.y&&0==a.z?0/0:0==this.x&&0==this.y&&0==this.z?0/0:2*AstroMath.asind(0.5*Math.sqrt(this.dist2(a)))},convertTo:function(a){this.frame.equals(a)||(this.frame.toICRS(this.coo),a.fromICRS(this.coo),this.frame=a,this.lon=this.lat=0/0)},rotate:function(c){var f,a,d;c!=Umatrix3&&(f=c[0][0]*this.x+c[0][1]*this.y+c[0][2]*this.z,a=c[1][0]*this.x+c[1][1]*this.y+c[1][2]*this.z,d=c[2][0]*this.x+c[2][1]*this.y+c[2][2]*this.z,this.x=f,this.y=a,this.z=d,this.lon=this.lat=0/0)},rotate_1:function(c){var f,a,d;c!=Umatrix3&&(f=c[0][0]*this.x+c[1][0]*this.y+c[2][0]*this.z,a=c[0][1]*this.x+c[1][1]*this.y+c[2][1]*this.z,d=c[0][2]*this.x+c[1][2]*this.y+c[2][2]*this.z,this.x=f,this.y=a,this.z=d,this.lon=this.lat=0/0)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z},parse:function(c){var f=c.indexOf("+");if(0>f&&(f=c.indexOf("-")),0>f&&(f=c.indexOf(" ")),0>f){return this.lon=0/0,this.lat=0/0,this.prec=0,!1}var a=c.substring(0,f),d=c.substring(f);return this.lon=this.parseLon(a),this.lat=this.parseLat(d),!0},parseLon:function(f){var f=f.trim();if(f=f.replace(/:/g," "),0>f.indexOf(" ")){var k=f.indexOf(".");return this.prec=0>k?0:f.length-k-1,parseFloat(f)}for(var d=new Tokenizer(f," "),j=0,l=0,h=0;d.hasMore();){var c=d.nextToken(),m=c.indexOf(".");switch(l+=parseFloat(c)*Coo.factor[j],j){case 0:h=0>m?1:2;break;case 1:h=0>m?3:4;break;case 2:h=0>m?5:4+c.length-m;default:}j++}return this.prec=h,15*l/3600},parseLat:function(p){var p=p.trim();p=p.replace(/:/g," ");var l;if("-"==p.charAt(0)?(l=-1,p=p.substring(1)):"-"==p.charAt(0)?(l=1,p=p.substring(1)):l=1,0>p.indexOf(" ")){var j=p.indexOf(".");return this.prec=0>j?0:p.length-j-1,parseFloat(p)*l}for(var c=new Tokenizer(p," "),d=0,q=0,m=0;c.hasMore();){var f=c.nextToken(),k=f.indexOf(".");switch(q+=parseFloat(f)*Coo.factor[d],d){case 0:m=0>k?1:2;break;case 1:m=0>k?3:4;break;case 2:m=0>k?5:4+f.length-k;default:}d++}return this.prec=m,q*l/3600},format:function(c){isNaN(this.lon)&&this.computeLonLat();var f="",a="";if(c.indexOf("d")>=0){f=Numbers.format(this.lon,this.prec),a=Numbers.format(this.lat,this.prec)}else{var d=this.lon/15,f=Numbers.toSexagesimal(d,this.prec+1,!1),a=Numbers.toSexagesimal(this.lat,this.prec,!1)}return this.lat>0&&(a="+"+a),c.indexOf("/")>=0?f+" "+a:c.indexOf("2")>=0?[f,a]:f+a}},Tokenizer.prototype={hasMore:function(){return this.pos<this.string.length},nextToken:function(){for(var a=this.pos;this.string.length>a&&this.string.charAt(a)==this.sep;){a++}for(var c=a;this.string.length>c&&this.string.charAt(c)!=this.sep;){c++}return this.pos=c,this.string.substring(a,c)}},Strings.trim=function(c,f){for(var a=0,d=c.length-1;c.length>a&&c.charAt(a)==f;){a++}if(a==c.length){return""}for(;d>a&&c.charAt(d)==f;){d--}return c.substring(a,d+1)},Numbers.pow10=[1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000,10000000000,100000000000,1000000000000,10000000000000,100000000000000],Numbers.rndval=[0.5,0.05,0.005,0.0005,0.00005,0.000005,5e-7,5e-8,5e-9,5e-10,5e-11,5e-12,5e-13,5e-14,5e-14],Numbers.format=function(c,h){if(0>=h){return""+Math.round(c)}var a=""+c,f=a.indexOf("."),j=f>=0?a.length-f-1:0;if(h>=j){0>f&&(a+=".");for(var d=0;h-j>d;d++){a+="0"}return a}return a=""+(c+Numbers.rndval[h]),a.substr(0,f+h+1)},Numbers.toSexagesimal=function(p,l,j){var c=0>p?"-":j?"+":"",d=Math.abs(p);switch(l){case 1:var q=Math.round(d);return c+(""+q);case 2:return c+Numbers.format(d,1);case 3:var q=Math.floor(d),m=Math.round(60*(d-q));return c+q+" "+m;case 4:var q=Math.floor(d),m=60*(d-q);return c+q+" "+Numbers.format(m,1);case 5:var q=Math.floor(d),m=60*(d-q),f=Math.floor(m),k=Math.round(60*(m-f));return c+q+" "+f+" "+k;case 6:case 7:case 8:var q=Math.floor(d);10>q&&(q="0"+q);var m=60*(d-q),f=Math.floor(m);10>f&&(f="0"+f);var k=60*(m-f);return c+q+" "+f+" "+Numbers.format(k,l-5);default:return c+Numbers.format(d,1)}},CooConversion=function(){var a={};return a.GALACTIC_TO_J2000=[-0.0548755604024359,0.4941094279435681,-0.867666148981161,-0.8734370902479237,-0.4448296299195045,-0.1980763734646737,-0.4838350155267381,0.7469822444763707,0.4559837762325372],a.J2000_TO_GALACTIC=[-0.0548755604024359,-0.873437090247923,-0.4838350155267381,0.4941094279435681,-0.4448296299195045,0.7469822444763707,-0.867666148981161,-0.1980763734646737,0.4559837762325372],a.Transform=function(f,k){f[0]=f[0]*Math.PI/180,f[1]=f[1]*Math.PI/180;var d=[Math.cos(f[0])*Math.cos(f[1]),Math.sin(f[0])*Math.cos(f[1]),Math.sin(f[1])],j=[d[0]*k[0]+d[1]*k[1]+d[2]*k[2],d[0]*k[3]+d[1]*k[4]+d[2]*k[5],d[0]*k[6]+d[1]*k[7]+d[2]*k[8]],l=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]),h=[0,0];h[1]=Math.asin(j[2]/l);var c=j[0]/l/Math.cos(h[1]),m=j[1]/l/Math.cos(h[1]);return h[0]=Math.atan2(m,c),0>h[0]&&(h[0]=h[0]+2*Math.PI),h[0]=180*h[0]/Math.PI,h[1]=180*h[1]/Math.PI,h},a.GalacticToJ2000=function(c){return a.Transform(c,a.GALACTIC_TO_J2000)},a.J2000ToGalactic=function(c){return a.Transform(c,a.J2000_TO_GALACTIC)},a}(),Sesame=function(){return Sesame={},Sesame.cache={},Sesame.getTargetRADec=function(c,f,a){if(f){var d=/[a-zA-Z]/.test(c);if(d){Sesame.resolve(c,function(e){f({ra:e.Target.Resolver.jradeg,dec:e.Target.Resolver.jdedeg})},function(){a&&a()})}else{var h=new Coo;h.parse(c),f&&f({ra:h.lon,dec:h.lat})}}},Sesame.resolve=function(c,f,a){var d="http://cds.u-strasbg.fr/cgi-bin/nph-sesame.jsonp?";$.ajax({url:d,data:{object:c},method:"GET",dataType:"jsonp",success:function(e){e.Target&&e.Target.Resolver&&e.Target.Resolver?f(e):a(e)},error:a})},Sesame}(),HealpixCache=function(){var a={};return a.staticCache={corners:{nside8:[]}},a.dynamicCache={},a.lastNside=8,a.hpxIdxCache=null,a.init=function(){var f=new HealpixIndex(8);f.init();for(var c=HealpixIndex.nside2Npix(8),d=0;c>d;d++){a.staticCache.corners.nside8[d]=f.corners_nest(d,1)}a.hpxIdxCache=f},a.corners_nest=function(d,c){return 8==c?a.staticCache.corners.nside8[d]:(c!=a.lastNside&&(a.hpxIdxCache=new HealpixIndex(c),a.hpxIdxCache.init(),a.lastNside=c),a.hpxIdxCache.corners_nest(d,1))},a}(),Utils=Utils||{},Utils.cssScale=void 0,HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords,Function.prototype.bind||(Function.prototype.bind=function(c){if("function"!=typeof this){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var h=[].slice,a=h.call(arguments,1),f=this,j=function(){},d=function(){return f.apply(this instanceof j?this:c||{},a.concat(h.call(arguments)))};return d.prototype=this.prototype,d}),$=$||jQuery,$.urlParam=function(a,c){return void 0===c&&(c=location.search),decodeURIComponent((RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(c)||[,""])[1].replace(/\+/g,"%20"))||null},Utils.isNumber=function(a){return !isNaN(parseFloat(a))&&isFinite(a)},Utils.isInt=function(a){return Utils.isNumber(a)&&Math.floor(a)==a},Utils.debounce=function(c,d){var a=null;return function(){var e=this,f=arguments;clearTimeout(a),a=setTimeout(function(){c.apply(e,f)},d)}},Utils.LRUCache=function(a){this._keys=[],this._items={},this._expires={},this._size=0,this._maxsize=a||1024},Utils.LRUCache.prototype={set:function(f,k){var d=this._keys,j=this._items,l=this._expires,h=this._size,c=this._maxsize;h>=c&&(d.sort(function(a,i){return l[a]>l[i]?-1:l[a]<l[i]?1:0}),h--,delete l[d[h]],delete j[d[h]]),d[h]=f,j[f]=k,l[f]=Date.now(),h++,this._keys=d,this._items=j,this._expires=l,this._size=h},get:function(a){var c=this._items[a];return c&&(this._expires[a]=Date.now()),c},keys:function(){return this._keys}},Utils.getAjaxObject=function(c,f,a,d){if(d!==!1&&(d=!0),d===!0){var h=Aladin.JSONP_PROXY+"?url="+encodeURIComponent(c)}else{h=c}return f=f||"GET",a=a||null,$.ajax({url:h,method:f,dataType:a})},URLBuilder=function(){return URLBuilder={buildSimbadCSURL:function(c,d){if(c&&"object"==typeof c&&"ra" in c&&"dec" in c){var a=new Coo(c.ra,c.dec,7);c=a.format("s")}return"http://alasky.u-strasbg.fr/cgi/simbad-flat/simbad-cs.py?target="+encodeURIComponent(c)+"&SR="+d+"&format=votable&SRUNIT=deg&SORTBY=nbref"},buildNEDPositionCSURL:function(c,d,a){return"http://nedwww.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Position+Search&of=xml_main&RA="+c+"&DEC="+d+"&SR="+a},buildNEDObjectCSURL:function(a,c){return"http://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Name+Search&radius="+60*c+"&of=xml_main&objname="+a},buildVizieRCSURL:function(c,f,a){if(f&&"object"==typeof f&&"ra" in f&&"dec" in f){var d=new Coo(f.ra,f.dec,7);f=d.format("s")}return"http://vizier.u-strasbg.fr/viz-bin/votable?-source="+c+"&-c="+encodeURIComponent(f)+"&-out.max=999999&-c.rd="+a}}}(),MeasurementTable=function(){return MeasurementTable=function(a){this.isShowing=!1,this.divEl=$('<div class="aladin-measurement-div"></div>'),$(a).append(this.divEl)},MeasurementTable.prototype.showMeasurement=function(c){this.divEl.empty();var d="<thead><tr>",a="<tr>";for(key in c.data){d+="<th>"+key+"</th>",a+="<td>"+c.data[key]+"</td>"}d+="</tr></thead>",a+="</tr>",this.divEl.append("<table>"+d+a+"</table>"),this.show()},MeasurementTable.prototype.show=function(){this.divEl.show()},MeasurementTable.prototype.hide=function(){this.divEl.hide()},MeasurementTable}(),Color=function(){return Color={},Color.curIdx=0,Color.colors=["#ff0000","#0000ff","#99cc00","#ffff00","#000066","#00ffff","#9900cc","#0099cc","#cc9900","#cc0099","#00cc99","#663333","#ffcc9a","#ff9acc","#ccff33","#660000","#ffcc33","#ff00ff","#00ff00","#ffffff"],Color.getNextColor=function(){var a=Color.colors[Color.curIdx%Color.colors.length];return Color.curIdx++,a},Color.getLabelColorForBackground=function(c){var d="#eee",a="#111";if(rgb=c.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),null==rgb){return a}r=parseInt(rgb[1]),g=parseInt(rgb[2]),b=parseInt(rgb[3]);var f=1-(0.299*r+0.587*g+0.114*b)/255;return 0.5>f?a:d},Color}(),AladinUtils=function(){return{xyToView:function(f,k,d,j,l,h,c){return void 0==c&&(c=!1),c?{vx:l/2*(1+h*f)-(l-d)/2,vy:l/2*(1+h*k)-(l-j)/2}:{vx:AladinUtils.myRound(l/2*(1+h*f)-(l-d)/2),vy:AladinUtils.myRound(l/2*(1+h*k)-(l-j)/2)}},viewToXy:function(c,h,a,f,j,d){return{x:((2*c+(j-a))/j-1)/d,y:((2*h+(j-f))/j-1)/d}},radecToViewXy:function(u,p,k,c,d,v,q,f){var m;if(c!=CooFrameEnum.J2000){var j=CooConversion.J2000ToGalactic([u,p]);m=k.project(j[0],j[1])}else{m=k.project(u,p)}return m?AladinUtils.xyToView(m.X,m.Y,d,v,q,f,!0):null},myRound:function(a){return 0>a?-1*(0|-a):0|a},isHpxPixVisible:function(c,f,a){for(var d=0;c.length>d;d++){if(c[d].vx>=-20&&f+20>c[d].vx&&c[d].vy>=-20&&a+20>c[d].vy){return !0}}return !1},ipixToIpix:function(c,d,a){},getZoomFactorForAngle:function(f,k){var d={ra:0,dec:0},j={ra:f,dec:0},l=new Projection(f/2,0);l.setProjection(k);var h=l.project(d.ra,d.dec),c=l.project(j.ra,j.dec),m=1/(h.X-c.Y);return m}}}(),ProjectionEnum={SIN:Projection.PROJ_SIN,AITOFF:Projection.PROJ_AITOFF},CooFrameEnum=function(){return{J2000:"J2000",GAL:"Galactic"}}(),CooFrameEnum.fromString=function(a,c){return a?(a=a.toLowerCase().replace(/^\s+|\s+$/g,""),0==a.indexOf("j2000")||0==a.indexOf("icrs")?CooFrameEnum.J2000:0==a.indexOf("gal")?CooFrameEnum.GAL:c?c:null):c?c:null},CooFrameEnum.shortName=function(a){return a==CooFrameEnum.J2000?"J2000":a==CooFrameEnum.GAL?"GAL":null},Downloader=function(){var c=4,f=!1,a=700,d=function(e){this.view=e,this.nbDownloads=0,this.dlQueue=[],this.urlsInQueue={}};return d.prototype.requestDownload=function(j,k,h){k in this.urlsInQueue||(this.dlQueue.push({img:j,url:k,cors:h}),this.urlsInQueue[k]=1,this.tryDownload())},d.prototype.tryDownload=function(){for(;this.dlQueue.length>0&&c>this.nbDownloads;){this.startDownloadNext()}},d.prototype.startDownloadNext=function(){var h=this.dlQueue.shift();if(h){this.nbDownloads++;var i=this;h.img.onload=function(){i.completeDownload(this,!0)},h.img.onerror=function(){i.completeDownload(this,!1)},h.cors?h.img.crossOrigin="anonymous":void 0!==h.img.crossOrigin&&delete h.img.crossOrigin,h.img.src=h.url}},d.prototype.completeDownload=function(e,h){if(delete this.urlsInQueue[e.src],e.onerror=null,e.onload=null,this.nbDownloads--,h){if(f){var i=(new Date).getTime();e.fadingStart=i,e.fadingEnd=i+a}this.view.requestRedraw()}else{e.dlError=!0}this.tryDownload()},d}(),function(){var w,M,I,C,E,B,P,F,J,H,O,q,N,D,L,k,K={}.hasOwnProperty,G=function(c,f){function a(){this.constructor=c}for(var d in f){K.call(f,d)&&(c[d]=f[d])}return a.prototype=f.prototype,c.prototype=new a,c.__super__=f.prototype,c},j=[].slice;null==this.astro&&(this.astro={}),w=function(){function a(){}return a.include=function(d){var f,c;for(f in d){c=d[f],this.prototype[f]=c}return this},a.extend=function(d){var f,c;for(f in d){c=d[f],this[f]=c}return this},a.prototype.proxy=function(c){var d=this;return function(){return c.apply(d,arguments)}},a.prototype.invoke=function(d,h,c){var f;return f=null!=(null!=h?h.context:void 0)?h.context:this,null!=d?d.call(f,c,h):void 0},a}(),q=function(a){function c(f,l,d){var h,m=this;this.arg=f,this.callback=l,this.opts=d,this.hdus=[],this.blockCount=0,this.begin=0,this.end=this.BLOCKLENGTH,this.offset=0,this.headerStorage=new Uint8Array,"string"==typeof this.arg?(this.readNextBlock=this._readBlockFromBuffer,h=new XMLHttpRequest,h.open("GET",this.arg),h.responseType="arraybuffer",h.onload=function(){return 200!==h.status?(m.invoke(m.callback,m.opts),void 0):(m.arg=h.response,m.length=m.arg.byteLength,m.readFromBuffer())},h.send()):(this.length=this.arg.size,this.readNextBlock=this._readBlockFromFile,this.readFromFile())}return G(c,a),c.prototype.LINEWIDTH=80,c.prototype.BLOCKLENGTH=2880,File.prototype.slice=File.prototype.slice||File.prototype.webkitSlice,Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice,c.prototype.readFromBuffer=function(){var d;return d=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(d)},c.prototype.readFromFile=function(){var d,f=this;return this.reader=new FileReader,this.reader.onloadend=function(e){return f.readBlock(e.target.result)},d=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.reader.readAsArrayBuffer(d)},c.prototype.readBlock=function(aa){var V,S,m,Q,ab,T,R,X,Z,W,n,U,Y;for(V=new Uint8Array(aa),Z=new Uint8Array(this.headerStorage),this.headerStorage=new Uint8Array(this.end),this.headerStorage.set(Z,0),this.headerStorage.set(V,this.begin),T=this.BLOCKLENGTH/this.LINEWIDTH;T--;){if(ab=T*this.LINEWIDTH,32!==V[ab]){if(69===V[ab]&&78===V[ab+1]&&68===V[ab+2]&&32===V[ab+3]){for(R="",Y=this.headerStorage,n=0,U=Y.length;U>n;n++){W=Y[n],R+=String.fromCharCode(W)}return Q=new F(R),this.start=this.end+this.offset,S=Q.getDataLength(),X=this.arg.slice(this.start,this.start+S),Q.hasDataUnit()&&(m=this.createDataUnit(Q,X)),this.hdus.push(new P(Q,m)),this.offset+=this.end+S+this.excessBytes(S),this.offset===this.length?(this.headerStorage=null,this.invoke(this.callback,this.opts,this),void 0):(this.blockCount=0,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,this.headerStorage=new Uint8Array,aa=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(aa),void 0)}break}}this.blockCount+=1,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,aa=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(aa)},c.prototype._readBlockFromBuffer=function(d){return this.readBlock(d)},c.prototype._readBlockFromFile=function(d){return this.reader.readAsArrayBuffer(d)},c.prototype.createDataUnit=function(f,h){var d;return d=f.getDataType(),new astro.FITS[d](f,h)},c.prototype.excessBytes=function(d){return(this.BLOCKLENGTH-d%this.BLOCKLENGTH)%this.BLOCKLENGTH},c.prototype.isEOF=function(){return this.offset===this.length?!0:!1},c}(w),B=function(a){function c(f,l,d){var h,m=this;this.arg=f,h=new q(this.arg,function(){return m.hdus=h.hdus,m.invoke(l,d,m)})}return G(c,a),c.prototype.getHDU=function(f){var l,d,h,m;if(null!=f&&null!=this.hdus[f]){return this.hdus[f]}for(m=this.hdus,d=0,h=m.length;h>d;d++){if(l=m[d],l.hasData()){return l}}},c.prototype.getHeader=function(d){return this.getHDU(d).header},c.prototype.getDataUnit=function(d){return this.getHDU(d).data},c}(w),B.version="0.6.5",this.astro.FITS=B,C=function(a){function c(d,f){f instanceof ArrayBuffer?this.buffer=f:this.blob=f}return G(c,a),c.swapEndian={B:function(d){return d},I:function(d){return d<<8|d>>8},J:function(d){return(255&d)<<24|(65280&d)<<8|65280&d>>8|255&d>>24}},c.swapEndian[8]=c.swapEndian.B,c.swapEndian[16]=c.swapEndian.I,c.swapEndian[32]=c.swapEndian.J,c}(w),this.astro.FITS.DataUnit=C,J={verifyOrder:function(a,c){return c!==this.cardIndex?console.warn(""+a+" should appear at index "+this.cardIndex+" in the FITS header"):void 0},verifyBetween:function(c,f,a,d){if(!(f>=a&&d>=f)){throw"The "+c+" value of "+f+" is not between "+a+" and "+d}},verifyBoolean:function(a){return"T"===a?!0:!1},VerifyFns:{SIMPLE:function(){var a,c;return a=arguments.length>=1?j.call(arguments,0):[],c=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(c)},XTENSION:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],this.extension=!0,this.extensionType=arguments[0],this.verifyOrder("XTENSION",0),this.extensionType},BITPIX:function(){var c,d,a;if(c=arguments.length>=1?j.call(arguments,0):[],d="BITPIX",a=parseInt(arguments[0]),this.verifyOrder(d,1),8!==a&&16!==a&&32!==a&&-32!==a&&-64!==a){throw""+d+" value "+a+" is not permitted"}return a},NAXIS:function(){var c,h,a,f,l,d;if(c=arguments.length>=1?j.call(arguments,0):[],a="NAXIS",l=parseInt(arguments[0]),h=arguments[1],!h&&(this.verifyOrder(a,2),this.verifyBetween(a,l,0,999),this.isExtension()&&("TABLE"===(d=this.extensionType)||"BINTABLE"===d)&&(f=2,l!==f))){throw""+a+" must be "+f+" for TABLE and BINTABLE extensions"}return l},PCOUNT:function(){var c,h,a,f,l,d;if(c=arguments.length>=1?j.call(arguments,0):[],h="PCOUNT",l=parseInt(arguments[0]),a=3+this.get("NAXIS"),this.verifyOrder(h,a),this.isExtension()&&("IMAGE"===(d=this.extensionType)||"TABLE"===d)&&(f=0,l!==f)){throw""+h+" must be "+f+" for the "+this.extensionType+" extensions"}return l},GCOUNT:function(){var c,h,a,f,l,d;if(c=arguments.length>=1?j.call(arguments,0):[],h="GCOUNT",l=parseInt(arguments[0]),a=3+this.get("NAXIS")+1,this.verifyOrder(h,a),this.isExtension()&&("IMAGE"===(d=this.extensionType)||"TABLE"===d||"BINTABLE"===d)&&(f=1,l!==f)){throw""+h+" must be "+f+" for the "+this.extensionType+" extensions"}return l},EXTEND:function(){var a,c;if(a=arguments.length>=1?j.call(arguments,0):[],c=arguments[0],!this.isPrimary()){throw"EXTEND must only appear in the primary header"}return this.verifyBoolean(c)},BSCALE:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var a,c;return a=arguments.length>=1?j.call(arguments,0):[],c=arguments[0],this.get("BITPIX")>0||console.warn("BLANK is not to be used for BITPIX = "+this.get("BITPIX")),parseInt(c)},DATAMIN:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])},EXTLEVEL:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])},TFIELDS:function(){var a,c;return a=arguments.length>=1?j.call(arguments,0):[],c=parseInt(arguments[0]),this.verifyBetween("TFIELDS",c,0,999),c},TBCOL:function(){var c,d,a;return c=arguments.length>=1?j.call(arguments,0):[],a=arguments[0],d=arguments[2],this.verifyBetween("TBCOL",d,0,this.get("TFIELDS")),a},ZIMAGE:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],this.verifyBoolean(arguments[0])},ZCMPTYPE:function(){var a,c;if(a=arguments.length>=1?j.call(arguments,0):[],c=arguments[0],"GZIP_1"!==c&&"RICE_1"!==c&&"PLIO_1"!==c&&"HCOMPRESS_1"!==c){throw"ZCMPTYPE value "+c+" is not permitted"}if("RICE_1"!==c){throw"Compress type "+c+" is not yet implement"}return c},ZBITPIX:function(){var a,c;if(a=arguments.length>=1?j.call(arguments,0):[],c=parseInt(arguments[0]),8!==c&&16!==c&&32!==c&&64!==c&&-32!==c&&-64!==c){throw"ZBITPIX value "+c+" is not permitted"}return c},ZNAXIS:function(){var c,d,a;return c=arguments.length>=1?j.call(arguments,0):[],a=parseInt(arguments[0]),d=arguments[1],a=a,d||this.verifyBetween("ZNAXIS",a,0,999),a},ZTILE:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])},ZSIMPLE:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],"T"===arguments[0]?!0:!1},ZPCOUNT:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])},ZGCOUNT:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])},ZDITHER0:function(){var a;return a=arguments.length>=1?j.call(arguments,0):[],parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=J,F=function(a){function c(f){var l,d,h;this.primary=!1,this.extension=!1,this.verifyCard={},h=this.VerifyFns;for(d in h){l=h[d],this.verifyCard[d]=this.proxy(l)}this.cards={},this.cards.COMMENT=[],this.cards.HISTORY=[],this.cardIndex=0,this.block=f,this.readBlock(f)}return G(c,a),c.include(J),c.prototype.arrayPattern=/(\D+)(\d+)/,c.prototype.maxLines=600,c.prototype.get=function(d){return this.contains(d)?this.cards[d].value:null},c.prototype.set=function(f,h,d){return d=d||"",this.cards[f]={index:this.cardIndex,value:h,comment:d},this.cardIndex+=1},c.prototype.contains=function(d){return this.cards.hasOwnProperty(d)},c.prototype.readLine=function(h){var p,f,m,u,l,d,v;return l=h.slice(0,8).trim(),(p=""===l)?void 0:(u=h.slice(8,10),d=h.slice(10),"= "!==u?(("COMMENT"===l||"HISTORY"===l)&&this.cards[l].push(d.trim()),void 0):(v=d.split(" /"),d=v[0],f=v[1],d=d.trim(),m=d[0],"'"===m?d=d.slice(1,-1).trim():"T"!==d&&"F"!==d&&(d=parseFloat(d)),d=this.validate(l,d),this.set(l,d,f)))},c.prototype.validate=function(h,n){var f,m,p,l,d;return m=null,f=h,p=this.arrayPattern.test(h),p&&(l=this.arrayPattern.exec(h),d=l.slice(1),f=d[0],m=d[1]),f in this.verifyCard&&(n=this.verifyCard[f](n,p,m)),n},c.prototype.readBlock=function(h){var p,f,m,u,l,d,v;for(m=80,u=h.length/m,u=this.maxLines>u?u:this.maxLines,v=[],p=l=0,d=u-1;d>=0?d>=l:l>=d;p=d>=0?++l:--l){f=h.slice(p*m,(p+1)*m),v.push(this.readLine(f))}return v},c.prototype.hasDataUnit=function(){return 0===this.get("NAXIS")?!1:!0},c.prototype.getDataLength=function(){var f,l,d,h,m;if(!this.hasDataUnit()){return 0}for(d=[],f=h=1,m=this.get("NAXIS");m>=1?m>=h:h>=m;f=m>=1?++h:--h){d.push(this.get("NAXIS"+f))}return l=d.reduce(function(i,n){return i*n})*Math.abs(this.get("BITPIX"))/8,l+=this.get("PCOUNT")},c.prototype.getDataType=function(){switch(this.extensionType){case"BINTABLE":return this.contains("ZIMAGE")?"CompressedImage":"BinaryTable";case"TABLE":return"Table";default:return this.hasDataUnit()?"Image":null}},c.prototype.isPrimary=function(){return this.primary},c.prototype.isExtension=function(){return this.extension},c}(w),this.astro.FITS.Header=F,O={getExtent:function(c){var f,a,d,h;for(f=c.length;f--;){if(h=c[f],!isNaN(h)){d=a=h;break}}if(-1===f){return[0/0,0/0]}for(;f--;){h=c[f],isNaN(h)||(d>h&&(d=h),h>a&&(a=h))}return[d,a]},getPixel:function(c,d,a){return c[a*this.width+d]}},this.astro.FITS.ImageUtils=O,H=function(a){function c(f){var e,p,u,m,d,v,l;for(c.__super__.constructor.apply(this,arguments),m=f.get("NAXIS"),this.bitpix=f.get("BITPIX"),this.naxis=[],u=d=1;m>=1?m>=d:d>=m;u=m>=1?++d:--d){this.naxis.push(f.get("NAXIS"+u))}for(this.width=f.get("NAXIS1"),this.height=f.get("NAXIS2")||1,this.depth=f.get("NAXIS3")||1,this.bzero=f.get("BZERO")||0,this.bscale=f.get("BSCALE")||1,this.bytes=Math.abs(this.bitpix)/8,this.length=this.naxis.reduce(function(h,i){return h*i})*Math.abs(this.bitpix)/8,this.frame=0,this.frameOffsets=[],this.frameLength=this.bytes*this.width*this.height,this.nBuffers=null!=this.buffer?1:2,u=v=0,l=this.depth-1;l>=0?l>=v:v>=l;u=l>=0?++v:--v){e=u*this.frameLength,p={begin:e},null!=this.buffer&&(p.buffers=[this.buffer.slice(e,e+this.frameLength)]),this.frameOffsets.push(p)}}return G(c,a),c.include(O),c.prototype.allocationSize=16777216,c.prototype._getFrame=function(V,R,v,d){var f,W,T,m,Q,p,S,U;if(W=Math.abs(R)/8,Q=m=V.byteLength/W,T=Math.abs(R),R>0){switch(R){case 8:S=new Uint8Array(V),S=new Uint16Array(S),p=function(e){return e};break;case 16:S=new Int16Array(V),p=function(e){return(255&e)<<8|255&e>>8};break;case 32:S=new Int32Array(V),p=function(e){return(255&e)<<24|(65280&e)<<8|65280&e>>8|255&e>>24}}for(f=parseInt(v)!==v||parseInt(d)!==d?new Float32Array(S.length):S;Q--;){S[Q]=p(S[Q]),f[Q]=v+d*S[Q]}}else{for(f=new Uint32Array(V),p=function(e){return(255&e)<<24|(65280&e)<<8|65280&e>>8|255&e>>24};m--;){U=f[m],f[m]=p(U)}for(f=new Float32Array(V);Q--;){f[Q]=v+d*f[Q]}}return f},c.prototype._getFrameAsync=function(S,ae,aa){var U,W,T,ah,X,ab,Z,ag,R,af,V,ad,Q,ac,Y=this;R=function(h){var p,f,m,u,l,d,v;return d=h.data,u=d.buffer,f=d.bitpix,l=d.bzero,m=d.bscale,v=d.url,importScripts(v),p=_getFrame(u,f,l,m),postMessage(p)},ah=(""+R).replace("return postMessage","postMessage"),ah="onmessage = "+ah,X=""+this._getFrame,X=X.replace("function","function _getFrame"),Z="application/javascript",T=new Blob([ah],{type:Z}),W=new Blob([X],{type:Z}),U=window.URL||window.webkitURL,Q=U.createObjectURL(T),ad=U.createObjectURL(W),ac=new Worker(Q),ag={buffer:S[0],bitpix:this.bitpix,bzero:this.bzero,bscale:this.bscale,url:ad},ab=0,af=null,V=0,ac.onmessage=function(e){var d;return d=e.data,null==af&&(af=new d.constructor(Y.width*Y.height)),af.set(d,V),V+=d.length,ab+=1,ab===Y.nBuffers?(Y.invoke(ae,aa,af),U.revokeObjectURL(Q),U.revokeObjectURL(ad),ac.terminate()):(ag.buffer=S[ab],ac.postMessage(ag,[S[ab]]))},ac.postMessage(ag,[S[0]])},c.prototype.getFrame=function(ad,X,U){var m,R,ae,aa,S,V,T,Z,ac,Y,Q,W,ab=this;if(this.frame=ad||this.frame,V=this.frameOffsets[this.frame],aa=V.buffers,(null!=aa?aa.length:void 0)===this.nBuffers){return this._getFrameAsync(aa,X,U)}for(this.frameOffsets[this.frame].buffers=[],m=V.begin,R=this.blob.slice(m,m+this.frameLength),ae=[],Z=Math.floor(this.height/this.nBuffers),S=Z*this.bytes*this.width,T=Q=0,W=this.nBuffers-1;W>=0?W>=Q:Q>=W;T=W>=0?++Q:--Q){Y=T*S,T===this.nBuffers-1?ae.push(R.slice(Y)):ae.push(R.slice(Y,Y+S))}return aa=[],ac=new FileReader,ac.frame=this.frame,T=0,ac.onloadend=function(d){var e;return ad=d.target.frame,e=d.target.result,ab.frameOffsets[ad].buffers.push(e),T+=1,T===ab.nBuffers?ab.getFrame(ad,X,U):ac.readAsArrayBuffer(ae[T])},ac.readAsArrayBuffer(ae[0])},c.prototype.getFrames=function(f,m,d,l){var n,h=this;return n=function(i,e){return h.invoke(d,e,i),m-=1,f+=1,m?h.getFrame(f,n,e):void 0},this.getFrame(f,n,l)},c.prototype.isDataCube=function(){return this.naxis.length>2?!0:!1},c}(C),this.astro.FITS.Image=H,D=function(a){function c(d){c.__super__.constructor.apply(this,arguments),this.rowByteSize=d.get("NAXIS1"),this.rows=d.get("NAXIS2"),this.cols=d.get("TFIELDS"),this.length=this.rowByteSize*this.rows,this.heapLength=d.get("PCOUNT"),this.columns=this.getColumns(d),null!=this.buffer?(this.rowsInMemory=this._rowsInMemoryBuffer,this.heap=this.buffer.slice(this.length,this.length+this.heapLength)):(this.rowsInMemory=this._rowsInMemoryBlob,this.firstRowInBuffer=this.lastRowInBuffer=0,this.nRowsInBuffer=Math.floor(this.maxMemory/this.rowByteSize)),this.accessors=[],this.descriptors=[],this.elementByteLengths=[],this.setAccessors(d)}return G(c,a),c.prototype.maxMemory=1048576,c.prototype._rowsInMemoryBuffer=function(){return !0},c.prototype._rowsInMemoryBlob=function(d,f){return this.firstRowInBuffer>d?!1:f>this.lastRowInBuffer?!1:!0},c.prototype.getColumns=function(f){var m,d,l,n,h;for(m=[],d=n=1,h=this.cols;h>=1?h>=n:n>=h;d=h>=1?++n:--n){if(l="TTYPE"+d,!f.contains(l)){return null}m.push(f.get(l))}return m},c.prototype.getColumn=function(ab,W,T){var m,Q,ac,Z,R,U,S,Y,aa,X,v,V=this;return null!=this.blob?(aa=this.columns.indexOf(ab),Z=this.descriptors[aa],m=this.accessors[aa],R=this.elementByteLengths[aa],U=this.elementByteLengths.slice(0,aa),U=0===U.length?0:U.reduce(function(d,f){return d+f}),ac=null!=this.typedArray[Z]?new this.typedArray[Z](this.rows):[],v=~~(this.maxMemory/this.rowByteSize),v=Math.min(v,this.rows),S=this.rows/v,X=Math.floor(S)===S?S:Math.floor(S)+1,Y=0,aa=0,Q=function(o,h){var e,p,d,f;for(e=o.byteLength/V.rowByteSize,f=new DataView(o),p=U;e--;){ac[Y]=m(f,p)[0],Y+=1,p+=V.rowByteSize}return X-=1,aa+=1,X?(d=aa*v,V.getTableBuffer(d,v,Q,h)):(V.invoke(W,h,ac),void 0)},this.getTableBuffer(0,v,Q,T)):(Q=function(d,e){return ac=d.map(function(f){return f[ab]}),V.invoke(W,e,ac)},this.getRows(0,this.rows,Q,T))},c.prototype.getTableBuffer=function(Q,u,m,d){var f,R,v,l,p=this;return u=Math.min(this.rows-Q,u),f=Q*this.rowByteSize,v=f+u*this.rowByteSize,R=this.blob.slice(f,v),l=new FileReader,l.row=Q,l.number=u,l.onloadend=function(e){return p.invoke(m,d,e.target.result)},l.readAsArrayBuffer(R)},c.prototype.getRows=function(T,Q,u,d){var f,U,S,m,v,p,R=this;return this.rowsInMemory(T,T+Q)?(null!=this.blob?S=this.buffer:(f=T*this.rowByteSize,m=f+Q*this.rowByteSize,S=this.buffer.slice(f,m)),p=this._getRows(S,Q),this.invoke(u,d,p),p):(f=T*this.rowByteSize,m=f+Math.max(this.nRowsInBuffer*this.rowByteSize,Q*this.rowByteSize),U=this.blob.slice(f,m),v=new FileReader,v.row=T,v.number=Q,v.onloadend=function(h){var e;return e=h.target,R.buffer=e.result,R.firstRowInBuffer=R.lastRowInBuffer=e.row,R.lastRowInBuffer+=e.number,R.getRows(T,Q,u,d)},v.readAsArrayBuffer(U))},c}(C),this.astro.FITS.Tabular=D,N=function(a){function c(){return L=c.__super__.constructor.apply(this,arguments)}return G(c,a),c.prototype.dataAccessors={A:function(d){return d.trim()},I:function(d){return parseInt(d)},F:function(d){return parseFloat(d)},E:function(d){return parseFloat(d)},D:function(d){return parseFloat(d)}},c.prototype.setAccessors=function(T){var Q,u,d,f,U,S,m,v,p,R=this;for(U=/([AIFED])(\d+)\.*(\d+)*/,p=[],d=m=1,v=this.cols;v>=1?v>=m:m>=v;d=v>=1?++m:--m){u=T.get("TFORM"+d),S=T.get("TTYPE"+d),f=U.exec(u),Q=f[1],p.push(function(h){var i;return i=function(l){return R.dataAccessors[h](l)},R.accessors.push(i)}(Q))}return p},c.prototype._getRows=function(U){var ag,ac,W,Y,V,aj,Z,ad,ab,ai,T,ah,X,af,S,ae,aa,Q,R;for(ad=U.byteLength/this.rowByteSize,ac=new Uint8Array(U),ai=[],V=X=0,Q=ad-1;Q>=0?Q>=X:X>=Q;V=Q>=0?++X:--X){for(W=V*this.rowByteSize,Y=W+this.rowByteSize,T=ac.subarray(W,Y),Z="",af=0,ae=T.length;ae>af;af++){ah=T[af],Z+=String.fromCharCode(ah)}for(Z=Z.trim().split(/\s+/),ab={},R=this.accessors,aj=S=0,aa=R.length;aa>S;aj=++S){ag=R[aj],ah=Z[aj],ab[this.columns[aj]]=ag(ah)}ai.push(ab)}return ai},c}(D),this.astro.FITS.Table=N,M=function(a){function c(){return k=c.__super__.constructor.apply(this,arguments)}return G(c,a),c.prototype.typedArray={B:Uint8Array,I:Uint16Array,J:Uint32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint16Array,4:Uint32Array},c.offsets={L:1,B:1,I:2,J:4,K:8,A:1,E:4,D:8,C:8,M:16},c.prototype.dataAccessors={L:function(f,l){var d,h;return h=f.getInt8(l),l+=1,d=84===h?!0:!1,[d,l]},B:function(f,h){var d;return d=f.getUint8(h),h+=1,[d,h]},I:function(f,h){var d;return d=f.getInt16(h),h+=2,[d,h]},J:function(f,h){var d;return d=f.getInt32(h),h+=4,[d,h]},K:function(h,n){var f,m,p,l,d;return m=Math.abs(h.getInt32(n)),n+=4,p=Math.abs(h.getInt32(n)),n+=4,l=m%10,f=l?-1:1,m-=l,d=f*(m<<32|p),[d,n]},A:function(f,h){var d;return d=f.getUint8(h),d=String.fromCharCode(d),h+=1,[d,h]},E:function(f,h){var d;return d=f.getFloat32(h),h+=4,[d,h]},D:function(f,h){var d;return d=f.getFloat64(h),h+=8,[d,h]},C:function(f,l){var d,h,m;return h=f.getFloat32(l),l+=4,m=f.getFloat32(l),l+=4,d=[h,m],[d,l]},M:function(f,l){var d,h,m;return h=f.getFloat64(l),l+=8,m=f.getFloat64(l),l+=8,d=[h,m],[d,l]}},c.prototype.toBits=function(f){var h,d;for(h=[],d=128;d>=1;){h.push(f&d?1:0),d/=2}return h},c.prototype.getFromHeap=function(h,p,f){var m,u,l,d,v;for(v=h.getInt32(p),p+=4,u=h.getInt32(p),p+=4,l=this.heap.slice(u,u+v),m=new this.typedArray[f](l),d=m.length;d--;){m[d]=this.constructor.swapEndian[f](m[d])}return[m,p]},c.prototype.setAccessors=function(X){var S,Q,f,Y,V,o,R,v,U,W,T,m=this;for(R=/(\d*)([P|Q]*)([L|X|B|I|J|K|A|E|D|C|M]{1})/,T=[],Y=U=1,W=this.cols;W>=1?W>=U:U>=W;Y=W>=1?++U:--U){f=X.get("TFORM"+Y),v=X.get("TTYPE"+Y),o=R.exec(f),S=parseInt(o[1])||1,V=o[2],Q=o[3],T.push(function(h,n){var d,l;if(m.descriptors.push(h),m.elementByteLengths.push(m.constructor.offsets[h]*n),V){switch(v){case"COMPRESSED_DATA":d=function(aa,t){var Z,u,p;return p=m.getFromHeap(aa,t,h),Z=p[0],t=p[1],u=new m.typedArray[m.algorithmParameters.BYTEPIX](m.ztile[0]),E.Rice(Z,m.algorithmParameters.BLOCKSIZE,m.algorithmParameters.BYTEPIX,u,m.ztile[0],E.RiceSetup),[u,t]};break;case"GZIP_COMPRESSED_DATA":d=function(s,u){var p;for(p=new Float32Array(m.width),Y=p.length;Y--;){p[Y]=0/0}return[p,u]};break;default:d=function(s,p){return m.getFromHeap(s,p,h)}}}else{1===n?d=function(t,p){var s,u;return u=m.dataAccessors[h](t,p),s=u[0],p=u[1],[s,p]}:"X"===h?(l=Math.log(n)/Math.log(2),d=function(ad,Z){var e,ae,ac,p,aa,u,ab;for(ac=ad.buffer.slice(Z,Z+l),aa=new Uint8Array(ac),ae=[],u=0,ab=aa.length;ab>u;u++){p=aa[u],e=m.toBits(p),ae=ae.concat(e)}return Z+=l,[ae.slice(0,+(n-1)+1||9000000000),Z]}):d="A"===h?function(u,p){var ab,ac,aa,e,ad,Z;for(ac=u.buffer.slice(p,p+n),ab=new Uint8Array(ac),aa="",ad=0,Z=ab.length;Z>ad;ad++){e=ab[ad],aa+=String.fromCharCode(e)}return aa=aa.trim(),p+=n,[aa,p]}:function(p,s){var t,e,u;for(Y=n,t=[];Y--;){u=m.dataAccessors[h](p,s),e=u[0],s=u[1],t.push(e)}return[t,s]}}return m.accessors.push(d)}(Q,S))}return T},c.prototype._getRows=function(X,S){var Q,f,m,Y,V,p,R,v,U,W,T;for(R=new DataView(X),m=0,V=[];S--;){for(Y={},W=this.accessors,f=v=0,U=W.length;U>v;f=++v){Q=W[f],T=Q(R,m),p=T[0],m=T[1],Y[this.columns[f]]=p}V.push(Y)}return V},c}(D),this.astro.FITS.BinaryTable=M,E={RiceSetup:{1:function(c){var f,a,d,h;return h=1,f=3,a=6,d=c[0],[f,a,d,h]},2:function(c){var h,a,f,l,d;return d=2,a=4,f=14,l=0,h=c[0],l|=h<<8,h=c[1],l|=h,[a,f,l,d]},4:function(c){var h,a,f,l,d;return d=4,a=5,f=25,l=0,h=c[0],l|=h<<24,h=c[1],l|=h<<16,h=c[2],l|=h<<8,h=c[3],l|=h,[a,f,l,d]}},Rice:function(V,ai,ae,Y,aa,W){var al,ab,af,ad,ak,U,aj,Z,ah,T,ag,ac,Q,S,X,R;for(ab=1<<ak,X=W[ae](V),ak=X[0],U=X[1],T=X[2],S=X[3],ac=new Uint8Array(256),Q=8,R=[128,255],ah=R[0],aj=R[1];aj>=0;){for(;aj>=ah;){ac[aj]=Q,aj-=1}ah/=2,Q-=1}for(ac[0]=0,al=V[S++],ag=8,aj=0;aa>aj;){for(ag-=ak;0>ag;){al=al<<8|V[S++],ag+=8}if(ad=(al>>ag)-1,al&=(1<<ag)-1,Z=aj+ai,Z>aa&&(Z=aa),0>ad){for(;Z>aj;){Y[aj]=T,aj+=1}}else{if(ad===U){for(;Z>aj;){for(ah=ab-ag,af=al<<ah,ah-=8;ah>=0;){al=V[S++],af|=al<<ah,ah-=8}ag>0?(al=V[S++],af|=al>>-ah,al&=(1<<ag)-1):al=0,0===(1&af)?af>>=1:af=~(af>>1),Y[aj]=af+T,T=Y[aj],aj++}}else{for(;Z>aj;){for(;0===al;){ag+=8,al=V[S++]}for(Q=ag-ac[al],ag-=Q+1,al^=1<<ag,ag-=ad;0>ag;){al=al<<8|V[S++],ag+=8}af=Q<<ad|al>>ag,al&=(1<<ag)-1,0===(1&af)?af>>=1:af=~(af>>1),Y[aj]=af+T,T=Y[aj],aj++}}}}return Y}},this.astro.FITS.Decompress=E,I=function(a){function c(f){var e,l,m,h,d,p;for(c.__super__.constructor.apply(this,arguments),this.zcmptype=f.get("ZCMPTYPE"),this.zbitpix=f.get("ZBITPIX"),this.znaxis=f.get("ZNAXIS"),this.zblank=f.get("ZBLANK"),this.blank=f.get("BLANK"),this.zdither=f.get("ZDITHER0")||0,this.ztile=[],e=d=1,p=this.znaxis;p>=1?p>=d:d>=p;e=p>=1?++d:--d){h=f.contains("ZTILE"+e)?f.get("ZTILE"+e):1===e?f.get("ZNAXIS1"):1,this.ztile.push(h)}for(this.width=f.get("ZNAXIS1"),this.height=f.get("ZNAXIS2")||1,this.algorithmParameters={},"RICE_1"===this.zcmptype&&(this.algorithmParameters.BLOCKSIZE=32,this.algorithmParameters.BYTEPIX=4),e=1;;){if(l="ZNAME"+e,!f.contains(l)){break}m="ZVAL"+e,this.algorithmParameters[f.get(l)]=f.get(m),e+=1}this.zmaskcmp=f.get("ZMASKCMP"),this.zquantiz=f.get("ZQUANTIZ")||"LINEAR_SCALING",this.bzero=f.get("BZERO")||0,this.bscale=f.get("BSCALE")||1}return G(c,a),c.include(O),c.extend(E),c.randomGenerator=function(){var h,n,f,m,p,l,d;for(h=16807,f=2147483647,p=1,m=new Float32Array(10000),n=d=0;9999>=d;n=++d){l=h*p,p=l-f*parseInt(l/f),m[n]=p/f}return m},c.randomSequence=c.randomGenerator(),c.prototype._getRows=function(Y,al){var ah,ab,ad,Z,ap,ae,ai,ag,an,X,am,ac,ak,W,aj,af,T,V,aa,U,Q,ao,R;for(af=new DataView(Y),ag=0,ab=new Float32Array(this.width*this.height);al--;){for(am={},ao=this.accessors,ae=V=0,U=ao.length;U>V;ae=++V){ah=ao[ae],R=ah(af,ag),aj=R[0],ag=R[1],am[this.columns[ae]]=aj}for(Z=am.COMPRESSED_DATA||am.UNCOMPRESSED_DATA||am.GZIP_COMPRESSED_DATA,ad=am.ZBLANK||this.zblank,ac=am.ZSCALE||this.bscale,T=am.ZZERO||this.bzero,ai=this.height-al,ak=ai+this.zdither-1,W=(ak-1)%10000,X=parseInt(500*this.constructor.randomSequence[W]),ae=aa=0,Q=Z.length;Q>aa;ae=++aa){aj=Z[ae],ap=(ai-1)*this.width+ae,-2147483647===aj?ab[ap]=0/0:-2147483646===aj?ab[ap]=0:(an=this.constructor.randomSequence[X],ab[ap]=(aj-an+0.5)*ac+T),X+=1,10000===X&&(W=(W+1)%10000,X=parseInt(500*this.randomSequence[W]))}}return ab},c.prototype.getFrame=function(f,m,d){var l,n,h=this;return this.heap?(this.frame=f||this.frame,this.getRows(0,this.rows,m,d)):(l=this.blob.slice(this.length,this.length+this.heapLength),n=new FileReader,n.onloadend=function(e){return h.heap=e.target.result,h.getFrame(f,m,d)},n.readAsArrayBuffer(l))},c}(M),this.astro.FITS.CompressedImage=I,P=function(){function a(c,d){this.header=c,this.data=d}return a.prototype.hasData=function(){return null!=this.data?!0:!1},a}(),this.astro.FITS.HDU=P}.call(this),MOC=function(){function c(e){return Math.log(e)/Math.LN2}MOC=function(e){this.norder=void 0,this._highResCells={},this._lowResCells={},e=e||{},this.name=e.name||"MOC",this.color=e.color||Color.getNextColor(),this.lineWidth=e.lineWidth||1,this.isShowing=!0},MOC.MAX_NORDER=13,MOC.LOWRES_MAXORDER=5,MOC.HIGHRES_MAXORDER=11,MOC.PIVOT_FOV=20,MOC.prototype.dataFromURL=function(k,f){var j=this,l=function(){var p;try{p=this.getHeader(0)}catch(q){return console.err("Could not get header of extension #0"),void 0}var m=this.getHeader(1);if(p.contains("HPXMOC")){j.order=p.get("HPXMOC")}else{if(p.contains("MOCORDER")){j.order=p.get("MOCORDER")}else{if(m.contains("HPXMOC")){j.order=m.get("HPXMOC")}else{if(!m.contains("MOCORDER")){return console.err("Can not find MOC order in FITS file"),void 0}j.order=m.get("MOCORDER")}}}var i=this.getDataUnit(1),t=i.columns[0];i.getRows(0,i.rows,function(C){for(var v=0;C.length>v;v++){var D=C[v][t],B=Math.floor(Math.floor(c(Math.floor(D/4)))/2),u=D-4*Math.pow(4,B);if(MOC.LOWRES_MAXORDER>=B){B in j._lowResCells||(j._lowResCells[B]=[],j._highResCells[B]=[]),j._lowResCells[B].push(u),j._highResCells[B].push(u)}else{if(MOC.HIGHRES_MAXORDER>=B){B in j._highResCells||(j._highResCells[B]=[]),j._highResCells[B].push(u);var w=MOC.LOWRES_MAXORDER,n=Math.floor(u/Math.pow(4,B-w));w in j._lowResCells||(j._lowResCells=[]),j._lowResCells[w].push(n)}else{var w=MOC.LOWRES_MAXORDER,n=Math.floor(u/Math.pow(4,B-w));w in j._lowResCells||(j._lowResCells=[]),j._lowResCells[w].push(n),w=MOC.HIGHRES_MAXORDER,n=Math.floor(u/Math.pow(4,B-w)),w in j._highResCells||(j._highResCells=[]),j._highResCells[w].push(n)}}}}),i=null,f&&f()};this.dataURL=k;var h=Aladin.JSONP_PROXY+"?url="+encodeURIComponent(this.dataURL);new astro.FITS(h,l)},MOC.prototype.setView=function(e){this.view=e},MOC.prototype.draw=function(u,p,l,f,j,v,q,k){if(this.isShowing){var m=k>MOC.PIVOT_FOV?this._lowResCells:this._highResCells;this._drawCells(u,m,k,p,l,CooFrameEnum.J2000,f,j,v,q)}},MOC.prototype._drawCells=function(E,H,J,F,V,K,O,N,T,D){E.lineWidth=this.lineWidth,E.strokeStyle=this.color,E.beginPath();var R=[];for(key in H){R.push(key)}R.sort();var I,Q,B;if(J>80){for(var P,L=0;R.length>L;L++){P=parseInt(R[L]),I=1<<P;for(var j=0;H[P].length>j;j++){if(B=H[P][j],P>=3){Q=a(I,B,V,K,O,N,T,D,F),Q&&d(E,Q)}else{for(var q=Math.pow(4,3-P),G=B*q,k=0;q>k;k++){Q=a(8,G+k,V,K,O,N,T,D,F),Q&&d(E,Q)}}}}}else{this.view.getVisiblePixList(3,CooFrameEnum.J2000);for(var e={},U=parseInt(R[R.length-1]),P=1;U>=P;P++){if(I=1<<P,3>=P){for(var j=0;H[P].length>j;j++){B=H[P][j];for(var q=Math.pow(4,3-P),G=B*q,k=0;q>k;k++){norder3Ipix=G+k,Q=a(8,norder3Ipix,V,K,O,N,T,D,F),Q&&d(E,Q),e[norder3Ipix]=1}}}else{for(var j=0;H[P].length>j;j++){B=H[P][j];var i=Math.floor(B/Math.pow(4,P-3));i in e||(Q=a(I,B,V,K,O,N,T,D,F),Q&&d(E,Q))}}}}E.stroke()};var d=function(f,h){f.moveTo(h[0].vx,h[0].vy),f.lineTo(h[1].vx,h[1].vy),f.lineTo(h[2].vx,h[2].vy),f.lineTo(h[3].vx,h[3].vy),f.lineTo(h[0].vx,h[0].vy)},a=function(I,D,w,j,m,J,G,q,B){for(var v=[],F=[],H=new SpatialVector,E=HealpixCache.corners_nest(D,I),k=0;4>k;k++){if(H.setXYZ(E[k].x,E[k].y,E[k].z),j&&j!=w){if(j==CooFrameEnum.J2000){var C=CooConversion.J2000ToGalactic([H.ra(),H.dec()]);lon=C[0],lat=C[1]}else{if(j==CooFrameEnum.GAL){var C=CooConversion.GalacticToJ2000([H.ra(),H.dec()]);lon=C[0],lat=C[1]}}}else{lon=H.ra(),lat=H.dec()}F[k]=B.project(lon,lat)}if(null==F[0]||null==F[1]||null==F[2]||null==F[3]){return null}for(var k=0;4>k;k++){v[k]=AladinUtils.xyToView(F[k].X,F[k].Y,m,J,G,q)}return 0>v[0].vx&&0>v[1].vx&&0>v[2].vx&&0>v[3].vx?null:0>v[0].vy&&0>v[1].vy&&0>v[2].vy&&0>v[3].vy?null:v[0].vx>=m&&v[1].vx>=m&&v[2].vx>=m&&v[3].vx>=m?null:v[0].vy>=J&&v[1].vy>=J&&v[2].vy>=J&&v[3].vy>=J?null:v};return MOC.prototype.reportChange=function(){this.view.requestRedraw()},MOC.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},MOC.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},MOC}(),CooGrid=function(){function a(v,q,m,d,f,w,u){var j,p=AladinUtils.viewToXy(q,m,d,f,w,u);try{j=v.unproject(p.x,p.y)}catch(k){return null}return{lon:j.ra,lat:j.dec}}var c=function(){};return c.prototype.redraw=function(X,R,K,N,H,ab,O,U){if(!(U>60)){var Q=0,Z=359.9999,G=-90,Y=90,L=a(R,0,0,N,H,ab,O),W=a(R,N-1,H-1,N,H,ab,O);Z=Math.min(L.lon,W.lon),Q=Math.max(L.lon,W.lon),Y=Math.min(L.lat,W.lat),G=Math.max(L.lat,W.lat);var F=a(R,0,H-1,N,H,ab,O);Z=Math.min(Z,F.lon),Q=Math.max(Q,F.lon),Y=Math.min(Y,F.lat),G=Math.max(G,F.lat);var V=a(R,N-1,0,N,H,ab,O);Z=Math.min(Z,V.lon),Q=Math.max(Q,V.lon),Y=Math.min(Y,V.lat),G=Math.max(G,V.lat);var P,t,E=Q-Z,J=G-Y;U>10?(P=4,t=4):U>1?(P=1,t=1):U>0.1?(P=0.1,t=0.1):(P=0.01,t=0.01);var D=Math.round(Z%P)*P,k=Math.round(Y%t)*t;X.lineWidth=1,X.strokeStyle="rgb(120,120,255)";for(var aa=k;G+t>aa;aa+=t){X.beginPath();var q;if(q=AladinUtils.radecToViewXy(Z,aa,R,CooFrameEnum.J2000,N,H,ab,O)){X.moveTo(q.vx,q.vy);for(var j=0,B=Z;Q+P>B;B+=E/10){j++,q=AladinUtils.radecToViewXy(B,aa,R,CooFrameEnum.J2000,N,H,ab,O),X.lineTo(q.vx,q.vy),3==j&&X.strokeText(aa.toFixed(2),q.vx,q.vy-2)}X.stroke()}}for(var B=D;Q+P>B;B+=P){X.beginPath();var q;if(q=AladinUtils.radecToViewXy(B,Y,R,CooFrameEnum.J2000,N,H,ab,O)){X.moveTo(q.vx,q.vy);for(var j=0,aa=Y;G+t>aa;aa+=J/10){j++,q=AladinUtils.radecToViewXy(B,aa,R,CooFrameEnum.J2000,N,H,ab,O),X.lineTo(q.vx,q.vy),3==j&&X.strokeText(B.toFixed(2),q.vx,q.vy-2)}X.stroke()}}}},c}(),Footprint=function(){return Footprint=function(a){this.polygons=a,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Footprint.prototype.setOverlay=function(a){this.overlay=a},Footprint.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Footprint.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Footprint}(),Popup=function(){return Popup=function(a){this.domEl=$('<div class="aladin-popup-container"><div class="aladin-popup"><a class="aladin-closeBtn">&times;</a><div class="aladin-popupTitle"></div><div class="aladin-popupText"></div></div><div class="aladin-popup-arrow"></div></div>'),this.domEl.appendTo(a);var c=this;this.domEl.find(".aladin-closeBtn").click(function(){c.hide()})},Popup.prototype.hide=function(){this.domEl.hide()},Popup.prototype.show=function(){this.domEl.show()},Popup.prototype.setTitle=function(a){this.domEl.find(".aladin-popupTitle").html(a||"")},Popup.prototype.setText=function(a){this.domEl.find(".aladin-popupText").html(a||""),this.w=this.domEl.outerWidth(),this.h=this.domEl.outerHeight()},Popup.prototype.setSource=function(a){this.source&&(this.source.popup=null),a.popup=this,this.source=a,this.setPosition(a.x,a.y)},Popup.prototype.setPosition=function(c,f){var a=c-this.w/2,d=f-this.h+this.source.catalog.sourceSize/2;this.domEl[0].style.left=a+"px",this.domEl[0].style.top=d+"px"},Popup}(),Circle=function(){return Circle=function(c,d,a){a=a||{},this.color=a.color||void 0,this.setCenter(c),this.setRadius(d),this.overlay=null,this.isShowing=!0,this.isSelected=!1},Circle.prototype.setOverlay=function(a){this.overlay=a},Circle.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.setCenter=function(a){this.centerRaDec=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.setRadius=function(a){this.radiusDegrees=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.draw=function(L,F,B,j,m,M,I){if(this.isShowing){var q;if(B!=CooFrameEnum.J2000){var C=CooConversion.J2000ToGalactic([this.centerRaDec[0],this.centerRaDec[1]]);q=F.project(C[0],C[1])}else{q=F.project(this.centerRaDec[0],this.centerRaDec[1])}if(q){var w,H=AladinUtils.xyToView(q.X,q.Y,j,m,M,I,!0),K=this.centerRaDec[0],G=this.centerRaDec[1]+(K>0?-this.radiusDegrees:this.radiusDegrees);if(B!=CooFrameEnum.J2000){var C=CooConversion.J2000ToGalactic([K,G]);w=F.project(C[0],C[1])}else{w=F.project(K,G)}if(w){var k=AladinUtils.xyToView(w.X,w.Y,j,m,M,I,!0),E=k.vx-H.vx,J=k.vy-H.vy,D=Math.sqrt(E*E+J*J);this.color&&(L.strokeStyle=this.color),L.beginPath(),L.arc(H.vx,H.vy,D,0,2*Math.PI,!1),L.stroke()}}}},Circle}(),Polyline=function(){return Polyline=function(a,c){c=c||{},this.color=c.color||void 0,this.radecArray=a,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Polyline.prototype.setOverlay=function(a){this.overlay=a},Polyline.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.draw=function(u,p,k,c,d,v,q){if(this.isShowing&&this.radecArray&&!(2>this.radecArray.length)){this.color&&(u.strokeStyle=this.color);var f=AladinUtils.radecToViewXy(this.radecArray[0][0],this.radecArray[0][1],p,k,c,d,v,q);if(f){u.moveTo(f.vx,f.vy);for(var m,j=1;this.radecArray.length>j&&(m=AladinUtils.radecToViewXy(this.radecArray[j][0],this.radecArray[j][1],p,k,c,d,v,q),m);j++){u.lineTo(m.vx,m.vy)}u.stroke()}}},Polyline}(),Overlay=function(){return Overlay=function(a){a=a||{},this.name=a.name||"overlay",this.color=a.color||Color.getNextColor(),this.lineWidth=a.lineWidth||2,this.overlays=[],this.overlay_items=[],this.isShowing=!0},Overlay.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},Overlay.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},Overlay.parseSTCS=function(p){for(var l,j=[],c=p.match(/\S+/g),d=0,q=c.length;q>d;){var m=c[d].toLowerCase();if("polygon"==m&&(l=[],d++,frame=c[d].toLowerCase(),"icrs"==frame||"j2000"==frame)){for(;q>d+2;){var f=parseFloat(c[d+1]);if(isNaN(f)){break}var k=parseFloat(c[d+2]);l.push([f,k]),d+=2}l.push(l[0]),j.push(l)}d++}return j},Overlay.prototype.addFootprints=function(c){this.overlays=this.overlays.concat(c);for(var d=0,a=c.length;a>d;d++){c[d].setOverlay(this)}this.view.requestRedraw()},Overlay.prototype.add=function(a){this.overlay_items.push(a),a.setOverlay(this),this.view.requestRedraw()},Overlay.prototype.getFootprint=function(a){return this.footprints.length>a?this.footprints[a]:null},Overlay.prototype.setView=function(a){this.view=a},Overlay.prototype.removeAll=function(){this.overlays=[],this.overlay_items=[]},Overlay.prototype.draw=function(p,l,j,c,d,q,m){if(this.isShowing){p.strokeStyle=this.color,p.lineWidth=this.lineWidth,p.beginPath(),xyviews=[];for(var f=0,k=this.overlays.length;k>f;f++){xyviews.push(this.drawFootprint(this.overlays[f],p,l,j,c,d,q,m))}p.stroke(),p.strokeStyle=Overlay.increase_brightness(this.color,80),p.beginPath();for(var f=0,k=this.overlays.length;k>f;f++){this.overlays[f].isSelected&&this.drawFootprintSelected(p,xyviews[f])}p.stroke();for(var f=0;this.overlay_items.length>f;f++){this.overlay_items[f].draw(p,l,j,c,d,q,m)}}},Overlay.increase_brightness=function(c,f){c=c.replace(/^\s*#|\s*$/g,""),3==c.length&&(c=c.replace(/(.)/g,"$1$1"));var a=parseInt(c.substr(0,2),16),d=parseInt(c.substr(2,2),16),h=parseInt(c.substr(4,2),16);return"#"+(0|256+a+(256-a)*f/100).toString(16).substr(1)+(0|256+d+(256-d)*f/100).toString(16).substr(1)+(0|256+h+(256-h)*f/100).toString(16).substr(1)},Overlay.prototype.drawFootprint=function(K,E,B,j,m,L,H,q){if(!K.isShowing){return null}for(var C=[],w=!1,G=K.polygons,J=0,F=G.length;F>J;J++){var k;if(j!=CooFrameEnum.J2000){var D=CooConversion.J2000ToGalactic([G[J][0],G[J][1]]);k=B.project(D[0],D[1])}else{k=B.project(G[J][0],G[J][1])}if(!k){return null}var I=AladinUtils.xyToView(k.X,k.Y,m,L,H,q);C.push(I),!w&&m>I.vx&&I.vx>=0&&L>=I.vy&&I.vy>=0&&(w=!0)}if(w){E.moveTo(C[0].vx,C[0].vy);for(var J=1,F=C.length;F>J;J++){E.lineTo(C[J].vx,C[J].vy)}}return C},Overlay.prototype.drawFootprintSelected=function(c,f){if(f){var a=f;c.moveTo(a[0].vx,a[0].vy);for(var d=1,h=a.length;h>d;d++){c.lineTo(a[d].vx,a[d].vy)}}},Overlay.prototype.reportChange=function(){this.view.requestRedraw()},Overlay}(),cds.Source=function(){return cds.Source=function(c,f,a,d){this.ra=c,this.dec=f,this.data=a,this.catalog=null,this.marker=d&&d.marker||!1,this.marker&&(this.popupTitle=d&&d.popupTitle?d.popupTitle:"",this.popupDesc=d&&d.popupDesc?d.popupDesc:""),this.isShowing=!0,this.isSelected=!1},cds.Source.prototype.setCatalog=function(a){this.catalog=a},cds.Source.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.actionClicked=function(){if(this.catalog&&this.catalog.onClick){var c=this.catalog.view;if("showTable"==this.catalog.onClick){c.aladin.measurementTable.showMeasurement(this),this.select()}else{if("showPopup"==this.catalog.onClick){c.popup.setTitle("<br><br>");var d='<div class="aladin-marker-measurement">';d+="<table>";for(var a in this.data){d+="<tr><td>"+a+"</td><td>"+this.data[a]+"</td></tr>"}d+="</table>",d+="</div>",c.popup.setText(d),c.popup.setSource(this),c.popup.show()}}}},cds.Source.prototype.actionOtherObjectClicked=function(){this.catalog&&this.catalog.onClick&&"showTable"==this.catalog.onClick&&this.deselect()},cds.Source}(),ProgressiveCat=function(){function a(f,j){var d=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],h=[],k=0;return f.keyRa=f.keyDec=null,$(j).find("FIELD").each(function(){for(var m={},l=0;d.length>l;l++){var i=d[l];$(this).attr(i)&&(m[i]=$(this).attr(i))}m.ID||(m.ID="col_"+k),f.keyRa||!m.ucd||0!=m.ucd.indexOf("pos.eq.ra")&&0!=m.ucd.indexOf("POS_EQ_RA")||(f.keyRa=m.name?m.name:m.ID),f.keyDec||!m.ucd||0!=m.ucd.indexOf("pos.eq.dec")&&0!=m.ucd.indexOf("POS_EQ_DEC")||(f.keyDec=m.name?m.name:m.ID),h.push(m),k++}),h}function c(E,v,p){if(!E.keyRa||!E.keyDec){return[]}lines=v.split("\n");for(var f=[],j=0;p.length>j;j++){p[j].name?f.push(p[j].name):f.push(p[j].ID)}for(var F=[],C=new Coo,k=2;lines.length>k;k++){var q={},m=lines[k].split("	");if(!(m.length<f.length)){for(var B=0;f.length>B;B++){q[f[B]]=m[B]}var D,w;Utils.isNumber(q[E.keyRa])&&Utils.isNumber(q[E.keyDec])?(D=parseFloat(q[E.keyRa]),w=parseFloat(q[E.keyDec])):(C.parse(q[E.keyRa]+" "+q[E.keyDec]),D=C.lon,w=C.lat),F.push(new cds.Source(D,w,q))}}return F}return ProgressiveCat=function(f,j,d,h){h=h||{},this.type="progressivecat",this.rootUrl=f,this.frame=CooFrameEnum.fromString(j)||CooFrameEnum.J2000,this.maxOrder=d,this.isShowing=!0,this.name=h.name||"progressive-cat",this.color=h.color||Color.getNextColor(),this.sourceSize=h.sourceSize||10,this.sourcesCache=new Utils.LRUCache(100),this.cacheCanvas=document.createElement("canvas"),this.cacheCanvas.width=this.sourceSize,this.cacheCanvas.height=this.sourceSize;var k=this.cacheCanvas.getContext("2d");k.beginPath(),k.strokeStyle=this.color,k.lineWidth=2,k.moveTo(0,0),k.lineTo(0,this.sourceSize),k.lineTo(this.sourceSize,this.sourceSize),k.lineTo(this.sourceSize,0),k.lineTo(0,0),k.stroke()},ProgressiveCat.prototype={init:function(d){this.view=d,this.level3Sources||this.loadLevel2Sources()},loadLevel2Sources:function(){var d=this;$.ajax({url:d.rootUrl+"/Norder2/Allsky.xml",method:"GET",success:function(e){d.fields=a(d,e),d.level2Sources=c(d,$(e).find("CSV").text(),d.fields),d.loadLevel3Sources()},error:function(e){console.log("Something went wrong: "+e)}})},loadLevel3Sources:function(){var d=this;$.ajax({url:d.rootUrl+"/Norder3/Allsky.xml",method:"GET",success:function(e){d.level3Sources=c(d,$(e).find("CSV").text(),d.fields),d.view.requestRedraw()},error:function(e){console.log("Something went wrong: "+e)}})},draw:function(w,q,m,d,f,B,v){if(this.isShowing&&this.level3Sources&&(this.drawSources(this.level2Sources,w,q,m,d,f,B,v),this.drawSources(this.level3Sources,w,q,m,d,f,B,v),this.tilesInView)){for(var j,p,k,u=0;this.tilesInView.length>u;u++){k=this.tilesInView[u],p=k[0]+"-"+k[1],j=this.sourcesCache.get(p),j&&this.drawSources(j,w,q,m,d,f,B,v)}}},drawSources:function(v,q,m,d,f,w,u,j){for(var p=0,k=v.length;k>p;p++){this.drawSource(v[p],q,m,d,f,w,u,j)}},getSources:function(){var f=[];if(this.level2Sources&&(f=f.concat(this.level2Sources)),this.level3Sources&&(f=f.concat(this.level3Sources)),this.tilesInView){for(var j,d,h,k=0;this.tilesInView.length>k;k++){h=this.tilesInView[k],d=h[0]+"-"+h[1],j=this.sourcesCache.get(d),j&&(f=f.concat(j))}}return f},drawSource:function(C,q,m,d,f,D,w,j){if(C.isShowing){var p,k=this.sourceSize;if(d!=CooFrameEnum.J2000){var v=CooConversion.J2000ToGalactic([C.ra,C.dec]);p=m.project(v[0],v[1])}else{p=m.project(C.ra,C.dec)}if(p){var B=AladinUtils.xyToView(p.X,p.Y,f,D,w,j);if(B){if(B.vx>f+k||0-k>B.vx||B.vy>D+k||0-k>B.vy){return C.x=C.y=void 0,void 0}C.x=B.vx,C.y=B.vy,q.drawImage(this.cacheCanvas,C.x-k/2,C.y-k/2)}}}},deselectAll:function(){for(var f=0;this.level2Sources.length>f;f++){this.level2Sources[f].deselect()}for(var f=0;this.level3Sources.length>f;f++){this.level3Sources[f].deselect()}var h=this.sourcesCache.keys();for(key in h){if(this.sourcesCache[key]){for(var d=this.sourcesCache[key],f=0;d.length>f;f++){d[f].deselect()}}}},show:function(){this.isShowing||(this.isShowing=!0,this.reportChange())},hide:function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},reportChange:function(){this.view.requestRedraw()},getTileURL:function(f,h){var d=10000*Math.floor(h/10000);return this.rootUrl+"/Norder"+f+"/Dir"+d+"/Npix"+h+".tsv"},loadNeededTiles:function(){this.tilesInView=[],this.otherSources=[];var q=this.view.realNorder;if(q>this.maxOrder&&(q=this.maxOrder),!(3>=q)){for(var k,d,e=this.view.getVisibleCells(q,this.frame),u=4;q>=u;u++){k=[];for(var p=0;e.length>p;p++){d=Math.floor(e[p].ipix/Math.pow(4,q-u)),0>k.indexOf(d)&&k.push(d)}for(var f=0;k.length>f;f++){this.tilesInView.push([u,k[f]])}}for(var m,j,p=0;this.tilesInView.length>p;p++){m=this.tilesInView[p],j=m[0]+"-"+m[1],this.sourcesCache.get(j)||function(l,h,n){var s=h+"-"+n;$.ajax({url:l.getTileURL(h,n),method:"GET",success:function(o){l.sourcesCache.set(s,c(l,o,l.fields)),l.view.requestRedraw()},error:function(){l.sourcesCache.set(s,[])}})}(this,m[0],m[1])}}}},ProgressiveCat}(),cds.Catalog=function(){return cds.Catalog=function(c){c=c||{},this.type="catalog",this.name=c.name||"catalog",this.color=c.color||Color.getNextColor(),this.sourceSize=c.sourceSize||6,this.markerSize=c.sourceSize||12,this.shape=c.shape||"square",this.maxNbSources=c.limit||void 0,this.onClick=c.onClick||void 0,this.raField=c.raField||void 0,this.decField=c.decField||void 0,this.displayLabel=c.displayLabel||!1,this.labelColor=c.labelColor||this.color,this.labelFont=c.labelFont||"10px sans-serif",this.displayLabel&&(this.labelColumn=c.labelColumn,this.labelColumn||(this.displayLabel=!1)),this.shape instanceof Image&&(this.sourceSize=this.shape.width),this.selectSize=this.sourceSize+2,this.isShowing=!0,this.indexationNorder=5,this.sources=[],this.hpxIdx=new HealpixIndex(this.indexationNorder),this.hpxIdx.init(),this.selectionColor="#00ff00",this.cacheCanvas=cds.Catalog.createShape(this.shape,this.color,this.sourceSize),this.cacheMarkerCanvas=document.createElement("canvas"),this.cacheMarkerCanvas.width=this.markerSize,this.cacheMarkerCanvas.height=this.markerSize;var f=this.cacheMarkerCanvas.getContext("2d");f.fillStyle=this.color,f.beginPath();var a=this.markerSize/2;f.arc(a,a,a-2,0,2*Math.PI,!1),f.fill(),f.lineWidth=2,f.strokeStyle="#ccc",f.stroke(),this.cacheSelectCanvas=document.createElement("canvas"),this.cacheSelectCanvas.width=this.selectSize,this.cacheSelectCanvas.height=this.selectSize;var d=this.cacheSelectCanvas.getContext("2d");d.beginPath(),d.strokeStyle=this.selectionColor,d.lineWidth=2,d.moveTo(0,0),d.lineTo(0,this.selectSize),d.lineTo(this.selectSize,this.selectSize),d.lineTo(this.selectSize,0),d.lineTo(0,0),d.stroke()},cds.Catalog.createShape=function(c,f,a){if(c instanceof Image){return c}var d=document.createElement("canvas");d.width=d.height=a;var h=d.getContext("2d");return h.beginPath(),h.strokeStyle=f,h.lineWidth=2,"plus"==c?(h.moveTo(a/2,0),h.lineTo(a/2,a),h.stroke(),h.moveTo(0,a/2),h.lineTo(a,a/2),h.stroke()):"cross"==c?(h.moveTo(0,0),h.lineTo(a-1,a-1),h.stroke(),h.moveTo(a-1,0),h.lineTo(0,a-1),h.stroke()):"rhomb"==c?(h.moveTo(a/2,0),h.lineTo(0,a/2),h.lineTo(a/2,a),h.lineTo(a,a/2),h.lineTo(a/2,0),h.stroke()):"triangle"==c?(h.moveTo(a/2,0),h.lineTo(0,a-1),h.lineTo(a-1,a-1),h.lineTo(a/2,0),h.stroke()):(h.moveTo(0,0),h.lineTo(0,a),h.lineTo(a,a),h.lineTo(a,0),h.lineTo(0,0),h.stroke()),d},cds.Catalog.parseVOTable=function(p,l,j,c,d,q){function m(h){console.log(h);var n;if(h.find("RESOURCE").length>0){n=""}else{if(n=h.find("*").first(),0==n.length){return""}n=n.prop("tagName");var a=n.indexOf(":");n=n.substring(0,a)+"\\:",console.log(n)}return n}function f(O,H){O=O.replace(/^\s+/g,"");var a=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],s=[],E=0,D=$(O),J=m(D);console.log(J),D.find(J+"FIELD").each(function(){for(var n={},u=0;a.length>u;u++){var h=a[u];$(this).attr(h)&&(n[h]=$(this).attr(h))}n.ID||(n.ID="col_"+E),s.push(n),E++});var N,I;if(N=I=null,d){for(var o=0,G=s.length;G>o;o++){var M=s[o];if(Utils.isInt(d)&&s.length>d){N=d;break}if(M.ID&&M.ID===d||M.name&&M.name===d){N=o;break}}}if(q){for(var o=0,G=s.length;G>o;o++){var M=s[o];if(Utils.isInt(q)&&s.length>q){I=q;break}if(M.ID&&M.ID===q||M.name&&M.name===q){I=o;break}}}for(var o=0,G=s.length;G>o&&(null==N||null==I);o++){var M=s[o];if(!N&&M.ucd){var F=M.ucd.toLowerCase();if(F.indexOf("pos.eq.ra")>=0||F.indexOf("pos_eq_ra")>=0){N=o;continue}}if(!I&&M.ucd){var F=M.ucd.toLowerCase();if(F.indexOf("pos.eq.dec")>=0||F.indexOf("pos_eq_dec")>=0){I=o;continue}}}var B,K,L=[],i=new Coo;D.find(J+"TR").each(function(){var h={},u=0;$(this).find(J+"TD").each(function(){var e=s[u].name?s[u].name:s[u].id;h[e]=$(this).text(),u++});var n=s[N].name?s[N].name:s[N].id,v=s[I].name?s[I].name:s[I].id;return Utils.isNumber(h[n])&&Utils.isNumber(h[v])?(B=parseFloat(h[n]),K=parseFloat(h[v])):(i.parse(h[n]+" "+h[v]),B=i.lon,K=i.lat),L.push(new cds.Source(B,K,h)),j&&L.length==j?!1:void 0}),H&&H(L)}var k=Utils.getAjaxObject(p,"GET","text",c);k.done(function(a){f(a,l)})},cds.Catalog.prototype.addSources=function(c){this.sources=this.sources.concat(c);for(var d=0,a=c.length;a>d;d++){c[d].setCatalog(this)}this.reportChange()},cds.Catalog.prototype.getSources=function(){return this.sources},cds.Catalog.prototype.selectAll=function(){if(this.sources){for(var a=0;this.sources.length>a;a++){this.sources[a].select()}}},cds.Catalog.prototype.deselectAll=function(){if(this.sources){for(var a=0;this.sources.length>a;a++){this.sources[a].deselect()}}},cds.Catalog.prototype.getSource=function(a){return this.sources.length>a?this.sources[a]:null},cds.Catalog.prototype.setView=function(a){this.view=a,this.reportChange()},cds.Catalog.prototype.removeAll=cds.Catalog.prototype.clear=function(){this.sources=[]},cds.Catalog.prototype.draw=function(p,l,j,c,d,q,m){if(this.isShowing){for(var f=0,k=this.sources.length;k>f;f++){this.drawSource(this.sources[f],p,l,j,c,d,q,m)}p.strokeStyle=this.selectionColor;for(var f=0,k=this.sources.length;k>f;f++){this.sources[f].isSelected&&this.drawSourceSelection(this.sources[f],p)}if(this.displayLabel){p.fillStyle=this.labelColor,p.font=this.labelFont;for(var f=0,k=this.sources.length;k>f;f++){this.drawSourceLabel(this.sources[f],p)}}}},cds.Catalog.prototype.drawSource=function(E,v,p,f,j,F,C,k){if(E.isShowing){var q,m=this.sourceSize;if(f!=CooFrameEnum.J2000){var B=CooConversion.J2000ToGalactic([E.ra,E.dec]);q=p.project(B[0],B[1])}else{q=p.project(E.ra,E.dec)}if(q){var D=AladinUtils.xyToView(q.X,q.Y,j,F,C,k),w=E.popup?100:E.sourceSize;if(D){if(D.vx>j+w||0-w>D.vx||D.vy>F+w||0-w>D.vy){return E.x=E.y=void 0,void 0}E.x=D.vx,E.y=D.vy,E.marker?v.drawImage(this.cacheMarkerCanvas,E.x-m/2,E.y-m/2):v.drawImage(this.cacheCanvas,E.x-this.cacheCanvas.width/2,E.y-this.cacheCanvas.height/2),E.popup&&E.popup.setPosition(E.x,E.y)}}}},cds.Catalog.prototype.drawSourceSelection=function(c,d){if(c&&c.isShowing&&c.x&&c.y){var a=this.selectSize;d.drawImage(this.cacheSelectCanvas,c.x-a/2,c.y-a/2)}},cds.Catalog.prototype.drawSourceLabel=function(c,d){if(c&&c.isShowing&&c.x&&c.y){var a=c.data[this.labelColumn];a&&d.fillText(a,c.x,c.y)}},cds.Catalog.prototype.reportChange=function(){this.view&&this.view.requestRedraw()},cds.Catalog.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},cds.Catalog.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.view&&this.view.popup&&this.view.popup.source&&this.view.popup.source.catalog==this&&this.view.popup.hide(),this.reportChange())},cds.Catalog}(),Tile=function(){function a(c,d){this.img=c,this.url=d}return a.isImageOk=function(c){return c.allSkyTexture?!0:c.src?c.complete?c.naturalWidth!==void 0&&0==c.naturalWidth?!1:!0:!1:!1},a}(),TileBuffer=function(){function a(){this.pointer=0,this.tilesMap={},this.tilesArray=Array(c);for(var d=0;c>d;d++){this.tilesArray[d]=new Tile(new Image,null)}}var c=800;return a.prototype.addTile=function(e){if(this.getTile(e)){return null}var d=this.tilesArray[this.pointer];return null!=d.url&&(d.img.src=null,delete this.tilesMap[d.url]),this.tilesArray[this.pointer].url=e,this.tilesMap[e]=this.tilesArray[this.pointer],this.pointer++,this.pointer>=c&&(this.pointer=0),this.tilesMap[e]},a.prototype.getTile=function(d){return this.tilesMap[d]},a}(),ColorMap=function(){return ColorMap=function(a){this.view=a,this.reversed=!1,this.map="native",this.sig=this.signature()},ColorMap.MAPS={},ColorMap.MAPS.eosb={name:"Eos B",r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.rainbow={name:"Rainbow",r:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],b:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.cubehelix={name:"Cubehelix",r:[0,1,3,4,6,8,9,10,12,13,14,15,17,18,19,20,20,21,22,23,23,24,24,25,25,25,26,26,26,26,26,26,26,26,26,26,26,25,25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21,21,21,21,20,20,20,21,21,21,21,21,22,22,22,23,23,24,25,26,27,27,28,30,31,32,33,35,36,38,39,41,43,45,47,49,51,53,55,57,60,62,65,67,70,72,75,78,81,83,86,89,92,95,98,101,104,107,110,113,116,120,123,126,129,132,135,138,141,144,147,150,153,155,158,161,164,166,169,171,174,176,178,181,183,185,187,189,191,193,194,196,198,199,201,202,203,204,205,206,207,208,209,209,210,211,211,211,212,212,212,212,212,212,212,212,211,211,211,210,210,210,209,208,208,207,207,206,205,205,204,203,203,202,201,201,200,199,199,198,197,197,196,196,195,195,194,194,194,193,193,193,193,193,193,193,193,193,193,194,194,195,195,196,196,197,198,199,200,200,202,203,204,205,206,208,209,210,212,213,215,217,218,220,222,223,225,227,229,231,232,234,236,238,240,242,244,245,247,249,251,253,255],g:[0,0,1,1,2,2,3,4,4,5,6,6,7,8,9,10,11,11,12,13,14,15,17,18,19,20,21,22,24,25,26,28,29,31,32,34,35,37,38,40,41,43,45,46,48,50,52,53,55,57,58,60,62,64,66,67,69,71,73,74,76,78,79,81,83,84,86,88,89,91,92,94,95,97,98,99,101,102,103,104,106,107,108,109,110,111,112,113,114,114,115,116,116,117,118,118,119,119,120,120,120,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,121,121,121,121,121,121,121,121,121,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,122,122,122,123,123,124,124,125,125,126,127,127,128,129,130,131,131,132,133,135,136,137,138,139,140,142,143,144,146,147,149,150,152,154,155,157,158,160,162,164,165,167,169,171,172,174,176,178,180,182,183,185,187,189,191,193,194,196,198,200,202,203,205,207,208,210,212,213,215,216,218,219,221,222,224,225,226,228,229,230,231,232,233,235,236,237,238,239,240,240,241,242,243,244,244,245,246,247,247,248,248,249,250,250,251,251,252,252,253,253,254,255],b:[0,1,3,4,6,8,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,48,50,52,54,56,57,59,60,62,63,65,66,67,69,70,71,72,73,74,74,75,76,76,77,77,77,78,78,78,78,78,78,78,77,77,77,76,76,75,75,74,73,73,72,71,70,69,68,67,66,66,65,64,63,61,60,59,58,58,57,56,55,54,53,52,51,51,50,49,49,48,48,47,47,47,46,46,46,46,46,47,47,47,48,48,49,50,50,51,52,53,55,56,57,59,60,62,64,65,67,69,71,74,76,78,81,83,86,88,91,94,96,99,102,105,108,111,114,117,120,124,127,130,133,136,140,143,146,149,153,156,159,162,165,169,172,175,178,181,184,186,189,192,195,197,200,203,205,207,210,212,214,216,218,220,222,224,226,227,229,230,231,233,234,235,236,237,238,239,239,240,241,241,242,242,242,243,243,243,243,243,243,243,243,243,243,242,242,242,242,241,241,241,241,240,240,240,239,239,239,239,239,238,238,238,238,238,238,238,238,239,239,239,240,240,240,241,242,242,243,244,245,246,247,248,249,250,252,253,255]},ColorMap.MAPS_CUSTOM=["cubehelix","eosb","rainbow"],ColorMap.MAPS_NAMES=["native","grayscale"].concat(ColorMap.MAPS_CUSTOM),ColorMap.prototype.reverse=function(a){this.reversed=a?a:!this.reversed,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.signature=function(){var a=this.map;return this.reversed&&(a+=" reversed"),a},ColorMap.prototype.update=function(a){this.map=a,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.apply=function(w){if("native"==this.sig){return w}if(w.cmSig==this.sig){return w.cmImg}var q=document.createElement("canvas");q.width=w.width,q.height=w.height;var m=q.getContext("2d");m.drawImage(w,0,0);var d,f,B,v=m.getImageData(0,0,q.width,q.height),j=v.data,p=j.length,k=3;"grayscale"==this.map?k=1:ColorMap.MAPS_CUSTOM.indexOf(this.map)>=0&&(k=2);for(var u=0;p>u;u+=4){switch(k){case 1:d=f=B=AladinUtils.myRound((j[u]+j[u+1]+j[u+2])/3);break;case 2:this.reversed?(d=ColorMap.MAPS[this.map].r[255-j[u]],f=ColorMap.MAPS[this.map].g[255-j[u+1]],B=ColorMap.MAPS[this.map].b[255-j[u+2]]):(d=ColorMap.MAPS[this.map].r[j[u]],f=ColorMap.MAPS[this.map].g[j[u+1]],B=ColorMap.MAPS[this.map].b[j[u+2]]);break;default:d=j[u],f=j[u+1],B=j[u+2]}2!=k&&this.reversed&&(d=255-d,f=255-f,B=255-B),j[u]=d,j[u+1]=f,j[u+2]=B}return v.data=j,m.putImageData(v,0,0),w.cmSig=this.sig,w.cmImg=q,w.cmImg},ColorMap}(),HpxKey=function(){var f=function(D,B,v,p,q,E,C,u,w){this.norder=D,this.npix=B,this.nside=Math.pow(2,D),this.hips=v,this.frame=v.cooFrame,this.width=p,this.height=q,this.dx=E||0,this.dy=C||0,this.allskyTexture=u||void 0,this.allskyTextureSize=w,this.parente=0,this.children=null,this.ancestor=null};f.createHpxKeyfromAncestor=function(o,a){var n=new f(o.norder+1,4*o.npix+a,o.hips,o.width/2,o.height/2,2==a||3==a?o.dx+o.width/2:o.dx,1==a||3==a?o.dy+o.height/2:o.dy,o.allskyTexture,o.allskyTextureSize);return n.parente=o.parente+1,n.ancestor=o.ancestor||o,n};var k=4;f.prototype={draw:function(I,e){var n=0,J=this.getProjViewCorners(e);if(null==J){return 0}J=d(J,1.5);var F=(new Date).getTime(),w=null==this.ancestor&&this.norder>=3&&F-this.hips.lastUpdateDateNeededTiles>0.2;try{if(m(J)){var q=this.drawChildren(I,e,k);if(q>0){return q}}}catch(E){return 0}var H=null==this.ancestor?this.norder:this.ancestor.norder,D=null==this.ancestor?this.npix:this.ancestor.npix,i=this.hips.getTileURL(H,D),C=this.hips.tileBuffer.getTile(i);if(C&&Tile.isImageOk(C.img)||this.allskyTexture){var G=this.allskyTexture||C.img,B=this.allskyTextureSize||G.width;this.parente&&(B/=Math.pow(2,this.parente)),this.hips.drawOneTile2(I,G,J,B,null,this.dx,this.dy,!0),n+=2}else{w&&!C&&(C=this.hips.tileBuffer.addTile(i),e.downloader.requestDownload(C.img,C.url,this.hips.useCors),this.hips.lastUpdateDateNeededTiles=F,e.requestRedrawAtDate(F+HpxImageSurvey.UPDATE_NEEDED_TILES_DELAY+10))}return n},drawChildren:function(q,w,p){var v=0,B=13;if(this.width>1&&B>this.norder&&p>this.parente){var u=this.getChildren();if(null!=u){for(var n=0;4>n;n++){null!=u[n]&&(v+=u[n].draw(q,w,p))}}}return v},getChildren:function(){if(null!=this.children){return this.children}for(var o=[],a=0;4>a;a++){var n=f.createHpxKeyfromAncestor(this,a);o[a]=n}return this.children=o,this.children},getProjViewCorners:function(u){var B=[],q=[],w=new SpatialVector;corners=HealpixCache.corners_nest(this.npix,this.nside);for(var C,v,p=0;4>p;p++){if(w.setXYZ(corners[p].x,corners[p].y,corners[p].z),this.frame!=u.cooFrame){if(this.frame==CooFrameEnum.J2000){var D=CooConversion.J2000ToGalactic([w.ra(),w.dec()]);C=D[0],v=D[1]}else{if(this.frame==CooFrameEnum.GAL){var D=CooConversion.GalacticToJ2000([w.ra(),w.dec()]);C=D[0],v=D[1]}}}else{C=w.ra(),v=w.dec()}B[p]=u.projection.project(C,v)}if(null==B[0]||null==B[1]||null==B[2]||null==B[3]){return null}for(var p=0;4>p;p++){q[p]=AladinUtils.xyToView(B[p].X,B[p].Y,u.width,u.height,u.largestDim,u.zoomFactor)}return q}};var d=function(F,C){for(var w=0,p=0;4>p;p++){null==F[p]&&w++}if(w>1){return F}for(var q=[],p=0;4>p;p++){q.push({vx:F[p].vx,vy:F[p].vy})}for(var p=0;2>p;p++){var G=1==p?1:0,E=1==p?2:3;if(null==q[G]){var u,B;0==G||3==G?(u=1,B=2):(u=0,B=3),q[G]={vx:(q[u].x+q[B].x)/2,vy:(q[u].y+q[B].y)/2}}if(null==q[E]){var u,B;0==E||3==E?(u=1,B=2):(u=0,B=3),q[E]={vx:(q[u].x+q[B].x)/2,vy:(q[u].y+q[B].y)/2}}if(null!=q[G]&&null!=q[E]){var v=Math.atan2(q[E].y-q[G].y,q[E].x-q[G].x),D=C*Math.cos(v);q[G].x-=D,q[E].x+=D,D=C*Math.sin(v),q[G].y-=D,q[E].y+=D}}return q},j=function(n,q,a){var p=n[q].vx-n[a].vx,s=n[q].vy-n[a].vy;return p*p+s*s},l=78400,h=22500,c=0.7,m=function(p){var s,o;if((s=j(p,0,2))>l||(o=j(p,2,1))>l){return !0}if(0==s||0==o){throw"Rhomb error"}var u=j(p,0,3),q=j(p,1,2);if(0==q||0==q){throw"Rhomb error"}var a=q>u?u/q:q/u;return c>a&&(u>h||q>h)};return f}(),HpxImageSurvey=function(){function c(E,R,N,H,J,F,U,K,O,M,T,D,S,I,Q,B,P,L){B=B||0,P=P||0,L||(L=!1),O+=B,T+=B,S+=B,M+=P,D+=P,I+=P;var j=(N+J+U)/3,q=(H+F+K)/3,j=(N+J+U)/3,q=(H+F+K)/3;E.save(),Q&&(E.globalAlpha=Q);var G=0.01;L&&(G=0.01),E.beginPath(),E.moveTo((1+G)*N-j*G,(1+G)*H-q*G),E.lineTo((1+G)*J-j*G,(1+G)*F-q*G),E.lineTo((1+G)*U-j*G,(1+G)*K-q*G),E.closePath(),E.clip(),L&&(G=0.01,N=(1+G)*N-j*G,H=(1+G)*H-q*G,J=(1+G)*J-j*G,F=(1+G)*F-q*G,U=(1+G)*U-j*G,K=(1+G)*K-q*G);var k=1/(O*(I-D)-T*I+S*D+(T-S)*M);E.transform(-(M*(U-J)-D*U+I*J+(D-I)*N)*k,(D*K+M*(F-K)-I*F+(I-D)*H)*k,(O*(U-J)-T*U+S*J+(T-S)*N)*k,-(T*K+O*(F-K)-S*F+(S-T)*H)*k,(O*(I*J-D*U)+M*(T*U-S*J)+(S*D-T*I)*N)*k,(O*(I*F-D*K)+M*(T*K-S*F)+(S*D-T*I)*H)*k),E.drawImage(R,0,0),E.restore()}function f(E,R,N,H,J,F,U,K,O,M,T,D,S,I,Q,B,P,L){B=B||0,P=P||0,L||(L=!1),O+=B,T+=B,S+=B,M+=P,D+=P,I+=P;var j=(N+J+U)/3,q=(H+F+K)/3,j=(N+J+U)/3,q=(H+F+K)/3;E.save(),Q&&(E.globalAlpha=Q);var G=0.01;L&&(G=0.01),E.beginPath(),E.moveTo((1+G)*N-j*G,(1+G)*H-q*G),E.lineTo((1+G)*J-j*G,(1+G)*F-q*G),E.lineTo((1+G)*U-j*G,(1+G)*K-q*G),E.closePath(),E.clip(),L&&(G=0.03,N=(1+G)*N-j*G,H=(1+G)*H-q*G,J=(1+G)*J-j*G,F=(1+G)*F-q*G,U=(1+G)*U-j*G,K=(1+G)*K-q*G);var k=1/(O*(I-D)-T*I+S*D+(T-S)*M);E.transform(-(M*(U-J)-D*U+I*J+(D-I)*N)*k,(D*K+M*(F-K)-I*F+(I-D)*H)*k,(O*(U-J)-T*U+S*J+(T-S)*N)*k,-(T*K+O*(F-K)-S*F+(S-T)*H)*k,(O*(I*J-D*U)+M*(T*U-S*J)+(S*D-T*I)*N)*k,(O*(I*F-D*K)+M*(T*K-S*F)+(S*D-T*I)*H)*k),E.drawImage(R,0,0),E.restore()}var a=function(j,p,m,q,l,i){this.id=j,this.name=p,this.rootUrl="/"===m.slice(-1)?m.substr(0,m.length-1):m,i=i||{},this.imgFormat=i.imgFormat||"jpg",this.minOrder=i.minOrder||null,this.cooFrame=CooFrameEnum.fromString(q,CooFrameEnum.J2000),this.rootUrl.indexOf("/glimpse360/aladin/data")>=0&&(this.cooFrame=CooFrameEnum.J2000),this.maxOrder=l,this.allskyTexture=null,this.alpha=0,this.allskyTextureSize=0,this.lastUpdateDateNeededTiles=0;for(var u=!1,k=0;a.SURVEYS.length>k;k++){a.SURVEYS[k].id==this.id&&(u=!0)}u||a.SURVEYS.push({id:this.id,url:this.rootUrl,name:this.name,maxOrder:this.maxOrder,frame:this.cooFrame}),a.SURVEYS_OBJECTS[this.id]=this};a.UPDATE_NEEDED_TILES_DELAY=1000,a.prototype.init=function(j,k){this.view=j,this.cm||(this.cm=new ColorMap(this.view)),this.tileBuffer=this.view.tileBuffer,this.useCors=!1;var h=this;$.support.cors?$.ajax({type:"GET",url:this.rootUrl+"/properties",dataType:"text",xhrFields:{},headers:{},success:function(){h.useCors=!0,h.retrieveAllskyTextures(),k&&k()},error:function(){h.retrieveAllskyTextures(),k&&k()}}):(this.retrieveAllskyTextures(),k())},a.DEFAULT_SURVEY_ID="P/DSS2/color",a.SURVEYS_OBJECTS={},a.SURVEYS=[{id:"P/2MASS/color",url:"http://alasky.u-strasbg.fr/2MASS/Color",name:"2MASS colored",maxOrder:9,frame:"equatorial",format:"jpeg"},{id:"P/DSS2/color",url:"http://alasky.u-strasbg.fr/DSS/DSSColor",name:"DSS colored",maxOrder:9,frame:"equatorial",format:"jpeg"},{id:"P/DSS2/red",url:"http://alasky.u-strasbg.fr/DSS/DSS2Merged",name:"DSS2 Red (F+R)",maxOrder:9,frame:"equatorial",format:"jpeg fits"},{id:"P/Fermi/color",url:"http://alasky.u-strasbg.fr/Fermi/Color",name:"Fermi color",maxOrder:3,frame:"equatorial",format:"jpeg"},{id:"P/Finkbeiner",url:"http://alasky.u-strasbg.fr/FinkbeinerHalpha",maxOrder:3,frame:"galactic",format:"jpeg fits",name:"Halpha"},{id:"P/GALEXGR6/AIS/color",url:"http://alasky.u-strasbg.fr/GALEX/GR6-02-Color",name:"GALEX Allsky Imaging Survey colored",maxOrder:8,frame:"equatorial",format:"jpeg"},{id:"P/IRIS/color",url:"http://alasky.u-strasbg.fr/IRISColor",name:"IRIS colored",maxOrder:3,frame:"galactic",format:"jpeg"},{id:"P/Mellinger/color",url:"http://alasky.u-strasbg.fr/MellingerRGB",name:"Mellinger colored",maxOrder:4,frame:"galactic",format:"jpeg"},{id:"P/SDSS9/color",url:"http://alasky.u-strasbg.fr/SDSS/DR9/color",name:"SDSS9 colored",maxOrder:10,frame:"equatorial",format:"jpeg"},{id:"P/SPITZER/color",url:"http://alasky.u-strasbg.fr/SpitzerI1I2I4color",name:"IRAC color I1,I2,I4 - (GLIMPSE, SAGE, SAGE-SMC, SINGS)",maxOrder:9,frame:"galactic",format:"jpeg"},{id:"P/VTSS/Ha",url:"http://alasky.u-strasbg.fr/VTSS/Ha",maxOrder:3,frame:"galactic",format:"png jpeg fits",name:"VTSS-Ha"},{id:"P/XMM/EPIC",url:"http://saada.u-strasbg.fr/xmmallsky",name:"XMM-Newton stacked EPIC images (no phot. normalization)",maxOrder:7,frame:"equatorial",format:"png fits"},{id:"P/XMM/PN/color",url:"http://saada.unistra.fr/xmmpnsky",name:"XMM PN colored",maxOrder:7,frame:"equatorial",format:"png jpeg"},{id:"P/allWISE/color",url:"http://alasky.u-strasbg.fr/AllWISE/RGB-W4-W2-W1/",name:"AllWISE color",maxOrder:8,frame:"equatorial",format:"jpeg"},{id:"P/GLIMPSE360",url:"http://www.spitzer.caltech.edu/glimpse360/aladin/data",name:"GLIMPSE360",maxOrder:9,frame:"equatorial",format:"jpeg"}],a.getAvailableSurveys=function(){return a.SURVEYS},a.getSurveyInfoFromId=function(h){for(var j=a.getAvailableSurveys(),i=0;j.length>i;i++){if(j[i].id==h){return j[i]}}return null},a.getSurveyFromId=function(h){if(a.SURVEYS_OBJECTS[h]){return a.SURVEYS_OBJECTS[h]}var j=a.getSurveyInfoFromId(h);if(j){var i={};return j.format&&0>j.format.indexOf("jpeg")&&j.format.indexOf("png")>=0&&(i.imgFormat="png"),new a(j.id,j.name,j.url,j.frame,j.maxOrder,i)}return null},a.prototype.getTileURL=function(j,k){var h=10000*Math.floor(k/10000);return this.rootUrl+"/Norder"+j+"/Dir"+h+"/Npix"+k+"."+this.imgFormat},a.prototype.retrieveAllskyTextures=function(){var h=new Image;this.useCors&&(h.crossOrigin="anonymous");var i=this;h.onload=function(){i.allskyTextureSize=h.width/27,i.allskyTexture=h,i.view.requestRedraw()},h.src=this.rootUrl+"/Norder3/Allsky."+this.imgFormat},a.prototype.draw=function(j,l,h){h=void 0===h?!1:h;var k=l.getVisibleCells(3),m=null;return l.curNorder>=3&&(m=3==l.curNorder?k:l.getVisibleCells(l.curNorder)),h?(l.curNorder>=3?this.drawHighres(j,m,l.curNorder,l):this.drawAllsky(j,k,l.curNorder,l),void 0):(l.curNorder>=3?this.redrawHighres(j,m,l.curNorder):this.redrawAllsky(j,k,l.fov,l.curNorder),void 0)},a.prototype.drawHighres=function(j,m,h,l){for(var n=[],k=0;m.length>k;k++){n.push(new HpxKey(h,m[k].ipix,this,512,512))}for(var k=0;n.length>k;k++){n[k].draw(j,l)}},a.prototype.drawAllsky=function(B,v,q,j){if(!(this.view.curNorder>6)&&this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){for(var k,C,w,m,u=[],p=0;v.length>p;p++){k=v[p],C=k.ipix,m=this.allskyTextureSize*Math.floor(C/27),w=this.allskyTextureSize*(C-27*Math.floor(C/27)),u.push(new HpxKey(3,v[p].ipix,this,this.allskyTextureSize,this.allskyTextureSize,w,m,this.allskyTexture,this.allskyTextureSize))}for(var p=0;u.length>p;p++){u[p].draw(B,j)}}},a.prototype.redrawAllsky=function(F,w,q){if(!(this.view.curNorder>6)&&this.allskyTexture){for(var j,k,G,D=0,m=0,v=w.length;v>m;m++){if(j=w[m],G=j.ipix,this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){var p=this.allskyTextureSize*Math.floor(G/27),C=this.allskyTextureSize*(G-27*Math.floor(G/27));if(q>40){D=0.02,D=0,k={x:(j[0].vx+j[2].vx)/2,y:(j[0].vy+j[2].vy)/2};for(var E=0;4>E;E++){var B={x:j[E].vx-k.x,y:j[E].vy-k.y};j[E].vx+=D*B.x,j[E].vy+=D*B.y}}this.drawOneTile(F,this.allskyTexture,j,this.allskyTextureSize,null,C,p,!0)}}}},a.prototype.getColorMap=function(){return this.cm};var d=!0;return a.prototype.redrawHighres=function(H,X,O){if(0!=X.length){d=!d;var J,ab,P,U,R,Z,G,Y,N=(new Date).getTime(),W=N-this.lastUpdateDateNeededTiles>a.UPDATE_NEEDED_TILES_DELAY,F=O-1,V=[],Q=[],q={},E=!1,K=[],D=[];if(W){var j=[(X[0][0].vx+X[0][1].vx)/2,(X[0][0].vy+X[0][1].vy)/2],aa=X.sort(function(l,p){var h=[(l[0].vx+l[2].vx)/2,(l[0].vy+l[2].vy)/2],n=[(p[0].vx+p[2].vx)/2,(p[0].vy+p[2].vy)/2],u=(h[0]-j[0])*(h[0]-j[0])+(h[1]-j[1])*(h[1]-j[1]),m=(n[0]-j[0])*(n[0]-j[0])+(n[1]-j[1])*(n[1]-j[1]);return u-m});X=aa}for(var k=0,i=X.length;i>k;k++){if(R=X[k],Y=R.ipix,G=~~(Y/4),U=this.getTileURL(F,G),W&&F>=3&&(P=this.tileBuffer.addTile(U),P&&D.push({img:P.img,url:U})),ab=this.getTileURL(O,Y),J=this.tileBuffer.getTile(ab)){Tile.isImageOk(J.img)?V.push({img:J.img,corners:R}):(E=!0,W&&!J.img.dlError&&K.push({img:J.img,url:ab}),F>=3&&!q[G]&&(P=this.tileBuffer.getTile(U),P&&Tile.isImageOk(P.img)&&(Z=this.view.getPositionsInView(G,F),Z&&Q.push({img:P.img,corners:Z,ipix:G})),q[G]=1))}else{if(E=!0,W){var J=this.tileBuffer.addTile(ab);J&&K.push({img:J.img,url:ab})}F>=3&&!q[G]&&(P=this.tileBuffer.getTile(U),P&&Tile.isImageOk(P.img)&&(Z=this.view.getPositionsInView(G,F),Z&&Q.push({img:P.img,corners:Z,ipix:G})),q[G]=1)}}for(var k=0,i=Q.length;i>k;k++){this.drawOneTile(H,Q[k].img,Q[k].corners,Q[k].img.width)}for(var k=0,i=V.length;i>k;k++){var B=null,L=V[k].img;L.fadingStart&&L.fadingEnd&&L.fadingEnd>N&&(B=0.2+0.8*((N-L.fadingStart)/(L.fadingEnd-L.fadingStart))),this.drawOneTile(H,L,V[k].corners,L.width,B)}if(W){for(var k=0,i=K.length;i>k;k++){this.view.downloader.requestDownload(K[k].img,K[k].url,this.useCors)}for(var k=0,i=D.length;i>k;k++){this.view.downloader.requestDownload(D[k].img,D[k].url,this.useCors)}this.lastUpdateDateNeededTiles=N}E&&this.view.requestRedrawAtDate(N+a.UPDATE_NEEDED_TILES_DELAY+10)}},a.prototype.drawOneTile=function(v,p,e,j,w,u,k,q){var m=this.useCors?this.cm.apply(p):p;f(v,m,e[0].vx,e[0].vy,e[1].vx,e[1].vy,e[3].vx,e[3].vy,j-1,j-1,j-1,0,0,j-1,w,u,k,q),f(v,m,e[1].vx,e[1].vy,e[3].vx,e[3].vy,e[2].vx,e[2].vy,j-1,0,0,j-1,0,0,w,u,k,q)},a.prototype.drawOneTile2=function(u,q,j,k,w,v,m,t){var p=this.useCors?this.cm.apply(q):q;c(u,p,j[0].vx,j[0].vy,j[1].vx,j[1].vy,j[3].vx,j[3].vy,k,k,k,0,0,k,w,v,m,t),c(u,p,j[1].vx,j[1].vy,j[3].vx,j[3].vy,j[2].vx,j[2].vy,k,0,0,k,0,0,w,v,m,t)},a.prototype.setAlpha=function(e){e=+e,this.alpha=Math.max(0,Math.min(e,1)),this.view.requestRedraw()},a.prototype.getAlpha=function(){return this.alpha},a}(),HealpixGrid=function(){var a=function(){};return a.prototype.redraw=function(f,k,d,j){f.lineWidth=1,f.strokeStyle="rgb(150,150,220)",f.beginPath();for(var l,h=0,c=k.length;c>h;h++){l=k[h],ipix=l.ipix,f.moveTo(l[0].vx,l[0].vy),f.lineTo(l[1].vx,l[1].vy),f.lineTo(l[2].vx,l[2].vy)}f.stroke(),f.strokeStyle="#FFDDDD",f.beginPath();for(var h=0,c=k.length;c>h;h++){l=k[h],ipix=l.ipix,f.strokeText(j+"/"+ipix,(l[0].vx+l[2].vx)/2,(l[0].vy+l[2].vy)/2)}f.stroke()},a}(),Location=function(){return Location=function(a){this.div=$(a)},Location.prototype.update=function(c,f,a){var d=new Coo(c,f,7);a==CooFrameEnum.J2000?this.div.html(d.format("s/")):this.div.html(d.format("d/"))},Location}(),View=function(){function c(t,m,u,q,k){this.aladin=t,this.options=t.options,this.aladinDiv=this.aladin.aladinDiv,this.popup=new Popup(this.aladinDiv),this.createCanvases(),this.location=m,this.fovDiv=u,this.mustClearCatalog=!0,this.mustRedrawReticle=!0,this.mode=c.PAN,this.minFOV=this.maxFOV=null,this.healpixGrid=new HealpixGrid(this.imageCanvas),this.cooFrame=q?q:CooFrameEnum.GAL;var v,p;v=p=0,this.projectionMethod=ProjectionEnum.SIN,this.projection=new Projection(v,p),this.projection.setProjection(this.projectionMethod),this.zoomLevel=0,this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.viewCenter={lon:v,lat:p},k&&this.setZoom(k),this.imageSurvey=null,this.catalogs=[],this.overlays=[],this.mocs=[],this.tileBuffer=new TileBuffer,this.fixLayoutDimensions(),this.curNorder=1,this.realNorder=1,this.curOverlayNorder=1,this.dragging=!1,this.dragx=null,this.dragy=null,this.needRedraw=!0,this.downloader=new Downloader(this),this.flagForceRedraw=!1,this.fadingLatestUpdate=null,this.dateRequestRedraw=null,this.showGrid=!1,d(this),this.resizeTimer=null;var j=this;$(window).resize(function(){clearTimeout(j.resizeTimer),j.resizeTimer=setTimeout(function(){j.fixLayoutDimensions(j)},100)})}function f(l,p,k,n){if(l.projection){var q,m=AladinUtils.viewToXy(p,k,l.width,l.height,l.largestDim,l.zoomFactor);try{q=l.projection.unproject(m.x,m.y)}catch(j){}q&&l.location.update(q.ra,q.dec,l.cooFrame,n)}}c.PAN=0,c.SELECT=1,c.DRAW_SOURCES_WHILE_DRAGGING=!0,c.DRAW_MOCS_WHILE_DRAGGING=!0,c.prototype.createCanvases=function(){var e=$(this.aladinDiv);e.find(".aladin-imageCanvas").remove(),e.find(".aladin-catalogCanvas").remove(),e.find(".aladin-reticleCanvas").remove(),this.imageCanvas=$("<canvas class='aladin-imageCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.catalogCanvas=$("<canvas class='aladin-catalogCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.reticleCanvas=$("<canvas class='aladin-reticleCanvas'></canvas>").appendTo(this.aladinDiv)[0]},c.prototype.fixLayoutDimensions=function(){Utils.cssScale=void 0,this.width=$(this.aladinDiv).width(),this.height=$(this.aladinDiv).height(),this.width=Math.max(this.width,1),this.height=Math.max(this.height,1),this.cx=this.width/2,this.cy=this.height/2,this.largestDim=Math.max(this.width,this.height),this.smallestDim=Math.min(this.width,this.height),this.ratio=this.largestDim/this.smallestDim,this.mouseMoveIncrement=160/this.largestDim,this.imageCtx=this.imageCanvas.getContext("2d"),this.catalogCtx=this.catalogCanvas.getContext("2d"),this.reticleCtx=this.reticleCanvas.getContext("2d"),this.imageCtx.canvas.width=this.width,this.catalogCtx.canvas.width=this.width,this.reticleCtx.canvas.width=this.width,this.imageCtx.canvas.height=this.height,this.catalogCtx.canvas.height=this.height,this.reticleCtx.canvas.height=this.height,a(this.imageCtx),this.computeNorder(),this.requestRedraw()};var a=function(e){e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1};c.prototype.setMode=function(i){this.mode=i,this.mode==c.SELECT?this.setCursor("crosshair"):this.setCursor("default")},c.prototype.setCursor=function(e){this.reticleCanvas.style.cursor!=e&&(this.reticleCanvas.style.cursor=e)},c.prototype.getCanvasDataURL=function(k){k=k||"image/png";var l=document.createElement("canvas");l.width=this.width,l.height=this.height;var j=l.getContext("2d");return j.drawImage(this.imageCanvas,0,0),j.drawImage(this.catalogCanvas,0,0),j.drawImage(this.reticleCanvas,0,0),l.toDataURL(k)},computeFov=function(i){var j=doComputeFov(i,i.zoomFactor);return i.mouseMoveIncrement=j/i.imageCanvas.width,j},doComputeFov=function(k,n){if(1>k.zoomFactor){fov=180}else{var j=AladinUtils.viewToXy(0,k.cy,k.width,k.height,k.largestDim,n),m=k.projection.unproject(j.x,j.y),p=AladinUtils.viewToXy(k.imageCanvas.width-1,k.cy,k.width,k.height,k.largestDim,n),l=k.projection.unproject(p.x,p.y);fov=new Coo(m.ra,m.dec).distance(new Coo(l.ra,l.dec))}return fov},updateFovDiv=function(i){if(isNaN(i.fov)){return i.fovDiv.html("FoV:"),void 0}var j;j=i.fov>1?Math.round(100*i.fov)/100+"":60*i.fov>1?Math.round(100*60*i.fov)/100+"'":Math.round(100*3600*i.fov)/100+'"',i.fovDiv.html("FoV: "+j)},createListeners=function(e){var k=!1;"ontouchstart" in window&&(k=!0),onDblClick=function(i){var p=e.imageCanvas.relMouseCoords(i),n=AladinUtils.viewToXy(p.x,p.y,e.width,e.height,e.largestDim,e.zoomFactor);try{var q=e.projection.unproject(n.x,n.y)}catch(m){return}radec=[],radec=e.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([q.ra,q.dec]):[q.ra,q.dec],e.pointTo(radec[0],radec[1])},k||$(e.reticleCanvas).dblclick(onDblClick),$(e.reticleCanvas).bind("mousedown touchstart",function(m){var i=e.imageCanvas.relMouseCoords(m);return m.originalEvent&&m.originalEvent.targetTouches?(e.dragx=m.originalEvent.targetTouches[0].clientX,e.dragy=m.originalEvent.targetTouches[0].clientY):(e.dragx=i.x,e.dragy=i.y),e.dragging=!0,e.mode==c.PAN?e.setCursor("move"):e.mode==c.SELECT&&(e.selectStartCoo={x:e.dragx,y:e.dragy}),!1});var l;$(e.reticleCanvas).bind("click mouseout touchend",function(o){if(e.mode==c.SELECT&&e.dragging&&e.aladin.fire("selectend",e.getObjectsInBBox(e.selectStartCoo.x,e.selectStartCoo.y,e.dragx-e.selectStartCoo.x,e.dragy-e.selectStartCoo.y)),e.dragging&&(e.setCursor("default"),e.dragging=!1),e.mustClearCatalog=!0,e.mustRedrawReticle=!0,e.dragx=e.dragy=null,"mouseout"===o.type){return e.requestRedraw(!0),void 0}var n=e.imageCanvas.relMouseCoords(o),m=e.closestObjects(n.x,n.y,5);if(m){var i=m[0];i.marker?(e.popup.setTitle(i.popupTitle),e.popup.setText(i.popupDesc),e.popup.setSource(i),e.popup.show()):(e.aladin.objClickedFunction&&e.aladin.objClickedFunction(i),l&&l.actionOtherObjectClicked(),i.actionClicked(),l=i)}else{l&&(e.aladin.measurementTable.hide(),l.actionOtherObjectClicked(),l=null,e.aladin.objClickedFunction&&e.aladin.objClickedFunction(null))}e.refreshProgressiveCats(),e.requestRedraw(!0)});var j;$(e.reticleCanvas).bind("mousemove touchmove",function(m){m.preventDefault();var B=e.imageCanvas.relMouseCoords(m);if(!e.dragging||k){if(f(e,B.x,B.y,!0),!e.dragging&&!e.mode==c.SELECT){var q=e.closestObjects(B.x,B.y,5);q?(e.setCursor("pointer"),e.aladin.objHoveredFunction&&q[0]!=j&&e.aladin.objHoveredFunction(q[0]),j=q[0]):(e.setCursor("default"),e.aladin.objHoveredFunction&&j&&(j=null,e.aladin.objHoveredFunction(null)))}if(!k){return}}var t,s,w,C;if(m.originalEvent&&m.originalEvent.targetTouches){t=m.originalEvent.targetTouches[0].clientX-e.dragx,s=m.originalEvent.targetTouches[0].clientY-e.dragy;var v=AladinUtils.viewToXy(m.originalEvent.targetTouches[0].clientX,m.originalEvent.targetTouches[0].clientY,e.width,e.height,e.largestDim,e.zoomFactor),i=AladinUtils.viewToXy(e.dragx,e.dragy,e.width,e.height,e.largestDim,e.zoomFactor);w=e.projection.unproject(v.x,v.y),C=e.projection.unproject(i.x,i.y)}else{t=B.x-e.dragx,s=B.y-e.dragy;var v=AladinUtils.viewToXy(B.x,B.y,e.width,e.height,e.largestDim,e.zoomFactor),i=AladinUtils.viewToXy(e.dragx,e.dragy,e.width,e.height,e.largestDim,e.zoomFactor);w=e.projection.unproject(v.x,v.y),C=e.projection.unproject(i.x,i.y)}return m.originalEvent&&m.originalEvent.targetTouches?(e.dragx=m.originalEvent.targetTouches[0].clientX,e.dragy=m.originalEvent.targetTouches[0].clientY):(e.dragx=B.x,e.dragy=B.y),e.mode==c.SELECT?(e.requestRedraw(),void 0):(e.viewCenter.lon+=C.ra-w.ra,e.viewCenter.lat+=C.dec-w.dec,e.viewCenter.lat>90?e.viewCenter.lat=90:-90>e.viewCenter.lat&&(e.viewCenter.lat=-90),0>e.viewCenter.lon?e.viewCenter.lon=360+e.viewCenter.lon:e.viewCenter.lon>360&&(e.viewCenter.lon=e.viewCenter.lon%360),e.requestRedraw(),void 0)}),$(e.aladinDiv).onselectstart=function(){return !1},$(e.reticleCanvas).on("mousewheel",function(i){i.preventDefault(),i.stopPropagation();var n=e.zoomLevel,m=i.deltaY;return m>0?n+=1:n-=1,e.setZoomLevel(n),!1})};var d=function(i){var j=new Stats;j.domElement.style.top="50px",$("#aladin-statsDiv").length>0&&$("#aladin-statsDiv")[0].appendChild(j.domElement),i.stats=j,createListeners(i),i.displayHpxGrid=!1,i.displaySurvey=!0,i.displayCatalog=!1,i.displayReticle=!0,i.fov=computeFov(i),updateFovDiv(i),i.redraw()};c.prototype.requestRedrawAtDate=function(e){this.dateRequestDraw=e},c.prototype.redraw=function(){var G=this.needRedraw;requestAnimFrame(this.redraw.bind(this));var C=(new Date).getTime();if(this.dateRequestDraw&&C>this.dateRequestDraw){this.dateRequestDraw=null}else{if(!this.needRedraw){if(!this.flagForceRedraw){return}this.flagForceRedraw=!1}}this.stats.update();var j=this.imageCtx;j.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height),this.projectionMethod==ProjectionEnum.SIN&&(this.fov>80?(j.fillStyle="rgb(0,0,0)",j.beginPath(),j.arc(this.cx,this.cy,this.cx*this.zoomFactor,0,2*Math.PI,!0),j.fill()):60>this.fov?(j.fillStyle="rgb(0,0,0)",j.fillRect(0,0,this.imageCanvas.width,this.imageCanvas.height)):(j.fillStyle="rgb(0,0,0)",j.beginPath(),j.arc(this.cx,this.cy,this.cx*this.zoomFactor,0,2*Math.PI,!0),j.fill())),this.projection?this.projection.setCenter(this.viewCenter.lon,this.viewCenter.lat):this.projection=new Projection(this.viewCenter.lon,this.viewCenter.lat),this.projection.setProjection(this.projectionMethod);var q=null;if(this.imageSurvey&&this.imageSurvey.isReady&&this.displaySurvey&&this.imageSurvey.draw(j,this,!1),this.overlayImageSurvey&&this.overlayImageSurvey.isReady){if(j.globalAlpha=this.overlayImageSurvey.getAlpha(),this.fov>50&&this.overlayImageSurvey.redrawAllsky(j,J,this.fov,this.curOverlayNorder),this.curOverlayNorder>=3){var M=Math.min(this.curOverlayNorder,this.overlayImageSurvey.maxOrder);(null==q||M!=this.curNorder)&&(q=this.getVisibleCells(M)),this.overlayImageSurvey.redrawHighres(j,q,M)}j.globalAlpha=1}if(this.displayHpxGrid){var J=this.getVisibleCells(3),q=null;this.curNorder>=3&&(q=3==this.curNorder?J:this.getVisibleCells(this.curNorder)),q&&this.curNorder>3?this.healpixGrid.redraw(j,q,this.fov,this.curNorder):this.healpixGrid.redraw(j,J,this.fov,3)}this.showGrid&&(null==this.cooGrid&&(this.cooGrid=new CooGrid),this.cooGrid.redraw(j,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov));var t=this.catalogCtx,D=!1;if(this.mustClearCatalog&&(t.clearRect(0,0,this.width,this.height),D=!0,this.mustClearCatalog=!1),this.catalogs&&this.catalogs.length>0&&this.displayCatalog&&(!this.dragging||c.DRAW_SOURCES_WHILE_DRAGGING)){D||(t.clearRect(0,0,this.width,this.height),D=!0);for(var B=0;this.catalogs.length>B;B++){this.catalogs[B].draw(t,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}}var I=this.catalogCtx;if(this.overlays&&this.overlays.length>0&&(!this.dragging||c.DRAW_SOURCES_WHILE_DRAGGING)){D||(t.clearRect(0,0,this.width,this.height),D=!0);for(var B=0;this.overlays.length>B;B++){this.overlays[B].draw(I,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}}var L=this.catalogCtx;if(this.mocs&&this.mocs.length>0&&(!this.dragging||c.DRAW_MOCS_WHILE_DRAGGING)){D||(t.clearRect(0,0,this.width,this.height),D=!0);for(var B=0;this.mocs.length>B;B++){this.mocs[B].draw(L,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov)}}this.mode==c.SELECT&&(mustRedrawReticle=!0);var H=this.reticleCtx;if((this.mustRedrawReticle||this.mode==c.SELECT)&&H.clearRect(0,0,this.width,this.height),this.displayReticle){if(!this.reticleCache){var k=document.createElement("canvas"),F=this.options.reticleSize;k.width=F,k.height=F;var K=k.getContext("2d");K.lineWidth=2,K.strokeStyle=this.options.reticleColor,K.beginPath(),K.moveTo(F/2,F/2+(F/2-1)),K.lineTo(F/2,F/2+2),K.moveTo(F/2,F/2-(F/2-1)),K.lineTo(F/2,F/2-2),K.moveTo(F/2+(F/2-1),F/2),K.lineTo(F/2+2,F/2),K.moveTo(F/2-(F/2-1),F/2),K.lineTo(F/2-2,F/2),K.stroke(),this.reticleCache=k}H.drawImage(this.reticleCache,this.width/2-this.reticleCache.width/2,this.height/2-this.reticleCache.height/2),this.mustRedrawReticle=!1}if(this.mode==c.SELECT&&this.dragging){H.fillStyle="rgba(100, 240, 110, 0.25)";var E=this.dragx-this.selectStartCoo.x,w=this.dragy-this.selectStartCoo.y;H.fillRect(this.selectStartCoo.x,this.selectStartCoo.y,E,w)}G==this.needRedraw&&(this.needRedraw=!1),this.dragging||this.updateObjectsLookup()},c.prototype.forceRedraw=function(){this.flagForceRedraw=!0},c.prototype.refreshProgressiveCats=function(){if(this.catalogs){for(var e=0;this.catalogs.length>e;e++){"progressivecat"==this.catalogs[e].type&&this.catalogs[e].loadNeededTiles()}}},c.prototype.getVisiblePixList=function(F,w){var q,j=Math.pow(2,F),k=HealpixIndex.nside2Npix(j);if(this.fov>80){q=[];for(var G=0;k>G;G++){q.push(G)}}else{var D=new HealpixIndex(j);D.init();var m=new SpatialVector,v=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),p=this.projection.unproject(v.x,v.y),C=[];w&&w!=this.cooFrame?w==CooFrameEnum.J2000?C=CooConversion.GalacticToJ2000([p.ra,p.dec]):w==CooFrameEnum.GAL&&(C=CooConversion.J2000ToGalactic([p.ra,p.dec])):C=[p.ra,p.dec],m.set(C[0],C[1]);var E=0.5*this.fov*this.ratio;E*=this.fov>60?1.6:this.fov>12?1.45:1.1,q=D.queryDisc(m,E*Math.PI/180,!0,!0);var B=Utils.radecToPolar(C[0],C[1]);ipixCenter=D.ang2pix_nest(B.theta,B.phi),q.unshift(ipixCenter)}return q},c.prototype.getVisibleCells=function(H,X){!X&&this.imageSurvey&&(X=this.imageSurvey.cooFrame);var R,K=[],N=[],I=new SpatialVector,ab=Math.pow(2,H),O=HealpixIndex.nside2Npix(ab),U=null;if(this.fov>80){R=[];for(var Q=0;O>Q;Q++){R.push(Q)}}else{var Z=new HealpixIndex(ab);Z.init();var G=new SpatialVector,Y=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),L=this.projection.unproject(Y.x,Y.y),W=[];X&&X!=this.cooFrame?X==CooFrameEnum.J2000?W=CooConversion.GalacticToJ2000([L.ra,L.dec]):X==CooFrameEnum.GAL&&(W=CooConversion.J2000ToGalactic([L.ra,L.dec])):W=[L.ra,L.dec],G.set(W[0],W[1]);var F=0.5*this.fov*this.ratio;F*=this.fov>60?1.6:this.fov>12?1.45:1.1,R=Z.queryDisc(G,F*Math.PI/180,!0,!0);var V=Utils.radecToPolar(W[0],W[1]);U=Z.ang2pix_nest(V.theta,V.phi),R.unshift(U)}for(var Q,P,B,E=0,J=R.length;J>E;E++){if(Q=R[E],!(Q==U&&E>0)){var D=[];corners=HealpixCache.corners_nest(Q,ab);for(var k=0;4>k;k++){if(I.setXYZ(corners[k].x,corners[k].y,corners[k].z),X&&X!=this.cooFrame){if(X==CooFrameEnum.J2000){var L=CooConversion.J2000ToGalactic([I.ra(),I.dec()]);P=L[0],B=L[1]}else{if(X==CooFrameEnum.GAL){var L=CooConversion.GalacticToJ2000([I.ra(),I.dec()]);P=L[0],B=L[1]}}}else{P=I.ra(),B=I.dec()}N[k]=this.projection.project(P,B)}if(null!=N[0]&&null!=N[1]&&null!=N[2]&&null!=N[3]){for(var k=0;4>k;k++){D[k]=AladinUtils.xyToView(N[k].X,N[k].Y,this.width,this.height,this.largestDim,this.zoomFactor)}if(!(0>D[0].vx&&0>D[1].vx&&0>D[2].vx&&0>D[3].vx||0>D[0].vy&&0>D[1].vy&&0>D[2].vy&&0>D[3].vy||D[0].vx>=this.width&&D[1].vx>=this.width&&D[2].vx>=this.width&&D[3].vx>=this.width||D[0].vy>=this.height&&D[1].vy>=this.height&&D[2].vy>=this.height&&D[3].vy>=this.height)){if(this.projection.PROJECTION==ProjectionEnum.AITOFF){var aa=D[0].vx-D[2].vx,q=D[0].vy-D[2].vy,j=Math.sqrt(aa*aa+q*q);if(j>this.largestDim/5){continue}if(aa=D[1].vx-D[3].vx,q=D[1].vy-D[3].vy,j=Math.sqrt(aa*aa+q*q),j>this.largestDim/5){continue}}D.ipix=Q,K.push(D)}}}}return K},c.prototype.getPositionsInView=function(C,v){for(var q,j,k=[],D=new SpatialVector,B=Math.pow(2,v),m=[],u=HealpixCache.corners_nest(C,B),p=0;4>p;p++){if(D.setXYZ(u[p].x,u[p].y,u[p].z),this.imageSurvey&&this.imageSurvey.cooFrame!=this.cooFrame){if(this.imageSurvey.cooFrame==CooFrameEnum.J2000){var w=CooConversion.J2000ToGalactic([D.ra(),D.dec()]);q=w[0],j=w[1]}else{if(this.imageSurvey.cooFrame==CooFrameEnum.GAL){var w=CooConversion.GalacticToJ2000([D.ra(),D.dec()]);q=w[0],j=w[1]}}}else{q=D.ra(),j=D.dec()}k[p]=this.projection.project(q,j)}if(null==k[0]||null==k[1]||null==k[2]||null==k[3]){return null}for(var p=0;4>p;p++){m[p]=AladinUtils.xyToView(k[p].X,k[p].Y,this.width,this.height,this.largestDim,this.zoomFactor)}return m},c.prototype.computeZoomFactor=function(e){return e>0?AladinUtils.getZoomFactorForAngle(180/Math.pow(1.15,e),this.projectionMethod):1+0.1*e},c.prototype.setZoom=function(i){if(!(0>i||i>180)){var j=Math.log(180/i)/Math.log(1.15);this.setZoomLevel(j)}},c.prototype.setShowGrid=function(e){this.showGrid=e,this.requestRedraw()},c.prototype.setZoomLevel=function(k){if(this.minFOV||this.maxFOV){var l=doComputeFov(this,this.computeZoomFactor(Math.max(-2,k)));if(this.maxFOV&&l>this.maxFOV||this.minFOV&&this.minFOV>l){return}}if(this.zoomLevel=this.projectionMethod==ProjectionEnum.SIN?this.aladin.options.allowFullZoomout===!0?this.width/this.height>2?Math.max(-7,k):0.5>this.width/this.height?Math.max(-2,k):Math.max(-6,k):Math.max(-2,k):Math.max(-7,k),this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.fov=computeFov(this),updateFovDiv(this),this.computeNorder(),this.forceRedraw(),this.requestRedraw(),!this.debounceProgCatOnZoom){var j=this;this.debounceProgCatOnZoom=Utils.debounce(function(){j.refreshProgressiveCats()},300)}this.debounceProgCatOnZoom()},c.prototype.computeNorder=function(){var k=this.fov/this.largestDim,m=512,j=HealpixIndex.calculateNSide(3600*m*k),l=Math.log(j)/Math.log(2);l=Math.max(l,1),this.realNorder=l,50>=this.fov&&2>=l&&(l=3),this.imageSurvey&&2>=l&&this.imageSurvey.minOrder>2&&(l=this.imageSurvey.minOrder);var n=l;this.imageSurvey&&l>this.imageSurvey.maxOrder&&(l=this.imageSurvey.maxOrder),this.overlayImageSurvey&&n>this.overlayImageSurvey.maxOrder&&(n=this.overlayImageSurvey.maxOrder),l>HealpixIndex.ORDER_MAX&&(l=HealpixIndex.ORDER_MAX),n>HealpixIndex.ORDER_MAX&&(n=HealpixIndex.ORDER_MAX),this.curNorder=l,this.curOverlayNorder=n},c.prototype.untaintCanvases=function(){this.createCanvases(),createListeners(this),this.fixLayoutDimensions()},c.prototype.setOverlayImageSurvey=function(k,m){if(!k){return this.overlayImageSurvey=null,this.requestRedraw(),void 0}$.support.cors&&this.overlayImageSurvey&&!this.overlayImageSurvey.useCors&&this.untaintCanvases();var j;"string"==typeof k?(j=HpxImageSurvey.getSurveyFromId(k),j||(j=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID))):j=k,j.isReady=!1,this.overlayImageSurvey=j;var l=this;j.init(this,function(){l.computeNorder(),j.isReady=!0,l.requestRedraw(),l.updateObjectsLookup(),m&&m()})},c.prototype.setUnknownSurveyIfNeeded=function(){h&&(this.setImageSurvey(h),h=void 0)};var h=void 0;return c.prototype.setImageSurvey=function(k,m){if(k){$.support.cors&&this.imageSurvey&&!this.imageSurvey.useCors&&this.untaintCanvases();var j;"string"==typeof k?(j=HpxImageSurvey.getSurveyFromId(k),j||(j=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID),h=k,console.log(h))):j=k,this.tileBuffer=new TileBuffer,j.isReady=!1,this.imageSurvey=j;var l=this;j.init(this,function(){l.computeNorder(),j.isReady=!0,l.requestRedraw(),l.updateObjectsLookup(),m&&m()})}},c.prototype.requestRedraw=function(){this.needRedraw=!0},c.prototype.changeProjection=function(e){this.projectionMethod=e,this.requestRedraw()},c.prototype.changeFrame=function(k){if(this.cooFrame=k,this.cooFrame==CooFrameEnum.GAL){var l=CooConversion.J2000ToGalactic([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=l[0],this.viewCenter.lat=l[1]}else{if(this.cooFrame==CooFrameEnum.J2000){var j=CooConversion.GalacticToJ2000([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=j[0],this.viewCenter.lat=j[1]}}this.requestRedraw()},c.prototype.showHealpixGrid=function(e){this.displayHpxGrid=e,this.requestRedraw()},c.prototype.showSurvey=function(e){this.displaySurvey=e,this.requestRedraw()},c.prototype.showCatalog=function(e){this.displayCatalog=e,this.displayCatalog||(this.mustClearCatalog=!0),this.requestRedraw()},c.prototype.showReticle=function(e){this.displayReticle=e,this.mustRedrawReticle=!0,this.requestRedraw()},c.prototype.pointTo=function(k,m){if(k=parseFloat(k),m=parseFloat(m),!isNaN(k)&&!isNaN(m)){if(this.cooFrame==CooFrameEnum.J2000){this.viewCenter.lon=k,this.viewCenter.lat=m}else{if(this.cooFrame==CooFrameEnum.GAL){var j=CooConversion.J2000ToGalactic([k,m]);this.viewCenter.lon=j[0],this.viewCenter.lat=j[1]}}this.forceRedraw(),this.requestRedraw();var l=this;setTimeout(function(){l.refreshProgressiveCats()},1000)}},c.prototype.makeUniqLayerName=function(k){if(!this.layerNameExists(k)){return k}for(var l=1;;++l){var j=k+"_"+l;if(!this.layerNameExists(j)){return j}}},c.prototype.layerNameExists=function(k){for(var l=this.catalogs,j=0;l.length>j;j++){if(k==l[j].name){return !0}}return !1},c.prototype.removeLayers=function(){this.catalogs=[],this.overlays=[],this.requestRedraw()},c.prototype.addCatalog=function(e){e.name=this.makeUniqLayerName(e.name),this.catalogs.push(e),"catalog"==e.type?e.setView(this):"progressivecat"==e.type&&e.init(this)},c.prototype.addOverlay=function(e){this.overlays.push(e),e.setView(this)},c.prototype.addMOC=function(e){this.mocs.push(e),e.setView(this)},c.prototype.getObjectsInBBox=function(B,v,q,j){0>q&&(B+=q,q=-q),0>j&&(v+=j,j=-j);var k,C,w,m=[];if(this.catalogs){for(var u=0;this.catalogs.length>u;u++){if(k=this.catalogs[u],k.isShowing){C=k.getSources();for(var p=0;C.length>p;p++){w=C[p],w.isShowing&&w.x&&w.y&&w.x>=B&&B+q>=w.x&&w.y>=v&&v+j>=w.y&&m.push(w)}}}}return m},c.prototype.updateObjectsLookup=function(){this.objLookup=[];var l,p,k,n,q;if(this.catalogs){for(var m=0;this.catalogs.length>m;m++){if(l=this.catalogs[m],l.isShowing){p=l.getSources();for(var j=0;p.length>j;j++){k=p[j],k.isShowing&&k.x&&k.y&&(n=k.x,q=k.y,this.objLookup[n]||(this.objLookup[n]=[]),this.objLookup[n][q]||(this.objLookup[n][q]=[]),this.objLookup[n][q].push(k))}}}}},c.prototype.closestObjects=function(v,q,m){if(!this.objLookup){return null}for(var j,k,w=0;m>=w;w++){j=k=null;for(var u=-m;m>=u;u++){if(this.objLookup[v+u]){for(var l=-m;m>=l;l++){if(this.objLookup[v+u][q+l]){if(j){var p=u*u+l*l;k>p&&(k=p,j=this.objLookup[v+u][q+l])}else{j=this.objLookup[v+u][q+l]}}}}}if(j){return j}}return null},c}(),Aladin=function(){var a=function(Q,M){if(0==$(Q).length){return console.log("Could not find div "+Q+". Aborting creation of Aladin Lite instance"),void 0}HealpixCache.init();var G=this;if(void 0===M&&(M=this.getOptionsFromQueryString()),M=M||{},"zoom" in M){var I=M.zoom;delete M.zoom,M.fov=I}var E={};for(var U in a.DEFAULT_OPTIONS){E[U]=void 0!==M[U]?M[U]:a.DEFAULT_OPTIONS[U]}for(var U in M){void 0===a.DEFAULT_OPTIONS[U]&&(E[U]=M[U])}this.options=E,this.aladinDiv=Q,$(Q).addClass("aladin-container");var J=CooFrameEnum.fromString(E.cooFrame,CooFrameEnum.J2000),N=J==CooFrameEnum.J2000,L=$('<div class="aladin-location">'+(E.showFrame?'<select class="aladin-frameChoice"><option value="'+CooFrameEnum.J2000+'" '+(N?'selected="selected"':"")+'>J2000</option><option value="'+CooFrameEnum.GAL+'" '+(N?"":'selected="selected"')+">GAL</option></select>":"")+'<span class="aladin-location-text"></span></div>').appendTo(Q),T=$('<div class="aladin-fov"></div>').appendTo(Q);E.showZoomControl&&$('<div class="aladin-zoomControl"><a href="#" class="zoomPlus" title="Zoom in">+</a><a href="#" class="zoomMinus" title="Zoom out">&ndash;</a></div>').appendTo(Q),E.showFullscreenControl&&$('<div class="aladin-fullscreenControl aladin-maximize" title="Full screen"></div>').appendTo(Q),this.fullScreenBtn=$(Q).find(".aladin-fullscreenControl"),this.fullScreenBtn.click(function(){G.toggleFullscreen()}),$("<div class='aladin-logo-container'><a href='http://aladin.u-strasbg.fr/' title='Powered by Aladin Lite' target='_blank'><div class='aladin-logo'></div></a></div>").appendTo(Q),this.boxes=[],this.measurementTable=new MeasurementTable(Q);var D=new Location(L.find(".aladin-location-text"));if(this.view=new View(this,D,T,J,E.fov),this.view.setShowGrid(E.showCooGrid),$.ajax({url:"http://aladin.u-strasbg.fr/java/nph-aladin.pl",data:{frame:"aladinLiteDic"},method:"GET",dataType:"jsonp",success:function(f){for(var h={},d=0;f.length>d;d++){h[f[d].id]=!0}for(var d=0;HpxImageSurvey.SURVEYS.length>d;d++){h[HpxImageSurvey.SURVEYS[d].id]||f.push(HpxImageSurvey.SURVEYS[d])}HpxImageSurvey.SURVEYS=f,G.view.setUnknownSurveyIfNeeded()},error:function(){}}),E.showLayersControl){var R=$('<div class="aladin-layersControl-container" title="Manage layers"><div class="aladin-layersControl"></div></div>');R.appendTo(Q);var H=$('<div class="aladin-box aladin-layerBox aladin-cb-list"></div>');H.appendTo(Q),this.boxes.push(H),R.click(function(){return G.hideBoxes(),G.showLayerBox(),!1})}if(E.showGotoControl){var R=$('<div class="aladin-gotoControl-container" title="Go to position"><div class="aladin-gotoControl"></div></div>');R.appendTo(Q);var P=$('<div class="aladin-box aladin-gotoBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><form class="aladin-target-form">Go to: <input type="text" placeholder="Object name/position" /></form></div>');P.appendTo(Q),this.boxes.push(P);var B=P.find(".aladin-target-form input");B.on("paste keydown",function(){$(this).removeClass("aladin-unknownObject")}),R.click(function(){return G.hideBoxes(),B.val(""),B.removeClass("aladin-unknownObject"),P.show(),B.focus(),!1}),P.find(".aladin-closeBtn").click(function(){return G.hideBoxes(),!1})}if(E.showShareControl){var R=$('<div class="aladin-shareControl-container" title="Share current view"><div class="aladin-shareControl"></div></div>');R.appendTo(Q);var O=$('<div class="aladin-box aladin-shareBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><b>Share</b><input type="text" class="aladin-shareInput" /></div>');O.appendTo(Q),this.boxes.push(O),R.click(function(){return G.hideBoxes(),O.show(),!1}),O.find(".aladin-closeBtn").click(function(){return G.hideBoxes(),!1})}if(this.gotoObject(E.target),E.log){var K=M;K.version=a.VERSION,Logger.log("startup",K)}if(this.showReticle(E.showReticle),E.catalogUrls){for(var k=0,t=E.catalogUrls.length;t>k;k++){this.createCatalogFromVOTable(E.catalogUrls[k])}}this.setImageSurvey(E.survey),this.view.showCatalog(E.showCatalog);var F=this;$(Q).find(".aladin-frameChoice").change(function(){F.setFrame($(this).val())}),$("#projectionChoice").change(function(){F.setProjection($(this).val())}),$(Q).find(".aladin-target-form").submit(function(){return F.gotoObject($(this).find("input").val(),function(){$(Q).find(".aladin-target-form input").addClass("aladin-unknownObject")}),!1});var q=$(Q).find(".zoomPlus");q.click(function(){return F.increaseZoom(),!1}),q.bind("mousedown",function(d){d.preventDefault()});var j=$(Q).find(".zoomMinus");j.click(function(){return F.decreaseZoom(),!1}),j.bind("mousedown",function(d){d.preventDefault()}),E.fullScreen&&window.setTimeout(function(){G.toggleFullscreen()},1000)};a.VERSION="2016-04-20",a.JSONP_PROXY="http://alasky.u-strasbg.fr/cgi/JSONProxy",a.DEFAULT_OPTIONS={target:"0 +0",cooFrame:"J2000",survey:"P/DSS2/color",fov:60,showReticle:!0,showZoomControl:!0,showFullscreenControl:!0,showLayersControl:!0,showGotoControl:!0,showShareControl:!1,showCatalog:!0,showFrame:!0,showCooGrid:!1,fullScreen:!1,reticleColor:"rgb(178, 50, 178)",reticleSize:22,log:!0,allowFullZoomout:!1},a.prototype.toggleFullscreen=function(){this.fullScreenBtn.toggleClass("aladin-maximize aladin-restore");var d=this.fullScreenBtn.hasClass("aladin-restore");this.fullScreenBtn.attr("title",d?"Restore original size":"Full screen"),$(this.aladinDiv).toggleClass("aladin-fullscreen"),this.view.fixLayoutDimensions()},a.prototype.updateSurveysDropdownList=function(f){f=f.sort(function(i,k){return i.order?i.order&&i.order>k.order?1:-1:i.id>k.id});var j=$(this.aladinDiv).find(".aladin-surveySelection");j.empty();for(var d=0;f.length>d;d++){var h=this.view.imageSurvey.id==f[d].id;j.append($("<option />").attr("selected",h).val(f[d].id).text(f[d].name))}},a.prototype.getOptionsFromQueryString=function(){var h={},l=$.urlParam("target");l&&(h.target=l);var f=$.urlParam("frame");f&&CooFrameEnum[f]&&(h.frame=f);var k=$.urlParam("survey");k&&HpxImageSurvey.getSurveyInfoFromId(k)&&(h.survey=k);var m=$.urlParam("zoom");m&&m>0&&180>m&&(h.zoom=m);var j=$.urlParam("showReticle");j&&(h.showReticle="true"==j.toLowerCase());var d=$.urlParam("cooFrame");d&&(h.cooFrame=d);var p=$.urlParam("fullScreen");return void 0!==p&&(h.fullScreen=p),h},a.prototype.setZoom=function(d){this.view.setZoom(d)},a.prototype.setFoV=a.prototype.setFov=function(d){this.view.setZoom(d)},a.prototype.setFrame=function(d){if(d){var f=CooFrameEnum.fromString(d,CooFrameEnum.J2000);f!=this.view.cooFrame&&(this.view.changeFrame(f),$(this.aladinDiv).find(".aladin-frameChoice").val(f))}},a.prototype.setProjection=function(d){if(d){switch(d=d.toLowerCase()){case"aitoff":this.view.changeProjection(ProjectionEnum.AITOFF);break;case"sinus":default:this.view.changeProjection(ProjectionEnum.SIN)}}},a.prototype.gotoObject=function(f,k){var d=/[a-zA-Z]/.test(f);if(d){var j=this;Sesame.resolve(f,function(n){var o=n.Target.Resolver.jradeg,m=n.Target.Resolver.jdedeg;j.view.pointTo(o,m)},function(e){console&&(console.log("Could not resolve object name "+f),console.log(e)),k&&k()})}else{var l=new Coo;l.parse(f);var h=[l.lon,l.lat];this.view.cooFrame==CooFrameEnum.GAL&&(h=CooConversion.GalacticToJ2000(h)),this.view.pointTo(h[0],h[1])}},a.prototype.gotoPosition=function(f,h){var d;d=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([f,h]):[f,h],this.view.pointTo(d[0],d[1])};var c=function(e){var d=e.animationParams;if(null!=d){var h=(new Date).getTime();if(h>d.end){return e.gotoRaDec(d.raEnd,d.decEnd),d.complete&&d.complete(),void 0}var j=d.raStart+(d.raEnd-d.raStart)*(h-d.start)/(d.end-d.start),f=d.decStart+(d.decEnd-d.decStart)*(h-d.start)/(d.end-d.start);e.gotoRaDec(j,f),setTimeout(function(){c(e)},50)}};return a.prototype.animateToRaDec=function(f,e,j,k){j=j||5,this.animationParams=null,c(this);var h={};h.start=(new Date).getTime(),h.end=(new Date).getTime()+1000*j;var d=this.getRaDec();h.raStart=d[0],h.decStart=d[1],h.raEnd=f,h.decEnd=e,h.complete=k,this.animationParams=h,c(this)},a.prototype.getRaDec=function(){if(this.view.cooFrame==CooFrameEnum.J2000){return[this.view.viewCenter.lon,this.view.viewCenter.lat]}var d=CooConversion.GalacticToJ2000([this.view.viewCenter.lon,this.view.viewCenter.lat]);return d},a.prototype.gotoRaDec=function(d,f){this.view.pointTo(d,f)},a.prototype.showHealpixGrid=function(d){this.view.showHealpixGrid(d)},a.prototype.showSurvey=function(d){this.view.showSurvey(d)},a.prototype.showCatalog=function(d){this.view.showCatalog(d)},a.prototype.showReticle=function(d){this.view.showReticle(d),$("#displayReticle").attr("checked",d)},a.prototype.removeLayers=function(){this.view.removeLayers()},a.prototype.addCatalog=function(d){this.view.addCatalog(d)},a.prototype.addOverlay=function(d){this.view.addOverlay(d)},a.prototype.addMOC=function(d){this.view.addMOC(d)},a.prototype.createImageSurvey=function(f,k,d,j,l,h){return new HpxImageSurvey(f,k,d,j,l,h)},a.prototype.getBaseImageLayer=function(){return this.view.imageSurvey},a.prototype.setImageSurvey=function(f,h){if(this.view.setImageSurvey(f,h),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys()),this.options.log){var d=f;"string"!=typeof f&&(d=f.rootUrl),Logger.log("changeImageSurvey",d)}},a.prototype.setBaseImageLayer=a.prototype.setImageSurvey,a.prototype.getOverlayImageLayer=function(){return this.view.overlayImageSurvey},a.prototype.setOverlayImageLayer=function(d,f){this.view.setOverlayImageSurvey(d,f)},a.prototype.increaseZoom=function(d){d||(d=5),this.view.setZoomLevel(this.view.zoomLevel+d)},a.prototype.decreaseZoom=function(d){d||(d=5),this.view.setZoomLevel(this.view.zoomLevel-d)},a.prototype.createCatalog=function(d){return A.catalog(d)},a.prototype.createProgressiveCatalog=function(f,j,d,h){return new ProgressiveCat(f,j,d,h)},a.prototype.createSource=function(f,h,d){return new cds.Source(f,h,d)},a.prototype.createMarker=function(f,j,d,h){return d=d||{},d.marker=!0,new cds.Source(f,j,h,d)},a.prototype.createOverlay=function(d){return new Overlay(d)},a.prototype.createFootprintsFromSTCS=function(f){for(var j=Overlay.parseSTCS(f),d=[],h=0,k=j.length;k>h;h++){d.push(new Footprint(j[h]))}return d},A.MOCFromURL=function(f,j,d){var h=new MOC(j);return h.dataFromURL(f,d),h},a.prototype.createCatalogFromVOTable=function(d,f){return A.catalogFromURL(d,f)},A.catalogFromURL=function(f,j,d,h){var k=A.catalog(j);return cds.Catalog.parseVOTable(f,function(e){k.addSources(e),d&&d(e)},k.maxNbSources,h,k.raField,k.decField),k},A.catalogFromSimbad=function(f,j,d,h){d=d||{},"name" in d||(d.name="Simbad");var k=URLBuilder.buildSimbadCSURL(f,j);return A.catalogFromURL(k,d,h,!1)},A.catalogFromNED=function(h,l,f,k){f=f||{},"name" in f||(f.name="NED");var m;if(h&&"object"==typeof h){"ra" in h&&"dec" in h&&(m=URLBuilder.buildNEDPositionCSURL(h.ra,h.dec,l))}else{var j=/[a-zA-Z]/.test(h);if(j){m=URLBuilder.buildNEDObjectCSURL(h,l)}else{var d=new Coo;d.parse(h),m=URLBuilder.buildNEDPositionCSURL(d.lon,d.lat,l)}}return A.catalogFromURL(m,f,k)},A.catalogFromVizieR=function(f,k,d,j,l){j=j||{},"name" in j||(j.name="VizieR:"+f);var h=URLBuilder.buildVizieRCSURL(f,k,d);return A.catalogFromURL(h,j,l,!1)},a.prototype.on=function(d,f){"select"===d?this.selectFunction=f:"objectClicked"==d?this.objClickedFunction=f:"objectHovered"==d&&(this.objHoveredFunction=f)},a.prototype.select=function(){this.fire("selectstart")},a.prototype.fire=function(d,f){"selectstart"===d?this.view.setMode(View.SELECT):"selectend"===d&&(this.view.setMode(View.PAN),this.selectFunction&&this.selectFunction(f))},a.prototype.hideBoxes=function(){if(this.boxes){for(var d=0;this.boxes.length>d;d++){this.boxes[d].hide()}}},a.prototype.updateCM=function(){},a.prototype.showLayerBox=function(){var q=this,L=$(this.aladinDiv).find(".aladin-layerBox");L.empty(),L.append('<a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><div class="aladin-label">Base image layer</div><select class="aladin-surveySelection"></select><div class="aladin-cmap">Color map:<div><select class="aladin-cmSelection"></select><button class="aladin-btn aladin-btn-small aladin-reverseCm" type="button">Reverse</button></div></div><div class="aladin-box-separator"></div><div class="aladin-label">Overlay layers</div>');for(var H=L.find(".aladin-cmap"),B=L.find(".aladin-cmSelection"),D=0;ColorMap.MAPS_NAMES.length>D;D++){B.append($("<option />").text(ColorMap.MAPS_NAMES[D]))}B.val(q.getBaseImageLayer().getColorMap().map);for(var w=this.view.catalogs,O="<ul>",D=w.length-1;D>=0;D--){var E=w[D].name,I="";w[D].isShowing&&(I='checked="checked"');var G=w[D].getSources().length,N=G+" source"+(G>1?"s":""),k=w[D].color,M=$("<div></div>").css("color",k).css("color"),C=Color.getLabelColorForBackground(M);O+='<li><div class="aladin-layerIcon" style="background: '+k+';"></div><input type="checkbox" '+I+' id="aladin_lite_'+E+'"></input><label for="aladin_lite_'+E+'" class="aladin-layer-label" style="background: '+k+"; color:"+C+';" title="'+N+'">'+E+"</label></li>"}O+="</ul>",L.append(O),L.append('<div class="aladin-blank-separator"></div>');var I="";this.view.displayReticle&&(I='checked="checked"');var K=$('<input type="checkbox" '+I+' id="displayReticle" />');L.append(K).append('<label for="displayReticle">Reticle</label><br/>'),K.change(function(){q.showReticle($(this).is(":checked"))}),I="",this.view.displayHpxGrid&&(I='checked="checked"');var j=$('<input type="checkbox" '+I+' id="displayHpxGrid"/>');L.append(j).append('<label for="displayHpxGrid">HEALPix grid</label><br/>'),j.change(function(){q.showHealpixGrid($(this).is(":checked"))}),L.append('<div class="aladin-box-separator"></div><div class="aladin-label">Tools</div>');var J=$('<button class="aladin-btn" type="button">Export view as PNG</button>');L.append(J),J.click(function(){q.exportAsPNG()}),L.find(".aladin-closeBtn").click(function(){return q.hideBoxes(),!1}),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys());var F=$(this.aladinDiv).find(".aladin-surveySelection");F.change(function(){var d=HpxImageSurvey.getAvailableSurveys()[$(this)[0].selectedIndex];q.setImageSurvey(d.id,function(){var f=q.getBaseImageLayer();f.useCors?(B.val(f.getColorMap().map),H.show(),J.show()):(H.hide(),J.hide())})}),H.find(".aladin-cmSelection").change(function(){var d=$(this).find(":selected").val();q.getBaseImageLayer().getColorMap().update(d)}),H.find(".aladin-reverseCm").click(function(){q.getBaseImageLayer().getColorMap().reverse()}),this.getBaseImageLayer().useCors?(H.show(),J.show()):(H.hide(),J.hide()),L.find(".aladin-reverseCm").parent().attr("disabled",!0),$(this.aladinDiv).find(".aladin-layerBox ul input").change(function(){var f=$(this).attr("id").substr(12),d=q.layerByName(f);$(this).is(":checked")?d.show():d.hide()}),L.show()},a.prototype.layerByName=function(f){for(var h=this.view.catalogs,d=0;this.view.catalogs.length>d;d++){if(f==h[d].name){return h[d]}}return null},a.prototype.exportAsPNG=function(){window.open(this.getViewDataURL(),"Aladin Lite snapshot")},a.prototype.getViewDataURL=function(d){return this.view.getCanvasDataURL(d)},a.prototype.setFOVRange=function(f,h){if(f>h){var d=f;f=h,h=d}this.view.minFOV=f,this.view.maxFOV=h},a.prototype.pix2world=function(f,j){var d,h=AladinUtils.viewToXy(f,j,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor),k=this.view.projection.unproject(h.x,h.y);return d=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([k.ra,k.dec]):[k.ra,k.dec]},a.prototype.world2pix=function(f,j){var d;if(this.view.cooFrame==CooFrameEnum.GAL){var h=CooConversion.J2000ToGalactic([f,j]);d=this.view.projection.project(h[0],h[1])}else{d=this.view.projection.project(f,j)}if(d){var k=AladinUtils.xyToView(d.X,d.Y,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor);return[k.vx,k.vy]}return null},a.prototype.getFovCorners=function(h){(!h||1>h)&&(h=1);for(var l,f,k,m,j=[],d=0;4>d;d++){l=0==d||3==d?0:this.view.width-1,f=2>d?0:this.view.height-1,k=2>d?this.view.width-1:0,m=1==d||2==d?this.view.height-1:0;for(var p=0;h>p;p++){j.push(this.pix2world(l+p/h*(k-l),f+p/h*(m-f)))}}return j},a.prototype.getFov=function(){var f=this.view.fov,h=this.getSize(),d=h[1]/h[0]*f;return f=Math.min(f,180),d=Math.min(d,180),[f,d]},a.prototype.getSize=function(){return[this.view.width,this.view.height]},a.prototype.getParentDiv=function(){return $(this.aladinDiv)},a}(),A.aladin=function(a,c){return new Aladin($(a)[0],c)},A.imageLayer=function(c,f,a,d){return new HpxImageSurvey(c,f,a,null,null,d)},A.source=function(c,f,a,d){return new cds.Source(c,f,a,d)},A.marker=function(c,f,a,d){return a=a||{},a.marker=!0,A.source(c,f,d,a)},A.polygon=function(a){var c=a.length;return c>0&&(a[0][0]!=a[c-1][0]||a[0][1]!=a[c-1][1])&&a.push([a[0][0],a[0][1]]),new Footprint(a)},A.polyline=function(a,c){return new Polyline(a,c)},A.circle=function(c,f,a,d){return new Circle([c,f],a,d)},A.graphicOverlay=function(a){return new Overlay(a)},A.catalog=function(a){return new cds.Catalog(a)},Aladin.prototype.getShareURL=function(){var a=this.getRaDec(),c=new Coo;return c.prec=7,c.lon=a[0],c.lat=a[1],"http://aladin.u-strasbg.fr/AladinLite/?target="+encodeURIComponent(c.format("s"))+"&fov="+this.getFov()[0].toFixed(2)+"&survey="+encodeURIComponent(this.getBaseImageLayer().id)},Aladin.prototype.getEmbedCode=function(){var c=this.getRaDec(),f=new Coo;f.prec=7,f.lon=c[0],f.lat=c[1];var a=this.getBaseImageLayer().id,d=this.getFov()[0],h="";return h+='<link rel="stylesheet" href="http://aladin.u-strasbg.fr/AladinLite/api/v2/latest/aladin.min.css" />\n',h+='<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js" charset="utf-8"><\/script>\n',h+='<div id="aladin-lite-div" style="width:400px;height:400px;"></div>\n',h+='<script type="text/javascript" src="http://aladin.u-strasbg.fr/AladinLite/api/v2/latest/aladin.min.js" charset="utf-8"><\/script>\n',h+='<script type="text/javascript">\n',h+='var aladin = A.aladin("#aladin-lite-div", {survey: "'+a+'P/DSS2/color", fov: '+d.toFixed(2)+', target: "'+f.format("s")+'"});\n',h+="<\/script>"},Aladin.prototype.displayFITS=function(c,f){f=f||{};var a={url:c};f.color&&(a.color=!0),f.outputFormat&&(a.format=f.outputFormat),f.order&&(a.order=f.order),f.nocache&&(a.nocache=f.nocache);var d=this;$.ajax({url:"http://alasky.u-strasbg.fr/cgi/fits2HiPS",data:a,method:"GET",dataType:"json",success:function(h){if("success"!=h.status){return alert("An error occured: "+h.message),void 0}var e=f.label||"FITS image";d.setOverlayImageLayer(d.createImageSurvey(e,e,h.data.url,"equatorial",h.data.meta.max_norder,{imgFormat:"png"})),d.setFoV(h.data.meta.fov),d.gotoRaDec(h.data.meta.ra,h.data.meta.dec);var j=f&&f.transparency||1;d.getOverlayImageLayer().setAlpha(j)}})},Aladin.prototype.displayJPG=Aladin.prototype.displayPNG=function(a,c){c=c||{},c.color=!0,c.label="JPG/PNG image",c.outputFormat="png",this.displayFITS(a,c)},$&&($.aladin=A.aladin);