var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=a;if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(d,c,b){var e=this.length;d=Number(d);c=Number(c);b=Number(b!=null?b:e);if(d<c){b=Math.min(b,e);while(c<b){if(c in this){this[d++]=this[c++]}else {delete this[d++];c++}}}else {b=Math.min(b,e+c-d);d+=b-c;while(b>c){if(--b in this){this[--d]=this[b]}else {delete this[d]}}}return this};return b},'es6','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global['Symbol']){$jscomp.global['Symbol']=$jscomp.Symbol}};$jscomp.Symbol=function(){var a=0;function Symbol(b){return $jscomp.SYMBOL_PREFIX+(b||'')+a++}return Symbol}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global['Symbol'].iterator;if(!a){a=$jscomp.global['Symbol'].iterator=$jscomp.global['Symbol']('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global['Symbol'].iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,c){return [b,c]})};return b},'es6','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(f,c,b){var d=this.length||0;if(c<0){c=Math.max(0,d+c)}if(b==null||b>d){b=d}b=Number(b);if(b<0){b=Math.max(0,d+b)}for(var e=Number(c||0);e<b;e++){this[e]=f}return this};return b},'es6','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=String(a)}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).v};return b},'es6','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).i};return b},'es6','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(b,c,g){$jscomp.initSymbolIterator();c=c!=null?c:function(d){return d};var d=[];var f=b[Symbol.iterator];if(typeof f=='function'){b=f.call(b);var h;while(!(h=b.next()).done){d.push(c.call(g,h.value))}}else {var i=b.length;for(var e=0;e<i;e++){d.push(c.call(g,b[e]))}}return d};return b},'es6','es3');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(b,c){if(b===c){return b!==0||1/b===1/c}else {return b!==b&&c!==c}};return b},'es6','es3');$jscomp.polyfill('Array.prototype.includes',function(a){if(a){return a}var b=function(d,e){var b=this;if(b instanceof String){b=String(b)}var f=b.length;for(var c=e||0;c<f;c++){if(b[c]==d||Object.is(b[c],d)){return !0}}return !1};return b},'es7','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b){return b})};return b},'es6','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(b){return Array.from(arguments)};return b},'es6','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(c,b){return b})};return b},'es6','es3');$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var d=b[a];delete b[a];try{d()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(d){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{d(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(d){return function(e){if(!a){a=!0;d.call(b,e)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_(b)}else {if(isObject(b)){this.resolveToNonPromiseObj_(b)}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,b)}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(d,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+d+', '+a|'): Promise already settled in state'+this.state_)}this.state_=d;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){var b=this.onSettledCallbacks_;for(var a=0;a<b.length;++a){b[a].call();b[a]=null}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,d){var a=this.createResolveAndReject_();try{b.call(d,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(f,g){var b;var d;var e=new a(function(a,e){b=a;d=e});function createCallback(a,e){if(typeof a=='function'){return function(h){try{b(a(h))}catch(i){d(i)}}}else {return e}}this.callWhenSettled_(createCallback(f,b),createCallback(g,d));return e};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(e,f){var a=this;function callback(){switch(a.state_){case b.FULFILLED:e(a.result_);break;case b.REJECTED:f(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(function(){d.asyncExecute(callback)})}};function resolvingPromise(b){if(b instanceof a){return b}else {return new a(function(a,d){a(b)})}}a['resolve']=resolvingPromise;a['reject']=function(b){return new a(function(d,a){a(b)})};a['race']=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var a=d.next();!a.done;a=d.next()){resolvingPromise(a.value).callWhenSettled_(e,f)}})};a['all']=function(e){var d=$jscomp.makeIterator(e);var b=d.next();if(b.done){return resolvingPromise([])}else {return new a(function(g,h){var a=[];var f=0;function onFulfilled(b){return function(d){a[b]=d;f--;if(f==0){g(a)}}}do{a.push(undefined);f++;resolvingPromise(b.value).callWhenSettled_(onFulfilled(a.length-1),h);b=d.next()}while(!b.done)})}};return a},'es6','es3');$jscomp.executeAsyncGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(d){if(d.done){b(d.value)}else {Promise.resolve(d.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new c([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if(isConformant()){return c}var a='$jscomp_hidden_'+Math.random().toString().substring(2);function insert(b){if(!$jscomp.owns(b,a)){var d={};$jscomp.defineProperty(b,a,{value:d})}}function patch(a){var b=Object[a];if(b){Object[a]=function(d){insert(d);return b(d)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=$jscomp.makeIterator(a);var b;while(!(b=f.next()).done){var e=b.value;this.set(e[0],e[1])}}};b.prototype.set=function(b,d){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=d;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6','es3');$jscomp.MapEntry=function(){this.previous;this.next;this.head;this.key;this.value};$jscomp.polyfill('Map',function(b){var g=!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(j){return !1}}();if(g){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=new WeakMap();var a=function(a){this.data_={};this.head_=f();this.size=0;if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.set(d[0],d[1])}}};a.prototype.set=function(e,d){var a=c(this,e);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:d};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=d}return this};a.prototype['delete']=function(d){var a=c(this,d);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};a.prototype.has=function(a){return !!c(this,a).entry};a.prototype.get=function(d){var a=c(this,d).entry;return a&&a.value};a.prototype.entries=function(){return d(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return d(this,function(a){return a.key})};a.prototype.values=function(){return d(this,function(a){return a.value})};a.prototype.forEach=function(e,d){var f=this.entries();var c;while(!(c=f.next()).done){var a=c.value;e.call(d,a[1],a[0],this)}};a.prototype[Symbol.iterator]=a.prototype.entries;var c=function(g,e){var f=i(e);var a=g.data_[f];if(a&&$jscomp.owns(g.data_,f)){for(var d=0;d<a.length;d++){var c=a[d];if(e!==e&&c.key!==c.key||e===c.key){return {id:f,list:a,index:d,entry:c}}}}return {id:f,list:a,index:-1,entry:undefined}};var d=function(c,d){var a=c.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=c.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:d(a)}}a=null}return {done:!0,value:void 0}})};var f=function(){var a={};a.previous=a.next=a.head=a;return a};var h=0;var i=function(a){var c=a&&typeof a;if(c=='object'||c=='function'){a=a;if(!e.has(a)){var d=''+ ++h;e.set(a,d);return d}return e.get(a)}return 'p_'+a};return a},'es6','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(b){b=Number(b);return Math.log(b+Math.sqrt(b*b-1))};return b},'es6','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.log(Math.abs(b)+Math.sqrt(b*b+1));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var f=b;var g=1;var c=b;var d=0;var e=1;while(d!=c){f*=b;e*=-1;c=(d=c)+e*f/++g}return c}return Math.log(1+b)};return b},'es6','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(c){c=Number(c);return (a(c)-a(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(b){if(b===0){return b}b=Number(b);var c=Math.pow(Math.abs(b),1/3);return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(b){b=Number(b)>>>0;if(b===0){return 32}var c=0;if((b&4.29490176E9)===0){b<<=16;c+=16}if((b&4.27819008E9)===0){b<<=8;c+=8}if((b&4.02653184E9)===0){b<<=4;c+=4}if((b&3.221225472E9)===0){b<<=2;c+=2}if((b&2.147483648E9)===0){c++}return c};return b},'es6','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);return (b(c)+b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var e=b;var f=1;var c=b;var d=0;while(d!=c){e*=b/++f;c=(d=c)+e}return c}return Math.exp(b)-1};return b},'es6','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(c,d,h){c=Number(c);d=Number(d);var b,g,f;var e=Math.max(Math.abs(c),Math.abs(d));for(b=2;b<arguments.length;b++){e=Math.max(e,Math.abs(arguments[b]))}if(e>1.0E100||e<1.0E-100){c=c/e;d=d/e;f=c*c+d*d;for(b=2;b<arguments.length;b++){g=Number(arguments[b])/e;f+=g*g}return Math.sqrt(f)*e}else {f=c*c+d*d;for(b=2;b<arguments.length;b++){g=Number(arguments[b]);f+=g*g}return Math.sqrt(f)}};return b},'es6','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(b,c){b=Number(b);c=Number(c);var f=b>>>16&65535;var d=b&65535;var g=c>>>16&65535;var e=c&65535;var h=f*e+d*g<<16>>>0;return d*e+h|0};return b},'es6','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN10};return b},'es6','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN2};return b},'es6','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(b){b=Number(b);return b===0||isNaN(b)?b:b>0?1:-1};return b},'es6','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);if(c===0){return c}return (b(c)-b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.exp(-2*Math.abs(b));var d=(1-c)/(1+c);return b<0?-d:d};return b},'es6','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(b){b=Number(b);if(isNaN(b)||b===Infinity||b===-Infinity||b===0){return b}var c=Math.floor(Math.abs(b));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(b){if(typeof b!=='number'){return !1}return !isNaN(b)&&b!==Infinity&&b!==-Infinity};return b},'es6','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(b){if(!Number.isFinite(b)){return !1}return b===Math.floor(b)};return b},'es6','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(b){return typeof b==='number'&&isNaN(b)};return b},'es6','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(b){return Number.isInteger(b)&&Math.abs(b)<=Number.MAX_SAFE_INTEGER};return b},'es6','es3');$jscomp.polyfill('Object.assign',function(a){if(a){return a}var b=function(e,f){for(var d=1;d<arguments.length;d++){var b=arguments[d];if(!b){continue}for(var c in b){if($jscomp.owns(b,c)){e[c]=b[c]}}}return e};return b},'es6','es3');$jscomp.polyfill('Object.entries',function(a){if(a){return a}var b=function(c){var d=[];for(var b in c){if($jscomp.owns(c,b)){d.push([b,c[b]])}}return d};return b},'es8','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6','es5');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(c){return c.substring(0,a.length)==a}var c=function(e){var f=[];var c=Object.getOwnPropertyNames(e);var d=Object.getOwnPropertySymbols(e);for(var a=0;a<c.length;a++){(isSymbol(c[a])?d:f).push(c[a])}return f.concat(d)};return c},'es6','es5');$jscomp.polyfill('Object.getOwnPropertyDescriptors',function(a){if(a){return a}var b=function(e){var d={};var c=Reflect.ownKeys(e);for(var b=0;b<c.length;b++){d[c[b]]=Object.getOwnPropertyDescriptor(e,c[b])}return d};return b},'es8','es5');$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0};var a={};try{a.__proto__=b;return a.a}catch(c){}return !1};$jscomp.setPrototypeOf=typeof Object.setPrototypeOf=='function'?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a}:null;$jscomp.polyfill('Object.setPrototypeOf',function(a){return a||$jscomp.setPrototypeOf},'es6','es5');$jscomp.polyfill('Object.values',function(a){if(a){return a}var b=function(b){var c=[];for(var d in b){if($jscomp.owns(b,d)){c.push(b[d])}}return c};return b},'es8','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(e,d,b){return c.call(e,d,b)};return b},'es6','es3');$jscomp.objectCreate=$jscomp.ASSUME_ES5||typeof Object.create=='function'?Object.create:function(b){var a=function(){};a.prototype=b;return new a()};$jscomp.construct=function(){function reflectConstructWorks(){function Base(){}function Derived(){}new Base();Reflect.construct(Base,[],Derived);return new Base() instanceof Base}if(typeof Reflect!='undefined'&&Reflect.construct){if(reflectConstructWorks()){return Reflect.construct}var b=Reflect.construct;var a=function(e,d,a){var c=b(e,d);if(a){Reflect.setPrototypeOf(c,a.prototype)}return c};return a}function construct(b,d,a){if(a===undefined){a=b}var f=a.prototype||Object.prototype;var c=$jscomp.objectCreate(f);var e=Function.prototype.apply;var g=e.call(b,c,d);return g||c}return construct}();$jscomp.polyfill('Reflect.construct',function(a){return $jscomp.construct},'es6','es3');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(e,d,c){try{Object.defineProperty(e,d,c);var b=Object.getOwnPropertyDescriptor(e,d);if(!b){return !1}return b.configurable===(c.configurable||!1)&&b.enumerable===(c.enumerable||!1)&&('value' in b?b.value===c.value&&b.writable===(c.writable||!1):b.get===c.get&&b.set===c.set)}catch(f){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(c,b){if(!$jscomp.owns(c,b)){return !0}try{return delete c[b]}catch(d){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(d,c,e){if(arguments.length<=2){return d[c]}var b=$jscomp.findDescriptor(d,c);if(b){return b.get?b.get.call(e):b.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(c,b){return b in c};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if($jscomp.ASSUME_ES5||typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(!($jscomp.ASSUME_ES5||typeof Object.preventExtensions=='function')){return function(){return !1}}var b=function(b){Object.preventExtensions(b);return !Object.isExtensible(b)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(b,d,e,f){var c=$jscomp.findDescriptor(b,d);if(!c){if(Reflect.isExtensible(b)){b[d]=e;return !0}return !1}if(c.set){c.set.call(arguments.length>3?f:b,e);return !0}else {if(c.writable&&!Object.isFrozen(b)){b[d]=e;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}else {if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;var c=function(c,d){try{b(c,d);return !0}catch(e){return !1}};return c}else {return null}}},'es6','es5');$jscomp.polyfill('Set',function(b){var c=!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}();if(c){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}this.size=this.map_.size};a.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(c){var a=this.map_['delete'](c);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};a.prototype.keys=a.prototype.values;a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(c,a){var d=this;this.map_.forEach(function(e){return c.call(a,e,e,d)})};return a},'es6','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(b){var e=$jscomp.checkStringArgs(this,null,'codePointAt');var f=e.length;b=Number(b)||0;if(!(b>=0&&b<f)){return void 0}b=b|0;var c=e.charCodeAt(b);if(c<55296||c>56319||b+1===f){return c}var d=e.charCodeAt(b+1);if(d<56320||d>57343){return c}return (c-55296)*1024+d+9216};return b},'es6','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'endsWith');b=b+'';if(c===void 0){c=d.length}var f=Math.max(0,Math.min(c|0,d.length));var e=b.length;while(e>0&&f>0){if(d[--f]!=b[--e]){return !1}}return e<=0};return b},'es6','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(e){var c='';for(var d=0;d<arguments.length;d++){var b=Number(arguments[d]);if(b<0||b>1114111||b!==Math.floor(b)){throw new RangeError('invalid_code_point '+b)}if(b<=65535){c+=String.fromCharCode(b)}else {b-=65536;c+=String.fromCharCode(b>>>10&1023|55296);c+=String.fromCharCode(b&1023|56320)}}return c};return b},'es6','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'includes');return d.indexOf(b,c||0)!==-1};return b},'es6','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(b){var c=$jscomp.checkStringArgs(this,null,'repeat');if(b<0||b>1342177279){throw new RangeError('Invalid count value')}b=b|0;var d='';while(b){if(b&1){d+=c}if(b>>>=1){c+=c}}return d};return b},'es6','es3');$jscomp.stringPadding=function(c,a){var b=c!==undefined?String(c):' ';if(!(a>0)||!b){return ''}var d=Math.ceil(a/b.length);return b.repeat(d).substring(0,a)};$jscomp.polyfill('String.prototype.padEnd',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return b+$jscomp.stringPadding(c,e)};return b},'es8','es3');$jscomp.polyfill('String.prototype.padStart',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return $jscomp.stringPadding(c,e)+b};return b},'es8','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(b,g){var c=$jscomp.checkStringArgs(this,b,'startsWith');b=b+'';var h=c.length;var e=b.length;var f=Math.max(0,Math.min(g|0,c.length));var d=0;while(d<e&&f<h){if(c[f++]!=b[d++]){return !1}}return d>=e};return b},'es6','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(a,b)}else {for(var c in b){if(c=='prototype'){continue}if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}}a.superClass_=b.prototype};$jscomp.polyfill('WeakSet',function(b){function isConformant(){if(!b||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var a=new b([c]);if(!a.has(c)||a.has(d)){return !1}a['delete'](c);a.add(d);return !a.has(c)&&a.has(d)}catch(e){return !1}}if(isConformant()){return b}var a=function(a){this.map_=new WeakMap();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}};a.prototype.add=function(a){this.map_.set(a,!0);return this};a.prototype.has=function(a){return this.map_.has(a)};a.prototype['delete']=function(a){return this.map_['delete'](a)};return a},'es6','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}function AstroMath(){}function Projection(b,a){this.PROJECTION=Projection.PROJ_TAN,this.ROT=this.tr_oR(b,a)}function Coo(c,a,b){this.lon=c,this.lat=a,this.prec=b,this.frame=null,this.computeDirCos()}function Tokenizer(b,a){this.string=Strings.trim(b,a),this.sep=a,this.pos=0}function Strings(){}function Numbers(){}function relMouseCoords(c){if(c.offsetX){return {x:c.offsetX,y:c.offsetY}}if(!Utils.cssScale){var a=window.getComputedStyle(document.body,null),i=a.getPropertyValue('-webkit-transform')||a.getPropertyValue('-moz-transform')||a.getPropertyValue('-ms-transform')||a.getPropertyValue('-o-transform')||a.getPropertyValue('transform'),l=/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/,g=i.match(l);Utils.cssScale=g?parseFloat(g[1]):1}var b=c;b.target;var d=b.target||b.srcElement,f=d.currentStyle||window.getComputedStyle(d,null),h=parseInt(f.borderLeftWidth,10),j=parseInt(f.borderTopWidth,10),e=d.getBoundingClientRect(),m=b.clientX-h-e.left,k=b.clientY-j-e.top;return {x:parseInt(m/Utils.cssScale),y:parseInt(k/Utils.cssScale)}}var cds=cds||{},A=A||{};'object'!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?'0'+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(c){var b=meta[c];return 'string'==typeof b?b:'\\u'+('0000'+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(h,i){var c,e,d,g,b,f=gap,a=i[h];switch(a&&'object'==typeof a&&'function'==typeof a.toJSON&&(a=a.toJSON(h)),'function'==typeof rep&&(a=rep.call(i,h,a)),typeof a){case 'string':return quote(a);case 'number':return isFinite(a)?a+'':'null';case 'boolean':case 'null':return a+'';case 'object':if(!a){return 'null'};if(gap+=indent,b=[],'[object Array]'===Object.prototype.toString.apply(a)){for(g=a.length,c=0;g>c;c+=1){b[c]=str(c,a)||'null'}return d=0===b.length?'[]':gap?'[\n'+gap+b.join(',\n'+gap)+'\n'+f+']':'['+b.join(',')+']',gap=f,d};if(rep&&'object'==typeof rep){for(g=rep.length,c=0;g>c;c+=1){'string'==typeof rep[c]&&(e=rep[c],d=str(e,a),d&&b.push(quote(e)+(gap?': ':':')+d))}}else {for(e in a){Object.prototype.hasOwnProperty.call(a,e)&&(d=str(e,a),d&&b.push(quote(e)+(gap?': ':':')+d))}};return d=0===b.length?'{}':gap?'{\n'+gap+b.join(',\n'+gap)+'\n'+f+'}':'{'+b.join(',')+'}',gap=f,d;}}'function'!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;'function'!=typeof JSON.stringify&&(JSON.stringify=function(d,a,b){var c;if(gap='',indent='','number'==typeof b){for(c=0;b>c;c+=1){indent+=' '}}else {'string'==typeof b&&(indent=b)}if(rep=a,a&&'function'!=typeof a&&('object'!=typeof a||'number'!=typeof a.length)){throw Error('JSON.stringify')}return str('',{'':d})}),'function'!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,d){var b,c,a=e[d];if(a&&'object'==typeof a){for(b in a){Object.prototype.hasOwnProperty.call(a,b)&&(c=walk(a,b),void 0!==c?a[b]=c:delete a[b])}}return reviver.call(e,d,a)}var j;if(text+='',cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return '\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){return j=eval('('+text+')'),'function'==typeof reviver?walk({'':j},''):j}throw new SyntaxError('JSON.parse')})}(),Logger={},Logger.log=function(d,a){try{var c='http://alasky.unistra.fr/cgi/AladinLiteLogger/log.py',b='';a&&(b=JSON.stringify(a)),$.ajax({url:c,data:{action:d,params:b,pageUrl:window.location.href,referer:document.referrer?document.referrer:''},method:'GET',dataType:'json'})}catch(e){window.console&&console.log('Exception: '+e)}},function(a){'function'==typeof define&&define.amd?define(['jquery'],a):'object'==typeof exports?module.exports=a:a(jQuery)}(function(a){function e(h){var d=h||window.event,p=j.call(arguments,1),k=0,g=0,e=0,l=0,o=0,q=0;if(h=a.event.fix(d),h.type='mousewheel','detail' in d&&(e=-1*d.detail),'wheelDelta' in d&&(e=d.wheelDelta),'wheelDeltaY' in d&&(e=d.wheelDeltaY),'wheelDeltaX' in d&&(g=-1*d.wheelDeltaX),'axis' in d&&d.axis===d.HORIZONTAL_AXIS&&(g=-1*e,e=0),k=0===e?g:e,'deltaY' in d&&(e=-1*d.deltaY,k=e),'deltaX' in d&&(g=d.deltaX,0===e&&(k=-1*g)),0!==e||0!==g){if(1===d.deltaMode){var m=a.data(this,'mousewheel-line-height');k*=m,e*=m,g*=m}else {if(2===d.deltaMode){var n=a.data(this,'mousewheel-page-height');k*=n,e*=n,g*=n}}if(l=Math.max(Math.abs(e),Math.abs(g)),(!b||b>l)&&(b=l,r(d,l)&&(b/=40)),r(d,l)&&(k/=40,g/=40,e/=40),k=Math[k>=1?'floor':'ceil'](k/b),g=Math[g>=1?'floor':'ceil'](g/b),e=Math[e>=1?'floor':'ceil'](e/b),c.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=h.clientX-s.left,q=h.clientY-s.top}return h.deltaX=g,h.deltaY=e,h.deltaFactor=b,h.offsetX=o,h.offsetY=q,h.deltaMode=0,p.unshift(h,k,g,e),f&&clearTimeout(f),f=setTimeout(i,200),(a.event.dispatch||a.event.handle).apply(this,p)}}function i(){b=null}function r(d,b){return c.settings.adjustOldDeltas&&'mousewheel'===d.type&&0===b%120}var f,b,g=['wheel','mousewheel','DOMMouseScroll','MozMousePixelScroll'],d='onwheel' in document||document.documentMode>=9?['wheel']:['mousewheel','DomMouseScroll','MozMousePixelScroll'],j=Array.prototype.slice;if(a.event.fixHooks){for(var h=g.length;h;){a.event.fixHooks[g[--h]]=a.event.mouseHooks}}var c=a.event.special.mousewheel={version:'3.1.12',setup:function(){if(this.addEventListener){for(var b=d.length;b;){this.addEventListener(d[--b],e,!1)}}else {this.onmousewheel=e}a.data(this,'mousewheel-line-height',c.getLineHeight(this)),a.data(this,'mousewheel-page-height',c.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var b=d.length;b;){this.removeEventListener(d[--b],e,!1)}}else {this.onmousewheel=null}a.removeData(this,'mousewheel-line-height'),a.removeData(this,'mousewheel-page-height')},getLineHeight:function(d){var c=a(d),b=c['offsetParent' in a.fn?'offsetParent':'parent']();return b.length||(b=a('body')),parseInt(b.css('fontSize'),10)||parseInt(c.css('fontSize'),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(b){return b?this.bind('mousewheel',b):this.trigger('mousewheel')},unmousewheel:function(b){return this.unbind('mousewheel',b)}})}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}();var Stats=function(){function t(c,g,e){var f,d,a;for(d=0;30>d;d++){for(f=0;73>f;f++){a=4*(f+74*d),c[a]=c[a+4],c[a+1]=c[a+5],c[a+2]=c[a+6]}}for(d=0;30>d;d++){a=4*(73+74*d),g>d?(c[a]=b[e].bg.r,c[a+1]=b[e].bg.g,c[a+2]=b[e].bg.b):(c[a]=b[e].fg.r,c[a+1]=b[e].fg.g,c[a+2]=b[e].fg.b)}}var c,i,g,a,p,x,e,d,o,y,h,f,n,z,q=0,A=2,B=0,j=(new Date()).getTime(),E=j,C=j,l=0,D=1000,w=0,m=0,r=1000,s=0,k=0,v=1000,u=0,b={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};c=document.createElement('div'),c.style.cursor='pointer',c.style.width='80px',c.style.opacity='0.9',c.style.zIndex='10001',c.addEventListener('click',function(){switch(q++,q==A&&(q=0),i.style.display='none',e.style.display='none',h.style.display='none',q){case 0:i.style.display='block';break;case 1:e.style.display='block';break;case 2:h.style.display='block';}},!1),i=document.createElement('div'),i.style.backgroundColor='rgb('+Math.floor(b.fps.bg.r/2)+','+Math.floor(b.fps.bg.g/2)+','+Math.floor(b.fps.bg.b/2)+')',i.style.padding='2px 0px 3px 0px',c.appendChild(i),g=document.createElement('div'),g.style.fontFamily='Helvetica, Arial, sans-serif',g.style.textAlign='left',g.style.fontSize='9px',g.style.color='rgb('+b.fps.fg.r+','+b.fps.fg.g+','+b.fps.fg.b+')',g.style.margin='0px 0px 1px 3px',g.innerHTML='<span style="font-weight:bold">FPS</span>',i.appendChild(g),a=document.createElement('canvas'),a.width=74,a.height=30,a.style.display='block',a.style.marginLeft='3px',i.appendChild(a),p=a.getContext('2d'),p.fillStyle='rgb('+b.fps.bg.r+','+b.fps.bg.g+','+b.fps.bg.b+')',p.fillRect(0,0,a.width,a.height),x=p.getImageData(0,0,a.width,a.height),e=document.createElement('div'),e.style.backgroundColor='rgb('+Math.floor(b.ms.bg.r/2)+','+Math.floor(b.ms.bg.g/2)+','+Math.floor(b.ms.bg.b/2)+')',e.style.padding='2px 0px 3px 0px',e.style.display='none',c.appendChild(e),d=document.createElement('div'),d.style.fontFamily='Helvetica, Arial, sans-serif',d.style.textAlign='left',d.style.fontSize='9px',d.style.color='rgb('+b.ms.fg.r+','+b.ms.fg.g+','+b.ms.fg.b+')',d.style.margin='0px 0px 1px 3px',d.innerHTML='<span style="font-weight:bold">MS</span>',e.appendChild(d),a=document.createElement('canvas'),a.width=74,a.height=30,a.style.display='block',a.style.marginLeft='3px',e.appendChild(a),o=a.getContext('2d'),o.fillStyle='rgb('+b.ms.bg.r+','+b.ms.bg.g+','+b.ms.bg.b+')',o.fillRect(0,0,a.width,a.height),y=o.getImageData(0,0,a.width,a.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(A=3)}catch(F){}return h=document.createElement('div'),h.style.backgroundColor='rgb('+Math.floor(b.mb.bg.r/2)+','+Math.floor(b.mb.bg.g/2)+','+Math.floor(b.mb.bg.b/2)+')',h.style.padding='2px 0px 3px 0px',h.style.display='none',c.appendChild(h),f=document.createElement('div'),f.style.fontFamily='Helvetica, Arial, sans-serif',f.style.textAlign='left',f.style.fontSize='9px',f.style.color='rgb('+b.mb.fg.r+','+b.mb.fg.g+','+b.mb.fg.b+')',f.style.margin='0px 0px 1px 3px',f.innerHTML='<span style="font-weight:bold">MB</span>',h.appendChild(f),a=document.createElement('canvas'),a.width=74,a.height=30,a.style.display='block',a.style.marginLeft='3px',h.appendChild(a),n=a.getContext('2d'),n.fillStyle='#301010',n.fillRect(0,0,a.width,a.height),z=n.getImageData(0,0,a.width,a.height),{domElement:c,update:function(){B++,j=(new Date()).getTime(),m=j-E,r=Math.min(r,m),s=Math.max(s,m),t(y.data,Math.min(30,30-30*(m/200)),'ms'),d.innerHTML='<span style="font-weight:bold">'+m+' MS</span> ('+r+'-'+s+')',o.putImageData(y,0,0),E=j,j>C+1000&&(l=Math.round(1000*B/(j-C)),D=Math.min(D,l),w=Math.max(w,l),t(x.data,Math.min(30,30-30*(l/100)),'fps'),g.innerHTML='<span style="font-weight:bold">'+l+' FPS</span> ('+D+'-'+w+')',p.putImageData(x,0,0),3==A&&(k=9.54E-7*performance.memory.usedJSHeapSize,v=Math.min(v,k),u=Math.max(u,k),t(z.data,Math.min(30,30-k/2),'mb'),f.innerHTML='<span style="font-weight:bold">'+Math.round(k)+' MB</span> ('+Math.round(v)+'-'+Math.round(u)+')',n.putImageData(z,0,0)),C=j,B=0)}}};Constants={},Constants.PI=Math.PI,Constants.C_PR=Math.PI/180,Constants.VLEV=2,Constants.EPS=1.0E-7,Constants.c=0.105,Constants.LN10=Math.log(10),Constants.PIOVER2=Math.PI/2,Constants.TWOPI=2*Math.PI,Constants.TWOTHIRD=2/3,Constants.ARCSECOND_RADIAN=4.84813681109536E-6,SpatialVector=function(){function t(c,a,b){this.x=c,this.y=a,this.z=b,this.ra_=0,this.dec_=0,this.okRaDec_=!1}return t.prototype.setXYZ=function(c,a,b){this.x=c,this.y=a,this.z=b,this.okRaDec_=!1},t.prototype.length=function(){return Math.sqrt(this.lengthSquared())},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalized=function(){var a=this.length();this.x/=a,this.y/=a,this.z/=a},t.prototype.set=function(b,a){this.ra_=b,this.dec_=a,this.okRaDec_=!0,this.updateXYZ()},t.prototype.angle=function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z,d=this.x*a.y-this.y*a.x,e=Math.sqrt(b*b+c*c+d*d);return Math.abs(Math.atan2(e,dot(a)))},t.prototype.get=function(){return [x,y,z]},t.prototype.toString=function(){return 'SpatialVector['+this.x+', '+this.y+', '+this.z+']'},t.prototype.cross=function(a){return new t(this.y*a.z-a.y*this.z,this.z*a.x-a.z*this.x,this.x*a.y-a.x()*this.y)},t.prototype.equal=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z()?!0:!1},t.prototype.mult=function(a){return new t(a*this.x,a*this.y,a*this.z)},t.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},t.prototype.add=function(a){return new t(this.x+a.x,this.y+a.y,this.z+a.z)},t.prototype.sub=function(a){return new t(this.x-a.x,this.y-a.y,this.z-a.z)},t.prototype.dec=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.dec_},t.prototype.ra=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.ra_},t.prototype.updateXYZ=function(){var a=Math.cos(this.dec_*Constants.C_PR);this.x=Math.cos(this.ra_*Constants.C_PR)*a,this.y=Math.sin(this.ra_*Constants.C_PR)*a,this.z=Math.sin(this.dec_*Constants.C_PR)},t.prototype.updateRaDec=function(){this.dec_=Math.asin(this.z)/Constants.C_PR;var a=Math.cos(this.dec_*Constants.C_PR);this.ra_=a>Constants.EPS||-Constants.EPS>a?this.y>Constants.EPS||this.y<-Constants.EPS?0>this.y?360-Math.acos(this.x/a)/Constants.C_PR:Math.acos(this.x/a)/Constants.C_PR:0>this.x?180:0:0,this.okRaDec_=!0},t.prototype.toRaRadians=function(){var a=0;return (0!=this.x||0!=this.y)&&(a=Math.atan2(this.y,this.x)),0>a&&(a+=2*Math.PI),a},t.prototype.toDeRadians=function(){var b=z/this.length(),a=Math.acos(b);return Math.PI/2-a},t}(),AngularPosition=function(){return AngularPosition=function(b,a){this.theta=b,this.phi=a},AngularPosition.prototype.toString=function(){return 'theta: '+this.theta+', phi: '+this.phi},AngularPosition}(),LongRangeSetBuilder=function(){function t(){this.items=[]}return t.prototype.appendRange=function(c,b){for(var a=c;b>=a;a++){a in this.items||this.items.push(a)}},t}(),HealpixIndex=function(){function t(a){this.nside=a}return t.NS_MAX=8192,t.ORDER_MAX=13,t.NSIDELIST=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192],t.JRLL=[2,2,2,2,3,3,3,3,4,4,4,4],t.JPLL=[1,3,5,7,0,2,4,6,1,3,5,7],t.XOFFSET=[-1,-1,0,1,1,1,0,-1],t.YOFFSET=[0,1,1,1,0,-1,-1,-1],t.FACEARRAY=[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],t.SWAPARRAY=[[0,0,0,0,0,0,0,0,3,3,3,3],[0,0,0,0,0,0,0,0,6,6,6,6],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,5,5,5,5],[0,0,0,0,0,0,0,0,0,0,0,0],[5,5,5,5,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[6,6,6,6,0,0,0,0,0,0,0,0],[3,3,3,3,0,0,0,0,0,0,0,0]],t.Z0=Constants.TWOTHIRD,t.prototype.init=function(){var b=256;this.ctab=Array(b),this.utab=Array(b);for(var a=0;256>a;++a){this.ctab[a]=1&a|(2&a)<<7|(4&a)>>1|(8&a)<<6|(16&a)>>2|(32&a)<<5|(64&a)>>3|(128&a)<<4,this.utab[a]=1&a|(2&a)<<1|(4&a)<<2|(8&a)<<3|(16&a)<<4|(32&a)<<5|(64&a)<<6|(128&a)<<7}this.nl2=2*this.nside,this.nl3=3*this.nside,this.nl4=4*this.nside,this.npface=this.nside*this.nside,this.ncap=2*this.nside*(this.nside-1),this.npix=12*this.npface,this.fact2=4/this.npix,this.fact1=(this.nside<<1)*this.fact2,this.order=t.nside2order(this.nside)},t.calculateNSide=function(e){for(var c=0,k=e*e,g=180/Constants.PI,j=51840000*Constants.PI*g*g,h=Utils.castToInt(j/k),i=h/12,b=Math.sqrt(i),f=t.NS_MAX,d=0,a=0;t.NSIDELIST.length>a;a++){if(f>=Math.abs(b-t.NSIDELIST[a])&&(f=Math.abs(b-t.NSIDELIST[a]),c=t.NSIDELIST[a],d=a),b>c&&t.NS_MAX>b&&(c=t.NSIDELIST[d+1]),b>t.NS_MAX){return console.log('nside cannot be bigger than '+t.NS_MAX),t.NS_MAX}}return c},t.nside2order=function(a){return (a&a-1)>0?-1:Utils.castToInt(t.log2(a))},t.log2=function(a){return Math.log(a)/Math.log(2)},t.prototype.ang2pix_nest=function(l,c){var r,j,n,f,m,d,i,a,b,e,g,h,k;if(c>=Constants.TWOPI&&(c-=Constants.TWOPI),0>c&&(c+=Constants.TWOPI),l>Constants.PI||0>l){throw {name:'Illegal argument',message:'theta must be between 0 and '+Constants.PI}}if(c>Constants.TWOPI||0>c){throw {name:'Illegal argument',message:'phi must be between 0 and '+Constants.TWOPI}}if(j=Math.cos(l),n=Math.abs(j),f=c/Constants.PIOVER2,t.Z0>=n){var o=this.nside*(0.5+f),p=0.75*this.nside*j,a=o-p,b=o+p;d=a>>this.order,i=b>>this.order,g=d==i?4==d?4:d+4:i>d?d:i+8,h=Utils.castToInt(b&this.nside-1),k=Utils.castToInt(this.nside-(a&this.nside-1)-1)}else {e=Utils.castToInt(f),e>=4&&(e=3),m=f-e;var q=this.nside*Math.sqrt(3*(1-n));a=Utils.castToInt(m*q),b=Utils.castToInt((1-m)*q),a=Math.min(t.NS_MAX-1,a),b=Math.min(t.NS_MAX-1,b),j>=0?(g=e,h=Utils.castToInt(this.nside-b-1),k=Utils.castToInt(this.nside-a-1)):(g=e+8,h=a,k=b)}return r=this.xyf2nest(h,k,g)},t.prototype.xyf2nest=function(b,a,c){return (c<<2*this.order)+(this.utab[255&b]|this.utab[255&b>>8]<<16|this.utab[255&b>>16]<<32|this.utab[255&b>>24]<<48|this.utab[255&a]<<1|this.utab[255&a>>8]<<17|this.utab[255&a>>16]<<33|this.utab[255&a>>24]<<49)},t.prototype.nest2xyf=function(d){var c={};c.face_num=d>>2*this.order;var a=d&this.npface-1,b=(9.382356058112E13&a)>>16|(6.1488208662442803E18&a)>>31|21845&a|(1431633920&a)>>15;return c.ix=this.ctab[255&b]|this.ctab[255&b>>8]<<4|this.ctab[255&b>>16]<<16|this.ctab[255&b>>24]<<20,a>>=1,b=(9.382356058112E13&a)>>16|(6.1488208662442803E18&a)>>31|21845&a|(1431633920&a)>>15,c.iy=this.ctab[255&b]|this.ctab[255&b>>8]<<4|this.ctab[255&b>>16]<<16|this.ctab[255&b>>24]<<20,c},t.prototype.pix2ang_nest=function(f){if(0>f||f>this.npix-1){throw {name:'Illegal argument',message:'ipix out of range'}}var a,e,c,g=this.nest2xyf(f),h=g.ix,j=g.iy,i=g.face_num,b=(t.JRLL[i]<<this.order)-h-j-1;this.nside>b?(a=b,e=1-a*a*this.fact2,c=0):b>this.nl3?(a=this.nl4-b,e=a*a*this.fact2-1,c=0):(a=this.nside,e=(this.nl2-b)*this.fact1,c=1&b-this.nside);var k=Math.acos(e),d=(t.JPLL[i]*a+h-j+1+c)/2;d>this.nl4&&(d-=this.nl4),1>d&&(d+=this.nl4);var l=(d-0.5*(c+1))*(Constants.PIOVER2/a);return {theta:k,phi:l}},t.nside2Npix=function(a){if(0>a||(a&-a)!=a||a>t.NS_MAX){throw {name:'Illegal argument',message:'nside should be >0, power of 2, <'+t.NS_MAX}}var b=12*a*a;return b},t.prototype.xyf2ring=function(f,g,h){var a,e,d,b=t.JRLL[h]*this.nside-f-g-1;this.nside>b?(a=b,d=2*a*(a-1),e=0):b>3*this.nside?(a=this.nl4-b,d=this.npix-2*(a+1)*a,e=0):(a=this.nside,d=this.ncap+(b-this.nside)*this.nl4,e=1&b-this.nside);var c=(t.JPLL[h]*a+f-g+1+e)/2;return c>this.nl4?c-=this.nl4:1>c&&(c+=this.nl4),d+c-1},t.prototype.nest2ring=function(c){var a=this.nest2xyf(c),b=this.xyf2ring(a.ix,a.iy,a.face_num);return b},t.prototype.corners_nest=function(c,a){var b=this.nest2ring(c);return this.corners_ring(b,a)},t.prototype.pix2ang_ring=function(d){var f,g,a,c,b,e,j,h,i;if(0>d||d>this.npix-1){throw {name:'Illegal argument',message:'ipix out of range'}}return e=d+1,this.ncap>=e?(h=e/2,i=Utils.castToInt(h),a=Utils.castToInt(Math.sqrt(h-Math.sqrt(i)))+1,c=e-2*a*(a-1),f=Math.acos(1-a*a*this.fact2),g=(c-0.5)*Constants.PI/(2*a)):this.npix-this.ncap>d?(b=d-this.ncap,a=b/this.nl4+this.nside,c=b%this.nl4+1,j=(1&a+this.nside)>0?1:0.5,f=Math.acos((this.nl2-a)*this.fact1),g=(c-j)*Constants.PI/this.nl2):(b=this.npix-d,a=Utils.castToInt(0.5*(1+Math.sqrt(2*b-1))),c=4*a+1-(b-2*a*(a-1)),f=Math.acos(-1+Math.pow(a,2)*this.fact2),g=(c-0.5)*Constants.PI/(2*a)),[f,g]},t.prototype.ring=function(f){var d,a,b=0,c=f+1,e=0;return this.ncap>=c?(a=c/2,e=Utils.castToInt(a),b=Utils.castToInt(Math.sqrt(a-Math.sqrt(e)))+1):this.nl2*(5*this.nside+1)>=c?(d=Utils.castToInt(c-this.ncap-1),b=Utils.castToInt(d/this.nl4+this.nside)):(d=this.npix-c+1,a=d/2,e=Utils.castToInt(a),b=Utils.castToInt(Math.sqrt(a-Math.sqrt(e)))+1,b=this.nl4-b),b},t.prototype.integration_limits_in_costh=function(a){var c,d,e,b;return b=1*this.nside,this.nside>=a?(d=1-Math.pow(a,2)/3/this.npface,e=1-Math.pow(a-1,2)/3/this.npface,c=a==this.nside?2*(this.nside-1)/3/b:1-Math.pow(a+1,2)/3/this.npface):this.nl3>a?(d=2*(2*this.nside-a)/3/b,e=2*(2*this.nside-a+1)/3/b,c=2*(2*this.nside-a-1)/3/b):(e=a==this.nl3?2*(-this.nside+1)/3/b:-1+Math.pow(4*this.nside-a+1,2)/3/this.npface,c=-1+Math.pow(this.nl4-a-1,2)/3/this.npface,d=-1+Math.pow(this.nl4-a,2)/3/this.npface),[e,d,c]},t.prototype.pixel_boundaries=function(m,f,d,k){var n,a,b,i,c,h,e,l,j=1*this.nside;if(Math.abs(k)>=1-1/3/this.npface){return e=d*Constants.PIOVER2,l=(d+1)*Constants.PIOVER2,[e,l]}if(1.5*k>=1){n=Math.sqrt(3*(1-k)),a=1/j/n,b=f,i=b-1,c=m-f,h=c+1,e=Constants.PIOVER2*(Math.max(i*a,1-h*a)+d),l=Constants.PIOVER2*(Math.min(1-c*a,b*a)+d)}else {if(1.5*k>-1){var o=0.5*(1-1.5*k),p=o+1,q=this.nside+m%2;b=f-(q-m)/2,i=b-1,c=(q+m)/2-f,h=c+1,e=Constants.PIOVER2*(Math.max(p-h/j,-o+i/j)+d),l=Constants.PIOVER2*(Math.min(p-c/j,-o+b/j)+d)}else {n=Math.sqrt(3*(1+k)),a=1/j/n;var g=2*this.nside;b=m-g+f,i=b-1,c=g-f,h=c+1,e=Constants.PIOVER2*(Math.max(1-(g-i)*a,(g-h)*a)+d),l=Constants.PIOVER2*(Math.min(1-(g-b)*a,(g-c)*a)+d)}}return [e,l]},t.vector=function(a,b){var c=1*Math.sin(a)*Math.cos(b),d=1*Math.sin(a)*Math.sin(b),e=1*Math.cos(a);return new SpatialVector(c,d,e)},t.prototype.corners_ring=function(q,h){var n=2*h+2,e=Array(n),m=this.pix2ang_ring(q),j=Math.cos(m[0]),l=m[0],k=m[1],f=Utils.castToInt(k/Constants.PIOVER2),b=this.ring(q),i=Math.min(b,Math.min(this.nside,this.nl4-b)),d=0,p=Constants.PIOVER2/i;d=b>=this.nside&&this.nl3>=b?Utils.castToInt(k/p+b%2/2)+1:Utils.castToInt(k/p)+1,d-=f*i;var v=n/2,c=this.integration_limits_in_costh(b),r=Math.acos(c[0]),s=Math.acos(c[2]),a=this.pixel_boundaries(b,d,f,c[0]);if(e[0]=d>i/2?t.vector(r,a[1]):t.vector(r,a[0]),a=this.pixel_boundaries(b,d,f,c[2]),e[v]=d>i/2?t.vector(s,a[1]):t.vector(s,a[0]),1==h){var o=Math.acos(c[1]);a=this.pixel_boundaries(b,d,f,c[1]),e[1]=t.vector(o,a[0]),e[3]=t.vector(o,a[1])}else {for(var w=c[2]-c[0],u=w/(h+1),g=1;h>=g;g++){j=c[0]+u*g,l=Math.acos(j),a=this.pixel_boundaries(b,d,f,j),e[g]=t.vector(l,a[0]),e[n-g]=t.vector(l,a[1])}}return e},t.vec2Ang=function(a){var c=a.z/a.length(),d=Math.acos(c),b=0;return (0!=a.x||0!=a.y)&&(b=Math.atan2(a.y,a.x)),0>b&&(b+=2*Math.PI),[d,b]},t.prototype.queryDisc=function(D,q,E,F){if(0>q||q>Constants.PI){throw {name:'Illegal argument',message:'angular radius is in RADIAN and should be in [0,pi]'}}var f,c,a,i,d,g,B,A,h,y,r,z,j,s,p,C,u,k,x,e=new LongRangeSetBuilder(),m=null,d=q;if(F&&(d+=Constants.PI/this.nl4),m=t.vec2Ang(D),g=m[0],B=m[1],r=this.fact2,z=this.fact1,i=Math.cos(g),x=1/Math.sqrt((1-i)*(1+i)),s=g-d,p=g+d,A=Math.cos(d),u=Math.cos(s),f=this.ringAbove(u)+1,C=Math.cos(p),c=this.ringAbove(C),f>c&&0==c&&(c=f),0>=s){for(var b=1;f>b;++b){this.inRing(b,0,Math.PI,e)}}for(a=f;c>=a;++a){k=this.nside>a?1-a*a*r:this.nl3>=a?(this.nl2-a)*z:-1+(this.nl4-a)*(this.nl4-a)*r,h=(A-k*i)*x,y=1-k*k-h*h,j=Math.atan2(Math.sqrt(y),h),isNaN(j)&&(j=d),this.inRing(a,B,j,e)}if(p>=Math.PI){for(var b=c+1;this.nl4>b;++b){this.inRing(b,0,Math.PI,e,!1)}}var l;if(E){for(var w=e.items,o=[],n=0;w.length>n;n++){var v=this.ring2nest(w[n]);o.indexOf(v)>=0||o.push(v)}l=o}else {l=e.items}return l},t.prototype.inRing=function(g,l,j,i,r){var m,d,c,f,p=!1,n=!1,k=1.0E-12,h=0,e=0,a=0,b=0,o=(l-j)%Constants.TWOPI-k,q=l+j+k,s=(l+j)%Constants.TWOPI+k;if(k>Math.abs(j-Constants.PI)&&(p=!0),g>=this.nside&&this.nl3>=g?(e=g-this.nside+1,c=this.ncap+this.nl4*(e-1),f=c+this.nl4-1,m=e%2,d=this.nl4):(this.nside>g?(e=g,c=2*e*(e-1),f=c+4*e-1):(e=4*this.nside-g,c=this.npix-2*e*(e+1),f=c+4*e-1),d=4*e,m=1),p){return i.appendRange(c,f),void 0}if(h=m/2,r){a=Math.round(d*o/Constants.TWOPI-h),b=Math.round(d*q/Constants.TWOPI-h),a%=d,b>d&&(b%=d)}else {if(a=Math.ceil(d*o/Constants.TWOPI-h),b=Utils.castToInt(d*s/Constants.TWOPI-h),a>b&&1==g&&(b=Utils.castToInt(d*q/Constants.TWOPI-h)),a==b+1&&(a=b),1==a-b&&Constants.PI>j*d){return console.log('the interval is too small and avay from center'),void 0}a=Math.min(a,d-1),b=Math.max(b,0)}if(a>b&&(n=!0),n){a+=c,b+=c,i.appendRange(c,b),i.appendRange(a,f)}else {if(0>a){return a=Math.abs(a),i.appendRange(c,c+b),i.appendRange(f-a+1,f),void 0}a+=c,b+=c,i.appendRange(a,b)}},t.prototype.ringAbove=function(a){var b=Math.abs(a);if(b>Constants.TWOTHIRD){var c=Utils.castToInt(this.nside*Math.sqrt(3*(1-b)));return a>0?c:4*this.nside-c-1}return Utils.castToInt(this.nside*(2-1.5*a))},t.prototype.ring2nest=function(b){var a=this.ring2xyf(b);return this.xyf2nest(a.ix,a.iy,a.face_num)},t.prototype.ring2xyf=function(h){var a,c,k,g,b={};if(this.ncap>h){a=Utils.castToInt(0.5*(1+Math.sqrt(1+2*h))),c=h+1-2*a*(a-1),k=0,g=a,b.face_num=0;var f=c-1;f>=2*a&&(b.face_num=2,f-=2*a),f>=a&&++b.face_num}else {if(this.npix-this.ncap>h){var e=h-this.ncap;this.order>=0?(a=(e>>this.order+2)+this.nside,c=(e&this.nl4-1)+1):(a=e/this.nl4+this.nside,c=e%this.nl4+1),k=1&a+this.nside,g=this.nside;var i,d,l=a-this.nside+1,n=this.nl2+2-l;this.order>=0?(i=c-Utils.castToInt(l/2)+this.nside-1>>this.order,d=c-Utils.castToInt(n/2)+this.nside-1>>this.order):(i=(c-Utils.castToInt(l/2)+this.nside-1)/this.nside,d=(c-Utils.castToInt(n/2)+this.nside-1)/this.nside),b.face_num=d==i?4==d?4:Utils.castToInt(d)+4:i>d?Utils.castToInt(d):Utils.castToInt(i)+8}else {var e=this.npix-h;a=Utils.castToInt(0.5*(1+Math.sqrt(2*e-1))),c=4*a+1-(e-2*a*(a-1)),k=0,g=a,a=2*this.nl2-a,b.face_num=8;var f=c-1;f>=2*g&&(b.face_num=10,f-=2*g),f>=g&&++b.face_num}}var m=a-t.JRLL[b.face_num]*this.nside+1,j=2*c-t.JPLL[b.face_num]*g-k-1;return j>=this.nl2&&(j-=8*this.nside),b.ix=j-m>>1,b.iy=-(j+m)>>1,b},t}(),Utils=function(){},Utils.radecToPolar=function(b,a){return {theta:Math.PI/2-a/180*Math.PI,phi:b/180*Math.PI}},Utils.polarToRadec=function(b,a){return {ra:180*a/Math.PI,dec:180*(Math.PI/2-b)/Math.PI}},Utils.castToInt=function(a){return a>0?Math.floor(a):Math.ceil(a)},AstroMath.D2R=Math.PI/180,AstroMath.R2D=180/Math.PI,AstroMath.sign=function(a){return a>0?1:0>a?-1:0},AstroMath.cosd=function(a){if(0==a%90){var b=Math.abs(Math.floor(a/90+0.5))%4;switch(b){case 0:return 1;case 1:return 0;case 2:return -1;case 3:return 0;}}return Math.cos(a*AstroMath.D2R)},AstroMath.sind=function(a){if(0===a%90){var b=Math.abs(Math.floor(a/90-0.5))%4;switch(b){case 0:return 1;case 1:return 0;case 2:return -1;case 3:return 0;}}return Math.sin(a*AstroMath.D2R)},AstroMath.tand=function(b){var a;return a=b%360,0==a||180==Math.abs(a)?0:45==a||225==a?1:-135==a||-315==a?-1:Math.tan(b*AstroMath.D2R)},AstroMath.asind=function(a){return Math.asin(a)*AstroMath.R2D},AstroMath.acosd=function(a){return Math.acos(a)*AstroMath.R2D},AstroMath.atand=function(a){return Math.atan(a)*AstroMath.R2D},AstroMath.atan2=function(c,a){if(0==c){return a>0?0:0>a?Math.PI:0/0}var b=AstroMath.sign(c);if(0==a){return Math.PI/2*b}var d=Math.atan(Math.abs(c/a));return a>0?d*b:0>a?(Math.PI-d)*b:void 0},AstroMath.atan2d=function(b,a){return AstroMath.atan2(b,a)*AstroMath.R2D},AstroMath.cosh=function(a){return (Math.exp(a)+Math.exp(-a))/2},AstroMath.sinh=function(a){return (Math.exp(a)-Math.exp(-a))/2},AstroMath.tanh=function(a){return (Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},AstroMath.acosh=function(a){return Math.log(a+Math.sqrt(a*a-1))},AstroMath.asinh=function(a){return Math.log(a+Math.sqrt(a*a+1))},AstroMath.atanh=function(a){return 0.5*Math.log((1+a)/(1-a))},AstroMath.sinc=function(c){var b,a=Math.abs(c);return 0.001>=a?(a*=a,b=1-a*(1-a/20)/6):b=Math.sin(a)/a,b},AstroMath.asinc=function(c){var b,a=Math.abs(c);return 0.001>=a?(a*=a,b=1+a*(6+0.45*a)/6):b=Math.asin(a)/a,b},AstroMath.hypot=function(b,a){return Math.sqrt(b*b+a*a)},AstroMath.eulerMatrix=function(j,h,i){var a=Array(3);a[0]=Array(3),a[1]=Array(3),a[2]=Array(3);var b=AstroMath.cosd(j),e=AstroMath.sind(j),c=AstroMath.cosd(h),g=AstroMath.sind(h),d=AstroMath.cosd(i),f=AstroMath.sind(i);return a[0][0]=d*c*b-f*e,a[0][1]=-f*c*b-d*e,a[0][2]=-g*b,a[1][0]=d*c*e+f*b,a[1][1]=-f*c*e+d*b,a[1][2]=-g*e,a[2][0]=-g*d,a[2][1]=-g*b,a[2][2]=c,a},AstroMath.displayMatrix=function(c){for(var d=c.length,f=0,a=0;d>a;a++){c[a].length>f&&(f=c[a].length)}for(var b='<table>\n',a=0;d>a;a++){b+='<tr>';for(var e=0;d>e;e++){b+='<td>',c[a].length>a&&(b+=''+c[a][e]),b+='</td>'}b+='</td>\n'}return b+='</table>\n'},Projection.PROJ_TAN=1,Projection.PROJ_TAN2=2,Projection.PROJ_STG=2,Projection.PROJ_SIN=3,Projection.PROJ_SIN2=4,Projection.PROJ_ZEA=4,Projection.PROJ_ARC=5,Projection.PROJ_SCHMIDT=5,Projection.PROJ_AITOFF=6,Projection.PROJ_AIT=6,Projection.PROJ_GLS=7,Projection.PROJ_MERCATOR=8,Projection.PROJ_MER=8,Projection.PROJ_LAM=9,Projection.PROJ_LAMBERT=9,Projection.PROJ_TSC=10,Projection.PROJ_QSC=11,Projection.PROJ_LIST=['Mercator',Projection.PROJ_MERCATOR,'Gnomonic',Projection.PROJ_TAN,'Stereographic',Projection.PROJ_TAN2,'Orthographic',Projection.PROJ_SIN,'Zenithal',Projection.PROJ_ZEA,'Schmidt',Projection.PROJ_SCHMIDT,'Aitoff',Projection.PROJ_AITOFF,'Lambert',Projection.PROJ_LAMBERT],Projection.PROJ_NAME=['-','Gnomonic','Stereographic','Orthographic','Equal-area','Schmidt plates','Aitoff','Global sin','Mercator','Lambert'],Projection.prototype={setCenter:function(b,a){this.ROT=this.tr_oR(b,a)},setProjection:function(a){this.PROJECTION=a},project:function(e,b){var c=this.tr_ou(e,b),d=this.tr_uu(c,this.ROT),a=this.tr_up(this.PROJECTION,d);return null==a?null:{X:-a[0],Y:-a[1]}},unproject:function(b,a){b=-b,a=-a;var d=this.tr_pu(this.PROJECTION,b,a),e=this.tr_uu1(d,this.ROT),c=this.tr_uo(e);return {ra:c[0],dec:c[1]}},tr_up:function(j,i){var f,c,e,a,b,d=i[0],g=i[1],h=i[2];if(f=AstroMath.hypot(d,g),0==f&&0==h){return null}switch(j){default:e=null;break;case Projection.PROJ_AITOFF:c=Math.sqrt(f*(f+d)/2),a=Math.sqrt(2*f*(f-d)),c=Math.sqrt((1+c)/2),a/=c,b=h/c,0>g&&(a=-a),e=[a,b];break;case Projection.PROJ_GLS:b=Math.asin(h),a=0!=f?Math.atan2(g,d)*f:0,e=[a,b];break;case Projection.PROJ_MERCATOR:0!=f?(a=Math.atan2(g,d),b=AstroMath.atanh(h),e=[a,b]):e=null;break;case Projection.PROJ_TAN:d>0?(a=g/d,b=h/d,e=[a,b]):e=null;break;case Projection.PROJ_TAN2:c=(1+d)/2,c>0?(a=g/c,b=h/c,e=[a,b]):e=null;break;case Projection.PROJ_ARC:-1>=d?(a=Math.PI,b=0):(f=AstroMath.hypot(g,h),c=d>0?AstroMath.asinc(f):Math.acos(d)/f,a=g*c,b=h*c),e=[a,b];break;case Projection.PROJ_SIN:d>=0?(a=g,b=h,e=[a,b]):e=null;break;case Projection.PROJ_SIN2:c=Math.sqrt((1+d)/2),0!=c?(a=g/c,b=h/c):(a=2,b=0),e=[a,b];break;case Projection.PROJ_LAMBERT:b=h,a=0,0!=f&&(a=Math.atan2(g,d)),e=[a,b];}return e},tr_pu:function(h,c,d){var a,b,f,e,g;switch(h){default:return null;case Projection.PROJ_AITOFF:if(a=c*c/8+d*d/2,a>1){return null};f=1-a,b=Math.sqrt(1-a/2),e=c*b/2,g=d*b,a=AstroMath.hypot(f,e),0!=a&&(b=f,f=(b*b-e*e)/a,e=2*b*e/a);break;case Projection.PROJ_GLS:if(g=Math.sin(d),a=1-g*g,0>a){return null};a=Math.sqrt(a),b=0!=a?c/a:0,f=a*Math.cos(b),e=a*Math.sin(b);break;case Projection.PROJ_MERCATOR:g=AstroMath.tanh(d),a=1/AstroMath.cosh(d),f=a*Math.cos(c),e=a*Math.sin(c);break;case Projection.PROJ_LAMBERT:if(g=d,a=1-g*g,0>a){return null};a=Math.sqrt(a),f=a*Math.cos(c),e=a*Math.sin(c);break;case Projection.PROJ_TAN:f=1/Math.sqrt(1+c*c+d*d),e=c*f,g=d*f;break;case Projection.PROJ_TAN2:a=(c*c+d*d)/4,b=1+a,f=(1-a)/b,e=c/b,g=d/b;break;case Projection.PROJ_ARC:if(a=AstroMath.hypot(c,d),a>Math.PI){return null};b=AstroMath.sinc(a),f=Math.cos(a),e=b*c,g=b*d;break;case Projection.PROJ_SIN:if(b=1-c*c-d*d,0>b){return null};f=Math.sqrt(b),e=c,g=d;break;case Projection.PROJ_SIN2:if(a=(c*c+d*d)/4,a>1){return null};b=Math.sqrt(1-a),f=1-2*a,e=b*c,g=b*d;}return [f,e,g]},tr_oR:function(c,b){var a=Array(3);return a[0]=Array(3),a[1]=Array(3),a[2]=Array(3),a[2][2]=AstroMath.cosd(b),a[0][2]=AstroMath.sind(b),a[1][1]=AstroMath.cosd(c),a[1][0]=-AstroMath.sind(c),a[1][2]=0,a[0][0]=a[2][2]*a[1][1],a[0][1]=-a[2][2]*a[1][0],a[2][0]=-a[0][2]*a[1][1],a[2][1]=a[0][2]*a[1][0],a},tr_ou:function(d,b){var a=Array(3),c=AstroMath.cosd(b);return a[0]=c*AstroMath.cosd(d),a[1]=c*AstroMath.sind(d),a[2]=AstroMath.sind(b),a},tr_uu:function(f,a){var b=Array(3),d=f[0],e=f[1],c=f[2];return b[0]=a[0][0]*d+a[0][1]*e+a[0][2]*c,b[1]=a[1][0]*d+a[1][1]*e+a[1][2]*c,b[2]=a[2][0]*d+a[2][1]*e+a[2][2]*c,b},tr_uu1:function(f,a){var b=Array(3),d=f[0],e=f[1],c=f[2];return b[0]=a[0][0]*d+a[1][0]*e+a[2][0]*c,b[1]=a[0][1]*d+a[1][1]*e+a[2][1]*c,b[2]=a[0][2]*d+a[1][2]*e+a[2][2]*c,b},tr_uo:function(f){var a,b,d=f[0],e=f[1],c=f[2],g=d*d+e*e;if(0==g){if(0==c){return null}a=0,b=c>0?90:-90}else {b=AstroMath.atand(c/Math.sqrt(g)),a=AstroMath.atan2d(e,d),0>a&&(a+=360)}return [a,b]}},Coo.factor=[3600,60,1],Coo.prototype={setFrame:function(a){this.frame=a},computeDirCos:function(){var a=AstroMath.cosd(this.lat);this.x=a*AstroMath.cosd(this.lon),this.y=a*AstroMath.sind(this.lon),this.z=AstroMath.sind(this.lat)},computeLonLat:function(){var a=this.x*this.x+this.y*this.y;this.lon=0,0==a?0==this.z?(this.lon=0/0,this.lat=0/0):this.lat=this.z>0?90:-90:(this.lon=AstroMath.atan2d(this.y,this.x),this.lat=AstroMath.atan2d(this.z,Math.sqrt(a)),0>this.lon&&(this.lon+=360))},dist2:function(b){var a=b.x-this.x,c=a*a;return a=b.y-this.y,c+=a*a,a=b.z-this.z,c+=a*a},distance:function(a){return 0==a.x&&0==a.y&&0==a.z?0/0:0==this.x&&0==this.y&&0==this.z?0/0:2*AstroMath.asind(0.5*Math.sqrt(this.dist2(a)))},convertTo:function(a){this.frame.equals(a)||(this.frame.toICRS(this.coo),a.fromICRS(this.coo),this.frame=a,this.lon=this.lat=0/0)},rotate:function(a){var b,c,d;a!=Umatrix3&&(b=a[0][0]*this.x+a[0][1]*this.y+a[0][2]*this.z,c=a[1][0]*this.x+a[1][1]*this.y+a[1][2]*this.z,d=a[2][0]*this.x+a[2][1]*this.y+a[2][2]*this.z,this.x=b,this.y=c,this.z=d,this.lon=this.lat=0/0)},rotate_1:function(a){var b,c,d;a!=Umatrix3&&(b=a[0][0]*this.x+a[1][0]*this.y+a[2][0]*this.z,c=a[0][1]*this.x+a[1][1]*this.y+a[2][1]*this.z,d=a[0][2]*this.x+a[1][2]*this.y+a[2][2]*this.z,this.x=b,this.y=c,this.z=d,this.lon=this.lat=0/0)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z},parse:function(b){var a=b.indexOf('+');if(0>a&&(a=b.indexOf('-')),0>a&&(a=b.indexOf(' ')),0>a){return this.lon=0/0,this.lat=0/0,this.prec=0,!1}var c=b.substring(0,a),d=b.substring(a);return this.lon=this.parseLon(c),this.lat=this.parseLat(d),!0},parseLon:function(a){var a=a.trim();if(a=a.replace(/:/g,' '),0>a.indexOf(' ')){var f=a.indexOf('.');return this.prec=0>f?0:a.length-f-1,parseFloat(a)}for(var g=new Tokenizer(a,' '),e=0,h=0,c=0;g.hasMore();){var d=g.nextToken(),b=d.indexOf('.');switch(h+=parseFloat(d)*Coo.factor[e],e){case 0:c=0>b?1:2;break;case 1:c=0>b?3:4;break;case 2:c=0>b?5:4+d.length-b;default:}e++}return this.prec=c,15*h/3600},parseLat:function(a){var a=a.trim();a=a.replace(/:/g,' ');var b;if('-'==a.charAt(0)?(b=-1,a=a.substring(1)):'-'==a.charAt(0)?(b=1,a=a.substring(1)):b=1,0>a.indexOf(' ')){var g=a.indexOf('.');return this.prec=0>g?0:a.length-g-1,parseFloat(a)*b}for(var i=new Tokenizer(a,' '),f=0,h=0,c=0;i.hasMore();){var e=i.nextToken(),d=e.indexOf('.');switch(h+=parseFloat(e)*Coo.factor[f],f){case 0:c=0>d?1:2;break;case 1:c=0>d?3:4;break;case 2:c=0>d?5:4+e.length-d;default:}f++}return this.prec=c,h*b/3600},format:function(c){isNaN(this.lon)&&this.computeLonLat();var b='',a='';if(c.indexOf('d')>=0){b=Numbers.format(this.lon,this.prec),a=Numbers.format(this.lat,this.prec)}else {var d=this.lon/15,b=Numbers.toSexagesimal(d,this.prec+1,!1),a=Numbers.toSexagesimal(this.lat,this.prec,!1)}return this.lat>0&&(a='+'+a),c.indexOf('/')>=0?b+' '+a:c.indexOf('2')>=0?[b,a]:b+a}},Tokenizer.prototype={hasMore:function(){return this.pos<this.string.length},nextToken:function(){for(var b=this.pos;this.string.length>b&&this.string.charAt(b)==this.sep;){b++}for(var a=b;this.string.length>a&&this.string.charAt(a)!=this.sep;){a++}return this.pos=a,this.string.substring(b,a)}},Strings.trim=function(b,d){for(var a=0,c=b.length-1;b.length>a&&b.charAt(a)==d;){a++}if(a==b.length){return ''}for(;c>a&&b.charAt(c)==d;){c--}return b.substring(a,c+1)},Numbers.pow10=[1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000,1.0E10,1.0E11,1.0E12,1.0E13,1.0E14],Numbers.rndval=[0.5,0.05,0.005,5.0E-4,5.0E-5,5.0E-6,5.0E-7,5.0E-8,5.0E-9,5.0E-10,5.0E-11,5.0E-12,5.0E-13,5.0E-14,5.0E-14],Numbers.format=function(d,b){if(0>=b){return ''+Math.round(d)}var a=''+d,c=a.indexOf('.'),f=c>=0?a.length-c-1:0;if(b>=f){0>c&&(a+='.');for(var e=0;b-f>e;e++){a+='0'}return a}return a=''+(d+Numbers.rndval[b]),a.substr(0,c+b+1)},Numbers.toSexagesimal=function(h,g,i){var e=0>h?'-':i?'+':'',b=Math.abs(h);switch(g){case 1:var a=Math.round(b);return e+(''+a);case 2:return e+Numbers.format(b,1);case 3:var a=Math.floor(b),c=Math.round(60*(b-a));return e+a+' '+c;case 4:var a=Math.floor(b),c=60*(b-a);return e+a+' '+Numbers.format(c,1);case 5:var a=Math.floor(b),c=60*(b-a),d=Math.floor(c),f=Math.round(60*(c-d));return e+a+' '+d+' '+f;case 6:case 7:case 8:var a=Math.floor(b);10>a&&(a='0'+a);var c=60*(b-a),d=Math.floor(c);10>d&&(d='0'+d);var f=60*(c-d);return e+a+' '+d+' '+Numbers.format(f,g-5);default:return e+Numbers.format(b,1);}},CooConversion=function(){var a={};return a.GALACTIC_TO_J2000=[-0.0548755604024359,0.4941094279435681,-0.867666148981161,-0.8734370902479237,-0.4448296299195045,-0.1980763734646737,-0.4838350155267381,0.7469822444763707,0.4559837762325372],a.J2000_TO_GALACTIC=[-0.0548755604024359,-0.873437090247923,-0.4838350155267381,0.4941094279435681,-0.4448296299195045,0.7469822444763707,-0.867666148981161,-0.1980763734646737,0.4559837762325372],a.Transform=function(e,b){e[0]=e[0]*Math.PI/180,e[1]=e[1]*Math.PI/180;var c=[Math.cos(e[0])*Math.cos(e[1]),Math.sin(e[0])*Math.cos(e[1]),Math.sin(e[1])],d=[c[0]*b[0]+c[1]*b[1]+c[2]*b[2],c[0]*b[3]+c[1]*b[4]+c[2]*b[5],c[0]*b[6]+c[1]*b[7]+c[2]*b[8]],f=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),a=[0,0];a[1]=Math.asin(d[2]/f);var g=d[0]/f/Math.cos(a[1]),h=d[1]/f/Math.cos(a[1]);return a[0]=Math.atan2(h,g),0>a[0]&&(a[0]=a[0]+2*Math.PI),a[0]=180*a[0]/Math.PI,a[1]=180*a[1]/Math.PI,a},a.GalacticToJ2000=function(b){return a.Transform(b,a.GALACTIC_TO_J2000)},a.J2000ToGalactic=function(b){return a.Transform(b,a.J2000_TO_GALACTIC)},a}(),Sesame=function(){return Sesame={},Sesame.cache={},Sesame.SESAME_URL='http://cds.unistra.fr/cgi-bin/nph-sesame.jsonp?',Sesame.getTargetRADec=function(c,a,d){if(a){var e=/[a-zA-Z]/.test(c);if(e){Sesame.resolve(c,function(b){a({ra:b.Target.Resolver.jradeg,dec:b.Target.Resolver.jdedeg})},function(){d&&d()})}else {var b=new Coo();b.parse(c),a&&a({ra:b.lon,dec:b.lat})}}},Sesame.resolve=function(d,b,a){var c=Sesame.SESAME_URL;$.ajax({url:c,data:{object:d},method:'GET',dataType:'jsonp',success:function(c){c.Target&&c.Target.Resolver&&c.Target.Resolver?b(c):a(c)},error:a})},Sesame}(),HealpixCache=function(){var a={};return a.staticCache={corners:{nside8:[]}},a.dynamicCache={},a.lastNside=8,a.hpxIdxCache=null,a.init=function(){var b=new HealpixIndex(8);b.init();for(var d,e=HealpixIndex.nside2Npix(8),c=0;e>c;c++){d=b.corners_nest(c,1),a.staticCache.corners.nside8.push(d)}a.hpxIdxCache=b},a.init(),a.corners_nest=function(c,b){return 8==b?a.staticCache.corners.nside8[c]:(b!=a.lastNside&&(a.hpxIdxCache=new HealpixIndex(b),a.hpxIdxCache.init(),a.lastNside=b),a.hpxIdxCache.corners_nest(c,1))},a}(),Utils=Utils||{},Utils.cssScale=void 0,HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords,Function.prototype.bind||(Function.prototype.bind=function(f){if('function'!=typeof this){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable')}var a=[].slice,c=a.call(arguments,1),d=this,e=function(){},b=function(){return d.apply(this instanceof e?this:f||{},c.concat(a.call(arguments)))};return b.prototype=this.prototype,b}),$=$||jQuery,$.urlParam=function(b,a){return void 0===a&&(a=location.search),decodeURIComponent((RegExp('[?|&]'+b+'='+'([^&;]+?)(&|#|;|$)').exec(a)||[''])[1].replace(/\+/g,'%20'))||null},Utils.isNumber=function(a){return !isNaN(parseFloat(a))&&isFinite(a)},Utils.isInt=function(a){return Utils.isNumber(a)&&Math.floor(a)==a},Utils.debounce=function(c,b){var a=null;return function(){var d=this,e=arguments;clearTimeout(a),a=setTimeout(function(){c.apply(d,e)},b)}},Utils.throttle=function(d,a,e){a||(a=250);var b,c;return function(){var h=e||this,f=+new Date(),g=arguments;b&&b+a>f?(clearTimeout(c),c=setTimeout(function(){b=f,d.apply(h,g)},a)):(b=f,d.apply(h,g))}},Utils.LRUCache=function(a){this._keys=[],this._items={},this._expires={},this._size=0,this._maxsize=a||1024},Utils.LRUCache.prototype={set:function(e,g){var c=this._keys,d=this._items,b=this._expires,a=this._size,f=this._maxsize;a>=f&&(c.sort(function(c,a){return b[c]>b[a]?-1:b[c]<b[a]?1:0}),a--,delete b[c[a]],delete d[c[a]]),c[a]=e,d[e]=g,b[e]=Date.now(),a++,this._keys=c,this._items=d,this._expires=b,this._size=a},get:function(b){var a=this._items[b];return a&&(this._expires[b]=Date.now()),a},keys:function(){return this._keys}},Utils.loadFromMirrors=function(b,a){var e=a&&a.data||null;a&&a.method||'GET',a&&a.method||null,a&&a.timeout||20;var c=a&&a.onSuccess||null,d=a&&a.onFailure||null;0===b.length?'function'==typeof d&&d():$.ajax({url:b[0],data:e}).done(function(d){'function'==typeof c&&c(d)}).fail(function(){loadFromMirrors(b.slice(1),a)})},Utils.getAjaxObject=function(e,a,b,c){if(c!==!1&&(c=!0),c===!0){var d=Aladin.JSONP_PROXY+'?url='+encodeURIComponent(e)}else {d=e}return a=a||'GET',b=b||null,$.ajax({url:d,method:a,dataType:b})},Utils.isHttpsContext=function(){return 'https:'===window.location.protocol},Utils.getAbsoluteURL=function(b){var a=document.createElement('a');return a.href=b,a.href},URLBuilder=function(){return URLBuilder={buildSimbadCSURL:function(a,b){if(a&&'object'==typeof a&&'ra' in a&&'dec' in a){var c=new Coo(a.ra,a.dec,7);a=c.format('s')}return 'http://alasky.unistra.fr/cgi/simbad-flat/simbad-cs.py?target='+encodeURIComponent(a)+'&SR='+b+'&format=votable&SRUNIT=deg&SORTBY=nbref'},buildNEDPositionCSURL:function(c,a,b){return 'http://nedwww.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Position+Search&of=xml_main&RA='+c+'&DEC='+a+'&SR='+b},buildNEDObjectCSURL:function(b,a){return 'http://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Name+Search&radius='+60*a+'&of=xml_main&objname='+b},buildVizieRCSURL:function(d,a,b){if(a&&'object'==typeof a&&'ra' in a&&'dec' in a){var c=new Coo(a.ra,a.dec,7);a=c.format('s')}return 'http://vizier.unistra.fr/viz-bin/votable?-source='+d+'&-c='+encodeURIComponent(a)+'&-out.max=999999&-c.rd='+b},buildSkyBotCSURL:function(g,d,e,f,b){var a='http://vo.imcce.fr/webservices/skybot/skybotconesearch_query.php?-from=AladinLite';if(a+='&RA='+encodeURIComponent(g),a+='&DEC='+encodeURIComponent(d),a+='&SR='+encodeURIComponent(e),a+='&EPOCH='+encodeURIComponent(f),b){for(var c in b){b.hasOwnProperty(c)&&(a+='&'+c+'='+encodeURIComponent(b[c]))}}return a}}}(),MeasurementTable=function(){return MeasurementTable=function(a){this.isShowing=!1,this.divEl=$('<div class="aladin-measurement-div"></div>'),$(a).append(this.divEl)},MeasurementTable.prototype.showMeasurement=function(c){this.divEl.empty();var a='<thead><tr>',b='<tr>';for(key in c.data){a+='<th>'+key+'</th>',b+='<td>'+c.data[key]+'</td>'}a+='</tr></thead>',b+='</tr>',this.divEl.append('<table>'+a+b+'</table>'),this.show()},MeasurementTable.prototype.show=function(){this.divEl.show()},MeasurementTable.prototype.hide=function(){this.divEl.hide()},MeasurementTable}(),Color=function(){return Color={},Color.curIdx=0,Color.colors=['#ff0000','#0000ff','#99cc00','#ffff00','#000066','#00ffff','#9900cc','#0099cc','#cc9900','#cc0099','#00cc99','#663333','#ffcc9a','#ff9acc','#ccff33','#660000','#ffcc33','#ff00ff','#00ff00','#ffffff'],Color.getNextColor=function(){var a=Color.colors[Color.curIdx%Color.colors.length];return Color.curIdx++,a},Color.getLabelColorForBackground=function(e){var c='#eee',a='#111';if(rgb=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),null==rgb){return a}r=parseInt(rgb[1]),g=parseInt(rgb[2]),b=parseInt(rgb[3]);var d=1-(0.299*r+0.587*g+0.114*b)/255;return 0.5>d?a:c},Color}(),AladinUtils=function(){return {xyToView:function(g,d,e,f,a,b,c){return void 0==c&&(c=!0),c?{vx:AladinUtils.myRound(a/2*(1+b*g)-(a-e)/2),vy:AladinUtils.myRound(a/2*(1+b*d)-(a-f)/2)}:{vx:a/2*(1+b*g)-(a-e)/2,vy:a/2*(1+b*d)-(a-f)/2}},viewToXy:function(f,c,d,e,a,b){return {x:((2*f+(a-d))/a-1)/b,y:((2*c+(a-e))/a-1)/b}},radecToViewXy:function(e,b,c,i,j,h,f,g){var a;if(i!=CooFrameEnum.J2000){var d=CooConversion.J2000ToGalactic([e,b]);a=c.project(d[0],d[1])}else {a=c.project(e,b)}return a?AladinUtils.xyToView(a.X,a.Y,j,h,f,g,!1):null},myRound:function(a){return 0>a?-1*(0|-a):0|a},isHpxPixVisible:function(b,c,d){for(var a=0;b.length>a;a++){if(b[a].vx>=-20&&c+20>b[a].vx&&b[a].vy>=-20&&d+20>b[a].vy){return !0}}return !1},ipixToIpix:function(c,a,b){},getZoomFactorForAngle:function(d,f){var b={ra:0,dec:0},c={ra:d,dec:0},a=new Projection(d/2,0);a.setProjection(f);var h=a.project(b.ra,b.dec),e=a.project(c.ra,c.dec),g=1/(h.X-e.Y);return g},grow2:function(h,i){for(var j=0,b=0;4>b;b++){null==h[b]&&j++}if(j>1){return h}for(var a=[],b=0;4>b;b++){a.push({vx:h[b].vx,vy:h[b].vy})}for(var b=0;2>b;b++){var f=1==b?1:0,c=1==b?3:2;if(null==a[f]){var e,d;0==f||3==f?(e=1,d=2):(e=0,d=3),a[f]={vx:(a[e].vx+a[d].vx)/2,vy:(a[e].vy+a[d].vy)/2}}if(null==a[c]){var e,d;0==c||3==c?(e=1,d=2):(e=0,d=3),a[c]={vx:(a[e].vx+a[d].vx)/2,vy:(a[e].vy+a[d].vy)/2}}if(null!=a[f]&&null!=a[c]){var k=Math.atan2(a[c].vy-a[f].vy,a[c].vx-a[f].vx),g=i*Math.cos(k);a[f].vx-=g,a[c].vx+=g,g=i*Math.sin(k),a[f].vy-=g,a[c].vy+=g}}return a}}}(),ProjectionEnum={SIN:Projection.PROJ_SIN,AITOFF:Projection.PROJ_AITOFF},CooFrameEnum=function(){return {J2000:'J2000',GAL:'Galactic'}}(),CooFrameEnum.fromString=function(a,b){return a?(a=a.toLowerCase().replace(/^\s+|\s+$/g,''),0==a.indexOf('j2000')||0==a.indexOf('icrs')?CooFrameEnum.J2000:0==a.indexOf('gal')?CooFrameEnum.GAL:b?b:null):b?b:null},CooFrameEnum.shortName=function(a){return a==CooFrameEnum.J2000?'J2000':a==CooFrameEnum.GAL?'GAL':null},HiPSDefinition=function(){var a=function(a){this.properties=a,this.id=this.getID(),this.obsTitle=a.obs_title,this.frame=a.hips_frame,this.order=parseInt(a.hips_order),this.clientSortKey=a.client_sort_key,this.tileFormats=a.hasOwnProperty('hips_tile_format')&&a.hips_tile_format.split(' '),this.urls=[],this.urls.push(a.hips_service_url);for(var b=1;a.hasOwnProperty('hips_service_url_'+b);){this.urls.push(a['hips_service_url_'+b]),b++}this.clientApplications=a.client_application};a.prototype={getServiceURLs:function(a){a=a===!0},getID:function(){if(this.properties.hasOwnProperty('ID')){return this.properties.ID}var a=null;return this.properties.hasOwnProperty('creator_did')&&(a=this.properties.creator_did),null==a&&this.properties.hasOwnProperty('publisher_did')&&(a=this.properties.publisher_did),null!=a&&('ivo://'===a.slice(0,6)&&(a=a.slice(6)),a=a.replace(/\?/g,'/')),a}};var g=[{ID:'CDS/P/2MASS/color',obs_title:'2MASS color J (1.23 microns), H (1.66 microns), K (2.16 microns)',client_sort_key:'04-001-00',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/2MASS/Color',hips_service_url_1:'http://alaskybis.unistra.fr/2MASS/Color',hips_service_url_2:'https://alaskybis.unistra.fr/2MASS/Color'},{ID:'CDS/P/AKARI/FIS/Color',obs_title:'AKARI Far-infrared All-Sky Survey - color composition WideL/WideS/N60',client_sort_key:'04-05-00',client_application:['AladinLite','AladinDesktop'],hips_order:'5',hips_frame:'equatorial',hips_tile_format:'png jpeg',hips_service_url:'http://alasky.unistra.fr/AKARI-FIS/ColorLSN60',hips_service_url_1:'http://alaskybis.unistra.fr/AKARI-FIS/ColorLSN60',hips_service_url_2:'https://alaskybis.unistra.fr/AKARI-FIS/ColorLSN60'},{ID:'CDS/P/DECaLS/DR3/color',obs_title:'DECaLS DR3 color',hips_frame:'equatorial',hips_order:'11',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/DECaLS/DR3/color'},{ID:'CDS/P/DSS2/blue',obs_title:'DSS2 Blue (XJ+S)',client_sort_key:'03-01-03',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'equatorial',hips_tile_format:'jpeg fits',hips_service_url:'http://alasky.unistra.fr/DSS/DSS2-blue-XJ-S',hips_service_url_1:'http://alaskybis.unistra.fr/DSS/DSS2-blue-XJ-S',hips_service_url_2:'https://alaskybis.unistra.fr/DSS/DSS2-blue-XJ-S',hips_service_url_3:'http://healpix.ias.u-psud.fr/DSS2Blue'},{ID:'CDS/P/DSS2/color',obs_title:'DSS colored',client_sort_key:'03-00',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/DSS/DSSColor',hips_service_url_1:'http://alaskybis.unistra.fr/DSS/DSSColor',hips_service_url_2:'https://alaskybis.unistra.fr/DSS/DSSColor',hips_service_url_3:'http://healpix.ias.u-psud.fr/DSSColorNew',hips_service_url_4:'http://skies.esac.esa.int/DSSColor/'},{ID:'CDS/P/DSS2/red',obs_title:'DSS2 Red (F+R)',client_sort_key:'03-01-02',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'equatorial',hips_tile_format:'jpeg fits',hips_service_url:'http://alasky.unistra.fr/DSS/DSS2Merged',hips_service_url_1:'http://alaskybis.unistra.fr/DSS/DSS2Merged',hips_service_url_2:'https://alaskybis.unistra.fr/DSS/DSS2Merged',hips_service_url_3:'http://healpix.ias.u-psud.fr/DSS2Merged'},{ID:'CDS/P/Fermi/color',obs_title:'Fermi Color HEALPix survey',client_sort_key:'00-01-01',client_application:['AladinLite','AladinDesktop'],hips_order:'3',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/Fermi/Color',hips_service_url_1:'http://alaskybis.unistra.fr/Fermi/Color',hips_service_url_2:'https://alaskybis.unistra.fr/Fermi/Color'},{ID:'CDS/P/Finkbeiner',obs_title:'Finkbeiner Halpha composite survey',client_sort_key:'06-01',client_application:['AladinLite','AladinDesktop'],hips_order:'3',hips_frame:'galactic',hips_tile_format:'jpeg fits',hips_service_url:'http://alasky.unistra.fr/FinkbeinerHalpha',hips_service_url_1:'http://alaskybis.unistra.fr/FinkbeinerHalpha',hips_service_url_2:'https://alaskybis.unistra.fr/FinkbeinerHalpha'},{ID:'CDS/P/GALEXGR6/AIS/color',obs_title:'GALEX GR6 AIS (until March 2014)- Color composition',client_sort_key:'02-01-01',client_application:['AladinLite','AladinDesktop'],hips_order:'8',hips_frame:'equatorial',hips_tile_format:'png jpeg',hips_service_url:'http://alasky.unistra.fr/GALEX/GR6-03-2014/AIS-Color',hips_service_url_1:'http://alaskybis.unistra.fr/GALEX/GR6-03-2014/AIS-Color',hips_service_url_2:'https://alaskybis.unistra.fr/GALEX/GR6-03-2014/AIS-Color'},{ID:'CDS/P/IRIS/color',obs_title:'IRAS-IRIS HEALPix survey, color',client_sort_key:'04-02-01',client_application:['AladinLite','AladinDesktop'],hips_order:'3',hips_frame:'galactic',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/IRISColor',hips_service_url_1:'http://alaskybis.unistra.fr/IRISColor',hips_service_url_2:'https://alaskybis.unistra.fr/IRISColor',hips_service_url_3:'http://healpix.ias.u-psud.fr/IRISColor',hips_service_url_4:'http://skies.esac.esa.int/IRISColor/'},{ID:'CDS/P/Mellinger/color',obs_title:'Mellinger optical survey, color',client_sort_key:'03-03',client_application:['AladinLite','AladinDesktop'],hips_order:'4',hips_frame:'galactic',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/MellingerRGB',hips_service_url_1:'http://alaskybis.unistra.fr/MellingerRGB',hips_service_url_2:'https://alaskybis.unistra.fr/MellingerRGB'},{ID:'CDS/P/SDSS9/color',obs_title:'SDSS 9 color',client_sort_key:'03-02-01',client_application:['AladinLite','AladinDesktop'],hips_order:'10',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/SDSS/DR9/color',hips_service_url_1:'http://alaskybis.unistra.fr/SDSS/DR9/color',hips_service_url_2:'https://alaskybis.unistra.fr/SDSS/DR9/color',hips_service_url_3:'http://healpix.ias.u-psud.fr/SDSS9Color',hips_service_url_4:'http://skies.esac.esa.int/SDSS9Color/'},{ID:'CDS/P/SPITZER/color',obs_title:'IRAC HEALPix survey, color',client_sort_key:'04-03-00',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'galactic',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/SpitzerI1I2I4color',hips_service_url_1:'http://alaskybis.unistra.fr/SpitzerI1I2I4color',hips_service_url_2:'https://alaskybis.unistra.fr/SpitzerI1I2I4color',hips_service_url_3:'http://healpix.ias.u-psud.fr/SPITZERColor'},{ID:'CDS/P/allWISE/color',obs_title:'AllWISE color  Red (W4) , Green (W2) , Blue (W1) from raw Atlas Images',client_sort_key:'04-003-00',client_application:['AladinLite','AladinDesktop'],hips_order:'8',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://alasky.unistra.fr/AllWISE/RGB-W4-W2-W1',hips_service_url_1:'http://alaskybis.unistra.fr/AllWISE/RGB-W4-W2-W1',hips_service_url_2:'https://alaskybis.unistra.fr/AllWISE/RGB-W4-W2-W1'},{ID:'IPAC/P/GLIMPSE360',obs_title:"GLIMPSE360: Spitzer's Infrared Milky Way",client_sort_key:'04-03-0',client_application:['AladinLite','AladinDesktop'],hips_order:'9',hips_frame:'equatorial',hips_tile_format:'jpeg',hips_service_url:'http://www.spitzer.caltech.edu/glimpse360/aladin/data'},{ID:'JAXA/P/MAXI_SSC_SUM',hips_tile_format:'png',hips_frame:'equatorial',obs_title:'MAXI SSC all-sky image integrated for 4.5 years',hips_order:'6',hips_service_url:'http://darts.isas.jaxa.jp/pub/judo2/HiPS/maxi_ssc_sum',hips_service_url_1:'http://alasky.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM',hips_service_url_2:'http://alaskybis.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM',hips_service_url_3:'https://alaskybis.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM'},{ID:'JAXA/P/SWIFT_BAT_FLUX',hips_tile_format:'png',hips_frame:'equatorial',obs_title:'Swift-BAT 70-month all-sray hard X-ray survey image',hips_order:'6',hips_service_url:'http://darts.isas.jaxa.jp/pub/judo2/HiPS/swift_bat_flux/',hips_service_url_1:'http://alasky.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX',hips_service_url_2:'http://alaskybis.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX',hips_service_url_3:'https://alaskybis.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX'},{ID:'ov-gso/P/VTSS/Ha',obs_title:'Virginia Tech Spectral-Line Survey (VTSS) - Halpha image',client_sort_key:'06-xx',client_application:['AladinLite','AladinDesktop'],hips_order:'3',hips_frame:['galactic','galactic'],hips_tile_format:'png jpeg fits',hips_service_url:'http://cade.irap.omp.eu/documents/Ancillary/4Aladin/VTSS',hips_service_url_1:'http://alasky.unistra.fr/IRAP/VTSS',hips_service_url_2:'http://alaskybis.unistra.fr/IRAP/VTSS',hips_service_url_3:'https://alaskybis.unistra.fr/IRAP/VTSS'},{ID:'xcatdb/P/XMM/EPIC',obs_title:'XMM-Newton stacked EPIC images',hips_frame:'equatorial',hips_order:'7',hips_service_url:'http://saada.u-strasbg.fr/xmmallsky',hips_tile_format:'png fits',hips_service_url_1:'http://alasky.unistra.fr/SSC/xmmallsky',hips_service_url_2:'http://alaskybis.unistra.fr/SSC/xmmallsky',hips_service_url_3:'https://alaskybis.unistra.fr/SSC/xmmallsky'},{ID:'xcatdb/P/XMM/PN/color',obs_title:'False color X-ray images (Red=0.5-1 Green=1-2 Blue=2-4.5)Kev',hips_order:'7',hips_frame:'equatorial',hips_tile_format:'png jpeg',hips_service_url:'http://saada.unistra.fr/xmmpnsky',hips_service_url_1:'http://alasky.unistra.fr/SSC/xmmpnsky',hips_service_url_2:'http://alaskybis.unistra.fr/SSC/xmmpnsky',hips_service_url_3:'https://alaskybis.unistra.fr/SSC/xmmpnsky'}],b=[];a.LOCAL_STORAGE_KEY='aladin:hips-list';var d='_timestamp_retrieved',c='_last_used_url';a.getLocalStorageDefinitions=function(){try{var b=window.localStorage.getItem(a.LOCAL_STORAGE_KEY);return null===b?[]:window.JSON.parse(b)}catch(i){return console.error(i),[]}},a.storeInLocalStorage=function(b){try{window.localStorage.setItem(a.LOCAL_STORAGE_KEY,window.JSON.stringify(b))}catch(i){return console.error(i),!1}return !0};var h=['http://alasky.u-strasbg.fr/MocServer/query','http://alaskybis.u-strasbg.fr/MocServer/query'],f=['https://alaskybis.unistra.fr/MocServer/query'];a.getRemoteDefinitions=function(a,b,c){var a=a||{client_application:'AladinLite'};a.fmt='json',a.fields='ID,obs_title,client_sort_key,client_application,hips_service_url*,hips_order,hips_tile_format,hips_frame';var d=Utils.isHttpsContext()?f:h,g=function(d){'function'==typeof b&&b(d)},e=function(){console.error('Could not load HiPS definitions from urls '+d),'function'==typeof c&&c()};Utils.loadFromMirrors(d,{data:a,onSuccess:g,onFailure:e,timeout:5})};var e=function(i,g){for(var e=[],f={},b=0;g.length>b;b++){var a=g[b];f[a.ID]=a}for(var b=0;i.length>b;b++){var a=i[b],h=a.ID;if(f.hasOwnProperty(h)){var d=f[h];a.hasOwnProperty(c)&&!d.hasOwnProperty(c)&&(d[c]=a[c]),e.push(d)}else {e.push(a)}}return e};return a.CACHE_RETENTION_TIME_SECONDS=604800,a.init=function(){b=g;for(var f=a.getLocalStorageDefinitions(),j=(new Date()).getTime(),h=[],c=0;f.length>c;c++){var i=f[c];i.hasOwnProperty(d)&&j-i[d]>1000*a.CACHE_RETENTION_TIME_SECONDS&&h.push(c)}for(var c=h.length-1;c>=0;c--){f.splice(h[c],1)}b=e(b,f),a.getRemoteDefinitions({dataproduct_type:'image',client_application:'AladinLite'},function(c){for(var g=(new Date()).getTime(),f=0;c.length>f;f++){c[f][d]=g}b=e(b,c),a.storeInLocalStorage(b)})},a.getALDefaultHiPSDefinitions=function(){for(var e=[],c=0;b.length>c;c++){var d=b[c];!d.hasOwnProperty('client_application')||0>d.client_application.indexOf('AladinLite')||e.push(new a(d))}return e},a.getDefinitions=function(){for(var d=[],c=0;b.length>c;c++){var e=b[c];d.push(new a(e))}return d},a.parseHiPSProperties=function(b){if(null==b){return null}var e={};b=b.replace(/[\r]/g,'');for(var f=b.split('\n'),d=0;f.length>d;d++){var a=$.trim(f[d]);if('#'!==a.slice(0,1)){var c=a.indexOf('=');if(!(0>c)){var g=$.trim(a.slice(0,c)),h=$.trim(a.slice(c+1));e[g]=h}}}return e},a.findByID=function(c,a){var b=findByIDLocal(c);return b.length>0?('function'==typeof a&&a(b),void 0):(findByIDRemote(c,a),void 0)},a.findByIDLocal=function(g){for(var e=[],c=0;b.length>c;c++){var d=b[c],f=d.ID;null!=f.match(g)&&e.push(new a(d))}return e},a.findByIDRemote=function(b,c){a.findHiPSRemote({ID:'*'+b+'*'},c)},a.findHiPSRemote=function(b,c){b=b||{},b.hasOwnProperty('dataproduct_type')||(b.dataproduct_type='image'),a.getRemoteDefinitions(b,function(e){for(var f=[],d=0;e.length>d;d++){f.push(new a(e[d]))}'function'==typeof c&&c(f)})},a.fromURL=function(b,d){var e,c;'properties'===b.slice(-10)?(c=b,e=c.slice(0,-11)):('/'===b.slice(-1)&&(b=b.slice(0,-1)),e=b,c=e+'/properties');var f=function(f){var c=a.parseHiPSProperties(f);c.hasOwnProperty('hips_service_url')||(c.hips_service_url=e),'function'==typeof d&&d(new a(c))},g=Utils.getAjaxObject(c,'GET','text',!1);g.done(function(a){f(a)}).fail(function(){var a=Utils.getAjaxObject(c,'GET','text',!0);a.done(function(a){f(a)}).fail(function(){'function'==typeof d&&d(null)})})},a.fromProperties=function(b){return new a(b)},a.init(),a}(),Downloader=function(){var d=4,b=!1,c=700,a=function(a){this.view=a,this.nbDownloads=0,this.dlQueue=[],this.urlsInQueue={}};return a.prototype.requestDownload=function(c,a,b){a in this.urlsInQueue||(this.dlQueue.push({img:c,url:a,cors:b}),this.urlsInQueue[a]=1,this.tryDownload())},a.prototype.tryDownload=function(){for(;this.dlQueue.length>0&&d>this.nbDownloads;){this.startDownloadNext()}},a.prototype.startDownloadNext=function(){var a=this.dlQueue.shift();if(a){this.nbDownloads++;var b=this;a.img.onload=function(){b.completeDownload(this,!0)},a.img.onerror=function(){b.completeDownload(this,!1)},a.cors?a.img.crossOrigin='anonymous':void 0!==a.img.crossOrigin&&delete a.img.crossOrigin,a.img.src=a.url}},a.prototype.completeDownload=function(a,e){if(delete this.urlsInQueue[a.src],a.onerror=null,a.onload=null,this.nbDownloads--,e){if(b){var d=(new Date()).getTime();a.fadingStart=d,a.fadingEnd=d+c}this.view.requestRedraw()}else {a.dlError=!0}this.tryDownload()},a}(),function(){var d,i,m,g,c,l,h,k,j,n,e,p,o,f,q,s,r={}.hasOwnProperty,b=function(b,a){function i(){this.constructor=b}for(var c in a){r.call(a,c)&&(b[c]=a[c])}return i.prototype=a.prototype,b.prototype=new i(),b.__super__=a.prototype,b},a=[].slice;null==this.astro&&(this.astro={}),d=function(){function t(){}return t.include=function(c){var a,b;for(a in c){b=c[a],this.prototype[a]=b}return this},t.extend=function(c){var a,b;for(a in c){b=c[a],this[a]=b}return this},t.prototype.proxy=function(b){var a=this;return function(){return b.apply(a,arguments)}},t.prototype.invoke=function(c,a,d){var b;return b=null!=(null!=a?a.context:void 0)?a.context:this,null!=c?c.call(b,d,a):void 0},t}(),p=function(a){function e(f,d,e){var b,c=this;this.arg=f,this.callback=d,this.opts=e,this.hdus=[],this.blockCount=0,this.begin=0,this.end=this.BLOCKLENGTH,this.offset=0,this.headerStorage=new Uint8Array(),'string'==typeof this.arg?(this.readNextBlock=this._readBlockFromBuffer,b=new XMLHttpRequest(),b.open('GET',this.arg),b.responseType='arraybuffer',b.onload=function(){return 200!==b.status?(c.invoke(c.callback,c.opts),void 0):(c.arg=b.response,c.length=c.arg.byteLength,c.readFromBuffer())},b.send()):(this.length=this.arg.size,this.readNextBlock=this._readBlockFromFile,this.readFromFile())}return b(e,a),e.prototype.LINEWIDTH=80,e.prototype.BLOCKLENGTH=2880,File.prototype.slice=File.prototype.slice||File.prototype.webkitSlice,Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice,e.prototype.readFromBuffer=function(){var b;return b=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(b)},e.prototype.readFromFile=function(){var b,c=this;return this.reader=new FileReader(),this.reader.onloadend=function(b){return c.readBlock(b.target.result)},b=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.reader.readAsArrayBuffer(b)},e.prototype.readBlock=function(e){var b,g,p,d,c,i,j,m,q,o,f,n,l;for(b=new Uint8Array(e),q=new Uint8Array(this.headerStorage),this.headerStorage=new Uint8Array(this.end),this.headerStorage.set(q,0),this.headerStorage.set(b,this.begin),i=this.BLOCKLENGTH/this.LINEWIDTH;i--;){if(c=i*this.LINEWIDTH,32!==b[c]){if(69===b[c]&&78===b[c+1]&&68===b[c+2]&&32===b[c+3]){for(j='',l=this.headerStorage,f=0,n=l.length;n>f;f++){o=l[f],j+=String.fromCharCode(o)}return d=new k(j),this.start=this.end+this.offset,g=d.getDataLength(),m=this.arg.slice(this.start,this.start+g),d.hasDataUnit()&&(p=this.createDataUnit(d,m)),this.hdus.push(new h(d,p)),this.offset+=this.end+g+this.excessBytes(g),this.offset===this.length?(this.headerStorage=null,this.invoke(this.callback,this.opts,this),void 0):(this.blockCount=0,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,this.headerStorage=new Uint8Array(),e=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(e),void 0)}break}}this.blockCount+=1,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,e=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(e)},e.prototype._readBlockFromBuffer=function(b){return this.readBlock(b)},e.prototype._readBlockFromFile=function(b){return this.reader.readAsArrayBuffer(b)},e.prototype.createDataUnit=function(c,d){var b;return b=c.getDataType(),new astro.FITS[b](c,d)},e.prototype.excessBytes=function(b){return (this.BLOCKLENGTH-b%this.BLOCKLENGTH)%this.BLOCKLENGTH},e.prototype.isEOF=function(){return this.offset===this.length?!0:!1},e}(d),l=function(a){function e(f,d,e){var c,b=this;this.arg=f,c=new p(this.arg,function(){return b.hdus=c.hdus,b.invoke(d,e,b)})}return b(e,a),e.prototype.getHDU=function(e){var c,b,f,d;if(null!=e&&null!=this.hdus[e]){return this.hdus[e]}for(d=this.hdus,b=0,f=d.length;f>b;b++){if(c=d[b],c.hasData()){return c}}},e.prototype.getHeader=function(b){return this.getHDU(b).header},e.prototype.getDataUnit=function(b){return this.getHDU(b).data},e}(d),l.version='0.6.5',this.astro.FITS=l,g=function(a){function e(c,b){b instanceof ArrayBuffer?this.buffer=b:this.blob=b}return b(e,a),e.swapEndian={B:function(b){return b},I:function(b){return b<<8|b>>8},J:function(b){return (255&b)<<24|(65280&b)<<8|65280&b>>8|255&b>>24}},e.swapEndian[8]=e.swapEndian.B,e.swapEndian[16]=e.swapEndian.I,e.swapEndian[32]=e.swapEndian.J,e}(d),this.astro.FITS.DataUnit=g,j={verifyOrder:function(b,a){return a!==this.cardIndex?console.warn(''+b+' should appear at index '+this.cardIndex+' in the FITS header'):void 0},verifyBetween:function(d,a,b,c){if(!(a>=b&&c>=a)){throw 'The '+d+' value of '+a+' is not between '+b+' and '+c}},verifyBoolean:function(a){return 'T'===a?!0:!1},VerifyFns:{SIMPLE:function(){var c,b;return c=arguments.length>=1?a.call(arguments,0):[],b=arguments[0],this.primary=!0,this.verifyOrder('SIMPLE',0),this.verifyBoolean(b)},XTENSION:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],this.extension=!0,this.extensionType=arguments[0],this.verifyOrder('XTENSION',0),this.extensionType},BITPIX:function(){var d,c,b;if(d=arguments.length>=1?a.call(arguments,0):[],c='BITPIX',b=parseInt(arguments[0]),this.verifyOrder(c,1),8!==b&&16!==b&&32!==b&&-32!==b&&-64!==b){throw ''+c+' value '+b+' is not permitted'}return b},NAXIS:function(){var g,e,b,d,c,f;if(g=arguments.length>=1?a.call(arguments,0):[],b='NAXIS',c=parseInt(arguments[0]),e=arguments[1],!e&&(this.verifyOrder(b,2),this.verifyBetween(b,c,0,999),this.isExtension()&&('TABLE'===(f=this.extensionType)||'BINTABLE'===f)&&(d=2,c!==d))){throw ''+b+' must be '+d+' for TABLE and BINTABLE extensions'}return c},PCOUNT:function(){var g,b,e,c,d,f;if(g=arguments.length>=1?a.call(arguments,0):[],b='PCOUNT',d=parseInt(arguments[0]),e=3+this.get('NAXIS'),this.verifyOrder(b,e),this.isExtension()&&('IMAGE'===(f=this.extensionType)||'TABLE'===f)&&(c=0,d!==c)){throw ''+b+' must be '+c+' for the '+this.extensionType+' extensions'}return d},GCOUNT:function(){var g,b,f,d,e,c;if(g=arguments.length>=1?a.call(arguments,0):[],b='GCOUNT',e=parseInt(arguments[0]),f=3+this.get('NAXIS')+1,this.verifyOrder(b,f),this.isExtension()&&('IMAGE'===(c=this.extensionType)||'TABLE'===c||'BINTABLE'===c)&&(d=1,e!==d)){throw ''+b+' must be '+d+' for the '+this.extensionType+' extensions'}return e},EXTEND:function(){var c,b;if(c=arguments.length>=1?a.call(arguments,0):[],b=arguments[0],!this.isPrimary()){throw 'EXTEND must only appear in the primary header'}return this.verifyBoolean(b)},BSCALE:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var c,b;return c=arguments.length>=1?a.call(arguments,0):[],b=arguments[0],this.get('BITPIX')>0||console.warn('BLANK is not to be used for BITPIX = '+this.get('BITPIX')),parseInt(b)},DATAMIN:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])},EXTLEVEL:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])},TFIELDS:function(){var c,b;return c=arguments.length>=1?a.call(arguments,0):[],b=parseInt(arguments[0]),this.verifyBetween('TFIELDS',b,0,999),b},TBCOL:function(){var d,b,c;return d=arguments.length>=1?a.call(arguments,0):[],c=arguments[0],b=arguments[2],this.verifyBetween('TBCOL',b,0,this.get('TFIELDS')),c},ZIMAGE:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],this.verifyBoolean(arguments[0])},ZCMPTYPE:function(){var c,b;if(c=arguments.length>=1?a.call(arguments,0):[],b=arguments[0],'GZIP_1'!==b&&'RICE_1'!==b&&'PLIO_1'!==b&&'HCOMPRESS_1'!==b){throw 'ZCMPTYPE value '+b+' is not permitted'}if('RICE_1'!==b){throw 'Compress type '+b+' is not yet implement'}return b},ZBITPIX:function(){var c,b;if(c=arguments.length>=1?a.call(arguments,0):[],b=parseInt(arguments[0]),8!==b&&16!==b&&32!==b&&64!==b&&-32!==b&&-64!==b){throw 'ZBITPIX value '+b+' is not permitted'}return b},ZNAXIS:function(){var d,c,b;return d=arguments.length>=1?a.call(arguments,0):[],b=parseInt(arguments[0]),c=arguments[1],b=b,c||this.verifyBetween('ZNAXIS',b,0,999),b},ZTILE:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])},ZSIMPLE:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],'T'===arguments[0]?!0:!1},ZPCOUNT:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])},ZGCOUNT:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])},ZDITHER0:function(){var b;return b=arguments.length>=1?a.call(arguments,0):[],parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=j,k=function(a){function e(e){var d,b,c;this.primary=!1,this.extension=!1,this.verifyCard={},c=this.VerifyFns;for(b in c){d=c[b],this.verifyCard[b]=this.proxy(d)}this.cards={},this.cards.COMMENT=[],this.cards.HISTORY=[],this.cardIndex=0,this.block=e,this.readBlock(e)}return b(e,a),e.include(j),e.prototype.arrayPattern=/(\D+)(\d+)/,e.prototype.maxLines=600,e.prototype.get=function(b){return this.contains(b)?this.cards[b].value:null},e.prototype.set=function(d,c,b){return b=b||'',this.cards[d]={index:this.cardIndex,value:c,comment:b},this.cardIndex+=1},e.prototype.contains=function(b){return this.cards.hasOwnProperty(b)},e.prototype.readLine=function(e){var i,f,g,h,c,b,d;return c=e.slice(0,8).trim(),(i=''===c)?void 0:(h=e.slice(8,10),b=e.slice(10),'= '!==h?(('COMMENT'===c||'HISTORY'===c)&&this.cards[c].push(b.trim()),void 0):(d=b.split(' /'),b=d[0],f=d[1],b=b.trim(),g=b[0],"'"===g?b=b.slice(1,-1).trim():'T'!==b&&'F'!==b&&(b=parseFloat(b)),b=this.validate(c,b),this.set(c,b,f)))},e.prototype.validate=function(g,d){var b,e,f,h,c;return e=null,b=g,f=this.arrayPattern.test(g),f&&(h=this.arrayPattern.exec(g),c=h.slice(1),b=c[0],e=c[1]),b in this.verifyCard&&(d=this.verifyCard[b](d,f,e)),d},e.prototype.readBlock=function(i){var e,h,f,d,c,b,g;for(f=80,d=i.length/f,d=this.maxLines>d?d:this.maxLines,g=[],e=c=0,b=d-1;b>=0?b>=c:c>=b;e=b>=0?++c:--c){h=i.slice(e*f,(e+1)*f),g.push(this.readLine(h))}return g},e.prototype.hasDataUnit=function(){return 0===this.get('NAXIS')?!1:!0},e.prototype.getDataLength=function(){var e,f,d,b,c;if(!this.hasDataUnit()){return 0}for(d=[],e=b=1,c=this.get('NAXIS');c>=1?c>=b:b>=c;e=c>=1?++b:--b){d.push(this.get('NAXIS'+e))}return f=d.reduce(function(c,b){return c*b})*Math.abs(this.get('BITPIX'))/8,f+=this.get('PCOUNT')},e.prototype.getDataType=function(){switch(this.extensionType){case 'BINTABLE':return this.contains('ZIMAGE')?'CompressedImage':'BinaryTable';case 'TABLE':return 'Table';default:return this.hasDataUnit()?'Image':null;}},e.prototype.isPrimary=function(){return this.primary},e.prototype.isExtension=function(){return this.extension},e}(d),this.astro.FITS.Header=k,e={getExtent:function(e){var b,c,d,a;for(b=e.length;b--;){if(a=e[b],!isNaN(a)){d=c=a;break}}if(-1===b){return [0/0,0/0]}for(;b--;){a=e[b],isNaN(a)||(d>a&&(d=a),a>c&&(c=a))}return [d,c]},getPixel:function(c,a,b){return c[b*this.width+a]}},this.astro.FITS.ImageUtils=e,n=function(a){function e(b){var i,j,c,h,d,g,f;for(e.__super__.constructor.apply(this,arguments),h=b.get('NAXIS'),this.bitpix=b.get('BITPIX'),this.naxis=[],c=d=1;h>=1?h>=d:d>=h;c=h>=1?++d:--d){this.naxis.push(b.get('NAXIS'+c))}for(this.width=b.get('NAXIS1'),this.height=b.get('NAXIS2')||1,this.depth=b.get('NAXIS3')||1,this.bzero=b.get('BZERO')||0,this.bscale=b.get('BSCALE')||1,this.bytes=Math.abs(this.bitpix)/8,this.length=this.naxis.reduce(function(d,c){return d*c})*Math.abs(this.bitpix)/8,this.frame=0,this.frameOffsets=[],this.frameLength=this.bytes*this.width*this.height,this.nBuffers=null!=this.buffer?1:2,c=g=0,f=this.depth-1;f>=0?f>=g:g>=f;c=f>=0?++g:--g){i=c*this.frameLength,j={begin:i},null!=this.buffer&&(j.buffers=[this.buffer.slice(i,i+this.frameLength)]),this.frameOffsets.push(j)}}return b(e,a),e.include(e),e.prototype.allocationSize=16777216,e.prototype._getFrame=function(f,g,h,j){var d,k,m,i,c,e,b,l;if(k=Math.abs(g)/8,c=i=f.byteLength/k,m=Math.abs(g),g>0){switch(g){case 8:b=new Uint8Array(f),b=new Uint16Array(b),e=function(b){return b};break;case 16:b=new Int16Array(f),e=function(b){return (255&b)<<8|255&b>>8};break;case 32:b=new Int32Array(f),e=function(b){return (255&b)<<24|(65280&b)<<8|65280&b>>8|255&b>>24};}for(d=parseInt(h)!==h||parseInt(j)!==j?new Float32Array(b.length):b;c--;){b[c]=e(b[c]),d[c]=h+j*b[c]}}else {for(d=new Uint32Array(f),e=function(b){return (255&b)<<24|(65280&b)<<8|65280&b>>8|255&b>>24};i--;){l=d[i],d[i]=e(l)}for(d=new Float32Array(f);c--;){d[c]=h+j*d[c]}}return d},e.prototype._getFrameAsync=function(j,r,s){var e,p,o,f,i,c,m,g,q,d,k,l,n,b,h=this;q=function(i){var c,d,g,h,f,b,e;return b=i.data,h=b.buffer,d=b.bitpix,f=b.bzero,g=b.bscale,e=b.url,importScripts(e),c=_getFrame(h,d,f,g),postMessage(c)},f=(''+q).replace('return postMessage','postMessage'),f='onmessage = '+f,i=''+this._getFrame,i=i.replace('function','function _getFrame'),m='application/javascript',o=new Blob([f],{type:m}),p=new Blob([i],{type:m}),e=window.URL||window.webkitURL,n=e.createObjectURL(o),l=e.createObjectURL(p),b=new Worker(n),g={buffer:j[0],bitpix:this.bitpix,bzero:this.bzero,bscale:this.bscale,url:l},c=0,d=null,k=0,b.onmessage=function(i){var f;return f=i.data,null==d&&(d=new f.constructor(h.width*h.height)),d.set(f,k),k+=f.length,c+=1,c===h.nBuffers?(h.invoke(r,s,d),e.revokeObjectURL(n),e.revokeObjectURL(l),b.terminate()):(g.buffer=j[c],b.postMessage(g,[j[c]]))},b.postMessage(g,[j[0]])},e.prototype.getFrame=function(i,p,q){var l,m,f,c,k,j,b,o,g,h,d,e,n=this;if(this.frame=i||this.frame,j=this.frameOffsets[this.frame],c=j.buffers,(null!=c?c.length:void 0)===this.nBuffers){return this._getFrameAsync(c,p,q)}for(this.frameOffsets[this.frame].buffers=[],l=j.begin,m=this.blob.slice(l,l+this.frameLength),f=[],o=Math.floor(this.height/this.nBuffers),k=o*this.bytes*this.width,b=d=0,e=this.nBuffers-1;e>=0?e>=d:d>=e;b=e>=0?++d:--d){h=b*k,b===this.nBuffers-1?f.push(m.slice(h)):f.push(m.slice(h,h+k))}return c=[],g=new FileReader(),g.frame=this.frame,b=0,g.onloadend=function(c){var d;return i=c.target.frame,d=c.target.result,n.frameOffsets[i].buffers.push(d),b+=1,b===n.nBuffers?n.getFrame(i,p,q):g.readAsArrayBuffer(f[b])},g.readAsArrayBuffer(f[0])},e.prototype.getFrames=function(c,d,f,g){var b,e=this;return b=function(i,h){return e.invoke(f,h,i),d-=1,c+=1,d?e.getFrame(c,b,h):void 0},this.getFrame(c,b,g)},e.prototype.isDataCube=function(){return this.naxis.length>2?!0:!1},e}(g),this.astro.FITS.Image=n,f=function(a){function e(b){e.__super__.constructor.apply(this,arguments),this.rowByteSize=b.get('NAXIS1'),this.rows=b.get('NAXIS2'),this.cols=b.get('TFIELDS'),this.length=this.rowByteSize*this.rows,this.heapLength=b.get('PCOUNT'),this.columns=this.getColumns(b),null!=this.buffer?(this.rowsInMemory=this._rowsInMemoryBuffer,this.heap=this.buffer.slice(this.length,this.length+this.heapLength)):(this.rowsInMemory=this._rowsInMemoryBlob,this.firstRowInBuffer=this.lastRowInBuffer=0,this.nRowsInBuffer=Math.floor(this.maxMemory/this.rowByteSize)),this.accessors=[],this.descriptors=[],this.elementByteLengths=[],this.setAccessors(b)}return b(e,a),e.prototype.maxMemory=1048576,e.prototype._rowsInMemoryBuffer=function(){return !0},e.prototype._rowsInMemoryBlob=function(c,b){return this.firstRowInBuffer>c?!1:b>this.lastRowInBuffer?!1:!0},e.prototype.getColumns=function(g){var d,e,f,c,b;for(d=[],e=c=1,b=this.cols;b>=1?b>=c:c>=b;e=b>=1?++c:--c){if(f='TTYPE'+e,!g.contains(f)){return null}d.push(g.get(f))}return d},e.prototype.getColumn=function(o,l,m){var n,h,g,i,p,e,f,j,b,k,c,d=this;return null!=this.blob?(b=this.columns.indexOf(o),i=this.descriptors[b],n=this.accessors[b],p=this.elementByteLengths[b],e=this.elementByteLengths.slice(0,b),e=0===e.length?0:e.reduce(function(c,b){return c+b}),g=null!=this.typedArray[i]?new this.typedArray[i](this.rows):[],c=~~(this.maxMemory/this.rowByteSize),c=Math.min(c,this.rows),f=this.rows/c,k=Math.floor(f)===f?f:Math.floor(f)+1,j=0,b=0,h=function(r,p){var i,f,q,s;for(i=r.byteLength/d.rowByteSize,s=new DataView(r),f=e;i--;){g[j]=n(s,f)[0],j+=1,f+=d.rowByteSize}return k-=1,b+=1,k?(q=b*c,d.getTableBuffer(q,c,h,p)):(d.invoke(l,p,g),void 0)},this.getTableBuffer(0,c,h,m)):(h=function(b,c){return g=b.map(function(d){return d[o]}),d.invoke(l,c,g)},this.getRows(0,this.rows,h,m))},e.prototype.getTableBuffer=function(e,c,i,j){var d,g,f,b,h=this;return c=Math.min(this.rows-e,c),d=e*this.rowByteSize,f=d+c*this.rowByteSize,g=this.blob.slice(d,f),b=new FileReader(),b.row=e,b.number=c,b.onloadend=function(b){return h.invoke(i,j,b.target.result)},b.readAsArrayBuffer(g)},e.prototype.getRows=function(d,b,j,l){var c,k,h,g,f,i,e=this;return this.rowsInMemory(d,d+b)?(null!=this.blob?h=this.buffer:(c=d*this.rowByteSize,g=c+b*this.rowByteSize,h=this.buffer.slice(c,g)),i=this._getRows(h,b),this.invoke(j,l,i),i):(c=d*this.rowByteSize,g=c+Math.max(this.nRowsInBuffer*this.rowByteSize,b*this.rowByteSize),k=this.blob.slice(c,g),f=new FileReader(),f.row=d,f.number=b,f.onloadend=function(f){var c;return c=f.target,e.buffer=c.result,e.firstRowInBuffer=e.lastRowInBuffer=c.row,e.lastRowInBuffer+=c.number,e.getRows(d,b,j,l)},f.readAsArrayBuffer(k))},e}(g),this.astro.FITS.Tabular=f,o=function(a){function e(){return q=e.__super__.constructor.apply(this,arguments)}return b(e,a),e.prototype.dataAccessors={A:function(b){return b.trim()},I:function(b){return parseInt(b)},F:function(b){return parseFloat(b)},E:function(b){return parseFloat(b)},D:function(b){return parseFloat(b)}},e.prototype.setAccessors=function(k){var g,h,d,j,i,l,c,b,e,f=this;for(i=/([AIFED])(\d+)\.*(\d+)*/,e=[],d=c=1,b=this.cols;b>=1?b>=c:c>=b;d=b>=1?++c:--c){h=k.get('TFORM'+d),l=k.get('TTYPE'+d),j=i.exec(h),g=j[1],e.push(function(c){var b;return b=function(b){return f.dataAccessors[c](b)},f.accessors.push(b)}(g))}return e},e.prototype._getRows=function(u){var o,r,l,t,k,b,d,q,j,i,m,g,c,f,n,p,s,e,h;for(q=u.byteLength/this.rowByteSize,r=new Uint8Array(u),i=[],k=c=0,e=q-1;e>=0?e>=c:c>=e;k=e>=0?++c:--c){for(l=k*this.rowByteSize,t=l+this.rowByteSize,m=r.subarray(l,t),d='',f=0,p=m.length;p>f;f++){g=m[f],d+=String.fromCharCode(g)}for(d=d.trim().split(/\s+/),j={},h=this.accessors,b=n=0,s=h.length;s>n;b=++n){o=h[b],g=d[b],j[this.columns[b]]=o(g)}i.push(j)}return i},e}(f),this.astro.FITS.Table=o,i=function(a){function e(){return s=e.__super__.constructor.apply(this,arguments)}return b(e,a),e.prototype.typedArray={B:Uint8Array,I:Uint16Array,J:Uint32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint16Array,4:Uint32Array},e.offsets={L:1,B:1,I:2,J:4,K:8,A:1,E:4,D:8,C:8,M:16},e.prototype.dataAccessors={L:function(e,b){var c,d;return d=e.getInt8(b),b+=1,c=84===d?!0:!1,[c,b]},B:function(d,b){var c;return c=d.getUint8(b),b+=1,[c,b]},I:function(d,b){var c;return c=d.getInt16(b),b+=2,[c,b]},J:function(d,b){var c;return c=d.getInt32(b),b+=4,[c,b]},K:function(h,b){var f,c,g,d,e;return c=Math.abs(h.getInt32(b)),b+=4,g=Math.abs(h.getInt32(b)),b+=4,d=c%10,f=d?-1:1,c-=d,e=f*(c<<32|g),[e,b]},A:function(d,c){var b;return b=d.getUint8(c),b=String.fromCharCode(b),c+=1,[b,c]},E:function(d,b){var c;return c=d.getFloat32(b),b+=4,[c,b]},D:function(d,b){var c;return c=d.getFloat64(b),b+=8,[c,b]},C:function(f,b){var c,d,e;return d=f.getFloat32(b),b+=4,e=f.getFloat32(b),b+=4,c=[d,e],[c,b]},M:function(f,b){var c,d,e;return d=f.getFloat64(b),b+=8,e=f.getFloat64(b),b+=8,c=[d,e],[c,b]}},e.prototype.toBits=function(d){var c,b;for(c=[],b=128;b>=1;){c.push(d&b?1:0),b/=2}return c},e.prototype.getFromHeap=function(i,b,f){var c,e,h,d,g;for(g=i.getInt32(b),b+=4,e=i.getInt32(b),b+=4,h=this.heap.slice(e,e+g),c=new this.typedArray[f](h),d=c.length;d--;){c[d]=this.constructor.swapEndian[f](c[d])}return [c,b]},e.prototype.setAccessors=function(o){var j,l,n,d,i,g,k,m,e,f,h,b=this;for(k=/(\d*)([P|Q]*)([L|X|B|I|J|K|A|E|D|C|M]{1})/,h=[],d=e=1,f=this.cols;f>=1?f>=e:e>=f;d=f>=1?++e:--e){n=o.get('TFORM'+d),m=o.get('TTYPE'+d),g=k.exec(n),j=parseInt(g[1])||1,i=g[2],l=g[3],h.push(function(e,f){var g,h;if(b.descriptors.push(e),b.elementByteLengths.push(b.constructor.offsets[e]*f),i){switch(m){case 'COMPRESSED_DATA':g=function(j,g){var i,h,d;return d=b.getFromHeap(j,g,e),i=d[0],g=d[1],h=new b.typedArray[b.algorithmParameters.BYTEPIX](b.ztile[0]),c.Rice(i,b.algorithmParameters.BLOCKSIZE,b.algorithmParameters.BYTEPIX,h,b.ztile[0],c.RiceSetup),[h,g]};break;case 'GZIP_COMPRESSED_DATA':g=function(h,g){var c;for(c=new Float32Array(b.width),d=c.length;d--;){c[d]=0/0}return [c,g]};break;default:g=function(c,d){return b.getFromHeap(c,d,e)};}}else {1===f?g=function(h,c){var g,d;return d=b.dataAccessors[e](h,c),g=d[0],c=d[1],[g,c]}:'X'===e?(h=Math.log(f)/Math.log(2),g=function(n,c){var m,g,j,l,i,d,k;for(j=n.buffer.slice(c,c+h),i=new Uint8Array(j),g=[],d=0,k=i.length;k>d;d++){l=i[d],m=b.toBits(l),g=g.concat(m)}return c+=h,[g.slice(0,+(f-1)+1||9.0E9),c]}):g='A'===e?function(k,c){var g,j,b,h,d,i;for(j=k.buffer.slice(c,c+f),g=new Uint8Array(j),b='',d=0,i=g.length;i>d;d++){h=g[d],b+=String.fromCharCode(h)}return b=b.trim(),c+=f,[b,c]}:function(j,g){var h,i,c;for(d=f,h=[];d--;){c=b.dataAccessors[e](j,g),i=c[0],g=c[1],h.push(i)}return [h,g]}}return b.accessors.push(g)}(l,j))}return h},e.prototype._getRows=function(n,m){var k,b,g,e,c,l,j,d,i,h,f;for(j=new DataView(n),g=0,c=[];m--;){for(e={},h=this.accessors,b=d=0,i=h.length;i>d;b=++d){k=h[b],f=k(j,g),l=f[0],g=f[1],e[this.columns[b]]=l}c.push(e)}return c},e}(f),this.astro.FITS.BinaryTable=i,c={RiceSetup:{1:function(e){var a,b,c,d;return d=1,a=3,b=6,c=e[0],[a,b,c,d]},2:function(f){var a,c,e,b,d;return d=2,c=4,e=14,b=0,a=f[0],b|=a<<8,a=f[1],b|=a,[c,e,b,d]},4:function(c){var a,d,f,b,e;return e=4,d=5,f=25,b=0,a=c[0],b|=a<<24,a=c[1],b|=a<<16,a=c[2],b|=a<<8,a=c[3],b|=a,[d,f,b,e]}},Rice:function(g,t,u,i,q,v){var a,r,d,l,p,s,b,h,e,j,c,n,k,f,m,o;for(r=1<<p,m=v[u](g),p=m[0],s=m[1],j=m[2],f=m[3],n=new Uint8Array(256),k=8,o=[128,255],e=o[0],b=o[1];b>=0;){for(;b>=e;){n[b]=k,b-=1}e/=2,k-=1}for(n[0]=0,a=g[f++],c=8,b=0;q>b;){for(c-=p;0>c;){a=a<<8|g[f++],c+=8}if(l=(a>>c)-1,a&=(1<<c)-1,h=b+t,h>q&&(h=q),0>l){for(;h>b;){i[b]=j,b+=1}}else {if(l===s){for(;h>b;){for(e=r-c,d=a<<e,e-=8;e>=0;){a=g[f++],d|=a<<e,e-=8}c>0?(a=g[f++],d|=a>>-e,a&=(1<<c)-1):a=0,0===(1&d)?d>>=1:d=~(d>>1),i[b]=d+j,j=i[b],b++}}else {for(;h>b;){for(;0===a;){c+=8,a=g[f++]}for(k=c-n[a],c-=k+1,a^=1<<c,c-=l;0>c;){a=a<<8|g[f++],c+=8}d=k<<l|a>>c,a&=(1<<c)-1,0===(1&d)?d>>=1:d=~(d>>1),i[b]=d+j,j=i[b],b++}}}}return i}},this.astro.FITS.Decompress=c,m=function(a){function e(b){var c,g,i,h,d,f;for(e.__super__.constructor.apply(this,arguments),this.zcmptype=b.get('ZCMPTYPE'),this.zbitpix=b.get('ZBITPIX'),this.znaxis=b.get('ZNAXIS'),this.zblank=b.get('ZBLANK'),this.blank=b.get('BLANK'),this.zdither=b.get('ZDITHER0')||0,this.ztile=[],c=d=1,f=this.znaxis;f>=1?f>=d:d>=f;c=f>=1?++d:--d){h=b.contains('ZTILE'+c)?b.get('ZTILE'+c):1===c?b.get('ZNAXIS1'):1,this.ztile.push(h)}for(this.width=b.get('ZNAXIS1'),this.height=b.get('ZNAXIS2')||1,this.algorithmParameters={},'RICE_1'===this.zcmptype&&(this.algorithmParameters.BLOCKSIZE=32,this.algorithmParameters.BYTEPIX=4),c=1;;){if(g='ZNAME'+c,!b.contains(g)){break}i='ZVAL'+c,this.algorithmParameters[b.get(g)]=b.get(i),c+=1}this.zmaskcmp=b.get('ZMASKCMP'),this.zquantiz=b.get('ZQUANTIZ')||'LINEAR_SCALING',this.bzero=b.get('BZERO')||0,this.bscale=b.get('BSCALE')||1}return b(e,a),e.include(e),e.extend(c),e.randomGenerator=function(){var h,e,b,g,c,f,d;for(h=16807,b=2147483647,c=1,g=new Float32Array(10000),e=d=0;9999>=d;e=++d){f=h*c,c=f-b*parseInt(f/b),g[e]=c/b}return g},e.randomSequence=e.randomGenerator(),e.prototype._getRows=function(z,s){var u,e,y,n,h,b,l,m,q,f,c,r,t,g,d,v,x,i,o,p,w,j,k;for(v=new DataView(z),m=0,e=new Float32Array(this.width*this.height);s--;){for(c={},j=this.accessors,b=i=0,p=j.length;p>i;b=++i){u=j[b],k=u(v,m),d=k[0],m=k[1],c[this.columns[b]]=d}for(n=c.COMPRESSED_DATA||c.UNCOMPRESSED_DATA||c.GZIP_COMPRESSED_DATA,y=c.ZBLANK||this.zblank,r=c.ZSCALE||this.bscale,x=c.ZZERO||this.bzero,l=this.height-s,t=l+this.zdither-1,g=(t-1)%10000,f=parseInt(500*this.constructor.randomSequence[g]),b=o=0,w=n.length;w>o;b=++o){d=n[b],h=(l-1)*this.width+b,-2147483647===d?e[h]=0/0:-2147483646===d?e[h]=0:(q=this.constructor.randomSequence[f],e[h]=(d-q+0.5)*r+x),f+=1,10000===f&&(g=(g+1)%10000,f=parseInt(500*this.randomSequence[g]))}}return e},e.prototype.getFrame=function(g,c,d){var f,b,e=this;return this.heap?(this.frame=g||this.frame,this.getRows(0,this.rows,c,d)):(f=this.blob.slice(this.length,this.length+this.heapLength),b=new FileReader(),b.onloadend=function(b){return e.heap=b.target.result,e.getFrame(g,c,d)},b.readAsArrayBuffer(f))},e}(i),this.astro.FITS.CompressedImage=m,h=function(){function t(b,a){this.header=b,this.data=a}return t.prototype.hasData=function(){return null!=this.data?!0:!1},t}(),this.astro.FITS.HDU=h}.call(this),MOC=function(){function t(a){return Math.log(a)/Math.LN2}MOC=function(a){this.order=void 0,this._highResCells={},this._lowResCells={},a=a||{},this.name=a.name||'MOC',this.color=a.color||Color.getNextColor(),this.opacity=a.opacity||1,this.opacity=Math.max(0,Math.min(1,this.opacity)),this.lineWidth=a.lineWidth||1,this.isShowing=!0},MOC.MAX_NORDER=13,MOC.LOWRES_MAXORDER=5,MOC.HIGHRES_MAXORDER=11,MOC.PIVOT_FOV=20,MOC.prototype._addPix=function(b,c){if(MOC.LOWRES_MAXORDER>=b){b in this._lowResCells||(this._lowResCells[b]=[],this._highResCells[b]=[]),this._lowResCells[b].push(c),this._highResCells[b].push(c)}else {if(MOC.HIGHRES_MAXORDER>=b){b in this._highResCells||(this._highResCells[b]=[]),this._highResCells[b].push(c);var a=MOC.LOWRES_MAXORDER,d=Math.floor(c/Math.pow(4,b-a));a in this._lowResCells||(this._lowResCells[a]=[]),this._lowResCells[a].push(d)}else {var a=MOC.LOWRES_MAXORDER,d=Math.floor(c/Math.pow(4,b-a));a in this._lowResCells||(this._lowResCells[a]=[]),this._lowResCells[a].push(d),a=MOC.HIGHRES_MAXORDER,d=Math.floor(c/Math.pow(4,b-a)),a in this._highResCells||(this._highResCells[a]=[]),this._highResCells[a].push(d)}}},MOC.prototype.dataFromJSON=function(c){this._highResCells={},this._lowResCells={};var a,e;for(var b in c){if(c.hasOwnProperty(b)){a=parseInt(b),(void 0===this.order||a>this.order)&&(this.order=a);for(var d=0;c[b].length>d;d++){e=c[b][d],this._addPix(a,e)}}}},MOC.prototype.dataFromFITSURL=function(c,b){this._highResCells={},this._lowResCells={};var a=this,e=function(){var d;try{d=this.getHeader(0)}catch(h){return console.err('Could not get header of extension #0'),void 0}var f=this.getHeader(1);if(d.contains('HPXMOC')){a.order=d.get('HPXMOC')}else {if(d.contains('MOCORDER')){a.order=d.get('MOCORDER')}else {if(f.contains('HPXMOC')){a.order=f.get('HPXMOC')}else {if(!f.contains('MOCORDER')){return console.err('Can not find MOC order in FITS file'),void 0}a.order=f.get('MOCORDER')}}}var e=this.getDataUnit(1),g=e.columns[0];e.getRows(0,e.rows,function(e){for(var d=0;e.length>d;d++){var h=e[d][g],f=Math.floor(Math.floor(t(Math.floor(h/4)))/2),i=h-4*Math.pow(4,f);a._addPix(f,i)}}),e=null,b&&b()};this.dataURL=c;var d=Aladin.JSONP_PROXY+'?url='+encodeURIComponent(this.dataURL);new astro.FITS(d,e)},MOC.prototype.setView=function(a){this.view=a},MOC.prototype.draw=function(i,c,e,g,h,f,b,a){if(this.isShowing){var d=a>MOC.PIVOT_FOV?this._lowResCells:this._highResCells;this._drawCells(i,d,a,c,e,CooFrameEnum.J2000,g,h,f,b)}},MOC.prototype._drawCells=function(e,g,y,r,l,q,o,p,m,s){e.lineWidth=this.lineWidth,1==this.opacity?e.strokeStyle=this.color:(e.fillStyle=this.color,e.globalAlpha=this.opacity),e.beginPath();var j=[];for(key in g){j.push(key)}j.sort();var n,d,h;if(y>80){for(var c,t=0;j.length>t;t++){c=parseInt(j[t]),n=1<<c;for(var f=0;g[c].length>f;f++){if(h=g[c][f],c>=3){d=b(n,h,l,q,o,p,m,s,r),d&&a(e,d)}else {for(var k=Math.pow(4,3-c),u=h*k,i=0;k>i;i++){d=b(8,u+i,l,q,o,p,m,s,r),d&&a(e,d)}}}}}else {this.view.getVisiblePixList(3,CooFrameEnum.J2000);for(var v={},w=parseInt(j[j.length-1]),c=1;w>=c;c++){if(n=1<<c,void 0!==g[c]){if(3>=c){for(var f=0;g[c].length>f;f++){h=g[c][f];for(var k=Math.pow(4,3-c),u=h*k,i=0;k>i;i++){norder3Ipix=u+i,d=b(8,norder3Ipix,l,q,o,p,m,s,r),d&&a(e,d),v[norder3Ipix]=1}}}else {for(var f=0;g[c].length>f;f++){h=g[c][f];var x=Math.floor(h/Math.pow(4,c-3));x in v||(d=b(n,h,l,q,o,p,m,s,r),d&&a(e,d))}}}}}1==this.opacity?e.stroke():(e.fill(),e.globalAlpha=1)};var a=function(b,a){b.moveTo(a[0].vx,a[0].vy),b.lineTo(a[1].vx,a[1].vy),b.lineTo(a[2].vx,a[2].vy),b.lineTo(a[3].vx,a[3].vy),b.lineTo(a[0].vx,a[0].vy)},b=function(o,k,m,h,g,f,j,n,l){for(var a=[],c=[],d=new SpatialVector(),i=HealpixCache.corners_nest(k,o),b=0;4>b;b++){if(d.setXYZ(i[b].x,i[b].y,i[b].z),h&&h!=m){if(h==CooFrameEnum.J2000){var e=CooConversion.J2000ToGalactic([d.ra(),d.dec()]);lon=e[0],lat=e[1]}else {if(h==CooFrameEnum.GAL){var e=CooConversion.GalacticToJ2000([d.ra(),d.dec()]);lon=e[0],lat=e[1]}}}else {lon=d.ra(),lat=d.dec()}c[b]=l.project(lon,lat)}if(null==c[0]||null==c[1]||null==c[2]||null==c[3]){return null}for(var b=0;4>b;b++){a[b]=AladinUtils.xyToView(c[b].X,c[b].Y,g,f,j,n)}return 0>a[0].vx&&0>a[1].vx&&0>a[2].vx&&0>a[3].vx?null:0>a[0].vy&&0>a[1].vy&&0>a[2].vy&&0>a[3].vy?null:a[0].vx>=g&&a[1].vx>=g&&a[2].vx>=g&&a[3].vx>=g?null:a[0].vy>=f&&a[1].vy>=f&&a[2].vy>=f&&a[3].vy>=f?null:a=AladinUtils.grow2(a,1)};return MOC.prototype.reportChange=function(){this.view.requestRedraw()},MOC.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},MOC.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},MOC}(),CooGrid=function(){function t(i,d,e,g,h,f,c){var a,b=AladinUtils.viewToXy(d,e,g,h,f,c);try{a=i.unproject(b.x,b.y)}catch(j){return null}return {lon:a.ra,lat:a.dec}}var a=function(){};return a.prototype.redraw=function(b,l,A,d,c,k,n,u){if(!(u>60)){var m=0,g=359.9999,o=-90,i=90,q=t(l,0,0,d,c,k,n),r=t(l,d-1,c-1,d,c,k,n);g=Math.min(q.lon,r.lon),m=Math.max(q.lon,r.lon),i=Math.min(q.lat,r.lat),o=Math.max(q.lat,r.lat);var v=t(l,0,c-1,d,c,k,n);g=Math.min(g,v.lon),m=Math.max(m,v.lon),i=Math.min(i,v.lat),o=Math.max(o,v.lat);var s=t(l,d-1,0,d,c,k,n);g=Math.min(g,s.lon),m=Math.max(m,s.lon),i=Math.min(i,s.lat),o=Math.max(o,s.lat);var h,j,x=m-g,y=o-i;u>10?(h=4,j=4):u>1?(h=1,j=1):u>0.1?(h=0.1,j=0.1):(h=0.01,j=0.01);var w=Math.round(g%h)*h,z=Math.round(i%j)*j;b.lineWidth=1,b.strokeStyle='rgb(120,120,255)';for(var f=z;o+j>f;f+=j){b.beginPath();var a;if(a=AladinUtils.radecToViewXy(g,f,l,CooFrameEnum.J2000,d,c,k,n)){b.moveTo(a.vx,a.vy);for(var p=0,e=g;m+h>e;e+=x/10){p++,a=AladinUtils.radecToViewXy(e,f,l,CooFrameEnum.J2000,d,c,k,n),b.lineTo(a.vx,a.vy),3==p&&b.strokeText(f.toFixed(2),a.vx,a.vy-2)}b.stroke()}}for(var e=w;m+h>e;e+=h){b.beginPath();var a;if(a=AladinUtils.radecToViewXy(e,i,l,CooFrameEnum.J2000,d,c,k,n)){b.moveTo(a.vx,a.vy);for(var p=0,f=i;o+j>f;f+=y/10){p++,a=AladinUtils.radecToViewXy(e,f,l,CooFrameEnum.J2000,d,c,k,n),b.lineTo(a.vx,a.vy),3==p&&b.strokeText(e.toFixed(2),a.vx,a.vy-2)}b.stroke()}}}},a}(),Footprint=function(){return Footprint=function(a){this.polygons=a,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Footprint.prototype.setOverlay=function(a){this.overlay=a},Footprint.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Footprint.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Footprint}(),Popup=function(){return Popup=function(b){this.domEl=$('<div class="aladin-popup-container"><div class="aladin-popup"><a class="aladin-closeBtn">&times;</a><div class="aladin-popupTitle"></div><div class="aladin-popupText"></div></div><div class="aladin-popup-arrow"></div></div>'),this.domEl.appendTo(b);var a=this;this.domEl.find('.aladin-closeBtn').click(function(){a.hide()})},Popup.prototype.hide=function(){this.domEl.hide()},Popup.prototype.show=function(){this.domEl.show()},Popup.prototype.setTitle=function(a){this.domEl.find('.aladin-popupTitle').html(a||'')},Popup.prototype.setText=function(a){this.domEl.find('.aladin-popupText').html(a||''),this.w=this.domEl.outerWidth(),this.h=this.domEl.outerHeight()},Popup.prototype.setSource=function(a){this.source&&(this.source.popup=null),a.popup=this,this.source=a,this.setPosition(a.x,a.y)},Popup.prototype.setPosition=function(d,a){var b=d-this.w/2,c=a-this.h+this.source.catalog.sourceSize/2;this.domEl[0].style.left=b+'px',this.domEl[0].style.top=c+'px'},Popup}(),Circle=function(){return Circle=function(c,b,a){a=a||{},this.color=a.color||void 0,this.setCenter(c),this.setRadius(b),this.overlay=null,this.isShowing=!0,this.isSelected=!1},Circle.prototype.setOverlay=function(a){this.overlay=a},Circle.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.setCenter=function(a){this.centerRaDec=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.setRadius=function(a){this.radiusDegrees=a,this.overlay&&this.overlay.reportChange()},Circle.prototype.draw=function(f,e,k,n,o,l,h){if(this.isShowing){var c;if(k!=CooFrameEnum.J2000){var a=CooConversion.J2000ToGalactic([this.centerRaDec[0],this.centerRaDec[1]]);c=e.project(a[0],a[1])}else {c=e.project(this.centerRaDec[0],this.centerRaDec[1])}if(c){var b,d=AladinUtils.xyToView(c.X,c.Y,n,o,l,h,!1),g=this.centerRaDec[0],m=this.centerRaDec[1]+(g>0?-this.radiusDegrees:this.radiusDegrees);if(k!=CooFrameEnum.J2000){var a=CooConversion.J2000ToGalactic([g,m]);b=e.project(a[0],a[1])}else {b=e.project(g,m)}if(b){var i=AladinUtils.xyToView(b.X,b.Y,n,o,l,h,!1),j=i.vx-d.vx,p=i.vy-d.vy,q=Math.sqrt(j*j+p*p);this.color&&(f.strokeStyle=this.color),f.beginPath(),f.arc(d.vx,d.vy,q,0,2*Math.PI,!1),f.stroke()}}}},Circle}(),Polyline=function(){return Polyline=function(b,a){a=a||{},this.color=a.color||void 0,this.radecArray=b,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Polyline.prototype.setOverlay=function(a){this.overlay=a},Polyline.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.draw=function(c,f,g,i,j,h,e){if(this.isShowing&&this.radecArray&&!(2>this.radecArray.length)){this.color&&(c.strokeStyle=this.color);var d=AladinUtils.radecToViewXy(this.radecArray[0][0],this.radecArray[0][1],f,g,i,j,h,e);if(d){c.moveTo(d.vx,d.vy);for(var a,b=1;this.radecArray.length>b&&(a=AladinUtils.radecToViewXy(this.radecArray[b][0],this.radecArray[b][1],f,g,i,j,h,e),a);b++){c.lineTo(a.vx,a.vy)}c.stroke()}}},Polyline}(),Overlay=function(){return Overlay=function(a){a=a||{},this.name=a.name||'overlay',this.color=a.color||Color.getNextColor(),this.lineWidth=a.lineWidth||2,this.overlays=[],this.overlay_items=[],this.isShowing=!0},Overlay.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},Overlay.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},Overlay.parseSTCS=function(i){for(var b,d=[],c=i.match(/\S+/g),a=0,f=c.length;f>a;){var g=c[a].toLowerCase();if('polygon'==g&&(b=[],a++,frame=c[a].toLowerCase(),'icrs'==frame||'j2000'==frame)){for(;f>a+2;){var e=parseFloat(c[a+1]);if(isNaN(e)){break}var h=parseFloat(c[a+2]);b.push([e,h]),a+=2}b.push(b[0]),d.push(b)}a++}return d},Overlay.prototype.addFootprints=function(b){this.overlays=this.overlays.concat(b);for(var a=0,c=b.length;c>a;a++){b[a].setOverlay(this)}this.view.requestRedraw()},Overlay.prototype.add=function(a){this.overlay_items.push(a),a.setOverlay(this),this.view.requestRedraw()},Overlay.prototype.getFootprint=function(a){return this.footprints.length>a?this.footprints[a]:null},Overlay.prototype.setView=function(a){this.view=a},Overlay.prototype.removeAll=function(){this.overlays=[],this.overlay_items=[]},Overlay.prototype.draw=function(b,e,f,h,i,g,d){if(this.isShowing){b.strokeStyle=this.color,b.lineWidth=this.lineWidth,b.beginPath(),xyviews=[];for(var a=0,c=this.overlays.length;c>a;a++){xyviews.push(this.drawFootprint(this.overlays[a],b,e,f,h,i,g,d))}b.stroke(),b.strokeStyle=Overlay.increase_brightness(this.color,80),b.beginPath();for(var a=0,c=this.overlays.length;c>a;a++){this.overlays[a].isSelected&&this.drawFootprintSelected(b,xyviews[a])}b.stroke();for(var a=0;this.overlay_items.length>a;a++){this.overlay_items[a].draw(b,e,f,h,i,g,d)}}},Overlay.increase_brightness=function(a,b){a=a.replace(/^\s*#|\s*$/g,''),3==a.length&&(a=a.replace(/(.)/g,'$1$1'));var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return '#'+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)},Overlay.prototype.drawFootprint=function(m,h,j,p,l,k,n,o){if(!m.isShowing){return null}for(var b=[],f=!1,c=m.polygons,a=0,g=c.length;g>a;a++){var d;if(p!=CooFrameEnum.J2000){var i=CooConversion.J2000ToGalactic([c[a][0],c[a][1]]);d=j.project(i[0],i[1])}else {d=j.project(c[a][0],c[a][1])}if(!d){return null}var e=AladinUtils.xyToView(d.X,d.Y,l,k,n,o);b.push(e),!f&&l>e.vx&&e.vx>=0&&k>=e.vy&&e.vy>=0&&(f=!0)}if(f){h.moveTo(b[0].vx,b[0].vy);for(var a=1,g=b.length;g>a;a++){h.lineTo(b[a].vx,b[a].vy)}}return b},Overlay.prototype.drawFootprintSelected=function(d,c){if(c){var a=c;d.moveTo(a[0].vx,a[0].vy);for(var b=1,e=a.length;e>b;b++){d.lineTo(a[b].vx,a[b].vy)}}},Overlay.prototype.reportChange=function(){this.view.requestRedraw()},Overlay}(),cds.Source=function(){return cds.Source=function(d,b,c,a){this.ra=d,this.dec=b,this.data=c,this.catalog=null,this.marker=a&&a.marker||!1,this.marker&&(this.popupTitle=a&&a.popupTitle?a.popupTitle:'',this.popupDesc=a&&a.popupDesc?a.popupDesc:''),this.isShowing=!0,this.isSelected=!1},cds.Source.prototype.setCatalog=function(a){this.catalog=a},cds.Source.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.actionClicked=function(){if(this.catalog&&this.catalog.onClick){var b=this.catalog.view;if('showTable'==this.catalog.onClick){b.aladin.measurementTable.showMeasurement(this),this.select()}else {if('showPopup'==this.catalog.onClick){b.popup.setTitle('<br><br>');var a='<div class="aladin-marker-measurement">';a+='<table>';for(var c in this.data){a+='<tr><td>'+c+'</td><td>'+this.data[c]+'</td></tr>'}a+='</table>',a+='</div>',b.popup.setText(a),b.popup.setSource(this),b.popup.show()}}}},cds.Source.prototype.actionOtherObjectClicked=function(){this.catalog&&this.catalog.onClick&&'showTable'==this.catalog.onClick&&this.deselect()},cds.Source}(),ProgressiveCat=function(){function t(a,e){var b=['name','ID','ucd','utype','unit','datatype','arraysize','width','precision'],c=[],d=0;return a.keyRa=a.keyDec=null,$(e).find('FIELD').each(function(){for(var f={},h=0;b.length>h;h++){var g=b[h];$(this).attr(g)&&(f[g]=$(this).attr(g))}f.ID||(f.ID='col_'+d),a.keyRa||!f.ucd||0!=f.ucd.indexOf('pos.eq.ra')&&0!=f.ucd.indexOf('POS_EQ_RA')||(a.keyRa=f.name?f.name:f.ID),a.keyDec||!f.ucd||0!=f.ucd.indexOf('pos.eq.dec')&&0!=f.ucd.indexOf('POS_EQ_DEC')||(a.keyDec=f.name?f.name:f.ID),c.push(f),d++}),c}function e(a,n,e){if(!a.keyRa||!a.keyDec){return []}lines=n.split('\n');for(var c=[],d=0;e.length>d;d++){e[d].name?c.push(e[d].name):c.push(e[d].ID)}for(var j,l=[],i=new Coo(),h=2;lines.length>h;h++){var b={},m=lines[h].split('\t');if(!(m.length<c.length)){for(var f=0;c.length>f;f++){b[c[f]]=m[f]}var k,g;Utils.isNumber(b[a.keyRa])&&Utils.isNumber(b[a.keyDec])?(k=parseFloat(b[a.keyRa]),g=parseFloat(b[a.keyDec])):(i.parse(b[a.keyRa]+' '+b[a.keyDec]),k=i.lon,g=i.lat),j=new cds.Source(k,g,b),l.push(j),j.setCatalog(a)}}return l}return ProgressiveCat=function(e,c,d,b){b=b||{},this.type='progressivecat',this.rootUrl=e,this.frameStr=c,this.frame=CooFrameEnum.fromString(c)||CooFrameEnum.J2000,this.maxOrder=d,this.isShowing=!0,this.name=b.name||'progressive-cat',this.color=b.color||Color.getNextColor(),this.shape=b.shape||'square',this.sourceSize=b.sourceSize||6,this.selectSize=this.sourceSize+2,this.selectionColor='#00ff00',this.onClick=b.onClick||void 0,this.sourcesCache=new Utils.LRUCache(100),this.cacheCanvas=cds.Catalog.createShape(this.shape,this.color,this.sourceSize),this.cacheSelectCanvas=document.createElement('canvas'),this.cacheSelectCanvas.width=this.selectSize,this.cacheSelectCanvas.height=this.selectSize;var a=this.cacheSelectCanvas.getContext('2d');a.beginPath(),a.strokeStyle=this.selectionColor,a.lineWidth=2,a.moveTo(0,0),a.lineTo(0,this.selectSize),a.lineTo(this.selectSize,this.selectSize),a.lineTo(this.selectSize,0),a.lineTo(0,0),a.stroke(),this.maxOrderAllsky=2,this.isReady=!1},ProgressiveCat.readProperties=function(d,a,b){if(a){var c=d+'/properties';$.ajax({url:c,method:'GET',dataType:'text',success:function(k){for(var g={},h=k.split('\n'),e=0;h.length>e;e++){var c=h[e],f=c.indexOf('='),j=$.trim(c.substring(0,f)),i=$.trim(c.substring(f+1));g[j]=i}a(g)},error:function(c){b&&b(c)}})}},ProgressiveCat.prototype={init:function(b){var a=this;this.view=b,this.maxOrder&&this.frameStr?this._loadMetadata():ProgressiveCat.readProperties(a.rootUrl,function(c){a.properties=c,a.maxOrder=a.properties.hips_order,a.frame=CooFrameEnum.fromString(a.properties.hips_frame),a._loadMetadata()},function(){console.log('Could not find properties for HiPS '+a.rootUrl)})},_loadMetadata:function(){var a=this;$.ajax({url:a.rootUrl+'/'+'Metadata.xml',method:'GET',success:function(b){a.fields=t(a,b),a._loadAllskyNewMethod()},error:function(){a._loadAllskyOldMethod()}})},_loadAllskyNewMethod:function(){var a=this;$.ajax({url:a.rootUrl+'/'+'Norder1/Allsky.tsv',method:'GET',success:function(b){a.order1Sources=e(a,b,a.fields),a.order2Sources&&(a.isReady=!0,a.view.requestRedraw())},error:function(a){console.log('Something went wrong: '+a)}}),$.ajax({url:a.rootUrl+'/'+'Norder2/Allsky.tsv',method:'GET',success:function(b){a.order2Sources=e(a,b,a.fields),a.order1Sources&&(a.isReady=!0,a.view.requestRedraw())},error:function(a){console.log('Something went wrong: '+a)}})},_loadAllskyOldMethod:function(){this.maxOrderAllsky=3,this._loadLevel2Sources(),this._loadLevel3Sources()},_loadLevel2Sources:function(){var a=this;$.ajax({url:a.rootUrl+'/'+'Norder2/Allsky.xml',method:'GET',success:function(b){a.fields=t(a,b),a.order2Sources=e(a,$(b).find('CSV').text(),a.fields),a.order3Sources&&(a.isReady=!0,a.view.requestRedraw())},error:function(a){console.log('Something went wrong: '+a)}})},_loadLevel3Sources:function(){var a=this;$.ajax({url:a.rootUrl+'/'+'Norder3/Allsky.xml',method:'GET',success:function(b){a.order3Sources=e(a,$(b).find('CSV').text(),a.fields),a.order2Sources&&(a.isReady=!0,a.view.requestRedraw())},error:function(a){console.log('Something went wrong: '+a)}})},draw:function(g,b,c,e,f,d,a){if(this.isShowing&&this.isReady&&(this.drawSources(this.order1Sources,g,b,c,e,f,d,a),this.drawSources(this.order2Sources,g,b,c,e,f,d,a),this.drawSources(this.order3Sources,g,b,c,e,f,d,a),this.tilesInView)){for(var j,k,i,h=0;this.tilesInView.length>h;h++){i=this.tilesInView[h],k=i[0]+'-'+i[1],j=this.sourcesCache.get(k),j&&this.drawSources(j,g,b,c,e,f,d,a)}}},drawSources:function(b,d,f,i,j,h,e,g){if(b){for(var a=0,c=b.length;c>a;a++){cds.Catalog.drawSource(this,b[a],d,f,i,j,h,e,g)}for(var a=0,c=b.length;c>a;a++){b[a].isSelected&&cds.Catalog.drawSourceSelection(this,b[a],d)}}},getSources:function(){var a=[];if(this.order1Sources&&(a=a.concat(this.order1Sources)),this.order2Sources&&(a=a.concat(this.order2Sources)),this.order3Sources&&(a=a.concat(this.order3Sources)),this.tilesInView){for(var b,e,c,d=0;this.tilesInView.length>d;d++){c=this.tilesInView[d],e=c[0]+'-'+c[1],b=this.sourcesCache.get(e),b&&(a=a.concat(b))}}return a},deselectAll:function(){if(this.order1Sources){for(var a=0;this.order1Sources.length>a;a++){this.order1Sources[a].deselect()}}if(this.order2Sources){for(var a=0;this.order2Sources.length>a;a++){this.order2Sources[a].deselect()}}if(this.order3Sources){for(var a=0;this.order3Sources.length>a;a++){this.order3Sources[a].deselect()}}var c=this.sourcesCache.keys();for(key in c){if(this.sourcesCache[key]){for(var b=this.sourcesCache[key],a=0;b.length>a;a++){b[a].deselect()}}}},show:function(){this.isShowing||(this.isShowing=!0,this.reportChange())},hide:function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},reportChange:function(){this.view.requestRedraw()},getTileURL:function(c,a){var b=10000*Math.floor(a/10000);return this.rootUrl+'/'+'Norder'+c+'/Dir'+b+'/Npix'+a+'.tsv'},loadNeededTiles:function(){this.tilesInView=[],this.otherSources=[];var b=this.view.realNorder;if(b>this.maxOrder&&(b=this.maxOrder),!(this.maxOrderAllsky>=b)){for(var d,h,j=this.view.getVisibleCells(b,this.frame),f=4;b>=f;f++){d=[];for(var a=0;j.length>a;a++){h=Math.floor(j[a].ipix/Math.pow(4,b-f)),0>d.indexOf(h)&&d.push(h)}for(var g=0;d.length>g;g++){this.tilesInView.push([f,d[g]])}}for(var c,i,a=0;this.tilesInView.length>a;a++){c=this.tilesInView[a],i=c[0]+'-'+c[1],this.sourcesCache.get(i)||function(a,b,c){var d=b+'-'+c;$.ajax({url:a.getTileURL(b,c),method:'GET',success:function(f){a.sourcesCache.set(d,e(a,f,a.fields)),a.view.requestRedraw()},error:function(){a.sourcesCache.set(d,[])}})}(this,c[0],c[1])}}},reportChange:function(){this.view&&this.view.requestRedraw()}},ProgressiveCat}(),cds.Catalog=function(){function t(f,h,i){var d,e;if(d=e=null,h){for(var a=0,g=f.length;g>a;a++){var b=f[a];if(Utils.isInt(h)&&f.length>h){d=h;break}if(b.ID&&b.ID===h||b.name&&b.name===h){d=a;break}}}if(i){for(var a=0,g=f.length;g>a;a++){var b=f[a];if(Utils.isInt(i)&&f.length>i){e=i;break}if(b.ID&&b.ID===i||b.name&&b.name===i){e=a;break}}}for(var a=0,g=f.length;g>a&&(null==d||null==e);a++){var b=f[a];if(!d&&b.ucd){var j=$.trim(b.ucd.toLowerCase());if(0==j.indexOf('pos.eq.ra')||0==j.indexOf('pos_eq_ra')){d=a;continue}}if(!e&&b.ucd){var j=$.trim(b.ucd.toLowerCase());if(0==j.indexOf('pos.eq.dec')||0==j.indexOf('pos_eq_dec')){e=a;continue}}}if(null==d&&null==e){for(var a=0,g=f.length;g>a;a++){var b=f[a],c=b.name||b.ID||'';c=c.toLowerCase(),d||0!=c.indexOf('ra')&&0!=c.indexOf('_ra')&&0!=c.indexOf('ra(icrs)')&&0!=c.indexOf('_ra')&&0!=c.indexOf('alpha')?e||0!=c.indexOf('dej2000')&&0!=c.indexOf('_dej2000')&&0!=c.indexOf('de')&&0!=c.indexOf('de(icrs)')&&0!=c.indexOf('_de')&&0!=c.indexOf('delta')||(e=a):d=a}}return (null==d||null==e)&&(d=0,e=1),[d,e]}return cds.Catalog=function(a){a=a||{},this.type='catalog',this.name=a.name||'catalog',this.color=a.color||Color.getNextColor(),this.sourceSize=a.sourceSize||6,this.markerSize=a.sourceSize||12,this.shape=a.shape||'square',this.maxNbSources=a.limit||void 0,this.onClick=a.onClick||void 0,this.raField=a.raField||void 0,this.decField=a.decField||void 0,this.displayLabel=a.displayLabel||!1,this.labelColor=a.labelColor||this.color,this.labelFont=a.labelFont||'10px sans-serif',this.displayLabel&&(this.labelColumn=a.labelColumn,this.labelColumn||(this.displayLabel=!1)),(this.shape instanceof Image||this.shape instanceof HTMLCanvasElement)&&(this.sourceSize=this.shape.width),this._shapeIsFunction=!1,$.isFunction(this.shape)&&(this._shapeIsFunction=!0),this.selectSize=this.sourceSize+2,this.isShowing=!0,this.indexationNorder=5,this.sources=[],this.hpxIdx=new HealpixIndex(this.indexationNorder),this.hpxIdx.init(),this.selectionColor='#00ff00',this.cacheCanvas=cds.Catalog.createShape(this.shape,this.color,this.sourceSize),this.cacheMarkerCanvas=document.createElement('canvas'),this.cacheMarkerCanvas.width=this.markerSize,this.cacheMarkerCanvas.height=this.markerSize;var c=this.cacheMarkerCanvas.getContext('2d');c.fillStyle=this.color,c.beginPath();var d=this.markerSize/2;c.arc(d,d,d-2,0,2*Math.PI,!1),c.fill(),c.lineWidth=2,c.strokeStyle='#ccc',c.stroke(),this.cacheSelectCanvas=document.createElement('canvas'),this.cacheSelectCanvas.width=this.selectSize,this.cacheSelectCanvas.height=this.selectSize;var b=this.cacheSelectCanvas.getContext('2d');b.beginPath(),b.strokeStyle=this.selectionColor,b.lineWidth=2,b.moveTo(0,0),b.lineTo(0,this.selectSize),b.lineTo(this.selectSize,this.selectSize),b.lineTo(this.selectSize,0),b.lineTo(0,0),b.stroke()},cds.Catalog.createShape=function(c,e,b){if(c instanceof Image||c instanceof HTMLCanvasElement){return c}var d=document.createElement('canvas');d.width=d.height=b;var a=d.getContext('2d');return a.beginPath(),a.strokeStyle=e,a.lineWidth=2,'plus'==c?(a.moveTo(b/2,0),a.lineTo(b/2,b),a.stroke(),a.moveTo(0,b/2),a.lineTo(b,b/2),a.stroke()):'cross'==c?(a.moveTo(0,0),a.lineTo(b-1,b-1),a.stroke(),a.moveTo(b-1,0),a.lineTo(0,b-1),a.stroke()):'rhomb'==c?(a.moveTo(b/2,0),a.lineTo(0,b/2),a.lineTo(b/2,b),a.lineTo(b,b/2),a.lineTo(b/2,0),a.stroke()):'triangle'==c?(a.moveTo(b/2,0),a.lineTo(0,b-1),a.lineTo(b-1,b-1),a.lineTo(b/2,0),a.stroke()):(a.moveTo(0,0),a.lineTo(0,b),a.lineTo(b,b),a.lineTo(b,0),a.lineTo(0,0),a.stroke()),d},cds.Catalog.parseVOTable=function(c,d,a,g,f,b){function n(h){var e;if(h.find('RESOURCE').length>0){e=''}else {if(e=h.find('*').first(),0==e.length){return ''}e=e.prop('tagName');var i=e.indexOf(':');e=e.substring(0,i)+'\\:'}return e}function h(k,s){k=k.replace(/^\s+/g,'');var v=['name','ID','ucd','utype','unit','datatype','arraysize','width','precision'],e=[],u=0,j=$(k),o=n(j);j.find(o+'FIELD').each(function(){for(var h={},i=0;v.length>i;i++){var j=v[i];$(this).attr(j)&&(h[j]=$(this).attr(j))}h.ID||(h.ID='col_'+u),e.push(h),u++});var i,h,r=t(e,f,b);i=r[0],h=r[1];var p,l,m=[],q=new Coo();j.find(o+'TR').each(function(){var j={},n=0;$(this).find(o+'TD').each(function(){var h=e[n].name?e[n].name:e[n].id;j[h]=$(this).text(),n++});var r=e[i].name?e[i].name:e[i].id,t=e[h].name?e[h].name:e[h].id;return Utils.isNumber(j[r])&&Utils.isNumber(j[t])?(p=parseFloat(j[r]),l=parseFloat(j[t])):(q.parse(j[r]+' '+j[t]),p=q.lon,l=q.lat),m.push(new cds.Source(p,l,j)),a&&m.length==a?!1:void 0}),s&&s(m)}var e=Utils.getAjaxObject(c,'GET','text',g);e.done(function(e){h(e,d)})},cds.Catalog.prototype.addSources=function(a){a=[].concat(a),this.sources=this.sources.concat(a);for(var b=0,c=a.length;c>b;b++){a[b].setCatalog(this)}this.reportChange()},cds.Catalog.prototype.addSourcesAsArray=function(d,k){for(var n=[],b=0;d.length>b;b++){n.push({name:d[b]})}var e,c,l=t(n,this.raField,this.decField);e=l[0],c=l[1];for(var h,i,a,j,m=[],f=new Coo(),g=0;k.length>g;g++){a=k[g],Utils.isNumber(a[e])&&Utils.isNumber(a[c])?(h=parseFloat(a[e]),i=parseFloat(a[c])):(f.parse(a[e]+' '+a[c]),h=f.lon,i=f.lat),j={};for(var b=0;d.length>b;b++){j[d[b]]=a[b]}m.push(A.source(h,i,j))}this.addSources(m)},cds.Catalog.prototype.getSources=function(){return this.sources},cds.Catalog.prototype.selectAll=function(){if(this.sources){for(var a=0;this.sources.length>a;a++){this.sources[a].select()}}},cds.Catalog.prototype.deselectAll=function(){if(this.sources){for(var a=0;this.sources.length>a;a++){this.sources[a].deselect()}}},cds.Catalog.prototype.getSource=function(a){return this.sources.length>a?this.sources[a]:null},cds.Catalog.prototype.setView=function(a){this.view=a,this.reportChange()},cds.Catalog.prototype.removeAll=cds.Catalog.prototype.clear=function(){this.sources=[]},cds.Catalog.prototype.draw=function(b,e,f,h,i,g,d){if(this.isShowing){this._shapeIsFunction&&b.save();for(var a=0,c=this.sources.length;c>a;a++){cds.Catalog.drawSource(this,this.sources[a],b,e,f,h,i,g,d)}this._shapeIsFunction&&b.restore(),b.strokeStyle=this.selectionColor;for(var a=0,c=this.sources.length;c>a;a++){this.sources[a].isSelected&&cds.Catalog.drawSourceSelection(this,this.sources[a],b)}if(this.displayLabel){b.fillStyle=this.labelColor,b.font=this.labelFont;for(var a=0,c=this.sources.length;c>a;a++){cds.Catalog.drawSourceLabel(this,this.sources[a],b)}}}},cds.Catalog.drawSource=function(b,a,f,j,n,i,g,m,l){if(a.isShowing){var d,h=b.sourceSize;if(n!=CooFrameEnum.J2000){var k=CooConversion.J2000ToGalactic([a.ra,a.dec]);d=j.project(k[0],k[1])}else {d=j.project(a.ra,a.dec)}if(d){var c=AladinUtils.xyToView(d.X,d.Y,i,g,m,l,!0),e=a.popup?100:a.sourceSize;if(c){if(c.vx>i+e||0-e>c.vx||c.vy>g+e||0-e>c.vy){return a.x=a.y=void 0,void 0}a.x=c.vx,a.y=c.vy,b._shapeIsFunction?b.shape(a,f,b.view.getViewParams()):a.marker?f.drawImage(b.cacheMarkerCanvas,a.x-h/2,a.y-h/2):f.drawImage(b.cacheCanvas,a.x-b.cacheCanvas.width/2,a.y-b.cacheCanvas.height/2),a.popup&&a.popup.setPosition(a.x,a.y)}}}},cds.Catalog.drawSourceSelection=function(c,a,d){if(a&&a.isShowing&&a.x&&a.y){var b=c.selectSize;d.drawImage(c.cacheSelectCanvas,a.x-b/2,a.y-b/2)}},cds.Catalog.drawSourceLabel=function(d,a,c){if(a&&a.isShowing&&a.x&&a.y){var b=a.data[d.labelColumn];b&&c.fillText(b,a.x,a.y)}},cds.Catalog.prototype.reportChange=function(){this.view&&this.view.requestRedraw()},cds.Catalog.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},cds.Catalog.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.view&&this.view.popup&&this.view.popup.source&&this.view.popup.source.catalog==this&&this.view.popup.hide(),this.reportChange())},cds.Catalog}(),Tile=function(){function t(b,a){this.img=b,this.url=a}return t.isImageOk=function(a){return a.allSkyTexture?!0:a.src?a.complete?a.naturalWidth!==void 0&&0==a.naturalWidth?!1:!0:!1:!1},t}(),TileBuffer=function(){function t(){this.pointer=0,this.tilesMap={},this.tilesArray=Array(a);for(var b=0;a>b;b++){this.tilesArray[b]=new Tile(new Image(),null)}}var a=800;return t.prototype.addTile=function(b){if(this.getTile(b)){return null}var c=this.tilesArray[this.pointer];return null!=c.url&&(c.img.src=null,delete this.tilesMap[c.url]),this.tilesArray[this.pointer].url=b,this.tilesMap[b]=this.tilesArray[this.pointer],this.pointer++,this.pointer>=a&&(this.pointer=0),this.tilesMap[b]},t.prototype.getTile=function(a){return this.tilesMap[a]},t}(),ColorMap=function(){return ColorMap=function(a){this.view=a,this.reversed=!1,this.mapName='native',this.sig=this.signature()},ColorMap.MAPS={},ColorMap.MAPS.eosb={name:'Eos B',r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.rainbow={name:'Rainbow',r:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],b:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.cubehelix={name:'Cubehelix',r:[0,1,3,4,6,8,9,10,12,13,14,15,17,18,19,20,20,21,22,23,23,24,24,25,25,25,26,26,26,26,26,26,26,26,26,26,26,25,25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21,21,21,21,20,20,20,21,21,21,21,21,22,22,22,23,23,24,25,26,27,27,28,30,31,32,33,35,36,38,39,41,43,45,47,49,51,53,55,57,60,62,65,67,70,72,75,78,81,83,86,89,92,95,98,101,104,107,110,113,116,120,123,126,129,132,135,138,141,144,147,150,153,155,158,161,164,166,169,171,174,176,178,181,183,185,187,189,191,193,194,196,198,199,201,202,203,204,205,206,207,208,209,209,210,211,211,211,212,212,212,212,212,212,212,212,211,211,211,210,210,210,209,208,208,207,207,206,205,205,204,203,203,202,201,201,200,199,199,198,197,197,196,196,195,195,194,194,194,193,193,193,193,193,193,193,193,193,193,194,194,195,195,196,196,197,198,199,200,200,202,203,204,205,206,208,209,210,212,213,215,217,218,220,222,223,225,227,229,231,232,234,236,238,240,242,244,245,247,249,251,253,255],g:[0,0,1,1,2,2,3,4,4,5,6,6,7,8,9,10,11,11,12,13,14,15,17,18,19,20,21,22,24,25,26,28,29,31,32,34,35,37,38,40,41,43,45,46,48,50,52,53,55,57,58,60,62,64,66,67,69,71,73,74,76,78,79,81,83,84,86,88,89,91,92,94,95,97,98,99,101,102,103,104,106,107,108,109,110,111,112,113,114,114,115,116,116,117,118,118,119,119,120,120,120,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,121,121,121,121,121,121,121,121,121,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,122,122,122,123,123,124,124,125,125,126,127,127,128,129,130,131,131,132,133,135,136,137,138,139,140,142,143,144,146,147,149,150,152,154,155,157,158,160,162,164,165,167,169,171,172,174,176,178,180,182,183,185,187,189,191,193,194,196,198,200,202,203,205,207,208,210,212,213,215,216,218,219,221,222,224,225,226,228,229,230,231,232,233,235,236,237,238,239,240,240,241,242,243,244,244,245,246,247,247,248,248,249,250,250,251,251,252,252,253,253,254,255],b:[0,1,3,4,6,8,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,48,50,52,54,56,57,59,60,62,63,65,66,67,69,70,71,72,73,74,74,75,76,76,77,77,77,78,78,78,78,78,78,78,77,77,77,76,76,75,75,74,73,73,72,71,70,69,68,67,66,66,65,64,63,61,60,59,58,58,57,56,55,54,53,52,51,51,50,49,49,48,48,47,47,47,46,46,46,46,46,47,47,47,48,48,49,50,50,51,52,53,55,56,57,59,60,62,64,65,67,69,71,74,76,78,81,83,86,88,91,94,96,99,102,105,108,111,114,117,120,124,127,130,133,136,140,143,146,149,153,156,159,162,165,169,172,175,178,181,184,186,189,192,195,197,200,203,205,207,210,212,214,216,218,220,222,224,226,227,229,230,231,233,234,235,236,237,238,239,239,240,241,241,242,242,242,243,243,243,243,243,243,243,243,243,243,242,242,242,242,241,241,241,241,240,240,240,239,239,239,239,239,238,238,238,238,238,238,238,238,239,239,239,240,240,240,241,242,242,243,244,245,246,247,248,249,250,252,253,255]},ColorMap.MAPS_CUSTOM=['cubehelix','eosb','rainbow'],ColorMap.MAPS_NAMES=['native','grayscale'].concat(ColorMap.MAPS_CUSTOM),ColorMap.prototype.reverse=function(a){this.reversed=a?a:!this.reversed,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.signature=function(){var a=this.mapName;return this.reversed&&(a+=' reversed'),a},ColorMap.prototype.update=function(a){this.mapName=a,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.apply=function(c){if('native'==this.sig){return c}if(c.cmSig==this.sig){return c.cmImg}var g=document.createElement('canvas');g.width=c.width,g.height=c.height;var j=g.getContext('2d');j.drawImage(c,0,0);var e,f,d,i=j.getImageData(0,0,g.width,g.height),b=i.data,k=b.length,h=3;'grayscale'==this.mapName?h=1:ColorMap.MAPS_CUSTOM.indexOf(this.mapName)>=0&&(h=2);for(var a=0;k>a;a+=4){switch(h){case 1:e=f=d=AladinUtils.myRound((b[a]+b[a+1]+b[a+2])/3);break;case 2:this.reversed?(e=ColorMap.MAPS[this.mapName].r[255-b[a]],f=ColorMap.MAPS[this.mapName].g[255-b[a+1]],d=ColorMap.MAPS[this.mapName].b[255-b[a+2]]):(e=ColorMap.MAPS[this.mapName].r[b[a]],f=ColorMap.MAPS[this.mapName].g[b[a+1]],d=ColorMap.MAPS[this.mapName].b[b[a+2]]);break;default:e=b[a],f=b[a+1],d=b[a+2];}2!=h&&this.reversed&&(e=255-e,f=255-f,d=255-d),b[a]=e,b[a+1]=f,b[a+2]=d}return i.data=b,j.putImageData(i,0,0),c.cmSig=this.sig,c.cmImg=g,c.cmImg},ColorMap}(),HpxKey=function(){var a=function(b,d,a,h,i,g,c,f,e){this.norder=b,this.npix=d,this.nside=Math.pow(2,b),this.hips=a,this.frame=a.cooFrame,this.width=h,this.height=i,this.dx=g||0,this.dy=c||0,this.allskyTexture=f||void 0,this.allskyTextureSize=e,this.parente=0,this.children=null,this.ancestor=null};a.createHpxKeyfromAncestor=function(b,c){var d=new a(b.norder+1,4*b.npix+c,b.hips,b.width/2,b.height/2,2==c||3==c?b.dx+b.width/2:b.dx,1==c||3==c?b.dy+b.height/2:b.dy,b.allskyTexture,b.allskyTextureSize);return d.parente=b.parente+1,d.ancestor=b.ancestor||b,d};var f=4;a.prototype={draw:function(l,b){var k=0,d=this.getProjViewCorners(b);if(null==d){return 0}var c=(new Date()).getTime(),n=null==this.ancestor&&this.norder>=3&&c-this.hips.lastUpdateDateNeededTiles>0.1;try{if(e(d)){var i=this.drawChildren(l,b,f);if(i>0){return i}}}catch(p){return 0}var g=null==this.ancestor?this.norder:this.ancestor.norder,o=null==this.ancestor?this.npix:this.ancestor.npix,j=this.hips.getTileURL(g,o),a=this.hips.tileBuffer.getTile(j);if(a&&Tile.isImageOk(a.img)||this.allskyTexture){this.allskyTexture||this.hips.tileSize||(this.hips.tileSize=a.img.width);var h=this.allskyTexture||a.img,m=this.allskyTextureSize||h.width;this.parente&&(m/=Math.pow(2,this.parente)),this.hips.drawOneTile2(l,h,d,m,null,this.dx,this.dy,!0,g),k+=2}else {n&&!a&&(a=this.hips.tileBuffer.addTile(j),b.downloader.requestDownload(a.img,a.url,this.hips.useCors),this.hips.lastUpdateDateNeededTiles=c,b.requestRedrawAtDate(c+HpxImageSurvey.UPDATE_NEEDED_TILES_DELAY+10))}return k},drawChildren:function(g,e,c){var d=0,f=13;if(this.width>1&&f>this.norder&&c>this.parente){var b=this.getChildren();if(null!=b){for(var a=0;4>a;a++){null!=b[a]&&(d+=b[a].draw(g,e,c))}}}return d},getChildren:function(){if(null!=this.children){return this.children}for(var c=[],b=0;4>b;b++){var d=a.createHpxKeyfromAncestor(this,b);c[b]=d}return this.children=c,this.children},getProjViewCorners:function(d){var b=[],h=[],c=new SpatialVector();corners=HealpixCache.corners_nest(this.npix,this.nside);for(var g,f,a=0;4>a;a++){if(c.setXYZ(corners[a].x,corners[a].y,corners[a].z),this.frame!=d.cooFrame){if(this.frame==CooFrameEnum.J2000){var e=CooConversion.J2000ToGalactic([c.ra(),c.dec()]);g=e[0],f=e[1]}else {if(this.frame==CooFrameEnum.GAL){var e=CooConversion.GalacticToJ2000([c.ra(),c.dec()]);g=e[0],f=e[1]}}}else {g=c.ra(),f=c.dec()}b[a]=d.projection.project(g,f)}if(null==b[0]||null==b[1]||null==b[2]||null==b[3]){return null}for(var a=0;4>a;a++){h[a]=AladinUtils.xyToView(b[a].X,b[a].Y,d.width,d.height,d.largestDim,d.zoomFactor)}return h}};var b=function(a,b,c){var d=a[b].vx-a[c].vx,e=a[b].vy-a[c].vy;return d*d+e*e},c=78400,d=22500,g=0.7,e=function(f){var i,h;if((i=b(f,0,2))>c||(h=b(f,2,1))>c){return !0}if(0==i||0==h){throw 'Rhomb error'}var e=b(f,0,3),a=b(f,1,2);if(0==a||0==a){throw 'Rhomb error'}var j=a>e?e/a:a/e;return g>j&&(e>d||a>d)};return a}(),HpxImageSurvey=function(){function t(h,u,j,k,g,e,a,d,n,o,b,i,f,c,t,r,q,s){r=r||0,q=q||0,s||(s=!1),n+=r,b+=r,f+=r,o+=q,i+=q,c+=q;var m=(j+g+a)/3,l=(k+e+d)/3,m=(j+g+a)/3,l=(k+e+d)/3;h.save(),t&&(h.globalAlpha=t),coeff=0.02,h.beginPath(),h.moveTo((1+coeff)*j-m*coeff,(1+coeff)*k-l*coeff),h.lineTo((1+coeff)*g-m*coeff,(1+coeff)*e-l*coeff),h.lineTo((1+coeff)*a-m*coeff,(1+coeff)*d-l*coeff),h.closePath(),h.clip(),s&&(coeff=0.01,j=(1+coeff)*j-m*coeff,k=(1+coeff)*k-l*coeff,g=(1+coeff)*g-m*coeff,e=(1+coeff)*e-l*coeff,a=(1+coeff)*a-m*coeff,d=(1+coeff)*d-l*coeff);var p=1/(n*(c-i)-b*c+f*i+(b-f)*o);h.transform(-(o*(a-g)-i*a+c*g+(i-c)*j)*p,(i*d+o*(e-d)-c*e+(c-i)*k)*p,(n*(a-g)-b*a+f*g+(b-f)*j)*p,-(b*d+n*(e-d)-f*e+(f-b)*k)*p,(n*(c*g-i*a)+o*(b*a-f*g)+(f*i-b*c)*j)*p,(n*(c*e-i*d)+o*(b*d-f*e)+(f*i-b*c)*k)*p),h.drawImage(u,0,0),h.restore()}function e(i,v,k,l,h,f,b,e,p,q,c,j,g,d,u,s,r,t){s=s||0,r=r||0,t||(t=!1),p+=s,c+=s,g+=s,q+=r,j+=r,d+=r;var n=(k+h+b)/3,m=(l+f+e)/3,n=(k+h+b)/3,m=(l+f+e)/3;i.save(),u&&(i.globalAlpha=u);var a=0.01;t&&(a=0.01),i.beginPath(),i.moveTo((1+a)*k-n*a,(1+a)*l-m*a),i.lineTo((1+a)*h-n*a,(1+a)*f-m*a),i.lineTo((1+a)*b-n*a,(1+a)*e-m*a),i.closePath(),i.clip(),t&&(a=0.03,k=(1+a)*k-n*a,l=(1+a)*l-m*a,h=(1+a)*h-n*a,f=(1+a)*f-m*a,b=(1+a)*b-n*a,e=(1+a)*e-m*a);var o=1/(p*(d-j)-c*d+g*j+(c-g)*q);i.transform(-(q*(b-h)-j*b+d*h+(j-d)*k)*o,(j*e+q*(f-e)-d*f+(d-j)*l)*o,(p*(b-h)-c*b+g*h+(c-g)*k)*o,-(c*e+p*(f-e)-g*f+(g-c)*l)*o,(p*(d*h-j*b)+q*(c*b-g*h)+(g*j-c*d)*k)*o,(p*(d*f-j*e)+q*(c*e-g*f)+(g*j-c*d)*l)*o),i.drawImage(v,0,0),i.restore()}var a=function(e,g,c,i,h,b){e instanceof HiPSDefinition?this.hipsDefinition=e:(this.id=e,this.name=g,this.rootUrl='/'===c.slice(-1)?c.substr(0,c.length-1):c,this.rootUrl=Utils.getAbsoluteURL(this.rootUrl),b=b||{},this.imgFormat=b.imgFormat||'jpg',this.minOrder=b.minOrder||null,this.cooFrame=CooFrameEnum.fromString(i,CooFrameEnum.J2000),this.rootUrl.indexOf('/glimpse360/aladin/data')>=0&&(this.cooFrame=CooFrameEnum.J2000),this.maxOrder=h),this.tileSize=void 0,this.allskyTexture=null,this.alpha=0,this.allskyTextureSize=0,this.lastUpdateDateNeededTiles=0;for(var f=!1,d=0;a.SURVEYS.length>d;d++){a.SURVEYS[d].id==this.id&&(f=!0)}f||a.SURVEYS.push({id:this.id,url:this.rootUrl,name:this.name,maxOrder:this.maxOrder,frame:this.cooFrame}),a.SURVEYS_OBJECTS[this.id]=this};a.UPDATE_NEEDED_TILES_DELAY=1000,a.prototype.init=function(c,a){this.view=c,this.cm||(this.cm=new ColorMap(this.view)),this.tileBuffer=this.view.tileBuffer,this.useCors=!1;var b=this;$.support.cors?$.ajax({type:'GET',url:this.rootUrl+'/properties',dataType:'text',xhrFields:{},headers:{},success:function(){b.useCors=!0,b.retrieveAllskyTextures(),a&&a()},error:function(){b.retrieveAllskyTextures(),a&&a()}}):(this.retrieveAllskyTextures(),a())},a.DEFAULT_SURVEY_ID='P/DSS2/color',a.SURVEYS_OBJECTS={},a.SURVEYS=[{id:'P/2MASS/color',url:'http://alasky.u-strasbg.fr/2MASS/Color',name:'2MASS colored',maxOrder:9,frame:'equatorial',format:'jpeg'},{id:'P/DSS2/color',url:'http://alasky.u-strasbg.fr/DSS/DSSColor',name:'DSS colored',maxOrder:9,frame:'equatorial',format:'jpeg'},{id:'P/DSS2/red',url:'http://alasky.u-strasbg.fr/DSS/DSS2Merged',name:'DSS2 Red (F+R)',maxOrder:9,frame:'equatorial',format:'jpeg fits'},{id:'P/Fermi/color',url:'http://alasky.u-strasbg.fr/Fermi/Color',name:'Fermi color',maxOrder:3,frame:'equatorial',format:'jpeg'},{id:'P/Finkbeiner',url:'http://alasky.u-strasbg.fr/FinkbeinerHalpha',maxOrder:3,frame:'galactic',format:'jpeg fits',name:'Halpha'},{id:'P/GALEXGR6/AIS/color',url:'http://alasky.u-strasbg.fr/GALEX/GR6-02-Color',name:'GALEX Allsky Imaging Survey colored',maxOrder:8,frame:'equatorial',format:'jpeg'},{id:'P/IRIS/color',url:'http://alasky.u-strasbg.fr/IRISColor',name:'IRIS colored',maxOrder:3,frame:'galactic',format:'jpeg'},{id:'P/Mellinger/color',url:'http://alasky.u-strasbg.fr/MellingerRGB',name:'Mellinger colored',maxOrder:4,frame:'galactic',format:'jpeg'},{id:'P/SDSS9/color',url:'http://alasky.u-strasbg.fr/SDSS/DR9/color',name:'SDSS9 colored',maxOrder:10,frame:'equatorial',format:'jpeg'},{id:'P/SPITZER/color',url:'http://alasky.u-strasbg.fr/SpitzerI1I2I4color',name:'IRAC color I1,I2,I4 - (GLIMPSE, SAGE, SAGE-SMC, SINGS)',maxOrder:9,frame:'galactic',format:'jpeg'},{id:'P/VTSS/Ha',url:'http://alasky.u-strasbg.fr/VTSS/Ha',maxOrder:3,frame:'galactic',format:'png jpeg fits',name:'VTSS-Ha'},{id:'P/XMM/EPIC',url:'http://saada.u-strasbg.fr/xmmallsky',name:'XMM-Newton stacked EPIC images (no phot. normalization)',maxOrder:7,frame:'equatorial',format:'png fits'},{id:'P/XMM/PN/color',url:'http://saada.unistra.fr/xmmpnsky',name:'XMM PN colored',maxOrder:7,frame:'equatorial',format:'png jpeg'},{id:'P/allWISE/color',url:'http://alasky.u-strasbg.fr/AllWISE/RGB-W4-W2-W1/',name:'AllWISE color',maxOrder:8,frame:'equatorial',format:'jpeg'},{id:'P/GLIMPSE360',url:'http://www.spitzer.caltech.edu/glimpse360/aladin/data',name:'GLIMPSE360',maxOrder:9,frame:'equatorial',format:'jpeg'}],a.getAvailableSurveys=function(){return a.SURVEYS},a.getSurveyInfoFromId=function(d){for(var c=a.getAvailableSurveys(),b=0;c.length>b;b++){if(c[b].id==d){return c[b]}}return null},a.getSurveyFromId=function(c){if(a.SURVEYS_OBJECTS[c]){return a.SURVEYS_OBJECTS[c]}var b=a.getSurveyInfoFromId(c);if(b){var d={};return b.format&&0>b.format.indexOf('jpeg')&&b.format.indexOf('png')>=0&&(d.imgFormat='png'),new a(b.id,b.name,b.url,b.frame,b.maxOrder,d)}return null},a.prototype.getTileURL=function(c,a){var b=10000*Math.floor(a/10000);return this.rootUrl+'/'+'Norder'+c+'/Dir'+b+'/Npix'+a+'.'+this.imgFormat},a.prototype.retrieveAllskyTextures=function(){var a=new Image();this.useCors&&(a.crossOrigin='anonymous');var b=this;a.onload=function(){b.allskyTextureSize=a.width/27,b.allskyTexture=a,b.view.requestRedraw()},a.src=this.rootUrl+'/Norder3/Allsky.'+this.imgFormat},a.prototype.draw=function(d,a,b,c){b=void 0===b?!1:b;var g=a.getVisibleCells(3,this.cooFrame),f=null,e=Math.min(c,this.maxOrder);return c>=3&&(f=3==c?g:a.getVisibleCells(e,this.cooFrame)),b?(c>=3?this.drawHighres(d,f,e,a):this.drawAllsky(d,g,e,a),void 0):(a.curNorder>=3?this.redrawHighres(d,f,a.curNorder):this.redrawAllsky(d,g,a.fov,a.curNorder),void 0)},a.prototype.drawHighres=function(g,c,e,f){for(var b=[],d=this.tileSize||512,a=0;c.length>a;a++){b.push(new HpxKey(e,c[a].ipix,this,d,d))}for(var a=0;b.length>a;a++){b[a].draw(g,f)}},a.prototype.drawAllsky=function(i,c,j,h){if(!(this.view.curNorder>6)&&this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){for(var g,b,e,f,d=[],a=0;c.length>a;a++){g=c[a],b=g.ipix,f=this.allskyTextureSize*Math.floor(b/27),e=this.allskyTextureSize*(b-27*Math.floor(b/27)),d.push(new HpxKey(3,c[a].ipix,this,this.allskyTextureSize,this.allskyTextureSize,e,f,this.allskyTexture,this.allskyTextureSize))}for(var a=0;d.length>a;a++){d[a].draw(i,h)}}},a.prototype.redrawAllsky=function(m,g,k){if(!(this.view.curNorder>6)&&this.allskyTexture){for(var a,f,d,c=0,e=0,j=g.length;j>e;e++){if(a=g[e],d=a.ipix,this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){var l=this.allskyTextureSize*Math.floor(d/27),i=this.allskyTextureSize*(d-27*Math.floor(d/27));if(k>40){c=0.02,c=0,f={x:(a[0].vx+a[2].vx)/2,y:(a[0].vy+a[2].vy)/2};for(var b=0;4>b;b++){var h={x:a[b].vx-f.x,y:a[b].vy-f.y};a[b].vx+=c*h.x,a[b].vy+=c*h.y}}this.drawOneTile(m,this.allskyTexture,a,this.allskyTextureSize,null,i,l,!0)}}}},a.prototype.getColorMap=function(){return this.cm};var b=!0;return a.prototype.redrawHighres=function(A,g,z){if(0!=g.length){b=!b;var i,n,d,q,w,k,e,x,o=(new Date()).getTime(),p=o-this.lastUpdateDateNeededTiles>a.UPDATE_NEEDED_TILES_DELAY,m=z-1,t=[],l=[],u={},v=!1,r=[],s=[];if(p){var j=[(g[0][0].vx+g[0][1].vx)/2,(g[0][0].vy+g[0][1].vy)/2],B=g.sort(function(d,a){var b=[(d[0].vx+d[2].vx)/2,(d[0].vy+d[2].vy)/2],c=[(a[0].vx+a[2].vx)/2,(a[0].vy+a[2].vy)/2],f=(b[0]-j[0])*(b[0]-j[0])+(b[1]-j[1])*(b[1]-j[1]),e=(c[0]-j[0])*(c[0]-j[0])+(c[1]-j[1])*(c[1]-j[1]);return f-e});g=B}for(var c=0,f=g.length;f>c;c++){if(w=g[c],x=w.ipix,e=~~(x/4),q=this.getTileURL(m,e),p&&m>=3&&(d=this.tileBuffer.addTile(q),d&&s.push({img:d.img,url:q})),n=this.getTileURL(z,x),i=this.tileBuffer.getTile(n)){Tile.isImageOk(i.img)?t.push({img:i.img,corners:w}):(v=!0,p&&!i.img.dlError&&r.push({img:i.img,url:n}),m>=3&&!u[e]&&(d=this.tileBuffer.getTile(q),d&&Tile.isImageOk(d.img)&&(k=this.view.getPositionsInView(e,m),k&&l.push({img:d.img,corners:k,ipix:e})),u[e]=1))}else {if(v=!0,p){var i=this.tileBuffer.addTile(n);i&&r.push({img:i.img,url:n})}m>=3&&!u[e]&&(d=this.tileBuffer.getTile(q),d&&Tile.isImageOk(d.img)&&(k=this.view.getPositionsInView(e,m),k&&l.push({img:d.img,corners:k,ipix:e})),u[e]=1)}}for(var c=0,f=l.length;f>c;c++){this.drawOneTile(A,l[c].img,l[c].corners,l[c].img.width)}for(var c=0,f=t.length;f>c;c++){var y=null,h=t[c].img;h.fadingStart&&h.fadingEnd&&h.fadingEnd>o&&(y=0.2+0.8*((o-h.fadingStart)/(h.fadingEnd-h.fadingStart))),this.drawOneTile(A,h,t[c].corners,h.width,y)}if(p){for(var c=0,f=r.length;f>c;c++){this.view.downloader.requestDownload(r[c].img,r[c].url,this.useCors)}for(var c=0,f=s.length;f>c;c++){this.view.downloader.requestDownload(s[c].img,s[c].url,this.useCors)}this.lastUpdateDateNeededTiles=o}v&&this.view.requestRedrawAtDate(o+a.UPDATE_NEEDED_TILES_DELAY+10)}},a.prototype.drawOneTile=function(j,f,a,b,i,c,h,d){var g=this.useCors?this.cm.apply(f):f;e(j,g,a[0].vx,a[0].vy,a[1].vx,a[1].vy,a[3].vx,a[3].vy,b-1,b-1,b-1,0,0,b-1,i,c,h,d),e(j,g,a[1].vx,a[1].vy,a[3].vx,a[3].vy,a[2].vx,a[2].vy,b-1,0,0,b-1,0,0,i,c,h,d)},a.prototype.drawOneTile2=function(g,i,a,c,k,e,j,h,d){var f=this.useCors?this.cm.apply(i):i,b=3>=d?0.2:0;t(g,f,a[0].vx,a[0].vy,a[1].vx,a[1].vy,a[3].vx,a[3].vy,c-b,c-b,c-b,0+b,0+b,c-b,k,e,j,h,d),t(g,f,a[1].vx,a[1].vy,a[3].vx,a[3].vy,a[2].vx,a[2].vy,c-b,0+b,0+b,c-b,0+b,0+b,k,e,j,h,d)},a.prototype.setAlpha=function(a){a=+a,this.alpha=Math.max(0,Math.min(a,1)),this.view.requestRedraw()},a.prototype.getAlpha=function(){return this.alpha},a}(),HealpixGrid=function(){var a=function(){};return a.prototype.redraw=function(b,d,g,f){b.lineWidth=1,b.strokeStyle='rgb(150,150,220)',b.beginPath();for(var a,c=0,e=d.length;e>c;c++){a=d[c],ipix=a.ipix,b.moveTo(a[0].vx,a[0].vy),b.lineTo(a[1].vx,a[1].vy),b.lineTo(a[2].vx,a[2].vy)}b.stroke(),b.strokeStyle='#FFDDDD',b.beginPath();for(var c=0,e=d.length;e>c;c++){a=d[c],ipix=a.ipix,b.strokeText(f+'/'+ipix,(a[0].vx+a[2].vx)/2,(a[0].vy+a[2].vy)/2)}b.stroke()},a}(),Location=function(){return Location=function(a){this.$div=$(a)},Location.prototype.update=function(e,c,d,a){a=a&&a===!0||!1;var b=new Coo(e,c,7);d==CooFrameEnum.J2000?this.$div.html(b.format('s/')):this.$div.html(b.format('d/')),this.$div.toggleClass('aladin-reticleColor',a)},Location}(),View=function(){function t(f,h,i,g,e){this.aladin=f,this.options=f.options,this.aladinDiv=this.aladin.aladinDiv,this.popup=new Popup(this.aladinDiv),this.createCanvases(),this.location=h,this.fovDiv=i,this.mustClearCatalog=!0,this.mustRedrawReticle=!0,this.mode=t.PAN,this.minFOV=this.maxFOV=null,this.healpixGrid=new HealpixGrid(this.imageCanvas),this.cooFrame=g?g:CooFrameEnum.GAL;var d,b;d=b=0,this.projectionMethod=ProjectionEnum.SIN,this.projection=new Projection(d,b),this.projection.setProjection(this.projectionMethod),this.zoomLevel=0,this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.viewCenter={lon:d,lat:b},e&&this.setZoom(e),this.imageSurvey=null,this.catalogs=[],this.overlays=[],this.mocs=[],this.tileBuffer=new TileBuffer(),this.fixLayoutDimensions(),this.curNorder=1,this.realNorder=1,this.curOverlayNorder=1,this.dragging=!1,this.dragx=null,this.dragy=null,this.needRedraw=!0,this.downloader=new Downloader(this),this.flagForceRedraw=!1,this.fadingLatestUpdate=null,this.dateRequestRedraw=null,this.showGrid=!1,c(this),this.resizeTimer=null;var a=this;$(window).resize(function(){clearTimeout(a.resizeTimer),a.resizeTimer=setTimeout(function(){a.fixLayoutDimensions(a)},100)}),setTimeout(function(){var c=$(a.aladinDiv).width(),b=$(a.aladinDiv).height();(a.width!==c||a.height===b)&&(a.fixLayoutDimensions(),a.setZoomLevel(a.zoomLevel))},1000)}function e(a,d,e,f){if(a.projection){var b,c=AladinUtils.viewToXy(d,e,a.width,a.height,a.largestDim,a.zoomFactor);try{b=a.projection.unproject(c.x,c.y)}catch(g){}b&&a.location.update(b.ra,b.dec,a.cooFrame,f)}}t.PAN=0,t.SELECT=1,t.DRAW_SOURCES_WHILE_DRAGGING=!0,t.DRAW_MOCS_WHILE_DRAGGING=!0,t.prototype.createCanvases=function(){var a=$(this.aladinDiv);a.find('.aladin-imageCanvas').remove(),a.find('.aladin-catalogCanvas').remove(),a.find('.aladin-reticleCanvas').remove(),this.imageCanvas=$("<canvas class='aladin-imageCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.catalogCanvas=$("<canvas class='aladin-catalogCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.reticleCanvas=$("<canvas class='aladin-reticleCanvas'></canvas>").appendTo(this.aladinDiv)[0]},t.prototype.fixLayoutDimensions=function(){Utils.cssScale=void 0;var c=$(this.aladinDiv).width(),a=$(this.aladinDiv).height();this.width=Math.max(c,1),this.height=Math.max(a,1),this.cx=this.width/2,this.cy=this.height/2,this.largestDim=Math.max(this.width,this.height),this.smallestDim=Math.min(this.width,this.height),this.ratio=this.largestDim/this.smallestDim,this.mouseMoveIncrement=160/this.largestDim,this.imageCtx=this.imageCanvas.getContext('2d'),this.catalogCtx=this.catalogCanvas.getContext('2d'),this.reticleCtx=this.reticleCanvas.getContext('2d'),this.imageCtx.canvas.width=this.width,this.catalogCtx.canvas.width=this.width,this.reticleCtx.canvas.width=this.width,this.imageCtx.canvas.height=this.height,this.catalogCtx.canvas.height=this.height,this.reticleCtx.canvas.height=this.height,b(this.imageCtx),this.logoDiv||(this.logoDiv=$(this.aladinDiv).find('.aladin-logo')[0]),this.width>800?($(this.logoDiv).removeClass('aladin-logo-small'),$(this.logoDiv).addClass('aladin-logo-large'),$(this.logoDiv).css('width','90px')):($(this.logoDiv).addClass('aladin-logo-small'),$(this.logoDiv).removeClass('aladin-logo-large'),$(this.logoDiv).css('width','32px')),this.computeNorder(),this.requestRedraw()};var b=function(a){a.imageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.oImageSmoothingEnabled=!1};t.prototype.setMode=function(a){this.mode=a,this.mode==t.SELECT?this.setCursor('crosshair'):this.setCursor('default')},t.prototype.setCursor=function(a){this.reticleCanvas.style.cursor!=a&&(this.reticleCanvas.style.cursor=a)},t.prototype.getCanvasDataURL=function(c){c=c||'image/png';var a=document.createElement('canvas');a.width=this.width,a.height=this.height;var b=a.getContext('2d');return b.drawImage(this.imageCanvas,0,0),b.drawImage(this.catalogCanvas,0,0),b.drawImage(this.reticleCanvas,0,0),a.toDataURL(c)},computeFov=function(a){var b=doComputeFov(a,a.zoomFactor);return a.mouseMoveIncrement=b/a.imageCanvas.width,b},doComputeFov=function(a,b){if(1>a.zoomFactor){fov=180}else {var c=AladinUtils.viewToXy(0,a.cy,a.width,a.height,a.largestDim,b),e=a.projection.unproject(c.x,c.y),f=AladinUtils.viewToXy(a.imageCanvas.width-1,a.cy,a.width,a.height,a.largestDim,b),d=a.projection.unproject(f.x,f.y);fov=(new Coo(e.ra,e.dec)).distance(new Coo(d.ra,d.dec))}return fov},updateFovDiv=function(a){if(isNaN(a.fov)){return a.fovDiv.html('FoV:'),void 0}var b;b=a.fov>1?Math.round(100*a.fov)/100+'':60*a.fov>1?Math.round(100*60*a.fov)/100+"'":Math.round(100*3600*a.fov)/100+'"',a.fovDiv.html('FoV: '+b)},createListeners=function(a){var d=!1;'ontouchstart' in window&&(d=!0),onDblClick=function(e){var c=a.imageCanvas.relMouseCoords(e),d=AladinUtils.viewToXy(c.x,c.y,a.width,a.height,a.largestDim,a.zoomFactor);try{var b=a.projection.unproject(d.x,d.y)}catch(f){return}radec=[],radec=a.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([b.ra,b.dec]):[b.ra,b.dec],a.pointTo(radec[0],radec[1])},d||$(a.reticleCanvas).dblclick(onDblClick),$(a.reticleCanvas).bind('mousedown touchstart',function(b){var c=a.imageCanvas.relMouseCoords(b);return b.originalEvent&&b.originalEvent.targetTouches?(a.dragx=b.originalEvent.targetTouches[0].clientX,a.dragy=b.originalEvent.targetTouches[0].clientY):(a.dragx=c.x,a.dragy=c.y),a.dragging=!0,a.mode==t.PAN?a.setCursor('move'):a.mode==t.SELECT&&(a.selectStartCoo={x:a.dragx,y:a.dragy}),!1});var b;$(a.reticleCanvas).bind('click mouseout touchend',function(h){if(a.mode==t.SELECT&&a.dragging&&a.aladin.fire('selectend',a.getObjectsInBBox(a.selectStartCoo.x,a.selectStartCoo.y,a.dragx-a.selectStartCoo.x,a.dragy-a.selectStartCoo.y)),a.dragging&&(a.setCursor('default'),a.dragging=!1),a.mustClearCatalog=!0,a.mustRedrawReticle=!0,a.dragx=a.dragy=null,'mouseout'===h.type){return a.requestRedraw(!0),e(a,a.width/2,a.height/2,!0),void 0}var g=a.imageCanvas.relMouseCoords(h),f=a.closestObjects(g.x,g.y,5);if(f){var c=f[0];if(c.marker){a.popup.setTitle(c.popupTitle),a.popup.setText(c.popupDesc),a.popup.setSource(c),a.popup.show()}else {var d=a.aladin.callbacksByEventName.objectClicked;'function'==typeof d&&d(c),b&&b.actionOtherObjectClicked(),c.actionClicked(),b=c}}else {if(b){a.aladin.measurementTable.hide(),b.actionOtherObjectClicked(),b=null;var d=a.aladin.callbacksByEventName.objectClicked;'function'==typeof d&&d(null)}}a.refreshProgressiveCats(),a.requestRedraw(!0)});var c;$(a.reticleCanvas).bind('mousemove touchmove',function(b){b.preventDefault();var f=a.imageCanvas.relMouseCoords(b);if(!a.dragging||d){if(e(a,f.x,f.y),!a.dragging&&!a.mode==t.SELECT){var j=a.closestObjects(f.x,f.y,5);if(j){a.setCursor('pointer');var i=a.aladin.callbacksByEventName.objectHovered;'function'==typeof i&&j[0]!=c&&i(j[0]),c=j[0]}else {a.setCursor('default');var i=a.aladin.callbacksByEventName.objectHovered;'function'==typeof i&&c&&(c=null,i(null))}}if(!d){return}}if(a.dragging){var n,m,l,k;if(b.originalEvent&&b.originalEvent.targetTouches){n=b.originalEvent.targetTouches[0].clientX-a.dragx,m=b.originalEvent.targetTouches[0].clientY-a.dragy;var g=AladinUtils.viewToXy(b.originalEvent.targetTouches[0].clientX,b.originalEvent.targetTouches[0].clientY,a.width,a.height,a.largestDim,a.zoomFactor),h=AladinUtils.viewToXy(a.dragx,a.dragy,a.width,a.height,a.largestDim,a.zoomFactor);l=a.projection.unproject(g.x,g.y),k=a.projection.unproject(h.x,h.y)}else {n=f.x-a.dragx,m=f.y-a.dragy;var g=AladinUtils.viewToXy(f.x,f.y,a.width,a.height,a.largestDim,a.zoomFactor),h=AladinUtils.viewToXy(a.dragx,a.dragy,a.width,a.height,a.largestDim,a.zoomFactor);l=a.projection.unproject(g.x,g.y),k=a.projection.unproject(h.x,h.y)}if(b.originalEvent&&b.originalEvent.targetTouches?(a.dragx=b.originalEvent.targetTouches[0].clientX,a.dragy=b.originalEvent.targetTouches[0].clientY):(a.dragx=f.x,a.dragy=f.y),a.mode==t.SELECT){return a.requestRedraw(),void 0}a.viewCenter.lon+=k.ra-l.ra,a.viewCenter.lat+=k.dec-l.dec,a.viewCenter.lat>90?a.viewCenter.lat=90:-90>a.viewCenter.lat&&(a.viewCenter.lat=-90),0>a.viewCenter.lon?a.viewCenter.lon=360+a.viewCenter.lon:a.viewCenter.lon>360&&(a.viewCenter.lon=a.viewCenter.lon%360),a.requestRedraw()}}),$(a.aladinDiv).onselectstart=function(){return !1},$(a.reticleCanvas).on('mousewheel',function(b){b.preventDefault(),b.stopPropagation();var c=a.zoomLevel,d=b.deltaY;return b.hasOwnProperty('originalEvent')&&(d=-b.originalEvent.deltaY),d>0?c+=1:c-=1,a.setZoomLevel(c),!1})};var c=function(a){var b=new Stats();b.domElement.style.top='50px',$('#aladin-statsDiv').length>0&&$('#aladin-statsDiv')[0].appendChild(b.domElement),a.stats=b,createListeners(a),a.executeCallbacksThrottled=Utils.throttle(function(){var c=a.aladin.pix2world(a.width/2,a.height/2),b=a.fov;if(void 0!==c&&void 0!==b){var d=c[0],e=c[1];if(d!==this.ra||e!==this.dec){var g=a.aladin.callbacksByEventName.positionChanged;'function'==typeof g&&g({ra:d,dec:e}),this.ra=d,this.dec=e}if(b!==this.old_fov){var f=a.aladin.callbacksByEventName.zoomChanged;'function'==typeof f&&f(b),this.old_fov=b}}},100),a.displayHpxGrid=!1,a.displaySurvey=!0,a.displayCatalog=!1,a.displayReticle=!0,a.fov=computeFov(a),updateFovDiv(a),a.redraw()};t.prototype.requestRedrawAtDate=function(a){this.dateRequestDraw=a},t.prototype.getBackgroundColor=function(){var g='rgb(255, 255, 255)',b='rgb(0, 0, 0)';if(!this.imageSurvey){return b}var a=this.imageSurvey.getColorMap();if(!a){return b}if('native'==a.mapName||'grayscale'==a.mapName){return a.reversed?g:b}var c=a.reversed?255:0,f=ColorMap.MAPS[a.mapName].r[c],e=ColorMap.MAPS[a.mapName].g[c],d=ColorMap.MAPS[a.mapName].b[c];return 'rgb('+f+','+e+','+d+')'},t.prototype.getViewParams=function(){var a=this.width>this.height?this.fov/this.width:this.fov/this.height;return {fov:[this.width*a,this.height*a],width:this.width,height:this.height}},t.prototype.redraw=function(){var n=this.needRedraw;requestAnimFrame(this.redraw.bind(this));var o=(new Date()).getTime();if(this.dateRequestDraw&&o>this.dateRequestDraw){this.dateRequestDraw=null}else {if(!this.needRedraw){if(!this.flagForceRedraw){return}this.flagForceRedraw=!1}}this.stats.update(),this.executeCallbacksThrottled();var b=this.imageCtx;b.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height);var k=this.getBackgroundColor();if(this.projectionMethod==ProjectionEnum.SIN){if(this.fov>=60){b.fillStyle=k,b.beginPath();var p=this.cx>this.cy?this.cx:this.cy;b.arc(this.cx,this.cy,p*this.zoomFactor,0,2*Math.PI,!0),b.fill()}else {b.fillStyle=k,b.fillRect(0,0,this.imageCanvas.width,this.imageCanvas.height)}}this.projection?this.projection.setCenter(this.viewCenter.lon,this.viewCenter.lat):this.projection=new Projection(this.viewCenter.lon,this.viewCenter.lat),this.projection.setProjection(this.projectionMethod);var g=null;if(this.imageSurvey&&this.imageSurvey.isReady&&this.displaySurvey&&(null==this.aladin.reduceDeformations?this.imageSurvey.draw(b,this,!this.dragging,this.curNorder):this.imageSurvey.draw(b,this,this.aladin.reduceDeformations,this.curNorder)),this.overlayImageSurvey&&this.overlayImageSurvey.isReady&&(b.globalAlpha=this.overlayImageSurvey.getAlpha(),null==this.aladin.reduceDeformations?this.overlayImageSurvey.draw(b,this,!this.dragging,this.curOverlayNorder):this.overlayImageSurvey.draw(b,this,this.aladin.reduceDeformations,this.curOverlayNorder),b.globalAlpha=1),this.displayHpxGrid){var j=this.getVisibleCells(3),g=null;this.curNorder>=3&&(g=3==this.curNorder?j:this.getVisibleCells(this.curNorder)),g&&this.curNorder>3?this.healpixGrid.redraw(b,g,this.fov,this.curNorder):this.healpixGrid.redraw(b,j,this.fov,3)}this.showGrid&&(null==this.cooGrid&&(this.cooGrid=new CooGrid()),this.cooGrid.redraw(b,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov));var f=this.catalogCtx,e=!1;if(this.mustClearCatalog&&(f.clearRect(0,0,this.width,this.height),e=!0,this.mustClearCatalog=!1),this.catalogs&&this.catalogs.length>0&&this.displayCatalog&&(!this.dragging||t.DRAW_SOURCES_WHILE_DRAGGING)){e||(f.clearRect(0,0,this.width,this.height),e=!0);for(var d=0;this.catalogs.length>d;d++){var r=this.catalogs[d];r.draw(f,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}}var q=this.catalogCtx;if(this.overlays&&this.overlays.length>0&&(!this.dragging||t.DRAW_SOURCES_WHILE_DRAGGING)){e||(f.clearRect(0,0,this.width,this.height),e=!0);for(var d=0;this.overlays.length>d;d++){this.overlays[d].draw(q,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}}var m=this.catalogCtx;if(this.mocs&&this.mocs.length>0&&(!this.dragging||t.DRAW_MOCS_WHILE_DRAGGING)){e||(f.clearRect(0,0,this.width,this.height),e=!0);for(var d=0;this.mocs.length>d;d++){this.mocs[d].draw(m,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov)}}this.mode==t.SELECT&&(mustRedrawReticle=!0);var h=this.reticleCtx;if((this.mustRedrawReticle||this.mode==t.SELECT)&&h.clearRect(0,0,this.width,this.height),this.displayReticle){if(!this.reticleCache){var i=document.createElement('canvas'),a=this.options.reticleSize;i.width=a,i.height=a;var c=i.getContext('2d');c.lineWidth=2,c.strokeStyle=this.options.reticleColor,c.beginPath(),c.moveTo(a/2,a/2+(a/2-1)),c.lineTo(a/2,a/2+2),c.moveTo(a/2,a/2-(a/2-1)),c.lineTo(a/2,a/2-2),c.moveTo(a/2+(a/2-1),a/2),c.lineTo(a/2+2,a/2),c.moveTo(a/2-(a/2-1),a/2),c.lineTo(a/2-2,a/2),c.stroke(),this.reticleCache=i}h.drawImage(this.reticleCache,this.width/2-this.reticleCache.width/2,this.height/2-this.reticleCache.height/2),this.mustRedrawReticle=!1}if(this.mode==t.SELECT&&this.dragging){h.fillStyle='rgba(100, 240, 110, 0.25)';var s=this.dragx-this.selectStartCoo.x,l=this.dragy-this.selectStartCoo.y;h.fillRect(this.selectStartCoo.x,this.selectStartCoo.y,s,l)}n==this.needRedraw&&(this.needRedraw=!1),this.dragging||this.updateObjectsLookup()},t.prototype.forceRedraw=function(){this.flagForceRedraw=!0},t.prototype.refreshProgressiveCats=function(){if(this.catalogs){for(var a=0;this.catalogs.length>a;a++){'progressivecat'==this.catalogs[a].type&&this.catalogs[a].loadNeededTiles()}}},t.prototype.getVisiblePixList=function(m,d){var c,j=Math.pow(2,m),l=HealpixIndex.nside2Npix(j);if(this.fov>80){c=[];for(var f=0;l>f;f++){c.push(f)}}else {var e=new HealpixIndex(j);e.init();var h=new SpatialVector(),g=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),b=this.projection.unproject(g.x,g.y),a=[];d&&d!=this.cooFrame?d==CooFrameEnum.J2000?a=CooConversion.GalacticToJ2000([b.ra,b.dec]):d==CooFrameEnum.GAL&&(a=CooConversion.J2000ToGalactic([b.ra,b.dec])):a=[b.ra,b.dec],h.set(a[0],a[1]);var k=0.5*this.fov*this.ratio;k*=this.fov>60?1.6:this.fov>12?1.45:1.1,c=e.queryDisc(h,k*Math.PI/180,!0,!0);var i=Utils.radecToPolar(a[0],a[1]);ipixCenter=e.ang2pix_nest(i.theta,i.phi),c.unshift(ipixCenter)}return c},t.prototype.getVisibleCells=function(y,d){!d&&this.imageSurvey&&(d=this.imageSurvey.cooFrame);var i,u=[],h=[],g=new SpatialVector(),p=Math.pow(2,y),x=HealpixIndex.nside2Npix(p),r=null;if(this.fov>80){i=[];for(var e=0;x>e;e++){i.push(e)}}else {var q=new HealpixIndex(p);q.init();var v=new SpatialVector(),t=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),b=this.projection.unproject(t.x,t.y),f=[];d&&d!=this.cooFrame?d==CooFrameEnum.J2000?f=CooConversion.GalacticToJ2000([b.ra,b.dec]):d==CooFrameEnum.GAL&&(f=CooConversion.J2000ToGalactic([b.ra,b.dec])):f=[b.ra,b.dec],v.set(f[0],f[1]);var w=0.5*this.fov*this.ratio;w*=this.fov>60?1.6:this.fov>12?1.45:1.1,i=q.queryDisc(v,w*Math.PI/180,!0,!0);var s=Utils.radecToPolar(f[0],f[1]);r=q.ang2pix_nest(s.theta,s.phi),i.unshift(r)}for(var e,m,n,l=0,z=i.length;z>l;l++){if(e=i[l],!(e==r&&l>0)){var a=[];corners=HealpixCache.corners_nest(e,p);for(var c=0;4>c;c++){if(g.setXYZ(corners[c].x,corners[c].y,corners[c].z),d&&d!=this.cooFrame){if(d==CooFrameEnum.J2000){var b=CooConversion.J2000ToGalactic([g.ra(),g.dec()]);m=b[0],n=b[1]}else {if(d==CooFrameEnum.GAL){var b=CooConversion.GalacticToJ2000([g.ra(),g.dec()]);m=b[0],n=b[1]}}}else {m=g.ra(),n=g.dec()}h[c]=this.projection.project(m,n)}if(null!=h[0]&&null!=h[1]&&null!=h[2]&&null!=h[3]){for(var c=0;4>c;c++){a[c]=AladinUtils.xyToView(h[c].X,h[c].Y,this.width,this.height,this.largestDim,this.zoomFactor)}if(!(0>a[0].vx&&0>a[1].vx&&0>a[2].vx&&0>a[3].vx||0>a[0].vy&&0>a[1].vy&&0>a[2].vy&&0>a[3].vy||a[0].vx>=this.width&&a[1].vx>=this.width&&a[2].vx>=this.width&&a[3].vx>=this.width||a[0].vy>=this.height&&a[1].vy>=this.height&&a[2].vy>=this.height&&a[3].vy>=this.height)){if(this.projection.PROJECTION==ProjectionEnum.AITOFF){var j=a[0].vx-a[2].vx,k=a[0].vy-a[2].vy,o=Math.sqrt(j*j+k*k);if(o>this.largestDim/5){continue}if(j=a[1].vx-a[3].vx,k=a[1].vy-a[3].vy,o=Math.sqrt(j*j+k*k),o>this.largestDim/5){continue}}a.ipix=e,u.push(a)}}}}return u},t.prototype.getPositionsInView=function(k,j){for(var e,f,c=[],b=new SpatialVector(),i=Math.pow(2,j),h=[],g=HealpixCache.corners_nest(k,i),a=0;4>a;a++){if(b.setXYZ(g[a].x,g[a].y,g[a].z),this.imageSurvey&&this.imageSurvey.cooFrame!=this.cooFrame){if(this.imageSurvey.cooFrame==CooFrameEnum.J2000){var d=CooConversion.J2000ToGalactic([b.ra(),b.dec()]);e=d[0],f=d[1]}else {if(this.imageSurvey.cooFrame==CooFrameEnum.GAL){var d=CooConversion.GalacticToJ2000([b.ra(),b.dec()]);e=d[0],f=d[1]}}}else {e=b.ra(),f=b.dec()}c[a]=this.projection.project(e,f)}if(null==c[0]||null==c[1]||null==c[2]||null==c[3]){return null}for(var a=0;4>a;a++){h[a]=AladinUtils.xyToView(c[a].X,c[a].Y,this.width,this.height,this.largestDim,this.zoomFactor)}return h},t.prototype.computeZoomFactor=function(a){return a>0?AladinUtils.getZoomFactorForAngle(180/Math.pow(1.15,a),this.projectionMethod):1+0.1*a},t.prototype.setZoom=function(a){if(!(0>a||a>180)){var b=Math.log(180/a)/Math.log(1.15);this.setZoomLevel(b)}},t.prototype.setShowGrid=function(a){this.showGrid=a,this.requestRedraw()},t.prototype.setZoomLevel=function(a){if(this.minFOV||this.maxFOV){var b=doComputeFov(this,this.computeZoomFactor(Math.max(-2,a)));if(this.maxFOV&&b>this.maxFOV||this.minFOV&&this.minFOV>b){return}}if(this.zoomLevel=this.projectionMethod==ProjectionEnum.SIN?this.aladin.options.allowFullZoomout===!0?this.width/this.height>2?Math.max(-7,a):0.5>this.width/this.height?Math.max(-2,a):Math.max(-6,a):Math.max(-2,a):Math.max(-7,a),this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.fov=computeFov(this),updateFovDiv(this),this.computeNorder(),this.forceRedraw(),this.requestRedraw(),!this.debounceProgCatOnZoom){var c=this;this.debounceProgCatOnZoom=Utils.debounce(function(){c.refreshProgressiveCats()},300)}this.debounceProgCatOnZoom()},t.prototype.computeNorder=function(){var e=this.fov/this.largestDim,c=512,d=HealpixIndex.calculateNSide(3600*c*e),a=Math.log(d)/Math.log(2);a=Math.max(a,1),this.realNorder=a,50>=this.fov&&2>=a&&(a=3),this.imageSurvey&&2>=a&&this.imageSurvey.minOrder>2&&(a=this.imageSurvey.minOrder);var b=a;this.imageSurvey&&a>this.imageSurvey.maxOrder&&(a=this.imageSurvey.maxOrder),this.overlayImageSurvey&&b>this.overlayImageSurvey.maxOrder&&(b=this.overlayImageSurvey.maxOrder),a>HealpixIndex.ORDER_MAX&&(a=HealpixIndex.ORDER_MAX),b>HealpixIndex.ORDER_MAX&&(b=HealpixIndex.ORDER_MAX),this.curNorder=a,this.curOverlayNorder=b},t.prototype.untaintCanvases=function(){this.createCanvases(),createListeners(this),this.fixLayoutDimensions()},t.prototype.setOverlayImageSurvey=function(b,d){if(!b){return this.overlayImageSurvey=null,this.requestRedraw(),void 0}$.support.cors&&this.overlayImageSurvey&&!this.overlayImageSurvey.useCors&&this.untaintCanvases();var a;'string'==typeof b?(a=HpxImageSurvey.getSurveyFromId(b),a||(a=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID))):a=b,a.isReady=!1,this.overlayImageSurvey=a;var c=this;a.init(this,function(){c.computeNorder(),a.isReady=!0,c.requestRedraw(),c.updateObjectsLookup(),d&&d()})},t.prototype.setUnknownSurveyIfNeeded=function(){a&&(this.setImageSurvey(a),a=void 0)};var a=void 0;return t.prototype.setImageSurvey=function(c,e){if(c){$.support.cors&&this.imageSurvey&&!this.imageSurvey.useCors&&this.untaintCanvases();var b;'string'==typeof c?(b=HpxImageSurvey.getSurveyFromId(c),b||(b=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID),a=c)):b=c,this.tileBuffer=new TileBuffer(),b.isReady=!1,this.imageSurvey=b;var d=this;b.init(this,function(){d.computeNorder(),b.isReady=!0,d.requestRedraw(),d.updateObjectsLookup(),e&&e()})}},t.prototype.requestRedraw=function(){this.needRedraw=!0},t.prototype.changeProjection=function(a){this.projectionMethod=a,this.requestRedraw()},t.prototype.changeFrame=function(c){if(this.cooFrame=c,this.cooFrame==CooFrameEnum.GAL){var a=CooConversion.J2000ToGalactic([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=a[0],this.viewCenter.lat=a[1]}else {if(this.cooFrame==CooFrameEnum.J2000){var b=CooConversion.GalacticToJ2000([this.viewCenter.lon,this.viewCenter.lat]);this.viewCenter.lon=b[0],this.viewCenter.lat=b[1]}}this.requestRedraw()},t.prototype.showHealpixGrid=function(a){this.displayHpxGrid=a,this.requestRedraw()},t.prototype.showSurvey=function(a){this.displaySurvey=a,this.requestRedraw()},t.prototype.showCatalog=function(a){this.displayCatalog=a,this.displayCatalog||(this.mustClearCatalog=!0),this.requestRedraw()},t.prototype.showReticle=function(a){this.displayReticle=a,this.mustRedrawReticle=!0,this.requestRedraw()},t.prototype.pointTo=function(b,a){if(b=parseFloat(b),a=parseFloat(a),!isNaN(b)&&!isNaN(a)){if(this.cooFrame==CooFrameEnum.J2000){this.viewCenter.lon=b,this.viewCenter.lat=a}else {if(this.cooFrame==CooFrameEnum.GAL){var c=CooConversion.J2000ToGalactic([b,a]);this.viewCenter.lon=c[0],this.viewCenter.lat=c[1]}}this.location.update(this.viewCenter.lon,this.viewCenter.lat,this.cooFrame,!0),this.forceRedraw(),this.requestRedraw();var d=this;setTimeout(function(){d.refreshProgressiveCats()},1000)}},t.prototype.makeUniqLayerName=function(a){if(!this.layerNameExists(a)){return a}for(var b=1;;++b){var c=a+'_'+b;if(!this.layerNameExists(c)){return c}}},t.prototype.layerNameExists=function(c){for(var b=this.catalogs,a=0;b.length>a;a++){if(c==b[a].name){return !0}}return !1},t.prototype.removeLayers=function(){this.catalogs=[],this.overlays=[],this.requestRedraw()},t.prototype.addCatalog=function(a){a.name=this.makeUniqLayerName(a.name),this.catalogs.push(a),'catalog'==a.type?a.setView(this):'progressivecat'==a.type&&a.init(this)},t.prototype.addOverlay=function(a){this.overlays.push(a),a.setView(this)},t.prototype.addMOC=function(a){this.mocs.push(a),a.setView(this)},t.prototype.getObjectsInBBox=function(i,d,b,c){0>b&&(i+=b,b=-b),0>c&&(d+=c,c=-c);var h,g,a,j=[];if(this.catalogs){for(var e=0;this.catalogs.length>e;e++){if(h=this.catalogs[e],h.isShowing){g=h.getSources();for(var f=0;g.length>f;f++){a=g[f],a.isShowing&&a.x&&a.y&&a.x>=i&&i+b>=a.x&&a.y>=d&&d+c>=a.y&&j.push(a)}}}}return j},t.prototype.updateObjectsLookup=function(){this.objLookup=[];var g,e,a,b,c;if(this.catalogs){for(var f=0;this.catalogs.length>f;f++){if(g=this.catalogs[f],g.isShowing){e=g.getSources();for(var d=0;e.length>d;d++){a=e[d],a.isShowing&&a.x&&a.y&&(b=a.x,c=a.y,this.objLookup[b]||(this.objLookup[b]=[]),this.objLookup[b][c]||(this.objLookup[b][c]=[]),this.objLookup[b][c].push(a))}}}}},t.prototype.closestObjects=function(e,f,d){if(!this.objLookup){return null}for(var c,g,i=0;d>=i;i++){c=g=null;for(var a=-d;d>=a;a++){if(this.objLookup[e+a]){for(var b=-d;d>=b;b++){if(this.objLookup[e+a][f+b]){if(c){var h=a*a+b*b;g>h&&(g=h,c=this.objLookup[e+a][f+b])}else {c=this.objLookup[e+a][f+b]}}}}}if(c){return c}}return null},t}(),Aladin=function(){var a=function(b,d){if(0==$(b).length){return console.log('Could not find div '+b+'. Aborting creation of Aladin Lite instance'),void 0}var e=this;if(void 0===d&&(d=this.getOptionsFromQueryString()),d=d||{},'zoom' in d){var v=d.zoom;delete d.zoom,d.fov=v}var c={};for(var f in a.DEFAULT_OPTIONS){c[f]=void 0!==d[f]?d[f]:a.DEFAULT_OPTIONS[f]}for(var f in d){void 0===a.DEFAULT_OPTIONS[f]&&(c[f]=d[f])}this.options=c,$("<style type='text/css'> .aladin-reticleColor { color: "+this.options.reticleColor+'; font-weight:bold;} </style>').appendTo(b),this.aladinDiv=b,this.reduceDeformations=!0,$(b).addClass('aladin-container');var q=CooFrameEnum.fromString(c.cooFrame,CooFrameEnum.J2000),o=q==CooFrameEnum.J2000,u=$('<div class="aladin-location">'+(c.showFrame?'<select class="aladin-frameChoice"><option value="'+CooFrameEnum.J2000+'" '+(o?'selected="selected"':'')+'>J2000</option><option value="'+CooFrameEnum.GAL+'" '+(o?'':'selected="selected"')+'>GAL</option></select>':'')+'<span class="aladin-location-text"></span></div>').appendTo(b),t=$('<div class="aladin-fov"></div>').appendTo(b);c.showZoomControl&&$('<div class="aladin-zoomControl"><a href="#" class="zoomPlus" title="Zoom in">+</a><a href="#" class="zoomMinus" title="Zoom out">&ndash;</a></div>').appendTo(b),c.showFullscreenControl&&$('<div class="aladin-fullscreenControl aladin-maximize" title="Full screen"></div>').appendTo(b),this.fullScreenBtn=$(b).find('.aladin-fullscreenControl'),this.fullScreenBtn.click(function(){e.toggleFullscreen()}),$("<div class='aladin-logo-container'><a href='http://aladin.unistra.fr/' title='Powered by Aladin Lite' target='_blank'><div class='aladin-logo'></div></a></div>").appendTo(b),this.boxes=[],this.measurementTable=new MeasurementTable(b);var w=new Location(u.find('.aladin-location-text'));if(this.view=new View(this,w,t,q,c.fov),this.view.setShowGrid(c.showCooGrid),$.ajax({url:'http://aladin.unistra.fr/java/nph-aladin.pl',data:{frame:'aladinLiteDic'},method:'GET',dataType:'jsonp',success:function(c){for(var f={},a=0;c.length>a;a++){f[c[a].id]=!0}for(var a=0;HpxImageSurvey.SURVEYS.length>a;a++){f[HpxImageSurvey.SURVEYS[a].id]||c.push(HpxImageSurvey.SURVEYS[a])}HpxImageSurvey.SURVEYS=c,e.view.setUnknownSurveyIfNeeded()},error:function(){}}),c.showLayersControl){var g=$('<div class="aladin-layersControl-container" title="Manage layers"><div class="aladin-layersControl"></div></div>');g.appendTo(b);var n=$('<div class="aladin-box aladin-layerBox aladin-cb-list"></div>');n.appendTo(b),this.boxes.push(n),g.click(function(){return e.hideBoxes(),e.showLayerBox(),!1})}if(c.showGotoControl){var g=$('<div class="aladin-gotoControl-container" title="Go to position"><div class="aladin-gotoControl"></div></div>');g.appendTo(b);var h=$('<div class="aladin-box aladin-gotoBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><form class="aladin-target-form">Go to: <input type="text" placeholder="Object name/position" /></form></div>');h.appendTo(b),this.boxes.push(h);var k=h.find('.aladin-target-form input');k.on('paste keydown',function(){$(this).removeClass('aladin-unknownObject')}),g.click(function(){return e.hideBoxes(),k.val(''),k.removeClass('aladin-unknownObject'),h.show(),k.focus(),!1}),h.find('.aladin-closeBtn').click(function(){return e.hideBoxes(),!1})}if(c.showShareControl){var g=$('<div class="aladin-shareControl-container" title="Share current view"><div class="aladin-shareControl"></div></div>');g.appendTo(b);var j=$('<div class="aladin-box aladin-shareBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><b>Share</b><input type="text" class="aladin-shareInput" /></div>');j.appendTo(b),this.boxes.push(j),g.click(function(){return e.hideBoxes(),j.show(),!1}),j.find('.aladin-closeBtn').click(function(){return e.hideBoxes(),!1})}if(this.gotoObject(c.target),c.log){var p=d;p.version=a.VERSION,Logger.log('startup',p)}if(this.showReticle(c.showReticle),c.catalogUrls){for(var l=0,s=c.catalogUrls.length;s>l;l++){this.createCatalogFromVOTable(c.catalogUrls[l])}}this.setImageSurvey(c.survey),this.view.showCatalog(c.showCatalog);var i=this;$(b).find('.aladin-frameChoice').change(function(){i.setFrame($(this).val())}),$('#projectionChoice').change(function(){i.setProjection($(this).val())}),$(b).find('.aladin-target-form').submit(function(){return i.gotoObject($(this).find('input').val(),function(){$(b).find('.aladin-target-form input').addClass('aladin-unknownObject')}),!1});var m=$(b).find('.zoomPlus');m.click(function(){return i.increaseZoom(),!1}),m.bind('mousedown',function(a){a.preventDefault()});var r=$(b).find('.zoomMinus');r.click(function(){return i.decreaseZoom(),!1}),r.bind('mousedown',function(a){a.preventDefault()}),c.fullScreen&&window.setTimeout(function(){e.toggleFullscreen()},1000),this.callbacksByEventName={}};a.VERSION='2017-07-26',a.JSONP_PROXY='http://alasky.unistra.fr/cgi/JSONProxy',a.DEFAULT_OPTIONS={target:'0 +0',cooFrame:'J2000',survey:'P/DSS2/color',fov:60,showReticle:!0,showZoomControl:!0,showFullscreenControl:!0,showLayersControl:!0,showGotoControl:!0,showShareControl:!1,showCatalog:!0,showFrame:!0,showCooGrid:!1,fullScreen:!1,reticleColor:'rgb(178, 50, 178)',reticleSize:22,log:!0,allowFullZoomout:!1},a.prototype.toggleFullscreen=function(){this.fullScreenBtn.toggleClass('aladin-maximize aladin-restore');var a=this.fullScreenBtn.hasClass('aladin-restore');this.fullScreenBtn.attr('title',a?'Restore original size':'Full screen'),$(this.aladinDiv).toggleClass('aladin-fullscreen'),this.view.fixLayoutDimensions()},a.prototype.updateSurveysDropdownList=function(a){a=a.sort(function(b,c){return b.order?b.order&&b.order>c.order?1:-1:b.id>c.id});var c=$(this.aladinDiv).find('.aladin-surveySelection');c.empty();for(var b=0;a.length>b;b++){var d=this.view.imageSurvey.id==a[b].id;c.append($('<option />').attr('selected',d).val(a[b].id).text(a[b].name))}},a.prototype.getOptionsFromQueryString=function(){var a={},f=$.urlParam('target');f&&(a.target=f);var c=$.urlParam('frame');c&&CooFrameEnum[c]&&(a.frame=c);var d=$.urlParam('survey');d&&HpxImageSurvey.getSurveyInfoFromId(d)&&(a.survey=d);var b=$.urlParam('zoom');b&&b>0&&180>b&&(a.zoom=b);var h=$.urlParam('showReticle');h&&(a.showReticle='true'==h.toLowerCase());var e=$.urlParam('cooFrame');e&&(a.cooFrame=e);var g=$.urlParam('fullScreen');return void 0!==g&&(a.fullScreen=g),a},a.prototype.setZoom=function(a){this.view.setZoom(a)},a.prototype.setFoV=a.prototype.setFov=function(a){this.view.setZoom(a)},a.prototype.adjustFovForObject=function(b){var a=this;this.getFovForObject(b,function(c){a.setFoV(c)})},a.prototype.getFovForObject=function(e,a){var b="SELECT galdim_majaxis, V FROM basic JOIN ident ON oid=ident.oidref JOIN allfluxes ON oid=allfluxes.oidref WHERE id='"+e+"'",c='http://simbad.u-strasbg.fr/simbad/sim-tap/sync?query='+encodeURIComponent(b)+'&request=doQuery&lang=adql&format=json&phase=run',d=Utils.getAjaxObject(c,'GET','json',!1);d.done(function(b){var g=4/60,d=g;if('data' in b&&b.data.length>0){var f=Utils.isNumber(b.data[0][0])?b.data[0][0]/60:null,c=Utils.isNumber(b.data[0][1])?b.data[0][1]:null;null!==f?d=2*f:null!==c&&10>c&&(d=2*Math.pow(2,6-c/2)/60)}'function'==typeof a&&a(d)})},a.prototype.setFrame=function(b){if(b){var a=CooFrameEnum.fromString(b,CooFrameEnum.J2000);a!=this.view.cooFrame&&(this.view.changeFrame(a),$(this.aladinDiv).find('.aladin-frameChoice').val(a))}},a.prototype.setProjection=function(a){if(a){switch(a=a.toLowerCase()){case 'aitoff':this.view.changeProjection(ProjectionEnum.AITOFF);break;case 'sinus':default:this.view.changeProjection(ProjectionEnum.SIN);}}},a.prototype.gotoObject=function(b,d){var e=/[a-zA-Z]/.test(b);if(e){var f=this;Sesame.resolve(b,function(a){var c=a.Target.Resolver.jradeg,e=a.Target.Resolver.jdedeg;f.view.pointTo(c,e)},function(a){console&&(console.log('Could not resolve object name '+b),console.log(a)),d&&d()})}else {var c=new Coo();c.parse(b);var a=[c.lon,c.lat];this.view.cooFrame==CooFrameEnum.GAL&&(a=CooConversion.GalacticToJ2000(a)),this.view.pointTo(a[0],a[1])}},a.prototype.gotoPosition=function(c,b){var a;a=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([c,b]):[c,b],this.view.pointTo(a[0],a[1])};var b=function(c){var a=c.animationParams;if(null!=a){var d=(new Date()).getTime();if(d>a.end){return c.gotoRaDec(a.raEnd,a.decEnd),a.complete&&a.complete(),void 0}var f=a.raStart+(a.raEnd-a.raStart)*(d-a.start)/(a.end-a.start),e=a.decStart+(a.decEnd-a.decStart)*(d-a.start)/(a.end-a.start);c.gotoRaDec(f,e),setTimeout(function(){b(c)},50)}};return a.prototype.animateToRaDec=function(g,e,c,f){c=c||5,this.animationParams=null,b(this);var a={};a.start=(new Date()).getTime(),a.end=(new Date()).getTime()+1000*c;var d=this.getRaDec();a.raStart=d[0],a.decStart=d[1],a.raEnd=g,a.decEnd=e,a.complete=f,this.animationParams=a,b(this)},a.prototype.getRaDec=function(){if(this.view.cooFrame==CooFrameEnum.J2000){return [this.view.viewCenter.lon,this.view.viewCenter.lat]}var a=CooConversion.GalacticToJ2000([this.view.viewCenter.lon,this.view.viewCenter.lat]);return a},a.prototype.gotoRaDec=function(b,a){this.view.pointTo(b,a)},a.prototype.showHealpixGrid=function(a){this.view.showHealpixGrid(a)},a.prototype.showSurvey=function(a){this.view.showSurvey(a)},a.prototype.showCatalog=function(a){this.view.showCatalog(a)},a.prototype.showReticle=function(a){this.view.showReticle(a),$('#displayReticle').attr('checked',a)},a.prototype.removeLayers=function(){this.view.removeLayers()},a.prototype.addCatalog=function(a){this.view.addCatalog(a)},a.prototype.addOverlay=function(a){this.view.addOverlay(a)},a.prototype.addMOC=function(a){this.view.addMOC(a)},a.prototype.createImageSurvey=function(f,a,b,d,e,c){return new HpxImageSurvey(f,a,b,d,e,c)},a.prototype.getBaseImageLayer=function(){return this.view.imageSurvey},a.prototype.setImageSurvey=function(a,c){if(this.view.setImageSurvey(a,c),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys()),this.options.log){var b=a;'string'!=typeof a&&(b=a.rootUrl),Logger.log('changeImageSurvey',b)}},a.prototype.setBaseImageLayer=a.prototype.setImageSurvey,a.prototype.getOverlayImageLayer=function(){return this.view.overlayImageSurvey},a.prototype.setOverlayImageLayer=function(b,a){this.view.setOverlayImageSurvey(b,a)},a.prototype.increaseZoom=function(a){a||(a=5),this.view.setZoomLevel(this.view.zoomLevel+a)},a.prototype.decreaseZoom=function(a){a||(a=5),this.view.setZoomLevel(this.view.zoomLevel-a)},a.prototype.createCatalog=function(a){return A.catalog(a)},a.prototype.createProgressiveCatalog=function(d,a,b,c){return new ProgressiveCat(d,a,b,c)},a.prototype.createSource=function(c,a,b){return new cds.Source(c,a,b)},a.prototype.createMarker=function(d,b,a,c){return a=a||{},a.marker=!0,new cds.Source(d,b,c,a)},a.prototype.createOverlay=function(a){return new Overlay(a)},a.prototype.createFootprintsFromSTCS=function(e){for(var b=Overlay.parseSTCS(e),c=[],a=0,d=b.length;d>a;a++){c.push(new Footprint(b[a]))}return c},A.MOCFromURL=function(d,b,c){var a=new MOC(b);return a.dataFromFITSURL(d,c),a},A.MOCFromJSON=function(c,b){var a=new MOC(b);return a.dataFromJSON(c),a},a.prototype.createCatalogFromVOTable=function(b,a){return A.catalogFromURL(b,a)},A.catalogFromURL=function(e,c,b,d){var a=A.catalog(c);return cds.Catalog.parseVOTable(e,function(f){a.addSources(f),b&&b(f)},a.maxNbSources,d,a.raField,a.decField),a},A.catalogFromSimbad=function(e,b,a,c){a=a||{},'name' in a||(a.name='Simbad');var d=URLBuilder.buildSimbadCSURL(e,b);return A.catalogFromURL(d,a,c,!1)},A.catalogFromNED=function(a,e,b,g){b=b||{},'name' in b||(b.name='NED');var c;if(a&&'object'==typeof a){'ra' in a&&'dec' in a&&(c=URLBuilder.buildNEDPositionCSURL(a.ra,a.dec,e))}else {var f=/[a-zA-Z]/.test(a);if(f){c=URLBuilder.buildNEDObjectCSURL(a,e)}else {var d=new Coo();d.parse(a),c=URLBuilder.buildNEDPositionCSURL(d.lon,d.lat,e)}}return A.catalogFromURL(c,b,g)},A.catalogFromVizieR=function(b,c,d,a,f){a=a||{},'name' in a||(a.name='VizieR:'+b);var e=URLBuilder.buildVizieRCSURL(b,c,d);return A.catalogFromURL(e,a,f,!1)},A.catalogFromSkyBot=function(h,d,e,g,b,a,c){b=b||{},a=a||{},'name' in a||(a.name='SkyBot');var f=URLBuilder.buildSkyBotCSURL(h,d,e,g,b);return A.catalogFromURL(f,a,c,!1)},a.AVAILABLE_CALLBACKS=['select','objectClicked','objectHovered','positionChanged','zoomChanged'],a.prototype.on=function(b,c){0>a.AVAILABLE_CALLBACKS.indexOf(b)||(this.callbacksByEventName[b]=c)},a.prototype.select=function(){this.fire('selectstart')},a.prototype.fire=function(b,c){if('selectstart'===b){this.view.setMode(View.SELECT)}else {if('selectend'===b){this.view.setMode(View.PAN);var a=this.callbacksByEventName.select;'function'==typeof a&&a(c)}}},a.prototype.hideBoxes=function(){if(this.boxes){for(var a=0;this.boxes.length>a;a++){this.boxes[a].hide()}}},a.prototype.updateCM=function(){},a.prototype.showLayerBox=function(){var c=this,a=$(this.aladinDiv).find('.aladin-layerBox');a.empty(),a.append('<a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><div class="aladin-label">Base image layer</div><select class="aladin-surveySelection"></select><div class="aladin-cmap">Color map:<div><select class="aladin-cmSelection"></select><button class="aladin-btn aladin-btn-small aladin-reverseCm" type="button">Reverse</button></div></div><div class="aladin-box-separator"></div><div class="aladin-label">Overlay layers</div>');for(var f=a.find('.aladin-cmap'),j=a.find('.aladin-cmSelection'),b=0;ColorMap.MAPS_NAMES.length>b;b++){j.append($('<option />').text(ColorMap.MAPS_NAMES[b]))}j.val(c.getBaseImageLayer().getColorMap().mapName);for(var g=this.view.catalogs,h='<ul>',b=g.length-1;b>=0;b--){var i=g[b].name,d='';g[b].isShowing&&(d='checked="checked"');var m=g[b].getSources().length,o=m+' source'+(m>1?'s':''),k=g[b].color,r=$('<div></div>').css('color',k).css('color'),p=Color.getLabelColorForBackground(r);h+='<li><div class="aladin-layerIcon" style="background: '+k+';"></div><input type="checkbox" '+d+' id="aladin_lite_'+i+'"></input><label for="aladin_lite_'+i+'" class="aladin-layer-label" style="background: '+k+'; color:'+p+';" title="'+o+'">'+i+'</label></li>'}h+='</ul>',a.append(h),a.append('<div class="aladin-blank-separator"></div>');var d='';this.view.displayReticle&&(d='checked="checked"');var l=$('<input type="checkbox" '+d+' id="displayReticle" />');a.append(l).append('<label for="displayReticle">Reticle</label><br/>'),l.change(function(){c.showReticle($(this).is(':checked'))}),d='',this.view.displayHpxGrid&&(d='checked="checked"');var n=$('<input type="checkbox" '+d+' id="displayHpxGrid"/>');a.append(n).append('<label for="displayHpxGrid">HEALPix grid</label><br/>'),n.change(function(){c.showHealpixGrid($(this).is(':checked'))}),a.append('<div class="aladin-box-separator"></div><div class="aladin-label">Tools</div>');var e=$('<button class="aladin-btn" type="button">Export view as PNG</button>');a.append(e),e.click(function(){c.exportAsPNG()}),a.find('.aladin-closeBtn').click(function(){return c.hideBoxes(),!1}),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys());var q=$(this.aladinDiv).find('.aladin-surveySelection');q.change(function(){var a=HpxImageSurvey.getAvailableSurveys()[$(this)[0].selectedIndex];c.setImageSurvey(a.id,function(){var a=c.getBaseImageLayer();a.useCors?(j.val(a.getColorMap().mapName),f.show(),e.show()):(f.hide(),e.hide())})}),f.find('.aladin-cmSelection').change(function(){var a=$(this).find(':selected').val();c.getBaseImageLayer().getColorMap().update(a)}),f.find('.aladin-reverseCm').click(function(){c.getBaseImageLayer().getColorMap().reverse()}),this.getBaseImageLayer().useCors?(f.show(),e.show()):(f.hide(),e.hide()),a.find('.aladin-reverseCm').parent().attr('disabled',!0),$(this.aladinDiv).find('.aladin-layerBox ul input').change(function(){var b=$(this).attr('id').substr(12),a=c.layerByName(b);$(this).is(':checked')?a.show():a.hide()}),a.show()},a.prototype.layerByName=function(c){for(var b=this.view.catalogs,a=0;this.view.catalogs.length>a;a++){if(c==b[a].name){return b[a]}}return null},a.prototype.exportAsPNG=function(){window.open(this.getViewDataURL(),'Aladin Lite snapshot')},a.prototype.getViewDataURL=function(a){return this.view.getCanvasDataURL(a)},a.prototype.setFOVRange=function(b,a){if(b>a){var c=b;b=a,a=c}this.view.minFOV=b,this.view.maxFOV=a},a.prototype.pix2world=function(e,c){if(this.view){var d,b=AladinUtils.viewToXy(e,c,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor),a=this.view.projection.unproject(b.x,b.y);return d=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([a.ra,a.dec]):[a.ra,a.dec]}},a.prototype.world2pix=function(e,b){if(this.view){var a;if(this.view.cooFrame==CooFrameEnum.GAL){var c=CooConversion.J2000ToGalactic([e,b]);a=this.view.projection.project(c[0],c[1])}else {a=this.view.projection.project(e,b)}if(a){var d=AladinUtils.xyToView(a.X,a.Y,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor);return [d.vx,d.vy]}return null}},a.prototype.getFovCorners=function(b){(!b||1>b)&&(b=1);for(var d,e,g,h,f=[],a=0;4>a;a++){d=0==a||3==a?0:this.view.width-1,e=2>a?0:this.view.height-1,g=2>a?this.view.width-1:0,h=1==a||2==a?this.view.height-1:0;for(var c=0;b>c;c++){f.push(this.pix2world(d+c/b*(g-d),e+c/b*(h-e)))}}return f},a.prototype.getFov=function(){var a=this.view.fov,c=this.getSize(),b=c[1]/c[0]*a;return a=Math.min(a,180),b=Math.min(b,180),[a,b]},a.prototype.getSize=function(){return [this.view.width,this.view.height]},a.prototype.getParentDiv=function(){return $(this.aladinDiv)},a}(),A.aladin=function(b,a){return new Aladin($(b)[0],a)},A.imageLayer=function(d,a,b,c){return new HpxImageSurvey(d,a,b,null,null,c)},A.source=function(d,a,b,c){return new cds.Source(d,a,b,c)},A.marker=function(d,b,a,c){return a=a||{},a.marker=!0,A.source(d,b,c,a)},A.polygon=function(a){var b=a.length;return b>0&&(a[0][0]!=a[b-1][0]||a[0][1]!=a[b-1][1])&&a.push([a[0][0],a[0][1]]),new Footprint(a)},A.polyline=function(b,a){return new Polyline(b,a)},A.circle=function(d,a,b,c){return new Circle([d,a],b,c)},A.graphicOverlay=function(a){return new Overlay(a)},A.catalog=function(a){return new cds.Catalog(a)},A.catalogHiPS=function(b,a){return new ProgressiveCat(b,null,null,a)},Aladin.prototype.getShareURL=function(){var b=this.getRaDec(),a=new Coo();return a.prec=7,a.lon=b[0],a.lat=b[1],'http://aladin.unistra.fr/AladinLite/?target='+encodeURIComponent(a.format('s'))+'&fov='+this.getFov()[0].toFixed(2)+'&survey='+encodeURIComponent(this.getBaseImageLayer().id)},Aladin.prototype.getEmbedCode=function(){var c=this.getRaDec(),b=new Coo();b.prec=7,b.lon=c[0],b.lat=c[1];var d=this.getBaseImageLayer().id,e=this.getFov()[0],a='';return a+='<link rel="stylesheet" href="http://aladin.unistra.fr/AladinLite/api/v2/latest/aladin.min.css" />\n',a+='<script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.min.js" charset="utf-8"></script>\n',a+='<div id="aladin-lite-div" style="width:400px;height:400px;"></div>\n',a+='<script type="text/javascript" src="http://aladin.unistra.fr/AladinLite/api/v2/latest/aladin.min.js" charset="utf-8"></script>\n',a+='<script type="text/javascript">\n',a+='var aladin = A.aladin("#aladin-lite-div", {survey: "'+d+'P/DSS2/color", fov: '+e.toFixed(2)+', target: "'+b.format('s')+'"});\n',a+='</script>'},Aladin.prototype.displayFITS=function(f,a,d,e){a=a||{};var c={url:f};a.color&&(c.color=!0),a.outputFormat&&(c.format=a.outputFormat),a.order&&(c.order=a.order),a.nocache&&(c.nocache=a.nocache);var b=this;$.ajax({url:'http://alasky.unistra.fr/cgi/fits2HiPS',data:c,method:'GET',dataType:'json',success:function(g){if('success'!=g.status){return console.error('An error occured: '+g.message),e&&e(g.message),void 0}var i=a.label||'FITS image',c=g.data.meta;b.setOverlayImageLayer(b.createImageSurvey(i,i,g.data.url,'equatorial',c.max_norder,{imgFormat:'png'}));var j=a&&a.transparency||1;b.getOverlayImageLayer().setAlpha(j);var h=!0;d&&(h=d(c.ra,c.dec,c.fov)),h===!0&&(b.gotoRaDec(c.ra,c.dec),b.setFoV(c.fov))}})},Aladin.prototype.displayJPG=Aladin.prototype.displayPNG=function(d,a,b,c){a=a||{},a.color=!0,a.label='JPG/PNG image',a.outputFormat='png',this.displayFITS(d,a,b,c)},Aladin.prototype.setReduceDeformations=function(a){this.reduceDeformations=a,this.view.requestRedraw()},$&&($.aladin=A.aladin);