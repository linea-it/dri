var $jscomp={};$jscomp.scope={};$jscomp.defineProperty=typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=(a);if(a.get||a.set){throw new TypeError('ES3 does not support getters and setters.')}if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(c,b,a){var d=this.length;c=Number(c);b=Number(b);a=Number(a!=null?a:d);if(c<b){a=Math.min(a,d);while(b<a){if(b in this){this[c++]=this[b++]}else {delete this[c++];b++}}}else {a=Math.min(a,d+b-c);c+=a-b;while(a>b){if(--a in this){this[--c]=this[a]}else {delete this[c]}}}return this};return b},'es6-impl','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global.Symbol){$jscomp.global.Symbol=$jscomp.Symbol}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return ($jscomp.SYMBOL_PREFIX+(a||'')+$jscomp.symbolCounter_++)};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;if(!a){a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global.Symbol.iterator]=function(){return this};return (a)};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a,b){return [a,b]})};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(e,b,a){var c=this.length||0;if(b<0){b=Math.max(0,c+(b))}if(a==null||a>c){a=c}a=Number(a);if(a<0){a=Math.max(0,c+a)}for(var d=Number(b||0);d<a;d++){this[d]=e}return this};return b},'es6-impl','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=(String(a))}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).v};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(b,a){return $jscomp.findInternal(this,b,a).i};return b},'es6-impl','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(a,b,f){$jscomp.initSymbolIterator();b=b!=null?b:function(a){return a};var c=[];var e=(a)[Symbol.iterator];if(typeof e=='function'){a=e.call(a);var g;while(!(g=a.next()).done){c.push(b.call((f),g.value))}}else {var h=a.length;for(var d=0;d<h;d++){c.push(b.call((f),a[d]))}}return c};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(a){return a})};return b},'es6-impl','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(a){return Array.from(arguments)};return b},'es6-impl','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})};return b},'es6','es3');$jscomp.executeAsyncGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(a){if(a.done){b(a.value)}else {Promise.resolve(a.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=(a)[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator((a))};$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new (c)([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if(isConformant()){return c}var a='$jscomp_hidden_'+Math.random().toString().substring(2);function insert(b){if(!$jscomp.owns(b,a)){var c={};$jscomp.defineProperty(b,a,{value:c})}}function patch(a){var b=Object[a];if(b){Object[a]=function(a){insert(a);return b(a)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(a);var b;while(!(b=e.next()).done){var c=b.value;this.set((c[0]),(c[1]))}}};b.prototype.set=function(b,c){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=c;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6-impl','es3');$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.polyfill('Map',function(b){var h=!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(k){return !1}}();if(h){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=new WeakMap();var c=function(){};c.prototype.previous;c.prototype.next;c.prototype.head;c.prototype.key;c.prototype.value;var a=function(a){this.data_={};this.head_=g();this.size=0;if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.set((c[0]),(c[1]))}}};a.prototype.set=function(c,b){var a=d(this,c);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:b};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=b}return this};a.prototype['delete']=function(b){var a=d(this,b);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return !!d(this,a).entry};a.prototype.get=function(b){var a=d(this,b).entry;return (a&&(a.value))};a.prototype.entries=function(){return e(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return e(this,function(a){return a.key})};a.prototype.values=function(){return e(this,function(a){return a.value})};a.prototype.forEach=function(d,c){var e=this.entries();var b;while(!(b=e.next()).done){var a=b.value;d.call((c),(a[1]),(a[0]),this)}};(a.prototype)[Symbol.iterator]=a.prototype.entries;var d=function(f,d){var e=j(d);var a=f.data_[e];if(a&&$jscomp.owns(f.data_,e)){for(var c=0;c<a.length;c++){var b=a[c];if(d!==d&&b.key!==b.key||d===b.key){return {id:e,list:a,index:c,entry:b}}}}return {id:e,list:a,index:-1,entry:undefined}};var e=function(b,c){var a=b.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=b.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:c(a)}}a=null}return {done:!0,value:void 0}})};var g=function(){var a={};a.previous=a.next=a.head=a;return a};var i=0;var j=function(a){var b=a&&typeof a;if(b=='object'||b=='function'){a=(a);if(!f.has(a)){var c=''+ ++i;f.set(a,c);return c}return f.get(a)}return 'p_'+a};return a},'es6-impl','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};return b},'es6-impl','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var e=a;var f=1;var b=a;var c=0;var d=1;while(c!=b){e*=a;d*=-1;b=(c=b)+d*e/++f}return b}return Math.log(1+a)};return b},'es6-impl','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(b){b=Number(b);return (a(b)-a(-b))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(a){if(a===0){return a}a=Number(a);var b=Math.pow(Math.abs(a),1/3);return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(a){a=Number(a)>>>0;if(a===0){return 32}var b=0;if((a&4.29490176E9)===0){a<<=16;b+=16}if((a&4.27819008E9)===0){a<<=8;b+=8}if((a&4.02653184E9)===0){a<<=4;b+=4}if((a&3.221225472E9)===0){a<<=2;b+=2}if((a&2.147483648E9)===0){b++}return b};return b},'es6-impl','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);return (b(a)+b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(a){a=Number(a);if(a<0.25&&a>-0.25){var d=a;var e=1;var b=a;var c=0;while(c!=b){d*=a/++e;b=(c=b)+d}return b}return Math.exp(a)-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(b,c,g){b=Number(b);c=Number(c);var a,f,e;var d=Math.max(Math.abs(b),Math.abs(c));for(a=2;a<arguments.length;a++){d=Math.max(d,Math.abs(arguments[a]))}if(d>1.0E100||d<1.0E-100){b=b/d;c=c/d;e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a])/d;e+=f*f}return Math.sqrt(e)*d}else {e=b*b+c*c;for(a=2;a<arguments.length;a++){f=Number(arguments[a]);e+=f*f}return Math.sqrt(e)}};return b},'es6-impl','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(a,b){a=Number(a);b=Number(b);var e=a>>>16&65535;var c=a&65535;var f=b>>>16&65535;var d=b&65535;var g=e*d+c*f<<16>>>0;return c*d+g|0};return b},'es6-impl','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN10};return b},'es6-impl','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(a){return Math.log(a)/Math.LN2};return b},'es6-impl','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(a){a=Number(a);return a===0||isNaN(a)?a:a>0?1:-1};return b},'es6-impl','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(a){a=Number(a);if(a===0){return a}return (b(a)-b(-a))/2};return c},'es6-impl','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(a){a=Number(a);if(a===0){return a}var b=Math.exp(-2*Math.abs(a));var c=(1-b)/(1+b);return a<0?-c:c};return b},'es6-impl','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(a){a=Number(a);if(isNaN(a)||a===Infinity||a===-Infinity||a===0){return a}var b=Math.floor(Math.abs(a));return a<0?-b:b};return b},'es6-impl','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6-impl','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6-impl','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(a){if(typeof a!=='number'){return !1}return !isNaN(a)&&a!==Infinity&&a!==-Infinity};return b},'es6-impl','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(a){if(!Number.isFinite(a)){return !1}return a===Math.floor(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(a){return typeof a==='number'&&isNaN(a)};return b},'es6-impl','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};return b},'es6-impl','es3');$jscomp.polyfill('Object.assign',function(a){if(a){return a}var b=function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};return b},'es6-impl','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6-impl','es5');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(a,b){if(a===b){return a!==0||1/a===1/(b)}else {return a!==a&&b!==b}};return b},'es6-impl','es3');$jscomp.polyfill('Object.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a};return b},'es6','es5');$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var c=b[a];delete b[a];try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(c){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(c){return function(d){if(!a){a=!0;c.call(b,d)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_((b))}else {if(isObject(b)){this.resolveToNonPromiseObj_((b))}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,(b))}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(c,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+c+', '+a|'): Promise already settled in state'+this.state_)}this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){var b=this.onSettledCallbacks_;for(var a=0;a<b.length;++a){(b[a]).call();b[a]=null}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,c){var a=this.createResolveAndReject_();try{b.call(c,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(e,f){var b;var c;var d=new a(function(a,d){b=a;c=d});function createCallback(a,d){if(typeof a=='function'){return function(d){try{b(a(d))}catch(g){c(g)}}}else {return d}}this.callWhenSettled_(createCallback(e,b),createCallback(f,c));return d};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(c,e){var a=this;function callback(){switch(a.state_){case b.FULFILLED:c(a.result_);break;case b.REJECTED:e(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(function(){d.asyncExecute(callback)})}};a.resolve=function(b){if(b instanceof a){return b}else {return new a(function(a,c){a(b)})}};a.reject=function(b){return new a(function(c,a){a(b)})};a.race=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var c=d.next();!c.done;c=d.next()){a.resolve(c.value).callWhenSettled_(e,f)}})};a.all=function(d){var c=$jscomp.makeIterator(d);var b=c.next();if(b.done){return a.resolve([])}else {return new a(function(f,g){var d=[];var e=0;function onFulfilled(a){return function(b){d[a]=b;e--;if(e==0){f(d)}}}do{d.push(undefined);e++;a.resolve(b.value).callWhenSettled_(onFulfilled(d.length-1),g);b=c.next()}while(!b.done)})}};if($jscomp.EXPOSE_ASYNC_EXECUTOR){a['$jscomp$new$AsyncExecutor']=function(){return new AsyncExecutor()}}return a},'es6-impl','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(d,b,a){return c.call(d,b,a)};return b},'es6','es3');$jscomp.polyfill('Reflect.construct',function(a){if(a){return a}var b=function(b,d,a){if(a===undefined){a=b}var e=a.prototype||Object.prototype;var c=Object.create(e);var f=Reflect.apply(b,c,d);return f||c};return b},'es6','es5');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(d,c,b){try{Object.defineProperty(d,c,b);var a=Object.getOwnPropertyDescriptor(d,c);if(!a){return !1}return a.configurable===(b.configurable||!1)&&a.enumerable===(b.enumerable||!1)&&('value' in a?a.value===b.value&&a.writable===(b.writable||!1):a.get===b.get&&a.set===b.set)}catch(e){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(b,a){if(!$jscomp.owns(b,a)){return !0}try{return delete b[a]}catch(c){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(c,b,d){if(arguments.length<=2){return c[b]}var a=$jscomp.findDescriptor(c,b);if(a){return a.get?a.get.call(d):a.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(b,a){return a in b};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if(typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(b){return b.substring(0,a.length)==a}var c=function(d){var e=[];var b=Object.getOwnPropertyNames(d);var c=Object.getOwnPropertySymbols(d);for(var a=0;a<b.length;a++){(isSymbol(b[a])?c:e).push(b[a])}return e.concat(c)};return c},'es6','es5');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(typeof Object.preventExtensions!='function'){return function(){return !1}}var b=function(a){Object.preventExtensions(a);return !Object.isExtensible(a)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(a,c,d,e){var b=$jscomp.findDescriptor(a,c);if(!b){if(Reflect.isExtensible(a)){a[c]=d;return !0}return !1}if(b.set){b.set.call(arguments.length>3?e:a,d);return !0}else {if(b.writable&&!Object.isFrozen(a)){a[c]=d;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}if(typeof ''.__proto__!='object'){return null}var b=function(a,b){try{a.__proto__=b;return a.__proto__===b}catch(c){return !1}};return b},'es6','es5');$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.polyfill('Set',function(b){var c=!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=(b);var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}();if(c){return b}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=(b).value;this.add(c)}}this.size=this.map_.size};a.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(b){var a=this.map_['delete'](b);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};(a.prototype)[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(b,a){var c=this;this.map_.forEach(function(d){return b.call((a),d,d,c)})};return a},'es6-impl','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(a){var d=$jscomp.checkStringArgs(this,null,'codePointAt');var e=d.length;a=Number(a)||0;if(!(a>=0&&a<e)){return void 0}a=a|0;var b=d.charCodeAt(a);if(b<55296||b>56319||a+1===e){return b}var c=d.charCodeAt(a+1);if(c<56320||c>57343){return b}return (b-55296)*1024+c+9216};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'endsWith');a=a+'';if(b===void 0){b=c.length}var e=Math.max(0,Math.min(b|0,c.length));var d=a.length;while(d>0&&e>0){if(c[--e]!=a[--d]){return !1}}return d<=0};return b},'es6-impl','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(d){var b='';for(var c=0;c<arguments.length;c++){var a=Number(arguments[c]);if(a<0||a>1114111||a!==Math.floor(a)){throw new RangeError('invalid_code_point '+a)}if(a<=65535){b+=String.fromCharCode(a)}else {a-=65536;b+=String.fromCharCode(a>>>10&1023|55296);b+=String.fromCharCode(a&1023|56320)}}return b};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(a,b){var c=$jscomp.checkStringArgs(this,a,'includes');return c.indexOf(a,b||0)!==-1};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(a){var b=$jscomp.checkStringArgs(this,null,'repeat');if(a<0||a>1342177279){throw new RangeError('Invalid count value')}a=a|0;var c='';while(a){if(a&1){c+=b}if(a>>>=1){b+=b}}return c};return b},'es6-impl','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(a,f){var b=$jscomp.checkStringArgs(this,a,'startsWith');a=a+'';var g=b.length;var d=a.length;var e=Math.max(0,Math.min((f)|0,b.length));var c=0;while(c<d&&e<g){if(b[e++]!=a[c++]){return !1}}return c>=d};return b},'es6-impl','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){function tempCtor(){}tempCtor.prototype=b.prototype;a.prototype=new tempCtor();a.prototype.constructor=a;for(var c in b){if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}};$jscomp.polyfill('WeakSet',function(b){function isConformant(){if(!b||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var a=new (b)([c]);if(!a.has(c)||a.has(d)){return !1}a['delete'](c);a.add(d);return !a.has(c)&&a.has(d)}catch(e){return !1}}if(isConformant()){return b}var a=function(a){this.map_=new WeakMap();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=$jscomp.makeIterator(a);var b;while(!(b=d.next()).done){var c=b.value;this.add(c)}}};a.prototype.add=function(a){this.map_.set(a,!0);return this};a.prototype.has=function(a){return this.map_.has(a)};a.prototype['delete']=function(a){return this.map_['delete'](a)};return a},'es6-impl','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}L.Projection.WCS=L.Class.extend({bounds:L.bounds([-0.5,-0.5],[0.5,0.5]),project:function(b){var a=this._raDecToPhiTheta(this.celsysflag?this.eqToCelsys(b):b);a.lat=this._thetaToR(a.lat);return this._redToPix(this._phiRToRed(a))},unproject:function(c){var b=this._redToPhiR(this._pixToRed(c));b.lat=this._rToTheta(b.lat);var a=this._phiThetaToRADec(b);if(a.lng<-180){a.lng+=360}return this.celsysflag?this.celsysToEq(a):a},_natpole:function(){var c=Math.PI/180,a=this.projparam,b=L.latLng(90,180);if(a.natrval.lat===90){if(a.natpole.lng===999){b.lng=180}b.lat=a.crval.lat}else {if(a.natpole.lng===999){b.lng=a.crval.lat<a.natrval.lat?180:0}}return b},_cpole:function(){var b=Math.PI/180,a=this.projparam,i=a.natpole.lng-a.natrval.lng,n=Math.cos(i*b),g=Math.sin(i*b),f=Math.cos(a.natrval.lat*b),l=Math.sin(a.natrval.lat*b),j=Math.cos(a.crval.lat*b),k=Math.sin(a.crval.lat*b),c=Math.atan2(l,f*n)/b,h=Math.acos(k/Math.sqrt(1-f*f*g*g))/b,d=c+h,e=c-h;if(d<-180){d+=360}else {if(d>180){d-=360}}if(e<-180){e+=360}else {if(e>180){e-=360}}if(d>90){c=e}else {if(e<-90){c=d}else {c=Math.abs(d-a.natpole.lat)<Math.abs(e-a.natpole.lat)?d:e}}var m=Math.abs(a.crval.lat)===90?a.crval.lng:c===90?a.crval.lng+a.natpole.lng-a.natrval.lng-180:c===-90?a.crval.lng-a.natpole.lng+a.natrval.lng:a.crval.lng-Math.atan2(g*f/j,(l-Math.sin(c*b)*k)/(Math.cos(c*b)*j))/b;return L.latLng(c,m)},_phiThetaToRADec:function(e){var b=this.projparam,c=Math.PI/180,i=180/Math.PI,m=e.lat*c,d=Math.cos(m),l=Math.sin(m),k=b.cpole.lat*c,h=Math.cos(k),j=Math.sin(k),g=(e.lng-b.natpole.lng)*c,f=Math.cos(g),a=l*j+d*h*f;if(a>1){a=1}else {if(a<-1){a=-1}}return L.latLng(Math.asin(a)*i,b.cpole.lng+Math.atan2(-d*Math.sin(g),l*h-d*j*f)*i)},_raDecToPhiTheta:function(f){var b=this.projparam,d=Math.PI/180,i=180/Math.PI,k=(f.lng-b.cpole.lng)*d,g=Math.cos(k),o=Math.sin(k),n=f.lat*d,e=Math.cos(n),m=Math.sin(n),l=b.cpole.lat*d,h=Math.cos(l),j=Math.sin(l),c=m*j+e*h*g,a=L.latLng(Math.asin(c>1?1:c<-1?-1:c)*i,b.natpole.lng+Math.atan2(-e*o,m*h-e*j*g)*i);if(a.lng>180){a.lng-=360}else {if(a.lng<-180){a.lng+=360}}return a},_pixToRed:function(d){var c=this.projparam,b=c.cd,a=d.subtract(c.crpix);return L.point(a.x*b[0][0]+a.y*b[0][1],a.x*b[1][0]+a.y*b[1][1])},_redToPix:function(b){var c=this.projparam,a=c.cdinv;return L.point(b.x*a[0][0]+b.y*a[0][1],b.x*a[1][0]+b.y*a[1][1]).add(c.crpix)},_invertCD:function(a){var b=1/(a[0][0]*a[1][1]-a[0][1]*a[1][0]);return [[a[1][1]*b,-a[0][1]*b],[-a[1][0]*b,a[0][0]*b]]}});L.Projection.WCS.PIX=L.Projection.WCS.extend({code:'PIX',_paramInit:function(a){this.projparam=a;a.cdinv=this._invertCD(a.cd);a.cpole=a.crval;this.bounds=L.bounds([0.5,this.projparam.naxis.y-0.5],[this.projparam.naxis.x-0.5,0.5])},project:function(a){return L.point(a.lng,a.lat)},unproject:function(a){return L.latLng(a.y,a.x)}});L.Projection.WCS.zenithal=L.Projection.WCS.extend({_paramInit:function(a){this.projparam=a;a.cdinv=this._invertCD(a.cd);a.natrval=L.latLng(90,0);a.natpole=this._natpole();a.cpole=this._cpole()},_redToPhiR:function(a){return L.latLng(Math.sqrt(a.x*a.x+a.y*a.y),Math.atan2(a.x,-a.y)*180/Math.PI)},_phiRToRed:function(a){var c=Math.PI/180,b=a.lng*c;return new L.Point(a.lat*Math.sin(b),-a.lat*Math.cos(b))}});L.Projection.WCS.TAN=L.Projection.WCS.zenithal.extend({code:'TAN',_rToTheta:function(a){return Math.atan2(180,Math.PI*a)*180/Math.PI},_thetaToR:function(a){return Math.tan((90-a)*Math.PI/180)*180/Math.PI}});L.Projection.WCS.ZEA=L.Projection.WCS.zenithal.extend({code:'ZEA',_rToTheta:function(b){var a=b*Math.PI/360;if(Math.abs(a)<1){return 90-2*Math.asin(a)*180/Math.PI}else {return 90}},_thetaToR:function(a){return Math.sin((90-a)*Math.PI/360)*360/Math.PI}});L.Projection.WCS.cylindrical=L.Projection.WCS.extend({_paramInit:function(a){var b=Math.PI/180;this.projparam=a;a.cdinv=this._invertCD(a.cd);a.lambda=a.pv[1][1];if(a.lambda===0){a.lambda=1}a.natrval=L.latLng(0,0);a.natpole=this._natpole();a.cpole=this._cpole()},_rToTheta:function(a){return a},_thetaToR:function(a){return a}});L.Projection.WCS.CAR=L.Projection.WCS.cylindrical.extend({_redToPhiR:function(a){return L.latLng(a.y,a.x)},_phiRToRed:function(a){return L.point(a.lng,a.lat)}});L.Projection.WCS.CEA=L.Projection.WCS.cylindrical.extend({_redToPhiR:function(c){var b=Math.PI/180,a=c.y*this.projparam.lambda*b;return L.latLng(a>-1?a<1?Math.asin(a)/b:90:-90,c.x)},_phiRToRed:function(a){var b=Math.PI/180;return L.point(a.lng,Math.sin(a.lat*b)/(this.projparam.lambda*b))}});L.Projection.WCS.conical=L.Projection.WCS.extend({_redToPhiR:function(a){var e=Math.PI/180,b=this.projparam,d=b.y0-a.y,c=b.sthetaA*Math.sqrt(a.x*a.x+d*d);return L.latLng(c,Math.atan2(a.x/c,d/c)/b.c/e)},_phiRToRed:function(a){var c=Math.PI/180,b=this.projparam.c*a.lng*c;return L.point(a.lat*Math.sin(b),-a.lat*Math.cos(b)+this.projparam.y0)}});L.Projection.WCS.COE=L.Projection.WCS.conical.extend({_paramInit:function(a){var b=Math.PI/180;this.projparam=a;a.cdinv=this._invertCD(a.cd);a.thetaA=a.pv[1][1];a.eta=a.pv[1][2];a.sthetaA=a.thetaA>=0?1:-1;var e=a.thetaA-a.eta,f=a.thetaA+a.eta,c=Math.sin(e*b),d=Math.sin(f*b);a.gamma=c+d;a.s1s2p1=c*d+1;a.c=a.gamma/2;a.y0=2/a.gamma*Math.sqrt(a.s1s2p1-a.gamma*Math.sin(a.thetaA*b))/b;a.natrval=L.latLng(a.thetaA,0);a.natpole=this._natpole();a.cpole=this._cpole()},_rToTheta:function(d){var b=Math.PI/180,c=this.projparam.gamma,a=this.projparam.s1s2p1/c-c*d*d*b*b/4;if(a<-1){a=-1}else {if(a>1){a=1}}return Math.asin(a)/b},_thetaToR:function(c){var b=Math.PI/180,a=this.projparam.gamma;return 2/a*Math.sqrt(this.projparam.s1s2p1-a*Math.sin(c*b))/b}});L.CRS.WCS=L.extend({},L.CRS,{code:'WCS',options:{nzoom:9,tileSize:[256,256],nativeCelsys:!1},defaultparam:{ctype:{x:'PIXEL',y:'PIXEL'},naxis:[256,256],crpix:[129,129],crval:[0,0],cd:[[1,0],[0,1]],natrval:[90,0],natpole:[90,999],pv:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},initialize:function(c,a){a=L.setOptions(this,a);var b=this.defaultparam;this.tileSize=L.point(a.tileSize);this.nzoom=a.nzoom;this.ctype={x:b.ctype.x,y:b.ctype.y};this.naxis=L.point(b.naxis,!0);this.projparam=new this._paramInit(b);if(c){this._readWCS(c)}this._paramInit(a,this.projparam);switch(this.ctype.x.substr(5,3)){case 'ZEA':this.projection=new L.Projection.WCS.ZEA();this.pixelFlag=!1;this.infinite=!0;break;case 'TAN':this.projection=new L.Projection.WCS.TAN();this.pixelFlag=!1;this.infinite=!0;break;case 'CAR':this.projection=new L.Projection.WCS.CAR();this.pixelFlag=!1;this.infinite=!0;break;case 'CEA':this.projection=new L.Projection.WCS.CEA();this.pixelFlag=!1;this.infinite=!0;break;case 'COE':this.projection=new L.Projection.WCS.COE();this.pixelFlag=!1;this.infinite=!0;break;default:this.projection=new L.Projection.WCS.PIX();this.pixelFlag=!0;this.infinite=!1;if(!this.options.crval){this.projparam.crval=L.latLng((this.naxis.y+1)/2,(this.naxis.x+1)/2)};this.wrapLng=[0.5,this.naxis.x-0.5];this.wrapLat=[this.naxis.y-0.5,0.5];break;}if(!this.pixelFlag){switch(this.ctype.x.substr(0,1)){case 'G':this.celsyscode='galactic';break;case 'E':this.celsyscode='ecliptic';break;case 'S':this.celsyscode='supergalactic';break;default:this.celsyscode='equatorial';break;}if(this.celsyscode!=='equatorial'){this.projparam.celsysmat=this._celsysmatInit(this.celsyscode);this.projection.celsysToEq=this.celsysToEq;this.projection.eqToCelsys=this.eqToCelsys;this.forceNativeCelsys=this.options.nativeCelsys===!0;this.projection.celsysflag=!this.forceNativeCelsys}}this.transformation=new L.Transformation(1,-0.5,-1,this.naxis.y+0.5);this.projection._paramInit(this.projparam);this.code+=':'+this.projection.code},celsysToEq:function(c){var a=this.projparam.celsysmat,e=Math.PI/180,b=180/Math.PI,g=c.lng*e-a[1],h=c.lat*e,f=Math.sin(h),d=Math.cos(h)*a[2],i=f*a[3]-d*Math.cos(g);return L.latLng(Math.asin(i)*b,((Math.atan2(d*Math.sin(g),f-i*a[3])+a[0])*b+360)%360)},eqToCelsys:function(b){var a=this.projparam.celsysmat,c=Math.PI/180,d=180/Math.PI,h=b.lng*c-a[0],g=Math.sin(b.lat*c),e=Math.cos(b.lat*c)*a[2],f=g*a[3]+e*Math.cos(h);return L.latLng(Math.asin(f)*d,((Math.atan2(e*Math.sin(h),f*a[3]-g)+a[1])*d+360)%360)},scale:function(a){return Math.pow(2,a-this.nzoom+1)},zoom:function(a){return Math.log(a)/Math.LN2+this.nzoom-1},rawPixelScale:function(a){var f=this.projection.project(a),d=this.projection.unproject(f.add([10,0])),e=this.projection.unproject(f.add([0,10])),b=d.lng-a.lng,c=e.lng-a.lng;if(b>180){b-=360}else {if(b<-180){b+=360}}if(c>180){c-=360}else {if(c<-180){c+=360}}return 0.1*Math.sqrt(Math.abs(b*(e.lat-a.lat)-c*(d.lat-a.lat))*Math.cos(a.lat*Math.PI/180))},pixelScale:function(b,a){return this.rawPixelScale(a)/this.scale(b)},fovToZoom:function(e,c,d){var a=this.rawPixelScale(d),b=e.getSize();if(c<a){c=a}a*=Math.sqrt(b.x*b.x+b.y*b.y);return c>0?this.zoom(a/c):this.nzoom-1},zoomToFov:function(f,e,d){var a=f.getSize(),c=this.rawPixelScale(d)*Math.sqrt(a.x*a.x+a.y*a.y),b=this.scale(e);return b>0?c/b:c},distance:function(b,c){var a=Math.PI/180,d=b.lat*a,e=c.lat*a,f=Math.sin(d)*Math.sin(e)+Math.cos(d)*Math.cos(e)*Math.cos((c.lng-b.lng)*a);return 180/Math.PI*Math.acos(Math.min(f,1))},parseCoords:function(c,d){var a;if(d){a=/J\s(\d+\.?\d*)\s*,?\s*\+?(-?\d+\.?\d*)/g.exec(c)}else {a=/(-?\d+\.?\d*)\s*,\s*\+?(-?\d+\.?\d*)/g.exec(c)}if(a&&a.length>=3){var b=L.latLng(Number(a[2]),Number(a[1]));if(this.forceNativeCelsys){b=this.eqToCelsys(b)}return b}else {return undefined}},_paramInit:function(a,b){if(!b){b=this}if(a.naxis){b.naxis=L.point(a.naxis)}if(a.crval){b.crval=b.cpole=L.latLng(a.crval)}if(a.crpix){b.crpix=L.point(a.crpix)}if(a.cd){b.cd=[[a.cd[0][0],a.cd[0][1]],[a.cd[1][0],a.cd[1][1]]]}if(a.natrval){b.natrval=L.latLng(a.natrval)}if(a.natpole){b.natpole=L.latLng(a.natpole)}if(a.pv){b.pv=[];b.pv[0]=a.pv[0].slice();b.pv[1]=a.pv[1].slice()}},_celsysmatInit:function(e){var d=Math.PI/180,b,a,c=[];switch(e){case 'galactic':b=L.latLng(-28.93617242,266.40499625);a=L.latLng(27.1282512,192.85948123);break;case 'ecliptic':b=L.latLng(0,0);a=L.latLng(66.99111111,273.85261111);break;case 'supergalactic':b=L.latLng(59.52315,42.29235);a=L.latLng(15.7048,283.7514);break;default:b=L.latLng(0,0);a=L.latLng(0,0);break;}c[0]=a.lng*d;c[1]=Math.asin(Math.cos(b.lat*d)*Math.sin((a.lng-b.lng)*d));c[2]=Math.cos(a.lat*d);c[3]=Math.sin(a.lat*d);return c},_readWCS:function(b){var c=L.IIPUtils.readFITSKey,d=this.projparam,a;if(a=c('CTYPE1',b)){this.ctype.x=a}if(a=c('CTYPE2',b)){this.ctype.y=a}if(a=c('NAXIS1',b)){d.naxis.x=this.naxis.x=parseInt(a,10)}if(a=c('NAXIS2',b)){d.naxis.y=this.naxis.y=parseInt(a,10)}if(a=c('CRPIX1',b)){d.crpix.x=parseFloat(a,10)}if(a=c('CRPIX2',b)){d.crpix.y=parseFloat(a,10)}if(a=c('CRVAL1',b)){d.crval.lng=parseFloat(a,10)}if(a=c('CRVAL2',b)){d.crval.lat=parseFloat(a,10)}if(a=c('LONPOLE',b)){d.natpole.lng=parseFloat(a,10)}if(a=c('LATPOLE',b)){d.natpol.lat=parseFloat(a,10)}if(a=c('CD1_1',b)){d.cd[0][0]=parseFloat(a,10)}if(a=c('CD1_2',b)){d.cd[0][1]=parseFloat(a,10)}if(a=c('CD2_1',b)){d.cd[1][0]=parseFloat(a,10)}if(a=c('CD2_2',b)){d.cd[1][1]=parseFloat(a,10)}for(var e=0;e<2;e++){for(var f=0;f<20;f++){if(a=c('PV'+(e+1)+'_'+f,b)){d.pv[e][f]=parseFloat(a,10)}}}},_deltaLng:function(c,b){var a=c.lng-b.lng;return a>180?a-360:a<-180?a+360:a}});L.CRS.WCS=L.Class.extend(L.CRS.WCS);L.CRS.wcs=function(a){return new L.CRS.WCS(a)};L.IIPUtils={REG_PDEC:'(\\d+\\.\\d*)',REG_FLOAT:'([-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)',requestURL:function(f,c,e,b,d){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else {if(window.ActiveXObject){try{a=new ActiveXObject('Msxml2.XMLHTTP')}catch(g){try{a=new ActiveXObject('Microsoft.XMLHTTP')}catch(h){}}}}if(!a){alert('Giving up: Cannot create an XMLHTTP instance for '+c);return !1}if(d){a.timeout=d*1000;a.ontimeout=function(){alert('Time out while '+c)}}a.open('GET',f);if(b&&b.options.credentials){a.withCredentials=!0}if(b&&b.options.authenticate==='csrftoken'){a.setRequestHeader('X-CSRFToken',this.getCookie('csrftoken'))}if(e){a.onreadystatechange=function(){e(b,a)}}a.send()},parseURL:function(b){var a={};b.replace(new RegExp('([^?=&]+)(=([^&]*))?','g'),function(d,b,e,c){a[b]=c});return a},updateURL:function(a,b,c){var d=new RegExp('([?&])'+b+'=.*?(&|$)','i'),e=a.indexOf('?')!==-1?'&':'?';return a.match(d)?a.replace(d,'$1'+b+'='+c+'$2'):a+e+b+'='+c},checkDomain:function(a){if(a.indexOf('//')===0){a=location.protocol+a}return a.toLowerCase().replace(/([a-z])?:\/\//,'$1').split('/')[0]},isExternal:function(a){return (a.indexOf(':')>-1||a.indexOf('//')>-1)&&this.checkDomain(location.href)!==this.checkDomain(a)},copyToClipboard:function(b){if(document.queryCommandSupported&&document.queryCommandSupported('copy')){var a=document.createElement('textarea');a.textContent=b;a.style.position='fixed';document.body.appendChild(a);a.select();try{return document.execCommand('copy')}catch(c){console.warn('Copy to clipboard failed.',c);return !1}finally{document.body.removeChild(a)}}},flashElement:function(a){L.DomUtil.addClass(a,'leaflet-control-flash');setTimeout(function(){L.DomUtil.removeClass(a,'leaflet-control-flash')},400)},readFITSKey:function(d,f){var c=d.trim().toUpperCase().substr(0,8),b=8-c.length,e=new RegExp(c+(b>0?'\\ {'+b.toString()+'}':'')+"=\\ *(?:'((?:\\ *[^'\\ ]+)*)\\ *'|([-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?))"),a=e.exec(f);if(!a){return null}else {if(a[1]){return a[1]}else {return a[2]}}},distance:function(b,c){var a=Math.PI/180,d=b.lat*a,e=c.lat*a,i=e-d,j=(c.lng-b.lng)*a,f=Math.sin(i/2),g=Math.sin(j/2);var h=f*f+g*g*Math.cos(d)*Math.cos(e);return Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*360/Math.PI},latLngToHMSDMS:function(f){var c=(f.lng+360)/360;c=(c-Math.floor(c))*24;var e=Math.floor(c),d=(c-e)*60,a=Math.floor(d),b=(d-a)*60;if(b>=60){a++;b=0}if(a===60){e++;a=0}var j=(e<10?'0':'')+e.toString()+':'+(a<10?'0':'')+a.toString()+':'+(b<10?'0':'')+b.toFixed(3),h=Math.abs(f.lat),i=f.lat<0?'-':'+',g=Math.floor(h);d=(h-g)*60;a=Math.floor(d);b=(d-a)*60;if(b>=60){a++;b=0}if(a===60){e++;a=0}return j+' '+i+(g<10?'0':'')+g.toString()+':'+(a<10?'0':'')+a.toString()+':'+(b<10?'0':'')+b.toFixed(2)},getCookie:function(e){var c=e+'=';var d=document.cookie.split(';');for(var b=0;b<d.length;b++){var a=d[b];while(a.charAt(0)===' '){a=a.substring(1)}if(a.indexOf(c)===0){return a.substring(c.length,a.length)}}return ''}};L.TileLayer.IIP=L.TileLayer.extend({options:{title:'',crs:null,nativeCelsys:!1,center:!1,fov:!1,minZoom:0,maxZoom:null,maxNativeZoom:18,noWrap:!0,contrast:1,colorSat:1,gamma:1,cMap:'grey',invertCMap:!1,quality:90,mixingMode:'color',channelColors:[],channelLabels:[],channelLabelMatch:'.*',channelUnits:[],minMaxValues:[],defaultChannel:0,credentials:!1},iipdefault:{contrast:1,gamma:1,cMap:'grey',invertCMap:!1,minValue:[],maxValue:[],channelColors:[[''],['#FFFFFF'],['#00BAFF','#FFBA00'],['#0000FF','#00FF00','#FF0000'],['#0000E0','#00BA88','#88BA00','#E00000'],['#0000CA','#007BA8','#00CA00','#A87B00','#CA0000'],['#0000BA','#00719B','#009B71','#719B00','#9B7100','#BA0000']],quality:90},initialize:function(b,a){this.type='tilelayer';this._url=b.replace(/\&.*$/g,'');a=L.setOptions(this,a);if(a.detectRetina&&L.Browser.retina&&a.maxZoom>0){a.tileSize=Math.floor(a.tileSize/2);a.zoomOffset++;a.minZoom=Math.max(0,a.minZoom);a.maxZoom--}if(typeof a.subdomains==='string'){a.subdomains=a.subdomains.split('')}this.iipTileSize={x:256,y:256};this.iipImageSize=[];this.iipImageSize[0]=this.iipTileSize;this.iipGridSize=[];this.iipGridSize[0]={x:1,y:1};this.iipBPP=8;this.iipMode=a.mixingMode;this.iipChannel=0;this.iipNChannel=1;this.iipMinZoom=a.minZoom;this.iipMaxZoom=a.maxZoom;this.iipContrast=a.contrast;this.iipColorSat=a.colorSat;this.iipGamma=a.gamma;this.iipCMap=a.cMap;this.iipInvertCMap=a.invertCMap;this.iipMinValue=[];this.iipMinValue[0]=0;this.iipMaxValue=[];this.iipMaxValue[0]=255;this.iipMix=[[]];this.iipRGB=[];this.iipChannelLabels=[];this.iipChannelFlags=[];this.iipChannelUnits=[];this.iipQuality=a.quality;this._title=a.title.length>0?a.title:this._url.match(/^.*\/(.*)\..*$/)[1];this.getIIPMetaData(this._url);if(!L.Browser.android){this.on('tileunload',this._onTileRemove)}return this},getIIPMetaData:function(a){L.IIPUtils.requestURL(a+'&obj=IIP,1.0&obj=max-size&obj=tile-size'+'&obj=resolution-number&obj=bits-per-channel'+'&obj=min-max-sample-values&obj=subject','getting IIP metadata',this._parseMetadata,this)},_parseMetadata:function(b,m){if(m.readyState===4){if(m.status===200){var g=m.responseText,d=b._readIIPKey(g,'IIP',L.IIPUtils.REG_PDEC);if(!d){alert('Error: Unexpected response from IIP server '+b._url.replace(/\?.*$/g,''))}var c=b.options,f=b.iipdefault;d=b._readIIPKey(g,'Max-size','(\\d+)\\s+(\\d+)');var v={x:parseInt(d[1],10),y:parseInt(d[2],10)};d=b._readIIPKey(g,'Tile-size','(\\d+)\\s+(\\d+)');b.iipTileSize={x:parseInt(d[1],10),y:parseInt(d[2],10)};c.tileSize=b.iipTileSize.x;d=b._readIIPKey(g,'Resolution-number','(\\d+)');b.iipMaxZoom=parseInt(d[1],10)-1;if(b.iipMinZoom>c.minZoom){c.minZoom=b.iipMinZoom}if(!c.maxZoom){c.maxZoom=b.iipMaxZoom+6}c.maxNativeZoom=b.iipMaxZoom;for(var e=0;e<=b.iipMaxZoom;e++){b.iipImageSize[e]={x:Math.floor(v.x/Math.pow(2,b.iipMaxZoom-e)),y:Math.floor(v.y/Math.pow(2,b.iipMaxZoom-e))};b.iipGridSize[e]={x:Math.ceil(b.iipImageSize[e].x/b.iipTileSize.x),y:Math.ceil(b.iipImageSize[e].y/b.iipTileSize.y)}}for(e=b.iipMaxZoom;e<=c.maxZoom;e++){b.iipGridSize[e]=b.iipGridSize[b.iipMaxZoom]}d=b._readIIPKey(g,'Bits-per-channel','(\\d+)');b.iipBPP=parseInt(d[1],10);if(b.iipGamma===b.iipdefault.gamma){b.iipGamma=b.iipBPP>=32?2.2:1}d=b._readIIPKey(g,'Min-Max-sample-values','\\s*(.*)');var r=d[1].split(/\s+/),h=b.iipNChannel=r.length/2,x=0;for(var a=0;a<h;a++){f.minValue[a]=parseFloat(r[x++]);f.maxValue[a]=parseFloat(r[x++])}var k=c.minMaxValues;if(k.length){for(a=0;a<h;a++){if(k[a]!==undefined&&k[a].length){b.iipMinValue[a]=k[a][0];b.iipMaxValue[a]=k[a][1]}else {b.iipMinValue[a]=f.minValue[a];b.iipMaxValue[a]=f.maxValue[a]}}}else {for(a=0;a<h;a++){b.iipMinValue[a]=f.minValue[a];b.iipMaxValue[a]=f.maxValue[a]}}b.iipChannel=c.defaultChannel;var s=c.channelLabels,z=s.length,n=b.iipChannelLabels,u=c.channelUnits,t=u.length,w=b.iipChannelUnits,A=L.IIPUtils.readFITSKey,o,p;for(a=0;a<h;a++){if(a<z){n[a]=s[a]}else {o=(a+1).toString();p=A('CHAN'+(a<9?'000':a<99?'00':a<999?'0':'')+o,g);n[a]=p?p:'Channel #'+o}}for(a=0;a<t;a++){w[a]=u[a]}for(a=t;a<h;a++){w[a]='ADUs'}var y=0,B=b.iipMix,i=c.channelColors,q=b.iipRGB,C=new RegExp(c.channelLabelMatch),j=0,l=b.iipChannelFlags;j=0;for(a=0;a<h;a++){l[a]=C.test(n[a]);if(l[a]){j++}}if(j>=f.channelColors.length){j=f.channelColors.length-1}for(a=0;a<h;a++){B[a]=[];var D=3;if(i.length&&i[a]&&i[a].length===3){q[a]=L.rgb(i[a][0],i[a][1],i[a][2])}else {q[a]=L.rgb(0,0,0)}if(i.length===0&&l[a]&&y<j){q[a]=L.rgb(f.channelColors[j][y++])}b.rgbToMix(a)}if(c.bounds){c.bounds=L.latLngBounds(c.bounds)}b.wcs=c.crs?c.crs:new L.CRS.WCS(g,{nativeCelsys:b.options.nativeCelsys,nzoom:b.iipMaxZoom+1,tileSize:b.iipTileSize});b.iipMetaReady=!0;b.fire('metaload')}else {alert('There was a problem with the IIP metadata request.')}}},rgbToMix:function(b,a){if(a){this.iipRGB[b]=a.clone()}else {a=this.iipRGB[b]}var e=this._gammaCorr(a.r),d=this._gammaCorr(a.g),c=this._gammaCorr(a.b),g=(e+d+c)/3,f=this.iipColorSat/3;this.iipMix[b][0]=g+f*(2*e-d-c);this.iipMix[b][1]=g+f*(2*d-e-c);this.iipMix[b][2]=g+f*(2*c-e-d);return},updateMono:function(){this.iipMode='mono'},updateMix:function(){var b=this.iipNChannel;this.iipMode='color';for(var a=0;a<b;a++){this.rgbToMix(a,this.iipRGB[a])}},_gammaCorr:function(a){return a>0?Math.pow(a,this.iipGamma):0},_readIIPKey:function(d,a,b){var c=new RegExp(a+':'+b);return c.exec(d)},addTo:function(a){if(this.iipMetaReady){this._addToMap(a)}else {this.once('metaload',function(){this._addToMap(a)},this)}return this},_addToMap:function(a){var c,b=this.wcs,e=a.options.crs,j=a._prevcrs,g=a._loaded,d=a.options.center?a.options.center:b.projparam.crval;if(g){e._prevLatLng=a.getCenter();e._prevZoom=a.getZoom()}a._prevcrs=a.options.crs=b;L.TileLayer.prototype.addTo.call(this,a);if(j&&b!==e&&g&&b.pixelFlag===e.pixelFlag){d=e._prevLatLng;c=e._prevZoom;var h=j.pixelScale(c,d),i=b.pixelScale(c,d);if(h>1.0E-20&&i>1.0E-20){c+=Math.round(Math.LOG2E*Math.log(i/h))}}else {if(b._prevLatLng){d=b._prevLatLng;c=b._prevZoom}else {if(this.options.center){var f=b.parseCoords(this.options.center);if(f){if(this.options.fov){c=b.fovToZoom(a,this.options.fov,f)}a.setView(f,c,{reset:!0,animate:!1})}else {L.IIPUtils.requestURL('http://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-oI/A?'+this.options.center,'getting coordinates for '+this.options.center,function(g,e){if(e.readyState===4){if(e.status===200){var h=e.responseText,f=b.parseCoords(h,!0);if(f){if(g.options.fov){c=b.fovToZoom(a,g.options.fov,f)}a.setView(f,c,{reset:!0,animate:!1})}else {a.setView(d,c,{reset:!0,animate:!1});alert(h+': Unknown location')}}else {a.setView(d,c,{reset:!0,animate:!1});alert('There was a problem with the request to the Sesame service at CDS')}}},this,10)}}else {a.setView(d,c,{reset:!0,animate:!1})}}}},_getTileSizeFac:function(){var c=this._map,b=this._tileZoom,a=this.options.maxNativeZoom;return a&&b>a?Math.round(c.getZoomScale(b)/c.getZoomScale(a)):1},_isValidTile:function(a){var d=this._map.options.crs;if(!d.infinite){var c=this._globalTileRange;if(!d.wrapLng&&(a.x<c.min.x||a.x>c.max.x)||!d.wrapLat&&(a.y<c.min.y||a.y>c.max.y)){return !1}}var e=this._getZoomForUrl(),b=a.clone();this._wrapCoords(b);if(b.x<0||b.x>=this.iipGridSize[e].x||b.y<0||b.y>=this.iipGridSize[e].y){return !1}if(!this.options.bounds){return !0}var f=this._tileCoordsToBounds(a);return L.latLngBounds(this.options.bounds).intersects(f)},createTile:function(a,c){var b=L.TileLayer.prototype.createTile.call(this,a,c);b.coords=a;return b},getTileUrl:function(h){var a=this._url,i=this._getZoomForUrl();if(this.iipCMap!==this.iipdefault.cMap){a+='&CMP='+this.iipCMap}if(this.iipInvertCMap!==this.iipdefault.invertCMap){a+='&INV'}if(this.iipContrast!==this.iipdefault.contrast){a+='&CNT='+this.iipContrast.toString()}if(this.iipGamma!==this.iipdefault.gamma){a+='&GAM='+(1/this.iipGamma).toFixed(4)}for(var c=0;c<this.iipNChannel;c++){if(this.iipMinValue[c]!==this.iipdefault.minValue[c]||this.iipMaxValue[c]!==this.iipdefault.maxValue[c]){a+='&MINMAX='+(c+1).toString()+':'+this.iipMinValue[c].toString()+','+this.iipMaxValue[c].toString()}}var f=this.iipNChannel,g=this.iipMix,d,b;a+='&CTW=';if(this.iipMode==='color'){for(b=0;b<3;b++){if(b){a+=';'}a+=g[0][b].toString();for(d=1;d<f;d++){if(g[d][b]!==undefined){a+=','+g[d][b].toString()}}}}else {var e=this.iipChannel;if(e>=f){e=0}if(e<f){f=e+1}for(b=0;b<3;b++){if(b){a+=';'}a+=e===0?'1':'0';for(d=1;d<f;d++){a+=','+(e===d?'1':'0')}}}if(this.iipQuality!==this.iipdefault.quality){a+='&QLT='+this.iipQuality.toString()}return a+'&JTL='+i.toString()+','+(h.x+this.iipGridSize[i].x*h.y).toString()},_initTile:function(a){L.DomUtil.addClass(a,'leaflet-tile');var e=this._getTileSizeFac();if(e>1){if(L.Browser.ie){a.style.msInterpolationMode='nearest-neighbor'}else {if(L.Browser.chrome){a.style.imageRendering='pixelated'}else {if(L.Browser.gecko){a.style.imageRendering='-moz-crisp-edges'}else {a.style.imageRendering='-webkit-optimize-contrast'}}}}var f=a.coords,b=f.z;if(b>this.iipMaxZoom){b=this.iipMaxZoom}var c=f.x+1===this.iipGridSize[b].x?this.iipImageSize[b].x%this.iipTileSize.x:this.iipTileSize.x,d=f.y+1===this.iipGridSize[b].y?this.iipImageSize[b].y%this.iipTileSize.y:this.iipTileSize.y;if(c===0){c=this.iipTileSize.x}if(d===0){d=this.iipTileSize.y}c*=e;d*=e;a.style.width=c+'px';a.style.height=d+'px';a.onselectstart=L.Util.falseFn;a.onmousemove=L.Util.falseFn;if(L.Browser.ielt9&&this.options.opacity<1){L.DomUtil.setOpacity(a,this.options.opacity)}if(L.Browser.android&&!L.Browser.android23){a.style.WebkitBackfaceVisibility='hidden'}}});L.tileLayer.iip=function(b,a){return new L.TileLayer.IIP(b,a)};L.RGB=function(c,b,a){this.r=c;this.g=b;this.b=a};L.RGB.prototype={clone:function(){return new L.RGB(this.r,this.g,this.b)},toStr:function(){var c=Math.round(this.r*255),b=Math.round(this.g*255),a=Math.round(this.b*255);if(c<0){c=0}else {if(c>255){c=255}}if(b<0){b=0}else {if(b>255){b=255}}if(a<0){a=0}else {if(a>255){a=255}}return '#'+((1<<24)+(c<<16)+(b<<8)+a).toString(16).slice(1)},isOn:function(){return this.r>0||this.g>0||this.b>0?!0:!1}};L.rgb=function(a,d,c){if(a instanceof L.RGB){return a}if(typeof a==='string'){var b=parseInt('0x'+a.slice(1),16);return new L.RGB((b>>16&255)/255,(b>>8&255)/255,(b&255)/255)}if(L.Util.isArray(a)){return new L.RGB(a[0],a[1],a[2])}if(a===undefined||a===null){return a}return new L.RGB(a,d,c)};L.EllipseMarker=L.Path.extend({CANVAS:!0,SVG:!1,options:{fill:!0,majAxis:10,minAxis:10,posAngle:0},initialize:function(m,l){L.setOptions(this,l);this._majAxis=this.options.majAxis;this._minAxis=this.options.majAxis;this._posAngle=this.options.posAngle;this._latlng=L.latLng(m);var k=Math.PI/180,e=Math.cos(this._posAngle*k),f=Math.sin(this._posAngle*k),i=e*e,j=f*f,g=this._majAxis*this._majAxis,h=this._minAxis*this._minAxis,a=g*i+h*j,c=g*j+h*i,b=(g-h)*e*f,d=a*c-b*b;this._limX=Math.sqrt(a);this._limY=Math.sqrt(c);if(d<=0){a+=1;c+=1;d=a*c-b*b}this._cXX=c/d;this._cYY=a/d;this._cXY=-2*b/d},setLatLng:function(a){this._latlng=L.latLng(a);this.redraw();return this.fire('move',{latlng:this._latlng})},getLatLng:function(){return this._latlng},setParams:function(a){this.options.majAxis=this._majAxis=a.majAxis;this.options.minAxis=this._minAxis=a.minAxis;this.options.posAngle=this._posAngle=a.posAngle;return this.redraw()},getParams:function(){var a;a.majAxis=this._majAxis;a.minAxis=this._minAxis;a.posAngle=this._posAngle;return a},setStyle:L.Path.prototype.setStyle,_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng);this._updateBounds()},_updateBounds:function(){var b=this._clickTolerance(),a=[this._limX+b,this._limY+b];this._pxBounds=new L.Bounds(this._point.subtract(a),this._point.add(a))},_update:function(){if(this._map){this._updatePath()}},_updatePath:function(){this._renderer._updateEllipse(this)},_empty:function(){return this._majAxis&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){var a=e.subtract(this._point),d=this._clickTolerance(),b=Math.abs(a.x)-d,c=Math.abs(a.y)-d;return this._cXX*(b>0?b*b:0)+this._cYY*(c>0?c*c:0)+this._cXY*(a.x*a.y)<=1}});L.ellipseMarker=function(b,a){return new L.EllipseMarker(b,a)};L.Canvas.include({_updateEllipse:function(b){if(b._empty()){return}var c=b._point,a=this._ctx,d=b._minAxis,e=b._majAxis/b._minAxis;a.save();a.translate(c.x,c.y);a.rotate(b._posAngle*Math.PI/180);a.scale(1,e);a.beginPath();a.arc(0,0,d,0,Math.PI*2,!1);a.restore();this._fillStroke(a,b)}});L.SVG.include({_updateEllipse:function(a){var f=Math.PI/180,g=a._point,d=a._minAxis,h=a._majAxis,b=d*Math.cos(a._posAngle*f),c=d*Math.sin(a._posAngle*f),e='a'+d+','+h+' '+a._posAngle+' 1,0 ';var i=a._empty()?'M0 0':'M'+(g.x-b)+','+(g.y-c)+e+b*2+','+c*2+' '+e+-b*2+','+-c*2+' ';this._setPath(a,i)}});L.Ellipse=L.EllipseMarker.extend({options:{fill:!0},initialize:function(i,h){L.setOptions(this,h);var g=Math.PI/180,a=Math.cos(this.options.posAngle*g),b=Math.sin(this.options.posAngle*g),e=a*a,f=b*b,c=this.options.majAxis*this.options.majAxis,d=this.options.minAxis*this.options.minAxis;this._latlng=L.latLng(i);this._mLat2=c*e+d*f;this._mLng2=c*f+d*e;this._mLatLng=(c-d)*a*b},getBounds:function(){var a=[this._limX,this._limY];return new L.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(a)),this._map.layerPointToLatLng(this._point.add(a)))},_project:function(){var n=this._map,k=n.options.crs;this._point=n.latLngToLayerPoint(this._latlng);if(!this._majAxis1){var v=this._latlng.lng,l=this._latlng.lat,u=Math.PI/180,t=Math.cos(l*u),d=l<90?0.001:-0.001,s=k.project(this._latlng),q=k.project(L.latLng(l+d,v)).subtract(s),r=k.project(L.latLng(l,v+d*1/(t>d?t:d))).subtract(s),f=q.x/d,g=r.x/d,h=q.y/d,i=r.y/d,a=f*f*this._mLat2+g*g*this._mLng2+2*f*g*this._mLatLng,b=h*h*this._mLat2+i*i*this._mLng2+2*h*i*this._mLatLng,c=f*h*this._mLat2+g*i*this._mLng2+(f*i+g*h)*this._mLatLng,o=0.5*(a+b),p=Math.sqrt(0.25*(a-b)*(a-b)+c*c),j=a*b-c*c;this._majAxis=this._majAxis1=Math.sqrt(o+p);this._minAxis=this._minAxis1=o>p?Math.sqrt(o-p):0;this._posAngle=0.5*Math.atan2(2*c,a-b)/u;this._limX=this._limX1=Math.sqrt(a);this._limY=this._limY1=Math.sqrt(b);if(j<=0){a+=1;b+=1;j=a*b-c*c}this._cXX1=b/j;this._cYY1=a/j;this._cXY1=-2*c/j}var e=k.scale(n._zoom),m=1/(e*e);this._majAxis=this._majAxis1*e;this._minAxis=this._minAxis1*e;this._limX=this._limX1*e;this._limY=this._limY1*e;this._cXX=this._cXX1*m;this._cYY=this._cYY1*m;this._cXY=this._cXY1*m;this._updateBounds()}});L.ellipse=function(b,a){return new L.Ellipse(b,a)};L.Catalog={nmax:10000,_csvToGeoJSON:function(k){var j=new RegExp('#|--|^$'),f=k.split('\n'),h={type:'FeatureCollection',features:[]};for(var l in f){var g=f[l];if(j.test(g)===!1){var a={type:'Feature',id:'',properties:{items:[]},geometry:{type:'Point',coordinates:[0,0]}},d=a.geometry,i=a.properties;var b=g.split(/[,;\t]/);a.id=b[0];d.coordinates[0]=parseFloat(b[1]);d.coordinates[1]=parseFloat(b[2]);var e=b.slice(3),c;for(var m in e){c=parseFloat(e[m]);i.items.push(isNaN(c)?'--':c)}h.features.push(a)}}return h},toGeoJSON:function(a){return this._csvToGeoJSON(a)},popup:function(b){var a='<div>';if(this.objurl){a+='ID: <a href="'+L.Util.template(this.objurl,L.extend({id:b.id,ra:b.geometry.coordinates[0].toFixed(6),dec:b.geometry.coordinates[1].toFixed(6)}))+'" target="_blank">'+b.id+'</a></div>'}else {a+='ID: '+b.id+'</div>'}a+='<TABLE style="margin:auto;">'+'<TBODY style="vertical-align:top;text-align:left;">';for(var c in this.properties){a+='<TR><TD>'+this.properties[c]+':</TD>'+'<TD>'+b.properties.items[c].toString()+' ';if(this.units[c]){a+=this.units[c]}a+='</TD></TR>'}a+='</TBODY></TABLE>';return a},draw:function(b,c){var a=b.properties.items[this.magindex?this.magindex:0];return L.circleMarker(c,{radius:a?this.maglim+5-a:8})},vizierURL:'http://vizier.u-strasbg.fr/viz-bin'};L.Catalog['2MASS']=L.extend({},L.Catalog,{name:'2MASS',attribution:'2MASS All-Sky Catalog of Point Sources (Cutri et al. 2003)',color:'red',maglim:17,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=II/246&'+'-out=2MASS,RAJ2000,DEJ2000,Jmag,Hmag,Kmag&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&'+'-out.max={nmax}',properties:['J','H','K'],units:['','',''],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=II/246&-c={ra},{dec},eq=J2000&-c.rs=0.01'});L.Catalog.SDSS=L.extend({},L.Catalog,{name:'SDSS release 9',attribution:'SDSS Photometric Catalog, Release 9 (Adelman-McCarthy et al. 2012)',color:'yellow',maglim:25,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=V/139&'+'-out=SDSS9,RAJ2000,DEJ2000,umag,gmag,rmag,imag,zmag&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-sort=imag&-out.max={nmax}',properties:['u','g','r','i','z'],units:['','','','',''],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=V/139/sdss9&-c={ra},{dec},eq=J2000&-c.rs=0.01'});L.Catalog.PPMXL=L.extend({},L.Catalog,{name:'PPMXL',attribution:'PPM-Extended, positions and proper motions by Roeser et al. 2008',color:'green',maglim:20,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=I/317&'+'-out=PPMXL,RAJ2000,DEJ2000,Jmag,Hmag,Kmag,b1mag,b2mag,r1mag,r2mag,imag,pmRA,pmDE&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['J','H','K','b<sub>1</sub>','b<sub>2</sub>','r<sub>1</sub>','r<sub>2</sub>','i','&#956;<sub>&#593;</sub> cos &#948;','&#956;<sub>&#948;</sub>'],units:['','','','','','','','','mas/yr','mas/yr'],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=I/317&-c={ra},{dec},eq=J2000&-c.rs=0.01'});L.Catalog.Abell=L.extend({},L.Catalog,{name:'Abell clusters',attribution:'Rich Clusters of Galaxies (Abell et al. 1989) ',color:'orange',maglim:30,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=VII/110A&'+'-out=ACO,_RAJ2000,_DEJ2000,m10,Rich,Dclass&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['m<sub>10</sub>','Richness','D<sub>class</sub>'],units:['','',''],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=VII/110A&-c={ra},{dec},eq=J2000&-c.rs=0.2'});L.Catalog.NVSS=L.extend({},L.Catalog,{name:'NVSS',attribution:'1.4GHz NRAO VLA Sky Survey (NVSS) (Condon et al. 1998)',color:'magenta',maglim:30,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=VIII/65/NVSS&'+'-out=NVSS,_RAJ2000,_DEJ2000,S1.4,MajAxis,MinAxis,PA&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['S<sub>1.4GHz</sub>','Major axis','Minor axis','Position angle'],units:['mJy','&#8243;','&#8243;','&#176;'],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=VIII/65/NVSS&-c={ra},{dec},eq=J2000&-c.rs=0.2',draw:function(a,b){return L.ellipse(b,{majAxis:a.properties.items[1]/7200,minAxis:a.properties.items[2]/7200,posAngle:a.properties.items[3]==='--'?90:90-a.properties.items[3]})}});L.Catalog.FIRST=L.extend({},L.Catalog,{name:'FIRST',attribution:'The FIRST Survey Catalog (Helfand et al. 2015)',color:'blue',maglim:30,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=VIII/92/first14&'+'-out=FIRST,_RAJ2000,_DEJ2000,Fpeak,fMaj,fMin,fPA&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['F<sub>peak</sub>(1.4GHz)','Major axis FWHM','Minor axis FWHM','Position angle'],units:['mJy','&#8243;','&#8243;','&#176;'],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=VIII/92/first14&-c={ra},{dec},eq=J2000&-c.rs=0.2',draw:function(a,b){return L.ellipse(b,{majAxis:a.properties.items[1]/7200,minAxis:a.properties.items[2]/7200,posAngle:a.properties.items[3]==='--'?90:90-a.properties.items[3]})}});L.Catalog.AllWISE=L.extend({},L.Catalog,{name:'AllWISE',attribution:'AllWISE Data Release (Cutri et al. 2013)',color:'red',maglim:18,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=II/328/allwise&'+'-out=AllWISE,_RAJ2000,_DEJ2000,W1mag,W2mag,W3mag,W4mag&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['W1<sub>mag</sub> (3.4m)','W2<sub>mag</sub> (4.6m)','W3<sub>mag</sub> (12m)','W4<sub>mag</sub> (22m)'],units:['','','',''],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=II/328/allwise&-c={ra},{dec},eq=J2000&-c.rs=0.2'});L.Catalog.GALEX_AIS=L.extend({},L.Catalog,{name:'GALEX AIS',attribution:'GALEX catalogs of UV sources: All-sky Imaging Survey (Bianchi et al. 2011)',color:'magenta',maglim:21,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=II/312/ais&'+'-out=objid,_RAJ2000,_DEJ2000,FUV,NUV&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['FUV<sub>AB</sub>','NUV<sub>AB</sub>'],units:['',''],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=II/312/ais&-c={ra},{dec},eq=J2000&-c.rs=0.2'});L.Catalog.GAIA_DR1=L.extend({},L.Catalog,{name:'Gaia DR1',attribution:'First Gaia Data Release (2016)',color:'green',maglim:20,service:'Vizier@CDS',regionType:'box',url:L.Catalog.vizierURL+'/asu-tsv?&-mime=csv&-source=I/337&'+'-out=Source,RA_ICRS,DE_ICRS,<Gmag>,pmRA,pmDE&-out.meta=&'+'-c.eq={sys}&-c={lng},{lat}&-c.bd={dlng},{dlat}&-out.max={nmax}',properties:['G','&#956;<sub>&#593;</sub> cos &#948;','&#956;<sub>&#948;</sub>'],units:['','mas/yr','mas/yr'],objurl:L.Catalog.vizierURL+'/VizieR-5?-source=I/337&-c={ra},{dec},eq=J2000&-c.rs=0.01'});L.FlipSwitch=L.Evented.extend({options:{checked:!1,title:'Click to switch',className:'leaflet-flipswitch',id:'leaflet-flipswitch'},initialize:function(f,a){a=L.setOptions(this,a);var g=this,b=a.className,c=L.DomUtil.create('div',b,f),d=this._input=L.DomUtil.create('input',b,c),e=L.DomUtil.create('label',b,c);d.type='checkbox';d.name=a.className;d.checked=a.checked;e.htmlFor=d.id=a.id;if(a.title){e.title=a.title}L.DomUtil.create('span',b+'-inner',e);L.DomUtil.create('span',b+'-button',e);L.DomEvent.disableClickPropagation(c).disableScrollPropagation(c);L.DomEvent.on(d,'change',function(){this.fire('change')},this);return c},value:function(a){if(a===undefined){return this._input.checked}else {this._input.checked=a?!0:!1;return this}}});L.flipswitch=function(b,a){return new L.FlipSwitch(b,a)};L.SpinBox=L.Evented.extend({options:{dmin:undefined,dmax:undefined,step:undefined,initValue:undefined,repButton:!0,clickEvent:'click',instantUpdate:!1,title:'Enter value',className:'leaflet-spinbox'},initialize:function(h,a){a=L.setOptions(this,a);var g=this,b=this._drag={startEvent:'touchstart mousedown',stopEvent:'touchend mouseup mouseout touchcancel',move:!1,start:!1,end:!1,pos:!1,target:!1,delta:!1,tmp:!1,cnt:0,step:a.step,prec:this._prec(a.step)},d=this._wrap=L.DomUtil.create('div',a.className,h),c=this._input=L.DomUtil.create('input',a.className+'-input',d),e=this._down=L.DomUtil.create('div',a.className+'-down',d),f=this._up=L.DomUtil.create('div',a.className+'-up',d);c.type='number';c.step=0.1;L.DomEvent.disableClickPropagation(d).disableScrollPropagation(d);if(c.disabled===!0){a.disabled=!0}if(a.dmin===undefined){a.dmin=-Number.MAX_VALUE}if(a.dmax===undefined){a.dmax=Number.MAX_VALUE}if(a.step===undefined){a.step=1}if(a.initValue===undefined){a.initValue=(a.dmin+a.dmax)/2}this.value(a.initValue);c.title=a.title;e.title='Decrease number by '+a.step;f.title='Increase number by '+a.step;L.DomEvent.on(this._input,'change',function(){this.fire('change')},this);if(a.repButton===!1){L.DomEvent.on(e,a.clickEvent,function(a){a.preventDefault();this._offset(a.currentTarget,-1)},this);L.DomEvent.on(f,a.clickEvent,function(a){a.preventDefault();this._offset(a.currentTarget,1)},this)}else {L.DomEvent.on(e,b.startEvent,function(d){c.blur();b.move=!0;b.cnt=0;b.step=a.step;b.prec=this._prec(b.step);b.delta=-1;this._offset(d.currentTarget,-1);if(!this.runButton){b.target=d.currentTarget;this.runButton=setTimeout(function(){g._sboxRun()},500)}},this);L.DomEvent.on(f,b.startEvent,function(d){c.blur();b.move=!0;b.cnt=0;b.step=a.step;b.prec=this._prec(b.step);b.delta=1;this._offset(d.currentTarget,1);if(!this.runButton){b.target=d.currentTarget;this.runButton=setTimeout(function(){g._sboxRun()},500)}},this);L.DomEvent.on(e,b.stopEvent,function(c){if(b.move){c.preventDefault();clearTimeout(this.runButton);this.runButton=!1;b.move=!1;if(a.instantUpdate===!1){this.fire('change')}}},this);L.DomEvent.on(f,b.stopEvent,function(c){if(b.move){c.preventDefault();clearTimeout(this.runButton);this.runButton=!1;b.move=!1;if(a.instantUpdate===!1){this.fire('change')}}},this)}if(a.disabled){this.disable()}return d},value:function(a){if(a===undefined){return parseFloat(this._input.value)}else {this._input.value=a;return this}},step:function(a){if(a===undefined){return this.options.step}else {this.options.step=a;return this}},disable:function(){var a='disabled';this._input.disabled=!0;this._input.blur();L.DomUtil.addClass(this._wrap,a);L.DomUtil.addClass(this._down,a);L.DomUtil.addClass(this._up,a);this.options.disabled=!0},enable:function(){var a='disabled';this._input.disabled=!1;L.DomUtil.removeClass(this._wrap,a);L.DomUtil.removeClass(this._down,a);L.DomUtil.removeClass(this._up,a);this.options.disabled=!1},_sboxRun:function(){var d=this,c=150,b=this.options,a=this._drag;if(a.cnt===20){c=50;a.step=10*b.step;a.prec=this._prec(a.step)}else {if(a.cnt===40){c=10;a.step=100*b.step;a.prec=this._prec(a.step)}else {if(a.cnt===60){a.step=1000*b.step;a.prec=this._prec(a.step)}else {if(a.cnt===80){a.step=10000*b.step;a.prec=this._prec(a.step)}}}}a.didRun=!0;this._offset(this,a.delta);a.cnt++;this.runButton=setTimeout(function(){d._sboxRun()},c)},_prec:function(b){var a=-0.4342944*Math.log(b);return a>0?Math.ceil(a):0},_offset:function(f,e){var a,b=this.options,c=this._input,d=this._drag;if(!this.disabled){if(e<1){a=(parseFloat(c.value)-d.step).toFixed(d.prec);if(a>=b.dmin){c.value=a;if(b.instantUpdate===!0){this.fire('change')}}}else {a=(parseFloat(c.value)+d.step).toFixed(d.prec);if(a<=b.dmax){c.value=a;if(b.instantUpdate===!0){this.fire('change')}}}}}});L.spinbox=function(b,a){return new L.SpinBox(b,a)};if(typeof require!=='undefined'){var $=require('jquery-browser')}$.extend($.fn,{fileTree:function(a,b){if(a.root===undefined){a.root='/'}if(a.script===undefined){a.script='dist/filetree.php'}if(a.folderEvent===undefined){a.folderEvent='click'}if(a.expandSpeed===undefined){a.expandSpeed=500}if(a.collapseSpeed===undefined){a.collapseSpeed=500}if(a.expandEasing===undefined){a.expandEasing=null}if(a.collapseEasing===undefined){a.collapseEasing=null}if(a.multiFolder===undefined){a.multiFolder=!0}if(a.loadMessage===undefined){a.loadMessage='Loading...'}$(this).each(function(){function showTree(b,c){$(b).addClass('wait');$('.filetree.start').remove();$.post(a.script,{dir:c},function(d){$(b).find('.start').html('');$(b).removeClass('wait').append(d);if(a.root===c){$(b).find('UL:hidden').show()}else {$(b).find('UL:hidden').slideDown({duration:a.expandSpeed,easing:a.expandEasing})}bindTree(b)})}function bindTree(c){$(c).find('LI A').on(a.folderEvent,function(){if($(this).parent().hasClass('directory')){if($(this).parent().hasClass('collapsed')){if(!a.multiFolder){$(this).parent().parent().find('UL').slideUp({duration:a.collapseSpeed,easing:a.collapseEasing});$(this).parent().parent().find('LI.directory').removeClass('expanded').addClass('collapsed')}$(this).parent().find('UL').remove();showTree($(this).parent(),encodeURI($(this).attr('rel').match(/.*\//)));$(this).parent().removeClass('collapsed').addClass('expanded')}else {$(this).parent().find('UL').slideUp({duration:a.collapseSpeed,easing:a.collapseEasing});$(this).parent().removeClass('expanded').addClass('collapsed')}}else {b($(this).attr('rel'))}return !1});if(a.folderEvent.toLowerCase!=='click'){$(c).find('LI A').on('click',function(){return !1})}}$(this).html('<ul class="filetree start"><li class="wait">'+a.loadMessage+'<li></ul>');showTree($(this),encodeURI(a.root))})}});L.Control.Attribution.include({_update:function(){if(!this._map){return}var b=[];for(var c in this._attributions){if(this._attributions[c]){b.push(c)}}var a=[];if(this.options.prefix){a.push(this.options.prefix)}if(b.length){a.push(b.join(', '))}this._container.innerHTML=a.join(' &#169; ')}});L.Map.addInitHook(function(){if(this.options.visiomaticLogo!==!1&&this.options.attributionControl){this.attributionControl.setPrefix('<a id="logo-visiomatic" class="leaflet-control-attribution-logo"'+'href="http://visiomatic.org">&nbsp;</a>'+'<a id="logo-iipimage" class="leaflet-control-attribution-logo"'+'href="http://iipimage.sourceforge.net">&nbsp;</a>'+'<a id="logo-leaflet" class="leaflet-control-attribution-logo"'+'href="http://leafletjs.com">&nbsp;</a>')}});L.Control.ExtraMap=L.Control.extend({options:{position:'bottomright',title:'Navigation mini-map. Grab to navigate',toggleDisplay:!0,zoomLevelFixed:!1,zoomLevelOffset:-5,zoomAnimation:!1,autoToggleDisplay:!1,width:150,height:150,collapsedWidth:24,collapsedHeight:24,aimingRectOptions:{color:'#FFFFFF',weight:1,clickable:!1},shadowRectOptions:{color:'#FDC82F',weight:1,clickable:!1,opacity:0,fillOpacity:0},strings:{hideText:'Hide map',showText:'Show map'}},initialize:function(b,a){L.Util.setOptions(this,a);this.options.aimingRectOptions.clickable=!1;this.options.shadowRectOptions.clickable=!1;this._layer=b},onAdd:function(a){this._mainMap=a;this._container=L.DomUtil.create('div','leaflet-control-extramap');this._container.style.width=this.options.width+'px';this._container.style.height=this.options.height+'px';this._container.title=this.options.title;L.DomEvent.disableClickPropagation(this._container);L.DomEvent.on(this._container,'mousewheel',L.DomEvent.stopPropagation);this._extraMap=new L.Map(this._container,{attributionControl:!1,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:!this._isZoomLevelFixed(),scrollWheelZoom:!this._isZoomLevelFixed(),doubleClickZoom:!this._isZoomLevelFixed(),boxZoom:!this._isZoomLevelFixed()});this._layer.addTo(this._extraMap);this._userToggledDisplay=!1;this._minimized=!1;if(this.options.toggleDisplay){this._addToggleButton()}this._layer.once('metaload',function(){this._mainMap.whenReady(L.Util.bind(function(){this._extraMap.whenReady(L.Util.bind(function(){this._aimingRect=L.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._extraMap);this._shadowRect=L.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._extraMap);this._mainMap.on('moveend',this._onMainMapMoved,this);this._mainMap.on('move',this._onMainMapMoving,this);this._extraMap.on('movestart',this._onExtraMapMoveStarted,this);this._extraMap.on('move',this._onExtraMapMoving,this);this._extraMap.on('moveend',this._onExtraMapMoved,this);this._extraMap.setView(this._mainMap.getCenter(),this._decideZoom(!0));this._setDisplay(this._decideMinimized())},this))},this))},this);return this._container},addTo:function(a){L.Control.prototype.addTo.call(this,a);return this},onRemove:function(a){this._mainMap.off('moveend',this._onMainMapMoved,this);this._mainMap.off('move',this._onMainMapMoving,this);this._extraMap.off('moveend',this._onExtraMapMoved,this);this._extraMap.removeLayer(this._layer)},changeLayer:function(a){this._extraMap.removeLayer(this._layer);this._layer=a;this._extraMap.addLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton('',this.options.strings.hideText,'leaflet-control-extramap-toggle-display '+'leaflet-control-extramap-toggle-display-'+this.options.position,this._container,this._toggleDisplayButtonClicked,this):undefined;this._toggleDisplayButton.style.width=this.options.collapsedWidth+'px';this._toggleDisplayButton.style.height=this.options.collapsedHeight+'px'},_createButton:function(g,f,c,d,h,e){var a=L.DomUtil.create('a',c,d);a.innerHTML=g;a.href='#';a.title=f;var b=L.DomEvent.stopPropagation;L.DomEvent.on(a,'click',b).on(a,'mousedown',b).on(a,'dblclick',b).on(a,'click',L.DomEvent.preventDefault).on(a,'click',h,e);return a},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0;if(!this._minimized){this._minimize();this._toggleDisplayButton.title=this.options.strings.showText}else {this._restore();this._toggleDisplayButton.title=this.options.strings.hideText}},_setDisplay:function(a){if(a!==this._minimized){if(!this._minimized){this._minimize()}else {this._restore()}}},_minimize:function(){if(this.options.toggleDisplay){this._container.style.width=this.options.collapsedWidth+'px';this._container.style.height=this.options.collapsedHeight+'px';this._toggleDisplayButton.className+=' minimized-'+this.options.position}else {this._container.style.display='none'}this._minimized=!0},_restore:function(){if(this.options.toggleDisplay){this._container.style.width=this.options.width+'px';this._container.style.height=this.options.height+'px';this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace('minimized-'+this.options.position,'')}else {this._container.style.display='block'}this._minimized=!1},_onMainMapMoved:function(a){if(!this._extraMapMoving){this._mainMapMoving=!0;this._extraMap.setView(this._mainMap.getCenter(),this._decideZoom(!0));this._setDisplay(this._decideMinimized())}else {this._extraMapMoving=!1}this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(a){this._aimingRect.setBounds(this._mainMap.getBounds())},_onExtraMapMoveStarted:function(d){var a=this._aimingRect.getBounds();var c=this._extraMap.latLngToContainerPoint(a.getSouthWest());var b=this._extraMap.latLngToContainerPoint(a.getNorthEast());this._lastAimingRectPosition={sw:c,ne:b}},_onExtraMapMoving:function(a){if(!this._mainMapMoving&&this._lastAimingRectPosition){this._shadowRect.setBounds(new L.LatLngBounds(this._extraMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._extraMap.containerPointToLatLng(this._lastAimingRectPosition.ne)));this._shadowRect.setStyle({opacity:1,fillOpacity:0.3})}},_onExtraMapMoved:function(a){if(!this._mainMapMoving){this._extraMapMoving=!0;this._mainMap.setView(this._extraMap.getCenter(),this._decideZoom(!1));this._shadowRect.setStyle({opacity:0,fillOpacity:0})}else {this._mainMapMoving=!1}},_isZoomLevelFixed:function(){var a=this.options.zoomLevelFixed;return this._isDefined(a)&&this._isInteger(a)},_decideZoom:function(b){if(!this._isZoomLevelFixed()){if(b){return this._mainMap.getZoom()+this.options.zoomLevelOffset}else {var d=this._extraMap.getZoom()-this._mainMap.getZoom();var c=this._extraMap.getZoom()-this.options.zoomLevelOffset;var a;if(d>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._extraMap.getMinZoom()-this.options.zoomLevelOffset){if(this._extraMap.getZoom()>this._lastExtraMapZoom){a=this._mainMap.getZoom()+1;this._extraMap.setZoom(this._extraMap.getZoom()-1)}else {a=this._mainMap.getZoom()}}else {a=c}this._lastExtraMapZoom=this._extraMap.getZoom();return a}}else {if(b){return this.options.zoomLevelFixed}else {return this._mainMap.getZoom()}}},_decideMinimized:function(){if(this._userToggledDisplay){return this._minimized}if(this.options.autoToggleDisplay){if(this._mainMap.getBounds().contains(this._extraMap.getBounds())){return !0}return !1}return this._minimized},_isInteger:function(a){return typeof a==='number'},_isDefined:function(a){return typeof a!=='undefined'}});L.Map.mergeOptions({extraMapControl:!1});L.Map.addInitHook(function(){if(this.options.extraMapControl){this.extraMapControl=(new L.Control.ExtraMap()).addTo(this)}});L.control.extraMap=function(b,a){return new L.Control.ExtraMap(b,a)};if(typeof require!=='undefined'){var jQuery=require('jquery-browser')}(function(){L.Control.FullScreen=L.Control.extend({options:{position:'topleft',title:'Toggle full screen mode',forceSeparateButton:!1},onAdd:function(b){var c='leaflet-control-zoom-fullscreen',a;if(b.zoomControl&&!this.options.forceSeparateButton){a=b.zoomControl._container}else {a=L.DomUtil.create('div','leaflet-bar')}this._createButton(this.options.title,c,a,this.toogleFullScreen,b);return a},_createButton:function(f,e,c,g,d){var b=L.DomUtil.create('a',e,c);b.href='#';b.title=f;L.DomEvent.addListener(b,'click',L.DomEvent.stopPropagation).addListener(b,'click',L.DomEvent.preventDefault).addListener(b,'click',g,d);L.DomEvent.addListener(c,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(c,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(c,a.fullScreenEventName,this._handleEscKey,d);L.DomEvent.addListener(document,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(document,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(document,a.fullScreenEventName,this._handleEscKey,d);return b},toogleFullScreen:function(){this._exitFired=!1;var b=this._container;if(this._isFullscreen){if(a.supportsFullScreen){a.cancelFullScreen(b)}else {L.DomUtil.removeClass(b,'leaflet-pseudo-fullscreen')}this.invalidateSize();this.fire('exitFullscreen');this._exitFired=!0;this._isFullscreen=!1}else {if(a.supportsFullScreen){a.requestFullScreen(b)}else {L.DomUtil.addClass(b,'leaflet-pseudo-fullscreen')}this.invalidateSize();this.fire('enterFullscreen');this._isFullscreen=!0}},_handleEscKey:function(){if(!a.isFullScreen(this)&&!this._exitFired){this.fire('exitFullscreen');this._exitFired=!0;this._isFullscreen=!1}}});L.Map.addInitHook(function(){if(this.options.fullscreenControl){this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions);this.addControl(this.fullscreenControl)}});L.control.fullscreen=function(a){return new L.Control.FullScreen(a)};var a={supportsFullScreen:!1,isFullScreen:function(){return !1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:'',prefix:''},c='webkit moz o ms khtml'.split(' ');if(typeof document.exitFullscreen!=='undefined'){a.supportsFullScreen=!0}else {for(var b=0,d=c.length;b<d;b++){a.prefix=c[b];if(typeof document[a.prefix+'CancelFullScreen']!=='undefined'){a.supportsFullScreen=!0;break}}}if(a.supportsFullScreen){a.fullScreenEventName=a.prefix+'fullscreenchange';a.isFullScreen=function(){switch(this.prefix){case '':return document.fullScreen;case 'webkit':return document.webkitIsFullScreen;default:return document[this.prefix+'FullScreen'];}};a.requestFullScreen=function(a){return this.prefix===''?a.requestFullscreen():a[this.prefix+'RequestFullScreen']()};a.cancelFullScreen=function(a){return this.prefix===''?document.exitFullscreen():document[this.prefix+'CancelFullScreen']()}}if(typeof jQuery!=='undefined'){jQuery.fn.requestFullScreen=function(){return this.each(function(){var b=jQuery(this);if(a.supportsFullScreen){a.requestFullScreen(b)}})}}window.fullScreenApi=a})();if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP=L.Control.extend({options:{title:'a control related to IIPImage',collapsed:!0,position:'topleft'},initialize:function(a,b){L.setOptions(this,b);this._className='leaflet-control-iip';this._id='leaflet-iipimage';this._layers=a},addTo:function(a){if(a._sidebar){this._sidebar=a;this._map=a._map;this._dialog=L.DomUtil.create('div',this._className+'-dialog');a.addTab(this._id,this._className,this.options.title,this._dialog,this._sideClass);this._map.on('layeradd',this._checkIIP,this);return a}else {return L.Control.prototype.addTo.call(this,a)}},onAdd:function(e){var c=this._className,d=this._id,a=this._container=L.DomUtil.create('div',c+' leaflet-bar');a.setAttribute('aria-haspopup',!0);L.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);this._dialog=L.DomUtil.create('div',c+'-dialog',a);if(this.options.collapsed){if(!L.Browser.android){L.DomEvent.on(a,'mouseover',this._expand,this).on(a,'mouseout',this._collapse,this)}var b=this._toggle=L.DomUtil.create('a',c+'-toggle leaflet-bar',a);b.href='#';b.id=d+'-toggle';b.title=this.options.title;if(L.Browser.touch){L.DomEvent.on(b,'click',L.DomEvent.stop).on(b,'click',this._expand,this)}else {L.DomEvent.on(b,'focus',this._expand,this)}this._map.on('click',this._collapse,this)}else {this._expand()}this._map.on('layeradd',this._checkIIP,this);return this._container},_checkIIP:function(b){var a=b.layer;if(!a||!a.iipdefault){return}this._layer=a;if(this._reloadFlag){a.once('load',this._resetDialog,this)}else {this._initDialog();this._reloadFlag=!0}},_initDialog:function(){},_resetDialog:function(){this._dialog.innerHTML='';this._initDialog()},_addDialogBox:function(b){var a=L.DomUtil.create('div',this._className+'-box',this._dialog);if(b){a.id=b}return a},_addDialogLine:function(c,b){var a=L.DomUtil.create('div',this._className+'-line',b),d=L.DomUtil.create('div',this._className+'-label',a);d.innerHTML=c;return a},_addDialogElement:function(a){return L.DomUtil.create('div',this._className+'-element',a)},_expand:function(){L.DomUtil.addClass(this._container,this._className+'-expanded')},_collapse:function(){this._container.className=this._container.className.replace(' '+this._className+'-expanded','')},getActiveBaseLayer:function(){return this._activeBaseLayer},_findActiveBaseLayer:function(){var b=this._layers;this._prelayer=undefined;for(var c in b){var a=b[c];if(!a.overlay){if(!a._map){this._prelayer=a}else {if(this._map.hasLayer(a)&&a.iipdefault){return a}}}}return undefined},_createButton:function(c,f,b,e,d){var a=L.DomUtil.create('a',c,f);a.target='_blank';if(b){a.id=c+'-'+b}if(e){L.DomEvent.on(a,'click touch',e,this)}if(d){a.title=d}return a},_createRadioButton:function(b,d,c,h,g,f){var a=L.DomUtil.create('input',b,d);a.type='radio';a.name=b;a.value=c;a.checked=h;if(g){L.DomEvent.on(a,'click touch',g,c)}var e=L.DomUtil.create('label',b,d);e.htmlFor=a.id=b+'-'+c;if(f){e.title=f}return a},_createSelectMenu:function(f,l,h,g,e,k,i){var j=L.DomUtil.create('div',f,l),b=L.DomUtil.create('select',f,j),d=document.createElement('option'),c=b.opt=[],a;d.text='choose';d.disabled=!0;if(!e||e<0){d.selected=!0}b.add(d,null);for(var m in h){a=parseInt(m,10);c[a]=document.createElement('option');c[a].text=h[a];c[a].value=a;if(g&&g[a]){c[a].disabled=!0}else {if(a===e){c[a].selected=!0}}b.add(c[a],null)}if(this._container&&!L.Browser.android&&this.options.collapsed){L.DomEvent.on(b,'mousedown',function(){L.DomEvent.off(this._container,'mouseout',this._collapse,this);this.collapsedOff=!0},this);L.DomEvent.on(this._container,'mouseover',function(){if(this.collapsedOff){L.DomEvent.on(this._container,'mouseout',this._collapse,this);this.collapsedOff=!1}},this)}if(k){L.DomEvent.on(b,'change keyup',k,this)}if(i){j.title=i}return b},_createColorPicker:function(c,i,g,f,e,h,d){var b=this,a=L.DomUtil.create('input',c,i);a.type='color';a.value=f;a.id=c+'-'+g;$(document).ready(function(){$(a).spectrum({showInput:!0,appendTo:'#'+b._id,showPaletteOnly:!0,togglePaletteOnly:!0,localStorageKey:h,change:function(b){a.value=b.toHexString()}}).on('show.spectrum',function(){if(b._container){L.DomEvent.off(b._container,'mouseout',b._collapse)}});if(e){$(a).on('change',e)}if(d){$('#'+a.id+'+.sp-replacer').prop('title',d)}});return a},_addSwitchInput:function(e,i,d,g,f,j,c){var h=this._addDialogLine(d,i),a=this._addDialogElement(h),b=L.flipswitch(a,{checked:c,id:j,title:f});b.on('change',function(){this._onInputChange(e,g,b.value())},this);return a},_addNumericalInput:function(e,k,d,g,f,n,c,j,m,l,h){var i=this._addDialogLine(d,k),b=this._addDialogElement(i),a=b.spinbox=L.spinbox(b,{step:j,dmin:m,dmax:l,initValue:c,title:f});a.on('change',function(){L.IIPUtils.flashElement(a._input);this._onInputChange(e,g,a.value(),h)},this);return b},_spinboxStep:function(c,a){var b=parseFloat((Math.abs(a===c?a:a-c)*0.01).toPrecision(1));return b===0?1:b},_onInputChange:function(b,e,c,d){var a=e.split(/\[|\]/);if(a[1]){b[a[0]][parseInt(a[1],10)]=c}else {b[a[0]]=c}if(d){d(b)}b.redraw()},_updateLayerList:function(){if(!this._dialog){return this}if(this._layerList){L.DomUtil.empty(this._layerList)}else {this._layerList=L.DomUtil.create('div','leaflet-control-iip'+'-layerlist',this._dialog)}for(var a in this._layers){this._addLayerItem(this._layers[a])}return this},_addLayerItem:function(a){var e=this,c=L.DomUtil.create('div','leaflet-control-iip-layer'),d=L.DomUtil.create('div','leaflet-control-iip-layerswitch',c);if(a.layer.notReady){L.DomUtil.create('div','leaflet-control-iip-activity',d)}else {var b,g=this._map.hasLayer(a.layer);b=document.createElement('input');b.type='checkbox';b.className='leaflet-control-iip-selector';b.defaultChecked=g;b.layerId=L.stamp(a.layer);L.DomEvent.on(b,'click',function(){var c,a,b,d=this._layerList.getElementsByTagName('input'),e=d.length;this._handlingClick=!0;for(c=0;c<e;c++){a=d[c];if(!('layerId' in a)){continue}b=this._layers[a.layerId];if(a.checked&&!this._map.hasLayer(b.layer)){b.layer.addTo(this._map)}else {if(!a.checked&&this._map.hasLayer(b.layer)){this._map.removeLayer(b.layer)}}}this._handlingClick=!1},this);d.appendChild(b)}var f=L.DomUtil.create('div','leaflet-control-iip-layername',c);f.innerHTML=' '+a.name;f.style.textShadow='0px 0px 5px '+a.layer.nameColor;this._createButton('leaflet-control-iip-trash',c,undefined,function(){e.removeLayer(a.layer);if(!a.notReady){e._map.removeLayer(a.layer)}},'Delete layer');this._layerList.appendChild(c);return c},addLayer:function(a,c,b){a.on('add remove',this._onLayerChange,this);var d=L.stamp(a);this._layers[d]={layer:a,name:c,index:b};return this._updateLayerList()},removeLayer:function(a){a.off('add remove',this._onLayerChange,this);a.fire('trash',{index:this._layers[L.stamp(a)].index});a.off('trash');delete this._layers[L.stamp(a)];return this._updateLayerList()},_onLayerChange:function(a){if(!this._handlingClick){this._updateLayerList()}var c=this._layers[L.stamp(a.target)],b=a.type==='add'?'overlayadd':'overlayremove';this._map.fire(b,c)}});L.control.iip=function(a,b){return new L.Control.IIP(a,b)};if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP.Catalog=L.Control.IIP.extend({defaultCatalogs:[L.Catalog.GAIA_DR1,L.Catalog['2MASS'],L.Catalog.SDSS,L.Catalog.PPMXL,L.Catalog.Abell],options:{title:'Catalog overlays',collapsed:!0,position:'topleft',nativeCelsys:!0,color:'#FFFF00',timeOut:30,authenticate:!1},initialize:function(a,b){L.setOptions(this,b);this._className='leaflet-control-iip';this._id='leaflet-iipcatalog';this._layers={};this._handlingClick=!1;this._sideClass='catalog';this._catalogs=a?a:this.defaultCatalogs},_initDialog:function(){var d=this._className,c=this._catalogs,g=this._addDialogBox(),e=this._addDialogLine('<a id="logo-cds" '+'href="http://cds.u-strasbg.fr">&nbsp;</a>',g),b=this._addDialogElement(e),f=this._createColorPicker(d+'-color',b,'catalog',this.options.color,!1,'iipCatalog','Click to set catalog color');var a=this._createSelectMenu(this._className+'-select',b,c.map(function(a){return a.name}),undefined,-1,undefined,'Select Catalog');L.DomEvent.on(a,'change keyup',function(){a.title=c[a.selectedIndex-1].attribution},this);b=this._addDialogElement(e);this._createButton(d+'-button',b,'catalog',function(){var d=a.selectedIndex-1;if(d>=0){var b=c[d];b.color=f.value;a.selectedIndex=0;a.title='Select Catalog';this._getCatalog(b,this.options.timeOut)}},'Query catalog')},_resetDialog:function(){},_getCatalog:function(d,n){var m=this,e=this._map,a=e.options.crs,l=a.forceNativeCelsys&&!this.options.nativeCelsys,c=l?a.celsysToEq(e.getCenter()):e.getCenter(),f=e.getPixelBounds(),g=e.getZoom(),i=new L.LayerGroup(null);i.notReady=!0;this.addLayer(i,d.name);if(d.authenticate){this.options.authenticate=d.authenticate}else {this.options.authenticate=!1}var o=Math.abs(Math.cos(c.lat*Math.PI/180)),b=l?[a.celsysToEq(e.unproject(f.min,g)),a.celsysToEq(e.unproject(L.point(f.min.x,f.max.y),g)),a.celsysToEq(e.unproject(f.max,g)),a.celsysToEq(e.unproject(L.point(f.max.x,f.min.y),g))]:[e.unproject(f.min,g),e.unproject(L.point(f.min.x,f.max.y),g),e.unproject(f.max,g),e.unproject(L.point(f.max.x,f.min.y),g)],h;if(a.forceNativeCelsys&&this.options.nativeCelsys){switch(a.celsyscode){case 'ecliptic':h='E2000.0';break;case 'galactic':h='G';break;case 'supergalactic':h='S';break;default:h='J2000.0';break;}}else {h='J2000.0'}if(d.regionType==='box'){var k=(Math.max(a._deltaLng(b[0],c),a._deltaLng(b[1],c),a._deltaLng(b[2],c),a._deltaLng(b[3],c))-Math.min(a._deltaLng(b[0],c),a._deltaLng(b[1],c),a._deltaLng(b[2],c),a._deltaLng(b[3],c)))*o,j=Math.max(b[0].lat,b[1].lat,b[2].lat,b[3].lat)-Math.min(b[0].lat,b[1].lat,b[2].lat,b[3].lat);if(j<1.0E-4){j=1.0E-4}if(k<1.0E-4){k=1.0E-4}L.IIPUtils.requestURL(L.Util.template(d.url,L.extend({sys:h,lng:c.lng.toFixed(6),lat:c.lat.toFixed(6),dlng:k.toFixed(4),dlat:j.toFixed(4),nmax:d.nmax+1,maglim:d.maglim})),'getting '+d.service+' data',function(b,a){m._loadCatalog(d,i,b,a)},this,n)}else {var p=Math.max(a.distance(b[0],c),a.distance(b[0],c),a.distance(b[0],c),a.distance(b[0],c));L.IIPUtils.requestURL(L.Util.template(d.url,L.extend({sys:h,lng:c.lng.toFixed(6),lat:c.lat.toFixed(6),dr:p.toFixed(4),nmax:d.nmax+1})),'querying '+d.service+' data',function(b,a){m._loadCatalog(d,i,b,a)},this,this.options.timeOut)}},_loadCatalog:function(a,f,g,b){if(b.readyState===4){if(b.status===200){var h=g._map.options.crs,i=b.responseText,c=a.toGeoJSON(i),e=L.geoJson(c,{onEachFeature:function(b,c){if(b.properties&&b.properties.items){c.bindPopup(a.popup(b))}},coordsToLatLng:function(a){if(h.forceNativeCelsys){var b=h.eqToCelsys(L.latLng(a[1],a[0]));return new L.LatLng(b.lat,b.lng,a[2])}else {return new L.LatLng(a[1],a[0],a[2])}},pointToLayer:function(b,c){return a.draw(b,c)},style:function(b){return {color:a.color,weight:2}}}),d;e.nameColor=a.color;e.addTo(g._map);this.removeLayer(f);if(c.features.length>a.nmax){c.features.pop();d=!0}this.addLayer(e,a.name+' ('+c.features.length.toString()+(d?'+ entries)':' entries)'));if(d){alert('Selected area is too large: '+a.name+' sample has been truncated to the first '+a.nmax+' sources.')}}else {if(b.status!==0){alert('Error '+b.status+' while querying '+a.service+'.')}this.removeLayer(f)}}}});L.control.iip.catalog=function(a,b){return new L.Control.IIP.Catalog(a,b)};if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP.Channel=L.Control.IIP.extend({options:{title:'Channel mixing',collapsed:!0,cMap:'grey',mixingMode:null,position:'topleft'},initialize:function(b,a){L.setOptions(this,a);this._className='leaflet-control-iip';this._id='leaflet-iipchannel';this._sideClass='channel';this._settings=[];this._initsettings=[]},saveSettings:function(b,d,e){if(!d[e]){d[e]={}}var a=d[e],f=b.iipNChannel;a.channel=b.iipChannel;a.cMap=b.iipCMap;a.rgb=[];for(var c=0;c<f;c++){a.rgb[c]=b.iipRGB[c].clone()}},loadSettings:function(b,e,g,d){var a=e[g],f=b.iipNChannel;if(!a){return}if(!d){b.iipChannel=a.channel}b.iipCMap=a.cMap;for(var c=0;c<f;c++){b.iipRGB[c]=a.rgb[c].clone()}},_initDialog:function(){var a=this,c=this._layer,f=this._className,e=this._dialog;this.saveSettings(c,this._initsettings,'mono');this.saveSettings(c,this._initsettings,'color');this.saveSettings(c,this._settings,'mono');this.saveSettings(c,this._settings,'color');this._mode=this.options.mixingMode?this.options.mixingMode:c.iipMode;var d=this._addDialogBox(),g=this._addDialogLine('Mode:',d),j=this._addDialogElement(g),i=L.DomUtil.create('div',f+'-radios',j),b,h;h=this._createRadioButton(f+'-radio',i,'mono',this._mode==='mono',function(){a.saveSettings(c,a._settings,a._mode);for(b=d.lastChild;b!==g;b=d.lastChild){d.removeChild(b)}for(b=e.lastChild;b!==d;b=e.lastChild){e.removeChild(b)}a._channelList=undefined;a.loadSettings(c,a._settings,'mono');a._initMonoDialog(c,d);a._mode='mono'},'Select mono-channel palettized mode');h=this._createRadioButton(f+'-radio',i,'color',this._mode!=='mono',function(){a.saveSettings(c,a._settings,a._mode);for(b=d.lastChild;b!==g;b=d.lastChild){d.removeChild(b)}for(b=e.lastChild;b!==d;b=e.lastChild){e.removeChild(b)}a.loadSettings(c,a._settings,'color');a._channelList=undefined;a._initColorDialog(c,d);a._mode='color'},'Select color mixing mode');if(a._mode==='mono'){a._initMonoDialog(c,d)}else {a._initColorDialog(c,d)}},_initMonoDialog:function(a,f){var k=this,l=a.iipChannelLabels,h=this._className,e=this._addDialogLine('Channel:',f),d=this._addDialogElement(e);a.updateMono();this._chanSelect=this._createSelectMenu(this._className+'-select',d,a.iipChannelLabels,undefined,a.iipChannel,function(){a.iipChannel=parseInt(this._chanSelect.selectedIndex-1,10);this._updateChannel(a,a.iipChannel);a.redraw()},'Select image channel');e=this._addDialogLine('LUT:',f);d=this._addDialogElement(e);var i=L.DomUtil.create('div',h+'-cmaps',d),j=[],c=['grey','jet','cold','hot'],g=function(){k._onInputChange(a,'iipCMap',this)},b;for(b in c){j[b]=this._createRadioButton('leaflet-cmap',i,c[b],c[b]===this.options.cMap,g,'"'+c[b].charAt(0).toUpperCase()+c[b].substr(1)+'" color-map')}this._addMinMax(a,a.iipChannel,f);a.redraw()},_initColorDialog:function(a,f){var b=this,d=this._className,e=this._addDialogLine('Channel:',f),c=this._addDialogElement(e),g=this._chanColPick=this._createColorPicker(d+'-color',c,'channel',a.iipRGB[a.iipChannel].toStr(),function(){var c=a.iipChannel,d=$(g).val();b._updateMix(a,c,L.rgb(d));b.collapsedOff=!0},'iipChannel','Click to set channel color');this._onInputChange(a,'iipCMap','grey');a.updateMix();this._chanSelect=this._createSelectMenu(this._className+'-select',c,a.iipChannelLabels,undefined,a.iipChannel,function(){a.iipChannel=this._chanSelect.selectedIndex-1;this._updateChannel(a,a.iipChannel,g)},'Select image channel');this._addMinMax(a,a.iipChannel,f);e=this._addDialogLine('Colors:',f);c=this._addDialogElement(e);this._createButton(d+'-button',c,'colormix-reset',function(){b.loadSettings(a,b._initsettings,'color',!0);a.updateMix();this._updateColPick(a);this._updateChannelList(a);a.redraw()},'Reset color mix');this._createButton(d+'-button',c,'colormix-auto',function(){var f=a.iipNChannel,g=0,c=0,e=a.iipRGB,d=a.iipdefault.channelColors;for(var b=0;b<f;b++){if(e[b].isOn()){c++}}if(c>=d.length){c=d.length-1}for(b=0;b<f;b++){if(e[b].isOn()&&g<c){e[b]=L.rgb(d[c][g++])}}a.updateMix();this._updateColPick(a);this._updateChannelList(a);a.redraw()},'Re-color active channels');b._updateChannelList(a);a.redraw()},_addMinMax:function(a,b,d){var c=this._spinboxStep(a.iipMinValue[b],a.iipMaxValue[b]);this._minElem=this._addNumericalInput(a,d,'Min:','iipMinValue['+b+']','Lower clipping limit in '+a.iipChannelUnits[b]+'.','leaflet-channel-minvalue',a.iipMinValue[b],c);this._maxElem=this._addNumericalInput(a,d,'Max:','iipMaxValue['+b+']','Upper clipping limit in '+a.iipChannelUnits[b]+'.','leaflet-channel-maxvalue',a.iipMaxValue[b],c)},_updateChannel:function(b,a,d){var c=this,e=this._spinboxStep(b.iipMinValue[a],b.iipMaxValue[a]);c._chanSelect.selectedIndex=a+1;if(d){$(d).spectrum('set',b.iipRGB[a].toStr());$(d).val(b.iipRGB[a].toStr()).off('change').on('change',function(){c._updateMix(b,a,L.rgb($(d).val()))})}this._minElem.spinbox.value(b.iipMinValue[a]).step(e).off('change').on('change',function(){c._onInputChange(b,'iipMinValue['+a+']',c._minElem.spinbox.value())},this);this._maxElem.spinbox.value(b.iipMaxValue[a]).step(e).off('change').on('change',function(){c._onInputChange(b,'iipMaxValue['+a+']',c._maxElem.spinbox.value())},this)},_updateMix:function(a,b,c){a.rgbToMix(b,c);this._updateChannelList(a);a.redraw()},_updateChannelList:function(b){var j=b.iipChannelLabels,e=this._channelList,l=this._channelElems,k=this._trashElems,a,d,h,f,g,i,c;if(e){L.DomUtil.empty(this._channelList)}else {e=this._channelList=L.DomUtil.create('div',this._className+'-chanlist',this._dialog)}l=this._channelElems=[];k=this._trashElems=[];for(i in j){c=parseInt(i,10);h=b.iipRGB[c];if(h.isOn()){a=L.DomUtil.create('div',this._className+'-channel',e);f=L.DomUtil.create('div',this._className+'-chancolor',a);f.style.backgroundColor=h.toStr();this._activateChanElem(f,b,c);g=L.DomUtil.create('div',this._className+'-chanlabel',a);g.innerHTML=j[i];this._activateChanElem(g,b,c);d=this._createButton('leaflet-control-iip-trash',a,undefined,undefined,'Delete channel');this._activateTrashElem(d,b,c);l.push(a);k.push(d)}}},_updateColPick:function(a){$(this._chanColPick).spectrum('set',a.iipRGB[a.iipChannel].toStr());$(this._chanColPick).val(a.iipRGB[a.iipChannel].toStr())},_activateTrashElem:function(c,a,b){L.DomEvent.on(c,'click touch',function(){this._updateMix(a,b,L.rgb(0,0,0));if(a===this._layer&&b===a.iipChannel){this._updateColPick(a)}},this)},_activateChanElem:function(c,a,b){L.DomEvent.on(c,'click touch',function(){a.iipChannel=b;this._updateChannel(a,b,this._chanColPick)},this)}});L.control.iip.channel=function(a){return new L.Control.IIP.Channel(a)};if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP.Doc=L.Control.IIP.extend({options:{title:'Documentation',collapsed:!0,position:'topleft',pdflink:undefined},initialize:function(b,a){L.setOptions(this,a);this._className='leaflet-control-iip';this._id='leaflet-iipdoc';this._sideClass='doc';this._url=b},_initDialog:function(){var h=this,a=this._className,i=this._layer,e=L.DomUtil.create('div',this._className+'-framebox',this._dialog),c=this._iframe=L.DomUtil.create('iframe',this._className+'-doc',e);c.src=this._url;c.frameborder=0;this._navHistory=[];this._navPos=0;this._ignore=!1;L.DomEvent.on(c,'load hashchange',this._onloadNav,this);var g=this._addDialogBox('leaflet-iipdoc-dialog'),f=this._addDialogLine('Navigate:',g),b=this._addDialogElement(f);this._homeButton=this._createButton(a+'-button',b,'home',this._homeNav,'Navigate home');this._backButton=this._createButton(a+'-button',b,'back',this._backNav,'Navigate backward');this._forwardButton=this._createButton(a+'-button',b,'forward',this._forwardNav,'Navigate forward');if(this.options.pdflink){var d=this._createButton(a+'-button',b,'pdf',undefined,'Download PDF version');d.href=this.options.pdflink}},_updateNav:function(a){if(a!==this._navPos){this._navPos=a;this._navIgnore=!0;this._iframe.src=this._navHistory[this._navPos-1];this._disableNav()}},_disableNav:function(){this._backButton.disabled=this._navPos===1;this._forwardButton.disabled=this._navPos>=this._navHistory.length},_backNav:function(){if(!this._backButton.disabled){this._updateNav(Math.max(1,this._navPos-1))}},_forwardNav:function(){if(!this._forwardButton.disabled){this._updateNav(Math.min(this._navHistory.length,this._navPos+1))}},_homeNav:function(){if(!this._backButton.disabled){this._updateNav(1)}},_onloadNav:function(){if(!0){var b=this._iframe.contentDocument.getElementsByTagName('a');for(var a=0;a<b.length;a++){if(L.IIPUtils.isExternal(b[a].href)){b[a].setAttribute('target','_blank')}}this._iframeLoad1=!0}if(!this._navIgnore){var c=this._iframe.contentWindow.location.href;if(c!==this._navHistory[this._navPos-1]){this._navHistory.splice(this._navPos,this._navHistory.length-this._navPos);this._navHistory.push(c);this._navPos=this._navHistory.length;this._disableNav()}}else {this._navIgnore=!1}}});L.control.iip.doc=function(b,a){return new L.Control.IIP.Doc(b,a)};if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP.Image=L.Control.IIP.extend({options:{title:'Image preferences',collapsed:!0,position:'topleft'},initialize:function(a){L.setOptions(this,a);this._className='leaflet-control-iip';this._id='leaflet-iipimage';this._sideClass='image'},_initDialog:function(){var c=this,b=this._className,a=this._layer,d=this._map;this._addSwitchInput(a,this._dialog,'Invert:','iipInvertCMap','Invert color map(s)','leaflet-invertCMap',a.iipInvertCMap);this._addNumericalInput(a,this._dialog,'Contrast:','iipContrast','Adjust Contrast. 1.0: normal.','leaflet-contrastValue',a.iipContrast,0.05,0,10);this._addNumericalInput(a,this._dialog,'Color Sat.:','iipColorSat','Adjust Color Saturation. 0: B&W, 1.0: normal.','leaflet-colorsatvalue',a.iipColorSat,0.05,0,5,this._updateMix);this._addNumericalInput(a,this._dialog,'Gamma:','iipGamma','Adjust Gamma correction. The standard value is 2.2.','leaflet-gammavalue',a.iipGamma,0.05,0.5,5);this._addNumericalInput(a,this._dialog,'JPEG quality:','iipQuality','Adjust JPEG compression quality. 1: lowest, 100: highest','leaflet-qualvalue',a.iipQuality,1,1,100)},_updateMix:function(b){var c=b.iipNChannel;for(var a=0;a<c;a++){b.rgbToMix(a)}return}});L.control.iip.image=function(a){return new L.Control.IIP.Image(a)};if(typeof require!=='undefined'){var $=require('jquery')}L.Control.IIP.Profile=L.Control.IIP.extend({options:{title:'Profile overlays',collapsed:!0,position:'topleft',profile:!0,profileColor:'#FF00FF',spectrum:!0,spectrumColor:'#A000FF'},initialize:function(a){L.setOptions(this,a);this._className='leaflet-control-iip';this._id='leaflet-iipprofile';this._layers={};this._sideClass='profile';this._handlingClick=!1},_initDialog:function(){var f=this,c=this.options,b=this._className,g=this._addDialogBox(),d,a;if(c.profile){d=this._addDialogLine('Profile:',g);a=this._addDialogElement(d);var e=this._createColorPicker(b+'-color',a,'profile',c.profileColor,!1,'iipProfile','Click to set line color');this._createButton(b+'-button',a,'start',function(){if(this._currProfileLine){this._updateLine()}else {var a=f._map,b=a.getCenter(),c=this._currProfileLine=L.polyline([b,b],{color:e.value,weight:7,opacity:0.5});c.nameColor=e.value;c.addTo(a);a.on('drag',this._updateLine,this)}},'Start drawing a profile line');this._createButton(b+'-button',a,'end',this._profileEnd,'End line and plot')}if(c.spectrum){d=this._addDialogLine('Spectrum:',g);a=this._addDialogElement(d);var h=this._createColorPicker(b+'-color',a,'spectrum',c.spectrumColor,!1,'iipSpectra','Click to set marker color');this._createButton(b+'-button',a,'spectrum',function(){var b=f._map,g=b.getCenter(),d=b.options.crs.options.nzoom-1,a=b.project(g,d).round(),e=b.unproject(a,d),i=this._spectrumMarker=L.circleMarker(e,{color:h.value,radius:6,title:'Spectrum'}).addTo(b),c=L.DomUtil.create('div',this._className+'-popup'),j=L.DomUtil.create('div',this._className+'-activity',c);c.id='leaflet-spectrum-plot';i.bindPopup(c,{minWidth:16,maxWidth:1024,closeOnClick:!1}).openPopup();L.IIPUtils.requestURL(this._layer._url.replace(/\&.*$/g,'')+'&PFL='+d.toString()+':'+a.x.toFixed(0)+','+a.y.toFixed(0)+'-'+a.x.toFixed(0)+','+a.y.toFixed(0),'getting IIP layer spectrum',this._plotSpectrum,this)},'Plot a spectrum at the current map position')}},_updateLine:function(g){var a=this._map,f=a.getCenter(),d=a.options.crs.options.nzoom-1,e=this._currProfileLine.getLatLngs(),c=a.project(e[0],d),b=a.project(a.getCenter(),d);if(Math.abs(c.x-b.x)>Math.abs(c.y-b.y)){b.y=c.y}else {b.x=c.x}e[1]=a.unproject(b,d);this._currProfileLine.redraw()},_profileEnd:function(){var c=this._map,k=c.getCenter(),f=this._profileLine=this._currProfileLine;c.off('drag',this._updateLine,this);this._currProfileLine=undefined;var d=L.DomUtil.create('div',this._className+'-popup'),j=L.DomUtil.create('div',this._className+'-activity',d);d.id='leaflet-profile-plot';f.bindPopup(d,{minWidth:16,maxWidth:1024,closeOnClick:!1}).openPopup();var e=c.options.crs.options.nzoom-1,g=f.getLatLngs(),a=c.project(g[0],e),b=c.project(g[1],e),h,i;if(b.x<a.x){h=b.x;b.x=a.x;a.x=h}if(b.y<a.y){i=b.y;b.y=a.y;a.y=i}L.IIPUtils.requestURL(this._layer._url.replace(/\&.*$/g,'')+'&PFL='+e.toString()+':'+a.x.toFixed(0)+','+a.y.toFixed(0)+'-'+b.x.toFixed(0)+','+b.y.toFixed(0),'getting IIP layer profile',this._plotProfile,this)},_getMeasurementString:function(){var e=this._currentLatLng,d=this._markers[this._markers.length-1].getLatLng(),a,c,b;a=this._measurementRunningTotal+L.IIPUtils.distance(e,d);if(a>=1){b='&#176;'}else {a*=60;if(a>=1){b='&#39;'}else {a*=60;b='&#34;'}}c=a.toFixed(2)+b;return c},_plotProfile:function(c,d){if(d.readyState===4){if(d.status===200){var m=JSON.parse(d.responseText),i=m.profile,a=c._layer,k=c._profileLine,j=document.getElementById('leaflet-profile-plot'),h=[],e=[],g,f;c.addLayer(k,'Image profile');if(a.iipMode==='mono'){h.push(c._extractProfile(a,i,a.iipChannel));e.push({color:'black'});g='Image profile for '+a.iipChannelLabels[a.iipChannel];f='Pixel value in '+a.iipChannelUnits[a.iipChannel]}else {var l=a.iipRGB;for(var b=0;b<a.iipNChannel;b++){if(l[b].isOn()){h.push(c._extractProfile(a,i,b));e.push({color:l[b].toStr(),label:a.iipChannelLabels[b]})}}g='Image profiles';f='Pixel value'}$(document).ready(function(){$.jqplot.config.enablePlugins=!0;$.jqplot('leaflet-profile-plot',h,{title:g,grid:{backgroundColor:'#ddd',gridLineColor:'#eee'},axes:{xaxis:{label:'position along line',labelRenderer:$.jqplot.CanvasAxisLabelRenderer,pad:1},yaxis:{label:f,labelRenderer:$.jqplot.CanvasAxisLabelRenderer,pad:1}},legend:{show:a.iipMode!=='mono',location:'ne'},highlighter:{show:!0,sizeAdjust:2,tooltipLocation:'n',tooltipAxes:'y',tooltipFormatString:'%.6g '+a.iipChannelUnits[a.iipChannel],useAxesFormatters:!1,bringSeriesToFront:!0},cursor:{show:!0,zoom:!0},series:e,seriesDefaults:{lineWidth:2,showMarker:!1}})});j.removeChild(j.childNodes[0]);k._popup.update()}}},_extractProfile:function(e,b,f){var d=[],c=e.iipNChannel,g=b.length/c;for(var a=0;a<g;a++){d.push(b[a*c+f])}return d},_plotSpectrum:function(c,d){if(d.readyState===4){if(d.status===200){var k=JSON.parse(d.responseText),j=k.profile,a=c._layer,e=c._spectrumMarker,f=document.getElementById('leaflet-spectrum-plot'),i=[],l=[],h,g;c.addLayer(e,'Image spectrum');for(var b=0;b<a.iipNChannel;b++){i.push([a.iipChannelLabels[b],c._extractAverage(a,j,b)])}h='Image Spectrum';g='Average pixel value';$(document).ready(function(){$.jqplot.config.enablePlugins=!0;$.jqplot('leaflet-spectrum-plot',[i],{title:h,grid:{backgroundColor:'#F0F0F0',gridLineColor:'#F8F8F8'},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:'6pt'}},yaxis:{label:g,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},highlighter:{show:!0,sizeAdjust:2,tooltipLocation:'n',tooltipAxes:'y',tooltipFormatString:'%.6g '+a.iipChannelUnits[a.iipChannel],useAxesFormatters:!1},cursor:{show:!0,zoom:!0},seriesDefaults:{lineWidth:2,showMarker:!1}})});f.removeChild(f.childNodes[0]);e._popup.update()}}},_extractAverage:function(f,c,g){var d=f.iipNChannel,a=c.length/d,e=0;if(a===0){return 0}for(var b=0;b<a;b++){e+=c[b*d+g]}return e/a}});L.control.iip.profile=function(a){return new L.Control.IIP.Profile(a)};L.Control.IIP.Region=L.Control.IIP.extend({options:{title:'Region overlays',collapsed:!0,position:'topleft',nativeCelsys:!0,color:'#00FFFF',timeOut:30},initialize:function(a,b){L.setOptions(this,b);this._className='leaflet-control-iip';this._id='leaflet-iipregion';this._layers={};this._handlingClick=!1;this._sideClass='region';this._regions=a&&a[0]?a:[]},_initDialog:function(){var f=this._className,a=this._regions,i=this._addDialogBox(),g=this._addDialogLine('Regions:',i),d=this._addDialogElement(g),h=this._createColorPicker(f+'-color',d,'region',this.options.color,!1,'iipRegion','Click to set region color');var e=this._regionSelect=this._createSelectMenu(this._className+'-select',d,a.map(function(a){return a.name}),a.map(function(a){return a.load?!0:!1}),-1,undefined,'Select region');d=this._addDialogElement(g);this._createButton(f+'-button',d,'region',function(){var a=e.selectedIndex-1;if(a>=0){var b=this._regions[a];b.color=h.value;e.selectedIndex=0;e.opt[a].disabled=!0;this._getRegion(b,this.options.timeOut)}},'Display region');var b;for(var c=0;c<a.length;c++){b=a[c];b.index=c;if(b.load===!0){if(!b.color){b.color=this.options.color}this._getRegion(a[c],this.options.timeOut)}}},_resetDialog:function(){},_getRegion:function(a,g){var c=this,d=this._map,e=d.options.crs,f=e.forceNativeCelsys&&!this.options.nativeCelsys,b=new L.LayerGroup(null);b.notReady=!0;this.addLayer(b,a.name);L.IIPUtils.requestURL(a.url,'loading '+a.name+' data',function(e,d){c._loadRegion(a,b,e,d)},this,this.options.timeOut)},_loadRegion:function(a,e,b,c){if(c.readyState===4){if(c.status===200){var f=b._map.options.crs,g=c.responseText,d=L.geoJson(JSON.parse(g),{onEachFeature:function(b,c){if(b.properties&&b.properties.description){c.bindPopup(b.properties.description)}else {if(a.description){c.bindPopup(a.description)}}},coordsToLatLng:function(a){if(f.forceNativeCelsys){var b=f.eqToCelsys(L.latLng(a[1],a[0]));return new L.LatLng(b.lat,b.lng,a[2])}else {return new L.LatLng(a[1],a[0],a[2])}},style:function(b){return {color:a.color,weight:2}},pointToLayer:function(c,b){return a.drawPoint?a.drawPoint(c,b):L.marker(b)}});d.nameColor=a.color;d.addTo(b._map);b.removeLayer(e);b.addLayer(d,a.name,a.index);L.DomEvent.on(d,'trash',function(a){if(a.index||a.index===0){b._regionSelect.opt[a.index].disabled=!1}},b)}else {if(c.status!==0){alert('Error '+c.status+' while downloading '+a.url+'.')}b.removeLayer(e);b._regionSelect.opt[a.index].disabled=!1}}}});L.control.iip.region=function(b,a){return new L.Control.IIP.Region(b,a)};if(typeof require!=='undefined'){var $=require('jquery'),html2canvas=require('html2canvas')}L.Control.IIP.Snapshot=L.Control.IIP.extend({options:{title:'Field snapshot',collapsed:!0,position:'topleft'},initialize:function(a){L.setOptions(this,a);this._className='leaflet-control-iip';this._id='leaflet-iipsnapshot';this._sideClass='snapshot'},_initDialog:function(){var i=this,f=this._className,a=this._layer,e=this._map;var d=this._addDialogLine('Snap:',this._dialog),c=this._addDialogElement(d),h=['Screen pixels','Native pixels'];this._snapType=0;this._snapSelect=this._createSelectMenu(this._className+'-select',c,h,undefined,this._snapType,function(){this._snapType=parseInt(this._snapSelect.selectedIndex-1,10)},'Select snapshot resolution');var b=document.createElement('a'),g=this._createButton(f+'-button',c,'snapshot',function(l){var j=e.getCenter(),c=e.getPixelBounds(),f=e.getZoom(),d;if(f>a.iipMaxZoom){d=Math.pow(2,f-a.iipMaxZoom);f=a.iipMaxZoom}else {d=1}var h=a.iipImageSize[f].x*d,i=a.iipImageSize[f].y*d,g=c.max.x-c.min.x,k=c.max.y-c.min.y;b.href=a.getTileUrl({x:1,y:1}).replace(/JTL\=\d+\,\d+/g,'RGN='+c.min.x/h+','+c.min.y/i+','+g/h+','+k/i+'&WID='+(this._snapType===0?Math.floor(g/d):Math.floor(g/d/a.wcs.scale(f)))+'&CVT=jpeg');b.download=a._title+'_'+L.IIPUtils.latLngToHMSDMS(j).replace(/[\s\:\.]/g,'')+'.jpg';b.click()},'Take a snapshot of the displayed image');document.body.appendChild(b);d=this._addDialogLine('Print:',this._dialog);c=this._addDialogElement(d);g=this._createButton(f+'-button',c,'print',function(b){var a=document.querySelector('#map > .leaflet-control-container');a.style.display='none';window.print();a.style.display='unset'},'Print current map')}});L.control.iip.snapshot=function(a){return new L.Control.IIP.Snapshot(a)};if(typeof require!=='undefined'){var $=require('jquery-browser')}L.Control.Layers.IIP=L.Control.Layers.extend({options:{title:'overlay menu',collapsed:!0,position:'topright',autoZIndex:!0,fileMenu:!1,fileURL:'/fcgi-bin/iipsrv.fcgi?FIF=',fileRoot:'',fileTreeScript:'visiomatic/dist/filetree.php',fileProcessScript:'visiomatic/dist/processfits.php'},onAdd:function(a){a._layerControl=this;this._initLayout();this._update();return this._container},_initLayout:function(){var a='leaflet-control-layers',b=this._container=L.DomUtil.create('div',a);b.setAttribute('aria-haspopup',!0);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(b).disableScrollPropagation(b)}else {L.DomEvent.on(b,'click',L.DomEvent.stopPropagation)}var c=this._form=L.DomUtil.create('form',a+'-list');if(this.options.collapsed){if(!L.Browser.android){L.DomEvent.on(b,{mouseover:this._expand,mouseout:this._collapse},this)}var d=this._layersLink=L.DomUtil.create('a',a+'-toggle',b);d.href='#';d.title='Layers';if(L.Browser.touch){L.DomEvent.on(d,'click',L.DomEvent.stop).on(d,'click',this._expand,this)}else {L.DomEvent.on(d,'focus',this._expand,this)}L.DomEvent.on(c,'click',function(){setTimeout(L.bind(this._onInputClick,this),0)},this);this._map.on('click',this._collapse,this)}else {this._expand()}this._baseLayersList=L.DomUtil.create('div',a+'-base',c);if(this.options.fileMenu){var e=this._addButton=L.DomUtil.create('input',a+'-add',c);e.type='button';e.value='Add...';L.DomEvent.on(e,'click',this._openFileMenu,this)}this._separator=L.DomUtil.create('div',a+'-separator',c);this._overlaysList=L.DomUtil.create('div',a+'-overlays',c);b.appendChild(c)},_addItem:function(a){var g=this,c=L.DomUtil.create('div','leaflet-control-layers-item'),e=L.DomUtil.create('div','leaflet-control-layers-select',c);if(a.layer.notReady){L.DomUtil.create('div','leaflet-control-activity',e)}else {var b,f=this._map.hasLayer(a.layer);if(a.overlay){b=document.createElement('input');b.type='checkbox';b.className='leaflet-control-layers-selector';b.defaultChecked=f}else {b=this._createRadioElement('leaflet-base-layers',f)}b.layerId=L.stamp(a.layer);L.DomEvent.on(b,'click',this._onInputClick,this);e.appendChild(b)}var h=L.DomUtil.create('div','leaflet-control-layers-name',c);h.innerHTML=' '+a.name;h.style.textShadow='0px 0px 5px '+a.layer.nameColor;var d=L.DomUtil.create('input','leaflet-control-layers-trash',c);d.type='button';L.DomEvent.on(d,'click',function(){g.removeLayer(a.layer);if(!a.notReady){g._map.removeLayer(a.layer)}},this);var i=a.overlay?this._overlaysList:this._baseLayersList;i.appendChild(c);return c},_onInputClick:function(){var c,a,b,d=this._form.getElementsByTagName('input'),e=d.length;this._handlingClick=!0;for(c=0;c<e;c++){a=d[c];if(!('layerId' in a)){continue}b=this._layers[a.layerId];if(a.checked&&!this._map.hasLayer(b.layer)){b.layer.addTo(this._map)}else {if(!a.checked&&this._map.hasLayer(b.layer)){this._map.removeLayer(b.layer)}}}this._handlingClick=!1},_addDialogLine:function(c,b){var a=L.DomUtil.create('div',this._className+'-element',b),d=L.DomUtil.create('span',this._className+'-label',a);d.innerHTML=c;return a},_openFileMenu:function(){var a=this,b=L.DomUtil.create('div','leaflet-control-filemenu',this._map._controlContainer);b.title='Open file';this._addButton.disabled=!0;L.DomEvent.disableClickPropagation(b).disableScrollPropagation(b);$('.leaflet-control-filemenu').dialog({appendTo:'body',close:function(c,d){L.DomUtil.remove(b);a._addButton.disabled=!1},show:{effect:'clip',duration:250},hide:{effect:'clip',duration:250},height:200});var c=L.DomUtil.create('div','leaflet-control-filetree',b);c.id='leaflet-filetree';$(document).ready(function(){$('#leaflet-filetree').fileTree({root:a.options.fileRoot,script:a.options.fileTreeScript},function(d){var c=a._map._layerControl,e=d.replace(/(^.*\/|\..*$)/g,''),b;if(c){b=new L.LayerGroup(null);b.notReady=!0;c.addBaseLayer(b,'converting '+e+'...');if(c.options.collapsed){c._expand()}}$.post(a.options.fileProcessScript,{fitsname:d},function(d){d=d.trim();var c=L.tileLayer.iip(a.options.fileURL+d,{title:e});if(c.iipMetaReady){a._updateBaseLayer(b,c)}else {c.once('metaload',function(){a._updateBaseLayer(b,c)})}})})})},_updateBaseLayer:function(d,c){var a=this._map,b=a._layerControl;b.removeLayer(d);a.eachLayer(a.removeLayer);c.addTo(a);b.addBaseLayer(c,c._title);a.fire('baselayerchange');if(b.options.collapsed){b._collapse()}}});L.control.layers.iip=function(a,b,c){return new L.Control.Layers.IIP(a,b,c)};L.Control.Reticle=L.Control.extend({options:{position:'bottomleft'},onAdd:function(d){var b=this._reticle=L.DomUtil.create('div','leaflet-reticle',this._map._controlContainer),a=b.style;a.position='absolute';a.left='50%';a.bottom='50%';a.textAlign='center';a.verticalAlign='middle';a.pointerEvents='none';b.innerHTML='';var c=this._container=L.DomUtil.create('div','leaflet-dummy');return c},onRemove:function(a){this._reticle.parentNode.removeChild(this._reticle)}});L.control.reticle=function(a){return new L.Control.Reticle(a)};L.Control.Scale.WCS=L.Control.Scale.extend({options:{position:'bottomleft',title:'Scale',maxWidth:128,metric:!1,imperial:!1,degrees:!0,pixels:!0,custom:!1,customScale:1,customUnits:'',planetRadius:6378137,updateWhenIdle:!1},_addScales:function(a,b,c){if(a.metric){this._mScale=L.DomUtil.create('div',b,c);this._mScale.title=a.metricTitle?a.metricTitle:a.title}if(a.imperial){this._iScale=L.DomUtil.create('div',b,c);this._iScale.title=a.imperialTitle?a.imperialTitle:a.title}if(a.degrees){this._dScale=L.DomUtil.create('div',b,c);this._dScale.title=a.degreesTitle?a.degreesTitle:a.title}if(a.pixels){this._pScale=L.DomUtil.create('div',b,c);this._pScale.title=a.pixelsTitle?a.pixelsTitle:a.title}if(a.custom){this._cScale=L.DomUtil.create('div',b,c);this._cScale.title=a.customTitle?a.customTitle:a.title}this.angular=a.metric||a.imperial||a.degrees},_update:function(){var a=this.options,c=this._map,b=c.options.crs;if(a.pixels&&b.options&&b.options.nzoom){var g=Math.pow(2,b.options.nzoom-1-c.getZoom());this._updatePixels(g*a.maxWidth)}if(a.custom&&b.options&&b.options.nzoom){var f=Math.pow(2,b.options.nzoom-1-c.getZoom())*a.customScale;this._updateCustom(f*a.maxWidth,a.customUnits)}if(this.angular){var e=c.getCenter(),h=Math.cos(e.lat*Math.PI/180),i=Math.sqrt(this._jacobian(e))*h,d=i*a.maxWidth;if(a.metric){this._updateMetric(d*Math.PI/180*a.planetRadius)}if(a.imperial){this._updateImperial(d*Math.PI/180*a.planetRadius)}if(a.degrees){this._updateDegrees(d)}}},_jacobian:function(a){var b=this._map,e=b.project(a),c=b.unproject(e.add([10,0])),d=b.unproject(e.add([0,10]));return 0.01*Math.abs((c.lng-a.lng)*(d.lat-a.lat)-(d.lng-a.lng)*(c.lat-a.lat))},_updateCustom:function(a,c){var b=this._cScale;if(a>1000000000){var d=a*1.0E-9,g=this._getRoundNum(d);this._updateScale(b,g+' G'+c,g/d)}else {if(a>1000000){var f=a*1.0E-6,i=this._getRoundNum(f);this._updateScale(b,i+' M'+c,i/f)}else {if(a>1000){var e=a*0.001,h=this._getRoundNum(e);this._updateScale(b,h+' k'+c,h/e)}else {var j=this._getRoundNum(a);this._updateScale(b,j+' '+c,j/a)}}}},_updatePixels:function(a){var b=this._pScale;if(a>1000000){var d=a*1.0E-6,f=this._getRoundNum(d);this._updateScale(b,f+' Mpx',f/d)}else {if(a>1000){var c=a*0.001,e=this._getRoundNum(c);this._updateScale(b,e+' kpx',e/c)}else {var g=this._getRoundNum(a);this._updateScale(b,g+' px',g/a)}}},_updateDegrees:function(b){var a=b*3600,c=this._dScale;if(a<1){var h=a*1000,i=this._getRoundNum(h);this._updateScale(c,i+' mas',i/h)}else {if(a<60){var g=this._getRoundNum(a);this._updateScale(c,g+' &#34;',g/a)}else {if(a<3600){var d=b*60,f=this._getRoundNum(d);this._updateScale(c,f+' &#39;',f/d)}else {var e=this._getRoundNum(b);this._updateScale(c,e+' &#176;',e/b)}}}}});L.control.scale.wcs=function(a){return new L.Control.Scale.WCS(a)};L.Control.Sidebar=L.Control.extend({includes:L.Mixin.Events,options:{position:'left',title:'Toggle advanced menu',collapsed:!0,forceSeparateButton:!1},initialize:function(a){var c,b;L.setOptions(this,a);this._sidebar=L.DomUtil.create('div','leaflet-container sidebar');if(this.options.collapsed){L.DomUtil.addClass(this._sidebar,'collapsed')}else {L.DomUtil.addClass(this._sidebar,'closed')}L.DomUtil.addClass(this._sidebar,'sidebar-'+this.options.position);if(L.Browser.touch){L.DomUtil.addClass(this._sidebar,'leaflet-touch')}this._tabs=L.DomUtil.create('div','sidebar-tabs',this._sidebar);this._tabitems=[];this._container=L.DomUtil.create('div','sidebar-content',this._sidebar);this._panes=[];this._closeButtons=[]},addTo:function(a){var d='leaflet-control-zoom-sidebar',c=a._controlContainer,b;L.DomUtil.addClass(a._container,'sidebar-map');c.insertBefore(this._sidebar,c.firstChild);L.DomEvent.disableClickPropagation(this._sidebar).disableScrollPropagation(this._sidebar);this._map=a;if(a.zoomControl&&!this.options.forceSeparateButton){b=a.zoomControl._container}else {b=L.DomUtil.create('div','leaflet-bar')}this._toggleButton=this._createButton(this.options.title,d+(this.options.collapsed?' collapsed':''),b);return this},addTabList:function(){this._tablist=L.DomUtil.create('ul','',this._tabs);this._tablist.setAttribute('role','tablist');return this._tablist},addTab:function(d,i,h,j,f){var k=this._tablist?this._tablist:this.addTabList(),a=L.DomUtil.create('li','',k),c=L.DomUtil.create('a',i,a);a.setAttribute('role','tab');a._sidebar=this;c.href='#'+d;c.id=d+'-toggle';c.title=h;L.DomEvent.on(c,'click',L.DomEvent.preventDefault);L.DomEvent.on(c,'click',this._onClick,a);a.sideClass=f;this._tabitems.push(a);var b=L.DomUtil.create('div','sidebar-pane',this._container),g=L.DomUtil.create('h1','sidebar-header',b);g.innerHTML=h;var e=L.DomUtil.create('div','sidebar-close',g);this._closeButtons.push(e);L.DomEvent.on(e,'click',this._onCloseClick,this);b.id=d;b.sideClass=f;b.appendChild(j);this._panes.push(b);return b},removeFrom:function(c){var a,b;this._map=null;for(a=this._tabitems.length-1;a>=0;a--){b=this._tabitems[a];L.DomEvent.off(b.querySelector('a'),'click',this._onClick)}for(a=this._closeButtons.length-1;a>=0;a--){b=this._closeButtons[a];L.DomEvent.off(b,'click',this._onCloseClick,this)}return this},open:function(c){var b,a;for(b=this._panes.length-1;b>=0;b--){a=this._panes[b];if(a.id===c){L.DomUtil.addClass(a,'active');if(a.sideClass){L.DomUtil.addClass(this._sidebar,a.sideClass)}}else {if(L.DomUtil.hasClass(a,'active')){L.DomUtil.removeClass(a,'active');if(a.sideClass){L.DomUtil.removeClass(this._sidebar,a.sideClass)}}}}for(b=this._tabitems.length-1;b>=0;b--){a=this._tabitems[b];if(a.querySelector('a').hash==='#'+c){L.DomUtil.addClass(a,'active')}else {if(L.DomUtil.hasClass(a,'active')){L.DomUtil.removeClass(a,'active')}}}this.fire('content',{id:c});if(L.DomUtil.hasClass(this._sidebar,'closed')){this.fire('opening');L.DomUtil.removeClass(this._sidebar,'closed')}return this},close:function(){for(var b=this._tabitems.length-1;b>=0;b--){var a=this._tabitems[b];if(L.DomUtil.hasClass(a,'active')){L.DomUtil.removeClass(a,'active');if(a.sideClass){L.DomUtil.removeClass(this._sidebar,a.sideClass)}}}if(!L.DomUtil.hasClass(this._sidebar,'closed')){this.fire('closing');L.DomUtil.addClass(this._sidebar,'closed')}return this},toggle:function(){this.close();if(L.DomUtil.hasClass(this._sidebar,'collapsed')){L.DomUtil.addClass(this._sidebar,'closed');this.fire('expanding');L.DomUtil.removeClass(this._sidebar,'collapsed');L.DomUtil.removeClass(this._toggleButton,'collapsed')}else {L.DomUtil.removeClass(this._sidebar,'closed');this.fire('collapsing');L.DomUtil.addClass(this._sidebar,'collapsed');L.DomUtil.addClass(this._toggleButton,'collapsed')}},_onClick:function(){if(L.DomUtil.hasClass(this,'active')){this._sidebar.close()}else {if(!L.DomUtil.hasClass(this,'disabled')){this._sidebar.open(this.querySelector('a').hash.slice(1))}}},_onCloseClick:function(){this.close()},_createButton:function(d,b,c){var a=L.DomUtil.create('a',b,c);a.href='#';a.title=d;L.DomEvent.addListener(a,'click',L.DomEvent.stopPropagation).addListener(a,'click',L.DomEvent.preventDefault).addListener(a,'click',this.toggle,this);return a}});L.control.sidebar=function(b,a){return new L.Control.Sidebar(b,a)};L.Control.WCS=L.Control.extend({options:{position:'bottomleft',title:'Center coordinates. Click to change',coordinates:[{label:'RA, Dec',units:'HMS',nativeCelsys:!1}],centerQueryKey:'center',fovQueryKey:'fov'},onAdd:function(f){var k=this,e='leaflet-control-wcs',h=this._wcsdialog=L.DomUtil.create('div',e+'-dialog'),c=L.DomUtil.create('select',e+'-select',h),l=document.createElement('option'),j=this.options.coordinates,d=[],g;L.DomEvent.disableClickPropagation(c);this._currentCoord=0;c.id='leaflet-coord-select';c.title='Switch coordinate system';for(var b in j){d[b]=document.createElement('option');d[b].text=j[b].label;g=parseInt(b,10);d[b].value=g;if(g===0){d[b].selected=!0}c.add(d[b],null)}L.DomEvent.on(c,'change',function(a){k._currentCoord=c.value;k._onDrag()});var a=this._wcsinput=L.DomUtil.create('input',e+'-input',h);L.DomEvent.disableClickPropagation(a);a.type='text';a.title=this.options.title;if('webkitSpeechRecognition' in window){a.setAttribute('x-webkit-speech','x-webkit-speech')}f.on('move zoomend',this._onDrag,this);L.DomEvent.on(a,'focus',function(){this.setSelectionRange(0,this.value.length)},a);L.DomEvent.on(a,'change',function(){this.panTo(this._wcsinput.value)},this);var i=L.DomUtil.create('div',e+'-clipboard',h);i.title='Copy to clipboard';L.DomEvent.on(i,'click',function(){var c={},a=location.href,d=this._map.options.crs,b=f.getCenter();L.IIPUtils.flashElement(this._wcsinput);a=L.IIPUtils.updateURL(a,this.options.centerQueryKey,L.IIPUtils.latLngToHMSDMS(b));a=L.IIPUtils.updateURL(a,this.options.fovQueryKey,d.zoomToFov(f,f.getZoom(),b).toPrecision(4));history.pushState(c,'',a);L.IIPUtils.copyToClipboard(a)},this);return this._wcsdialog},onRemove:function(a){a.off('drag',this._onDrag)},_onDrag:function(d){var a=this._map.getCenter(),b=this._map.options.crs,c=this.options.coordinates[this._currentCoord];if(b.pixelFlag){this._wcsinput.value=a.lng.toFixed(0)+' , '+a.lat.toFixed(0)}else {if(!c.nativeCelsys&&b.forceNativeCelsys){a=b.celsysToEq(a)}else {if(c.nativeCelsys&&b.forceNativeCelsys===!1){a=b.eqToCelsys(a)}}switch(c.units){case 'HMS':this._wcsinput.value=L.IIPUtils.latLngToHMSDMS(a);break;case 'deg':this._wcsinput.value=a.lng.toFixed(5)+' , '+a.lat.toFixed(5);break;default:this._wcsinput.value=a.lng.toFixed(1)+' , '+a.lat.toFixed(1);break;}}},panTo:function(c){var e=/^(-?\d+\.?\d*)\s*,\s*\+?(-?\d+\.?\d*)/g,f=e.exec(c),b=this._map.options.crs,d=this.options.coordinates[this._currentCoord],a=b.parseCoords(c);if(a){if(b.pixelFlag){this._map.panTo(a)}else {if(!d.nativeCelsys&&b.forceNativeCelsys){a=b.eqToCelsys(a)}else {if(d.nativeCelsys&&b.forceNativeCelsys===!1){a=b.celsysToEq(a)}}this._map.panTo(a)}}else {L.IIPUtils.requestURL('http://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-oI/A?'+c,'getting coordinates for '+c,this._getCoordinates,this,10)}},_getCoordinates:function(b,a){if(a.readyState===4){if(a.status===200){var d=a.responseText,c=b._map.options.crs.parseCoords(d,!0);if(c){b._map.panTo(c);b._onDrag()}else {alert(d+': Unknown location')}}else {alert('There was a problem with the request to the Sesame service at CDS')}}}});L.Map.mergeOptions({positionControl:!1});L.Map.addInitHook(function(){if(this.options.positionControl){this.positionControl=new L.Control.MousePosition();this.addControl(this.positionControl)}});L.control.wcs=function(a){return new L.Control.WCS(a)};